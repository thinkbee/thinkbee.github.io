<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>태그: MongoDB - Blogging through Programming</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="thinkbee blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="thinkbee blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Blogging through Programming"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Blogging through Programming"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Blogging through Programming","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"publisher":{"@type":"Organization","name":"Blogging through Programming","logo":{"@type":"ImageObject","url":"http://example.com/images/thinkbee_logo.png"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1465716454138955" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 6.0.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">태그</a></li><li class="is-active"><a href="#" aria-current="page">MongoDB</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-10-30T00:00:00.000Z" title="2017-10-30 9:00:00">2017-10-30</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:45:45.946Z" title="2022-2-25 1:45:45">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Raspberry-Pi/">Raspberry Pi</a><span> / </span><a class="link-muted" href="/categories/Raspberry-Pi/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Raspberry-Pi/Linux/Database/">Database</a></span><span class="level-item">15분안에 읽기 (약 2238 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/10/30/raspberrypi-2017-10-30-opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></h1><div class="content"><p><strong>Raspberry Pi 3 64bit OS openSUSE</strong> 는 이글은 4개 글타래로 구성되며, openSUSE 설치 및 사용에 대해 작성한다.</p>
<p>Opensuse 에서 Raspberry Pi 3를 위한 64bit OS openSESE Leap 42.2 을 제공하고 있다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://en.opensuse.org/HCL:Raspberry_Pi3">https://en.opensuse.org/HCL:Raspberry_Pi3</a></li>
</ul>
<ol>
<li><a href="!--swig%EF%BF%BC32--">Install 64bit openSUSE Leap 42.2 &#x2F; JeOS</a></li>
<li>openSUSE: Managing Service daemon</li>
<li>openSUSE: Basic OS Security for Server</li>
<li>Install &amp; Configuration - Nginx, Node JS</li>
<li>Build MongoDB 3.4.x</li>
</ol>
<h2 id="MongoDB-Community-Edition-설치"><a href="#MongoDB-Community-Edition-설치" class="headerlink" title="MongoDB Community Edition 설치"></a>MongoDB Community Edition 설치</h2><p>Opensuse 용 MongoDB가 제공되지만 AMD64, X64 관련한 플랫폼에 지원될 뿐이다. Raspberry Pi 3에 JeOS를 설치하고 네이티브로 빌드해보기로 했다.</p>
<h3 id="준비"><a href="#준비" class="headerlink" title="준비"></a>준비</h3><p>MongoDB 빌드를 위해서 git, gcc 등, Scons 가 필요하다.</p>
<h4 id="컴파일-환경-준비"><a href="#컴파일-환경-준비" class="headerlink" title="컴파일 환경 준비"></a>컴파일 환경 준비</h4><p>최신 <strong>master branch</strong>는,</p>
<ul>
<li>최신 C++11 compiler:<ul>
<li>VS2015 Update 2 or newer</li>
<li>GCC 5.3.0</li>
<li>Clang 3.4 (or Apple XCode 5.1.1 Clang) or newer</li>
</ul>
</li>
<li>Python 2.7</li>
<li>SCons 2.3.5 or newer (for MSVC 2015 support)</li>
</ul>
<p><strong>branch 3.2, 3.0</strong> 는</p>
<ul>
<li>C++11 compiler:<ul>
<li>VS2013 Update 4 or newer. Note that VS2015 is currently not compatible with the 3.0 and 3.2 branches. You must use VS2013.</li>
<li>GCC 4.8.2 or newer. Note that versions of GCC newer than 4.8.2 may produce warnings when building these branches, which are promoted to errors. Please use the –disable-warnings-as-errors build option if necessary to allow the build to succeed despite the warnings.</li>
</ul>
</li>
<li>Python 2.7</li>
<li>SCons 2.3.0 or newer</li>
</ul>
<h3 id="필요한-패키지"><a href="#필요한-패키지" class="headerlink" title="필요한 패키지"></a>필요한 패키지</h3><p>여기서는 터미널에서 openSUSE <code>yast</code> 사용해 관련 패키지를 설치한다. <code>yast</code>를 시작한다.<br><em>YaST -&gt; Software -&gt; Software Management</em> 를 선택한다.</p>
<p>![][&#x2F;images&#x2F;opensuse&#x2F;yast-sw2.png]</p>
<h4 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h4><p>gcc 을 선택한다. gcc를 선택하면 gcc-4.8 을 기본으로 설치한다.</p>
<p>![][&#x2F;images&#x2F;opensuse&#x2F;yast-sw-gcc.png]</p>
<p>여러 버전을 설치하면 gcc 를 선택하기 위해 <code>update-alternatives</code>을 사용한다. 링크 <a href="/linux/linux-update-alternatives/">update-alternatives</a> 에서 설명을 볼 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/gcc gcc \</span><br><span class="line">/usr/bin/gcc-4.8 10 --slave /usr/bin/g++ g++ /usr/bin/g++-4.8</span><br><span class="line">$ sudo update-alternatives --install /usr/bin/gcc gcc \</span><br><span class="line">/usr/bin/gcc-6 30 --slave /usr/bin/g++ g++ /usr/bin/g++-6</span><br></pre></td></tr></table></figure>

<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><p>검색어에 다음 패키지를 넣고 찾아 하나씩 <strong>+</strong> 키로 패키지를 선택한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git python python-pip python-devel python3 python3-pip python3-devel</span><br></pre></td></tr></table></figure>

<p><em>Search Phrase</em>에 다음 패키지를 찾아 개발관련 라이브러리를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">build-essential libboost-filesystem-dev libboost-program-options-dev</span><br><span class="line"> libboost-system-dev libboost-thread-dev -y</span><br></pre></td></tr></table></figure>

<p><em>yast-sw-devel_basis</em> 패키지를 찾아 설치한다.</p>
<p><img src="/images/opensuse/yast-sw-devel_basis.png">{:width&#x3D;”640”}</p>
<p><em>Search Phrase</em> 에 gcc 를 넣고 적절한 버전을 선택한다.</p>
<p><img src="/images/opensuse/yast-sw-gcc.png">{:width&#x3D;”640”}</p>
<p>그리고 Action 탭에서 설치를 실행한다.</p>
<p><img src="/images/opensuse/yast-sw-gcc3.png">{:width&#x3D;”640”}</p>
<p>ssl 지원을 위해서 Debian과 Ubuntu systems에서 SSL 지원을 위해서 <strong>libssl-dev</strong> 가 필요하다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install libopenssl-devel</span><br></pre></td></tr></table></figure>

<!--

#### zypper 로 설치



zypper in devel_basis

Opensuse for Ubuntu/Debian users
>
개발관련 라이브러리를 설치한다.
>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git python python-pip python-dev python3 python3-pip python3-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build-essential libboost-filesystem-dev libboost-program-options-dev libboost-system-dev libboost-thread-dev -y</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<h4 id="SCons"><a href="#SCons" class="headerlink" title="SCons"></a>SCons</h4><p>mongodb 3.x는 scons를 최신버전으로 요구한다. Suse LEAP은 <code>scons</code> 가 2.3 버전이지만, 여기서 최신 버전 2.5.1 버전을 다운로드해서 설치했다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://prdownloads.sourceforge.net/scons/scons-2.5.1.tar.gz</span><br><span class="line">tar xvf scons-2.5.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> scons-2.5.1</span><br><span class="line">sudo python setup.py install</span><br><span class="line">scons --version</span><br><span class="line">SCons by Steven Knight et al.:</span><br><span class="line">  script: v2.5.1.rel_2.5.1:3735:9dc6cee5c168[MODIFIED], 2016/11/03 14:02:02, by bdbaddog on mongodog</span><br></pre></td></tr></table></figure>

<h3 id="Build-시작"><a href="#Build-시작" class="headerlink" title="Build 시작"></a>Build 시작</h3><p><a target="_blank" rel="noopener" href="https://github.com/mongodb">github mongodb</a> 소스를 사용하고, 라즈베리파이세 Fan을 달라</p>
<blockquote>
<p>혹시, 이 글을 보고, 또 필요해서 꼭 라즈베리파이에서 MongoDB를 빌드하고자 하면<br>필자는 빌드를 시작해서 9일이 걸렸다.</p>
</blockquote>
<h4 id="소스-다운로드"><a href="#소스-다운로드" class="headerlink" title="소스 다운로드"></a>소스 다운로드</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/mongodb/mongo.git mongodb-src</span><br><span class="line">git checkout v3.4.9</span><br></pre></td></tr></table></figure>

<p>pip 패키지 설치</p>
<p>opensuse에서 배포하는 pip는 7.x 버전으로 최신버전으로 업그레이드한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>최신 3.4 master 브랜치를 설치하려면 소스를 다운로드한 후에 pip로 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r buildscripts/requirements.txt</span><br></pre></td></tr></table></figure>

<p>그리고 scons에서 에러코드 점검에 사용하는 다음 패키지를 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --user regex</span><br></pre></td></tr></table></figure>

<p>swap이 필요하다. 다음은 block size 1G 크기 파일을 4회에 걸쳐 만들기 때문에 4G 파일이 생성된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo dd if=/dev/zero of=/data/swap4G bs=1G count=4</span><br><span class="line">sudo chmod 600 /swapfile</span><br><span class="line">sudo mkswap /swapfile</span><br><span class="line">sudo swapon /swapfile</span><br><span class="line">sudo swapon -s</span><br></pre></td></tr></table></figure>

<h4 id="Build-시작-1"><a href="#Build-시작-1" class="headerlink" title="Build 시작"></a>Build 시작</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~&gt; w</span><br><span class="line"> 11:14:58 up 1 day,  2:26,  2 users,  load average: 7.27, 7.30, 7.52</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">qkboo    pts/0    192.168.11.102   10:30    2.00s  1.56s  0.07s w</span><br><span class="line">qkboo    pts/1    tmux(9980).%0    05:08    6:06m  4:48   0.72s /usr/lib64/gcc/</span><br><span class="line"></span><br><span class="line">~&gt; free</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:        803988     771156      32832          0       6528     355580</span><br><span class="line">-/+ buffers/cache:     409048     394940</span><br><span class="line">Swap:      2594940    1158396    1436544</span><br></pre></td></tr></table></figure>

<p>그리고 드디어, 빌드가 끝나고 나니 <strong>9일</strong>이 걸렸다 Bravo!!!</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Linking build/opt/mongo/mongod</span><br><span class="line">Install file: <span class="string">&quot;build/opt/mongo/mongod&quot;</span> as <span class="string">&quot;mongod&quot;</span></span><br><span class="line">scons: <span class="keyword">done</span> building targets.</span><br><span class="line"></span><br><span class="line">real    13514m39.223s</span><br><span class="line">user    751m26.374s</span><br><span class="line">sys     180m32.031s</span><br></pre></td></tr></table></figure>

<p>빌드한 바이너리는 build&#x2F;opt&#x2F;mongo 밑에 생성된다. 이 바이너리에는 디버깅용 심볼 정보가 포함되어 있다. 이 부분을 제거하기 위해서 <code>strip</code> 명령을 사용한다. 여기서는 <code>mongod</code> 만 빌드해서</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~&gt; <span class="built_in">cd</span> build/opt/mongo</span><br><span class="line">~&gt; strip -s mongod</span><br></pre></td></tr></table></figure>

<h3 id="MongoDB-설치"><a href="#MongoDB-설치" class="headerlink" title="MongoDB 설치"></a>MongoDB 설치</h3><p>소스를 빌드한 바이너리를 설치한다. 먼저 <code>mongod</code> 를 복사한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo <span class="built_in">cp</span> mongo mongod mongos /usr/local/bin/</span><br><span class="line">~&gt; sudo <span class="built_in">chown</span> root:root /usr/local/bin/mongo*</span><br><span class="line">~&gt; sudo <span class="built_in">chmod</span> 755 /usr/local/bin/mongo*</span><br></pre></td></tr></table></figure>

<h4 id="User-mongodb"><a href="#User-mongodb" class="headerlink" title="User mongodb"></a>User mongodb</h4><p>사용자를 추가하기 openSUSE <code>yast</code>라는 시스템 도구로 할 수 있지만 여기선 <code>adduser</code> 명령을 사용해서 사용자 추가한다. 자세한 것은 <a target="_blank" rel="noopener" href="http://www.tecmint.com/add-users-in-linux/">useradd 명령</a>을 참조한다.</p>
<p><code>useradd</code> 는 홈 디렉토리, 쉘 등에 대한 옵션을 주고 사용자를 등록하는데, 사용자 아이디를 <em>&#x2F;etc&#x2F;passwd</em>, <em>&#x2F;etc&#x2F;shadow</em>, <em>&#x2F;etc&#x2F;group</em>과 <em>&#x2F;etc&#x2F;gshadow</em>에 추가해준다.</p>
<p>로그인이 필요없는 사용자므로, 로그인, 패스워드, 홈디렉토리를 비활성화한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo useradd -M -N -s /dev/zero -g nogroup mongodb</span><br></pre></td></tr></table></figure>

<h4 id="디렉토리와-설정"><a href="#디렉토리와-설정" class="headerlink" title="디렉토리와 설정"></a>디렉토리와 설정</h4><p>mongod 가 사용하는 로그 디렉토리,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo <span class="built_in">mkdir</span> /var/log/mongodb</span><br><span class="line">~&gt; sudo <span class="built_in">chown</span> mongodb:nogroup /var/log/mongodb</span><br></pre></td></tr></table></figure>

<p>데이터 디렉토리</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo <span class="built_in">mkdir</span> /var/lib/mongodb</span><br><span class="line">~&gt; sudo <span class="built_in">chown</span> mongodb:root /var/lib/mongodb</span><br><span class="line">~&gt; sudo <span class="built_in">chmod</span> 775 /var/lib/mongodb</span><br></pre></td></tr></table></figure>

<p>이제 <code>mongod</code> 데몬을 시작해 보자, 먼저 다음 같이 명령을 입력해 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo /usr/local/bin/mongod --dbpath /var/lib/mongodb</span><br></pre></td></tr></table></figure>

<p>데이터베이스 엔진에서 발생하는 로그가 화면에 출력되는 것을 확인할 수 있다.</p>
<p><code>mongo</code> 클라이언트 혹은 mongobooster 같은 클라이언트에서 데이터베이스에 접속해 보고 잘 동작하는지 확인한다.</p>
<p>확인후 log 파일을 지정해 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo /usr/local/bin/mongod --dbpath /var/lib/mongodb/ --logpath /var/log/mongodb/mongod.log</span><br></pre></td></tr></table></figure>

<h4 id="mongod-conf"><a href="#mongod-conf" class="headerlink" title="mongod.conf"></a>mongod.conf</h4><p>보통 MongoDB는 데이터베이스 엔진 실행시 필요한 설정으로 로그 파일, 데이터 디렉토리 등의 내용을 <em>&#x2F;etc&#x2F;mongod.conf</em> 설정 파일에 선언해서 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo vi /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p>다음 내용으로 작성한다. 설정 파일 내용에 대해서는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/configuration-options">mongodb.conf</a>를 참조한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line">#  engine: mmapv1</span><br><span class="line">#  mmapv1:</span><br><span class="line">  wiredTiger:</span><br><span class="line">    engineConfig:</span><br><span class="line">      cacheSizeGB: 0.5</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line"># network interfaces</span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">  authorization: disabled</span><br></pre></td></tr></table></figure>

<p>설정 파일을 주고 시작해 본다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; sudo /usr/local/bin/mongod --config /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p>잘 동작한다.</p>
<h3 id="create-systemd-x2F-service-entry"><a href="#create-systemd-x2F-service-entry" class="headerlink" title="create systemd &#x2F; service entry"></a>create systemd &#x2F; service entry</h3><p>이제 systemd unit 파일 <code>mongod.service</code> 를 생성해서 데몬으로 등록해 보자. <em>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system</em> 디렉토리는 서비스 유닛 파일이 설치되는 곳으로, 활성화 되면 <em>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;</em> 밑에 설치된다.</p>
<blockquote>
<p>Ubuntu&#x2F;Debian 계열은 <em>&#x2F;lib&#x2F;systemd&#x2F;system</em> 이다</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~&gt; <span class="built_in">cd</span> /usr/lib/systemd/system</span><br><span class="line">~&gt; sudo vi mongod.service</span><br></pre></td></tr></table></figure>

<p>다음 내용을 입력한다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=High-performance, schema-free document-oriented database</span><br><span class="line">After=network.target</span><br><span class="line">Documentation=https://docs.mongodb.org/manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">#User=mongodb</span><br><span class="line">#Group=nogroup</span><br><span class="line">ExecStart=/usr/local/bin/mongod --config /etc/mongod.conf</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE=infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU=infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS=infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE=64000</span><br><span class="line"># processes/threads</span><br><span class="line">LimitNPROC=64000</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax=infinity</span><br><span class="line">TasksAccounting=false</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p><code>mongod</code> 에 대한 제약은 <a target="_blank" rel="noopener" href="http://docs.mongodb.org/manual/reference/ulimit/#recommended-settings">Recommended limits for for mongod</a> 를 참조한다.</p>
<p>서비스 유닛 파일이 제대로 위치하는지 검증하기 위해 다음 명령으로 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --<span class="built_in">type</span>=service  |grep mongod</span><br><span class="line">mongodb.service             disabled</span><br></pre></td></tr></table></figure>

<p>이제 <code>mongod.service</code> 를 할성화 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> mongod.service</span><br></pre></td></tr></table></figure>

<p>활성화 되면 <em>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target</em> 밑에 설치된다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl status mongod.service</span><br><span class="line">● mongod.service - High-performance, schema-free document-oriented database</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mongodb.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line">     Docs: https://docs.mongodb.org/manual</span><br></pre></td></tr></table></figure>

<p>이제 mongodb 를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start mongod.service</span><br></pre></td></tr></table></figure>

<p>중지는,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop mongod.service</span><br><span class="line">sudo systemctl restart mongod.service</span><br></pre></td></tr></table></figure>

<p>그리고 <em>mongod.service</em> 내용을 수정하면 다시 로딩을 해야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>일단 여기까지 데몬으로 잘 실행된다. 다만 사용자가 아닌 <code>root</code> 에서만… ㅠ.ㅜ</p>
<!--

#### Data disk

MLC를 지원하는 USB memory 를 장착하고, 2017-04-03-odroid-lvm2 에서 설명한데로 디렉토리를 구성해서 데이터 파일시스템으로 사용하고 있다.
-->

<h3 id="기념사진"><a href="#기념사진" class="headerlink" title="기념사진"></a>기념사진</h3><p>우분투&#x2F;데비안 계열에 익숙해 있다가 Raspberry Pi 3 에 openSUSE 를 개발자용 패키지들을 설치하고, 맘 먹고 빌드를 시작해서 9일이 걸렸다. <em>9일 동안 꿋꿋이 버텨준</em> <strong>Raspberry Pi 3&#x2F;openSUSE</strong> machine!!!</p>
<p><img src="/images/opensuse/rpi3-opensuse-machine.JPG">{:width&#x3D;”550”}</p>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^1]: <a target="_blank" rel="noopener" href="http://koenaerts.ca/compile-and-install-mongodb-on-raspberry-pi/">Mongodb on Raspberry pi</a></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/qkboo_400.png" alt="Gangtai"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gangtai</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Paju, South Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">53</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">95</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/thinkbee" target="_blank" rel="noopener">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/gtko"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">링크</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">26</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/NodeJS/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Photoshop/"><span class="level-start"><span class="level-item">Photoshop</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Angular/"><span class="level-start"><span class="level-item">Angular</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Angularjs/"><span class="level-start"><span class="level-item">Angularjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Raspberry-Pi/"><span class="level-start"><span class="level-item">Raspberry Pi</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-23T15:47:59.802Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/hello-world/">blog.thinkbee.kr 이전 작업중입니다.</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-02T09:00:00.000Z">2020-02-02</time></p><p class="title"><a href="/2020/02/02/linux/2020-02-02-letsencrypt%EB%B0%9C%EA%B8%89/">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T03:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-config/">MongoDB 구성 설정과 사용자 인증 사용</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T01:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-4-2-install-arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu/Debian Armbian</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-09-05T11:00:00.000Z">2019-09-05</time></p><p class="title"><a href="/2019/09/05/python/2019-09-05-OpenSuse-JupyterNotebook_scientific/">openSUSE - 과학계산을 위한 Python, Jupyter Notebook</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Programming/">Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">아카이브</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">2월 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">2월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">12월 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">9월 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">10월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">8월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">7월 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">6월 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">12월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">11월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">10월 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">9월 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">7월 2017</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">5월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">4월 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">12월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">2월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">태그</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Armbian/"><span class="tag">Armbian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Artificial-Intelligence/"><span class="tag">Artificial Intelligence</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian/"><span class="tag">Debian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian-Strech/"><span class="tag">Debian Strech</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JSON-Web-Token/"><span class="tag">JSON Web Token</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT-Toekn/"><span class="tag">JWT Toekn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-15-0/"><span class="tag">LEAP 15.0</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-42-3/"><span class="tag">LEAP 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Numpy/"><span class="tag">Numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid/"><span class="tag">Odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid-C2/"><span class="tag">Odroid C2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Orange-Pi/"><span class="tag">Orange Pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi/"><span class="tag">Raspberry Pi</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi-3/"><span class="tag">Raspberry Pi 3</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspbian/"><span class="tag">Raspbian</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SD-Card/"><span class="tag">SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scientific/"><span class="tag">Scientific</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript-Tutorials/"><span class="tag">TypeScript Tutorials</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/X11/"><span class="tag">X11</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/amd64/"><span class="tag">amd64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angular4/"><span class="tag">angular4</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/arm64/"><span class="tag">arm64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/armbian/"><span class="tag">armbian</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/banana-pi/"><span class="tag">banana pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/certificate-ssl/"><span class="tag">certificate ssl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/clipping-mask/"><span class="tag">clipping-mask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collages/"><span class="tag">collages</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cross-compiler/"><span class="tag">cross compiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian/"><span class="tag">debian</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewall/"><span class="tag">firewall</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewalld/"><span class="tag">firewalld</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/https/"><span class="tag">https</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/install/"><span class="tag">install</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jasmine/"><span class="tag">jasmine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter/"><span class="tag">jupyter</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter notebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter-notebook</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/karma/"><span class="tag">karma</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-15/"><span class="tag">leap 15</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-42-3/"><span class="tag">leap 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm/"><span class="tag">lvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm2/"><span class="tag">lvm2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/micro-SD-Card/"><span class="tag">micro SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongoose/"><span class="tag">mongoose</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs-tutorials/"><span class="tag">nodejs tutorials</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nvm/"><span class="tag">nvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid/"><span class="tag">odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid c2</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid-c2</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openSUSE/"><span class="tag">openSUSE</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse/"><span class="tag">opensuse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse-leap-15/"><span class="tag">opensuse leap 15</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/orange-pi/"><span class="tag">orange pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/photoshop/"><span class="tag">photoshop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry pi</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/synergy/"><span class="tag">synergy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unit-testing/"><span class="tag">unit testing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenv/"><span class="tag">virtualenv</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenvwrapper/"><span class="tag">virtualenvwrapper</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webdav/"><span class="tag">webdav</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EB%B9%84%EC%95%88/"><span class="tag">데비안</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/"><span class="tag">데이안</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/"><span class="tag">라즈베리파이</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/"><span class="tag">라즈비안</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%A6%AC%EB%88%85%EC%8A%A4/"><span class="tag">리눅스</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%94%EB%82%98%EB%82%98%ED%8C%8C%EC%9D%B4/"><span class="tag">바나나파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%A9%ED%99%94%EB%B2%BD/"><span class="tag">방화벽</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%98%A4%EB%A0%8C%EC%A7%80%ED%8C%8C%EC%9D%B4/"><span class="tag">오렌지파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/"><span class="tag">우분투</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/"><span class="tag">웹토큰</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9D%B8%EA%B3%B5%EC%A7%80%EB%8A%A5/"><span class="tag">인공지능</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/"><span class="tag">전원관리</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%8D%AC/"><span class="tag">파이썬</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%96%B4%EC%9B%94/"><span class="tag">파이어월</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">업데이트 소식 받기</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1465716454138955" data-ad-slot="4883770640" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a><p class="is-size-7"><span>&copy; 2022 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>인" class="headerlink" title="퍼미션 확인"></a>퍼미션 확인</h4><p><strong>로그 디렉토리</strong> <em>&#x2F;var&#x2F;log&#x2F;mongo</em> 그리고 <strong>데이터 디렉토리</strong> <em>&#x2F;data&#x2F;mongodata</em> 라면 해당 디렉토리에 몽고디비 사용자가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> mongo.daemon /var/log/mongodb</span><br><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h4 id="mongod-conf-설정"><a href="#mongod-conf-설정" class="headerlink" title="mongod.conf 설정"></a>mongod.conf 설정</h4><p>MongoDB의 <code>systemd</code> 서비스는 데이터베이스 구성 파일 <code>/etc/mongod.conf</code> 을 참조한다.</p>
<p>먼저 <code>/etc/mongod.conf</code> 파일에 <strong>인증</strong>을 제외한 <strong>데이터 디렉토리</strong>, <strong>bindIp</strong>, <strong>로그</strong> 부분만 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 127.0.0.1,192.168.0.2</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbPath</strong> : 데이터베이스 스토리지 위치</li>
<li><strong>bindIp</strong>: 서버 외에서 mongo 클라이언트가 접근하려면 IP 를 입력한다.</li>
</ul>
<p>현재는 <code>mongo.conf</code> 설정 파일에 접근 제어가 없는 상태에서 <strong>mongo</strong> 클라이언트로 접속한다</p>
<h4 id="Admin-사용자"><a href="#Admin-사용자" class="headerlink" title="Admin 사용자"></a>Admin 사용자</h4><p><code>mongod</code>에 인증이 비활성화 상태에서 mongo&#96; 클라이언트로 접속에 성공하면 <strong>&gt;</strong> 프롬프트가 나온다. <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$mongo</span><br><span class="line">&gt;</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><em>admin</em> 데이터베이스에서 관리자 role을 가진 사용자를 추가하고, 사용할 데이터베이스의 사용자와 접근 제어를 추가해서 사용하기 위해서 작업한다.</p>
<h4 id="user-administrator"><a href="#user-administrator" class="headerlink" title="user administrator"></a>user administrator</h4><p><code>userAdmin role</code> 혹은 <code>userAdminAnyDatabase role</code>을 가진 사용자 만든다. 다음은 <em>admin</em> 데이터베이스에서 사용자를 관리하는 <strong>admin 계정</strong>을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user:&#x27;admin&#x27;,</span><br><span class="line">    pwd:&#x27;****&#x27;,</span><br><span class="line">    roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers()</span><br></pre></td></tr></table></figure>

<p>admin <code>사용자 패스워드 변경</code>은</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.changeUserPassword(&quot;accountUser&quot;, &quot;SOh3TbYhx8ypJPxmt1oOfL&quot;)</span><br></pre></td></tr></table></figure>

<p>사용자의 <code>role</code> 을 변경,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.grantRolesToUser( &#x27;admin&#x27;, [&#123;role: &#x27;userAdmin&#x27;, db:&#x27;admin&#x27;&#125;])</span><br><span class="line">&gt; db.getUsers()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdmin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>혹은 updateUser 를 사용할 수 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( &quot;appClient01&quot;, ...</span><br></pre></td></tr></table></figure>

<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<blockquote>
<p>인증모드는 v2.4이전에는 <code>--auth</code> 옵션을 사용하고, v2.6 이후에서 <em>mongod.conf</em> 파일 사용할 때 <code>security.authorization</code> 를 활성화 한다.</p>
</blockquote>
<p>systemd 로 서비스를 재시작 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>이제 인증 모드에서 데이터베이스에 접속해야 한다. 만약 인증모드로 시작한 후에 다음 같이 인증 정보없이 로그인 하면 데이터베이스 사용시 에러를 만난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">&gt; show dbs;</span><br><span class="line">Tue Sep 27 23:22:40.683 listDatabases failed:&#123; &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;unauthorized&quot; &#125; at src/mongo/shell/mongo.js:46</span><br><span class="line">&gt;</span><br><span class="line">&gt; show users</span><br><span class="line">Tue Sep 27 23:22:44.667 error: &#123; &quot;$err&quot; : &quot;not authorized for query on test.system.users&quot;, &quot;code&quot; : 16550 &#125; at src/mongo/shell/query.js:128</span><br></pre></td></tr></table></figure>

<h4 id="인증모드로-접속"><a href="#인증모드로-접속" class="headerlink" title="인증모드로 접속"></a>인증모드로 접속</h4><p>데이터베이스 시스템에 접근제어가 활성화 되면 <code>mongo</code> 클라이언트 접속시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>만약 데이터베이스 인증모드로 실행되는데 비인증 클라이언트 접근은 아래 같이 에러를 낸다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MongoDB shell version v3.6.5</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.6.5</span><br><span class="line">&gt; use students</span><br><span class="line">switched to db students</span><br><span class="line">&gt; show users</span><br><span class="line">2018-06-25T18:30:38.174+0900 E QUERY    [thread1] Error: not authorized on students to execute command &#123; usersInfo: 1.0, $db: &quot;students&quot; &#125; :</span><br></pre></td></tr></table></figure>

<h4 id="원격지에서-접근"><a href="#원격지에서-접근" class="headerlink" title="원격지에서 접근"></a>원격지에서 접근</h4><p>외부에서 mongodb로 접근시 authentication을 적용한 상태라면 다음과 같은 URL로 접근할 수 있다:</p>
<blockquote>
<p>“username:password@HOST_NAME&#x2F;mydb”</p>
</blockquote>
<blockquote>
<p>그러나 외부접근시 클라이언트 버전과 서버의 Credential 버전이 맞지 않은 경우 다음 같이 실패 메시지를 확인할 수 있다.</p>
<p>2016-05-16T00:53:10.338+0900 I ACCESS [conn2] Failed to authenticate student@student with mechanism MONGODB-CR: AuthenticationFailed: MONGODB-CR credentials missing in the user document<br>2016-05-16T00:53:10.352+0900 I NETWORK [conn2] end connection 220.121.140.59:51634 (0 connections now open)</p>
</blockquote>
<br/>
### 데이터베이스 생성과 인증

<p>새 데이터베이스에 컬렉션을 생성하고 데이터베이스 사용자를 접근제어할 수 있는 내용은 <a href="!--swig%EF%BF%BC31--">MongoDB User Authentication</a> 에서 다루고 있다.</p>
<br/>
<br/>
## MongoDB에 관련 글


<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<br/>
### `mongod` 명령 사용

<p><code>systemd</code>가 아닌, <code>mongod</code> 명령으로 로 MongoDB를 시작해 설정 파일 등이 제대로 동작하는지 확인할 수 있다.</p>
<p>다만 데이터베이스가 생성하는 데이터와 로그 파일의 접근권한이 실행한 사용자 계정으로 처리되어 퍼미션 문제가 발생할 수 있다.</p>
<h4 id="mongoDB-v2-4-인증모드로-시작"><a href="#mongoDB-v2-4-인증모드로-시작" class="headerlink" title="mongoDB v2.4 인증모드로 시작"></a>mongoDB v2.4 인증모드로 시작</h4><p><code>mongod</code> 명령라인으로 시작할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>mongoDB v2.4는 다음 같이 인증 모드로 시작한다. <code>mongod</code> 명령라인에서 <code>--auth</code> 옵션을 붙여 DB 인스턴스(<code>mongod</code>)를 시작 혹은 재시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/db1</span><br></pre></td></tr></table></figure>

<p>혹은 <em>mongod.conf</em> 설정 파일에서 <strong>auth</strong> 를 활성화 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth = true</span><br></pre></td></tr></table></figure>

<h4 id="mongoDB-v2-6-이후"><a href="#mongoDB-v2-6-이후" class="headerlink" title="mongoDB v2.6 이후"></a>mongoDB v2.6 이후</h4><p>앞서 시작한 명령행 <strong>mongodb</strong>를 종료하고 명령라인에서 재시작 <code>--auth</code> 옵션을 붙여 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>접근제어 <code>--auth</code> 옵션으로 데이터베이스를 시작하면 로그인시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-12-20T00:00:00.000Z" title="2017-12-20 9:00:00">2017-12-20</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:14:19.401Z" title="2022-2-25 1:14:19">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/NodeJS/">NodeJS</a><span> / </span><a class="link-muted" href="/categories/NodeJS/Database/">Database</a></span><span class="level-item">10분안에 읽기 (약 1560 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/12/20/nodejs-2017-12-20-mongodb-mongoose-middleware/">NodeJS - mongoose middleware</a></h1><div class="content"><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>이 글은  <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/middleware.html">mongoose middleware</a>를 한글로 요약 정리한 것이다. 실제 본문을 요약하여 번역해 정리했으므로 이해가 안되는 부분은 위 링크의 내용을 참조하기 바란다.</p>
<h3 id="mongoose-middleware"><a href="#mongoose-middleware" class="headerlink" title="mongoose middleware"></a>mongoose middleware</h3><p><em>pre</em>, <em>post</em> hook 이라고 불리는 <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/middleware.html">mongoose middleware</a>는 비동기 함수의 실행중 제어권을 다룰 수 있다. 미들웨어는 스키마 수순에서 사용고 <a target="_blank" rel="noopener" href="http://github.com/Automattic/mongoose">plugins</a> 를 작성하는데 유용하다.</p>
<p>Mongoose 4.x 은 4종류의 미들웨어를 지원한다: </p>
<ul>
<li>document middleware</li>
<li>model middleware</li>
<li>aggregate middleware</li>
<li>query middleware</li>
</ul>
<p>Document middleware는 아래 도큐멘트 함수를 지원한다. 도큐멘트 미들웨어에서 <code>this</code> 는 도큐멘트를 가르킨다.</p>
<ul>
<li>init</li>
<li>validate</li>
<li>save</li>
<li>remove</li>
</ul>
<p>Query middleware 는 아래 모델과 쿼리 함수를 지원한다. 쿼리 미들웨어 함수에서 <code>this</code> 는 쿼리를 가르킨다.</p>
<ul>
<li>count</li>
<li>find</li>
<li>findOne</li>
<li>findOneAndRemove</li>
<li>findOneAndUpdate</li>
<li>update</li>
</ul>
<p>Aggregate middleware 는 <code>MyModel.aggregate()</code> 를 위한것이다. Aggregate middleware는 aggregate 객체에서 <code>exec()</code> 를 호출할 때 실행된다.. 여기서 <code>this</code> 는 aggregation object를 가르킨다.</p>
<ul>
<li>aggregate</li>
</ul>
<p>Model middleware 는 아래 모델 함수에 대해 지원한다. 여기서 <code>this</code>는 모델을 가르킨다.</p>
<ul>
<li>insertMany</li>
</ul>
<blockquote>
<p>Note: There is no query hook for remove(), only for documents. If you set a ‘remove’ hook, it will be fired when you call myDoc.remove(), not when you call MyModel.remove(). Note: The create() function fires save() hooks.</p>
</blockquote>
<p>모든 미들웨어 형식은 <code>pre</code>와 <code>post</code> 훅(hook)을 지원한다.</p>
<br>
<br>
### Pre middleware

<p>Serial과 parallel 이라는 두가지 <code>pre</code> 훅이 있다.</p>
<br>
#### Serial

<p>Serial middleware는 각 미들웨어가 <code>next()</code>를 호출하면 하나 다음 다른 하나를 실행한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(..);</span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">next</span>) &#123;</span><br><span class="line">  <span class="comment">// do stuff</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>그렇지만 <code>next()</code> 함수가 미들웨어의 다음 코드 실행을 멈추지 않기 때문에 <code>return</code> 패턴을 사용해서 코드 진행을 멈추면 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(..);</span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">foo</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;calling next!&#x27;</span>);</span><br><span class="line">    <span class="comment">// `return next();` will make sure the rest of this function doesn&#x27;t run</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after next&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<br>
#### Parallel

<p>Parallel middleware는 제어를 더욱 정밀하게 할 수 있다.</p>
<p>아래는 Pre 훅에 <code>true</code> 인자를 전달해 parallel 미들웨어를 사용하게 하고, 이것은 <code>save</code> 인 경우 각 미들웨어에서 done 호출 전까지 실행하지 않는다는 의미이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(..);</span><br><span class="line"></span><br><span class="line"><span class="comment">// `true`: parallel middleware.</span></span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="literal">true</span>, <span class="keyword">function</span>(<span class="params">next, done</span>) &#123;</span><br><span class="line">  <span class="comment">// calling next kicks off the next middleware in parallel</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">  <span class="built_in">setTimeout</span>(done, <span class="number">100</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<br>
#### Use Cases

<p>미들웨어는 원자화 모델과 비동기 코드의 중첩을 회피하는데 유용한다. 아래 같은 사례:</p>
<ul>
<li>복합 유효성 확인</li>
<li>의존하는 문서 삭제 (사용자에 관련한 모든 문서를 삭제)</li>
<li>asynchronous defaults</li>
<li>asynchronous tasks that a certain action triggers<ul>
<li>triggering custom events</li>
<li>notifications</li>
</ul>
</li>
</ul>
<br>
#### 에러 처리

<p>미들웨어에서 <code>Error</code> 형식 매개변수로 next(), done() 을 호출할 때 에러로 처리가 가로채지면 콜백 함수에 에러가 전달된다.</p>
<p>아래 같이 에러 발생시 <code>new Error()</code>를 생성해야 다음 <code>next()</code> 가 호출되지 않는다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">next</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;something went wrong&#x27;</span>);</span><br><span class="line">  <span class="title function_">next</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// later...</span></span><br><span class="line">myDoc.<span class="title function_">save</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>) <span class="comment">// something went wrong</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<br>
<br>
### Post middleware

<p>post middleware 는 pre middle 웨어가 완료되어 훅 메서드가 처리된 뒤에 실행된다. post 는 제어를 직접 하지 못한다. 예를 들어 next(), done() callback이 전달되면 post 훅은 이들 메서드를 이벤트 리스너에 등록하는 방법이다. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;init&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been initialized from the db&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;validate&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been validated (but not saved yet)&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been saved&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;remove&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been removed&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
#### Asynchronous Post Hooks

<p>post가 선언된 순서에 따라 post hook이 비동기 적으로 실행되는데, callback function에 두 개의 인자를 전달하면 mongoose는 두번째를 <code>next()</code> 로 가정하고 순서에 따라 next를 트리거 호출한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Takes 2 parameters: this is an asynchronous post hook</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc, next</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;post1&#x27;</span>);</span><br><span class="line">    <span class="comment">// Kick off the second post hook</span></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;, <span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Will not execute until the first middleware calls `next()`</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc, next</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;post2&#x27;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
#### Save/Validate Hooks

<p>The <code>save()</code> 함수는 <code>validate()</code> hook을 유발하는데 이것은 <code>pre(&#39;save&#39;)</code> hook이 호출되면서  <code>pre(&#39;validate&#39;)</code> 와 <code>post(&#39;validate&#39;)</code> hook이 호출된다는 것이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;validate&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed first&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;validate&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed second&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed third&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed fourth&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
#### Notes on findAndUpdate() and Query Middleware

<p>Pre 와 post save() hook은 <code>update()</code>, <code>findOneAndUpdate()</code> 등에서 호출되지 않는다. Mongoose 4.0 은 이들 함수에 다른 훅을 가지고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;find&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> mongoose.<span class="property">Query</span>); <span class="comment">// true</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">start</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;find&#x27;</span>, <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> mongoose.<span class="property">Query</span>); <span class="comment">// true</span></span><br><span class="line">  <span class="comment">// prints returned documents</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;find() returned &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span><br><span class="line">  <span class="comment">// prints number of milliseconds the query took</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;find() took &#x27;</span> + (<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">start</span>) + <span class="string">&#x27; millis&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>document middleware에서 <code>this</code> 는 갱신하는 도큐멘트를 가르킨다. 그래서 <code>update()</code> 에 타임스탬프를 추가하고자 하면 아래 pre hook을 사용한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;update&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">update</span>(&#123;&#125;,&#123; <span class="attr">$set</span>: &#123; <span class="attr">updatedAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125; &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="Error-Handling-Middleware"><a href="#Error-Handling-Middleware" class="headerlink" title="Error Handling Middleware"></a>Error Handling Middleware</h3><blockquote>
<p>New in 4.5.0</p>
</blockquote>
<p>일반적으로 next() 호출시 첫번째 error에서 멈추는데 특별한 post middleware로 “error handling middleware” 가 있다.<br>Error handling middleware는 부가적으로 콜백 함수의 매개변수에 <code>error</code>가 전달되는데, 첫번째 인자로 <code>error</code> 를 전달한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="comment">// Will trigger a MongoError with code 11000 when</span></span><br><span class="line">    <span class="comment">// you save a duplicate</span></span><br><span class="line">    <span class="attr">unique</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handler **must** take 3 parameters: the error that occurred, the document</span></span><br><span class="line"><span class="comment">// in question, and the `next()` function</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, doc, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;MongoError&#x27;</span> &amp;&amp; error.<span class="property">code</span> === <span class="number">11000</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;There was a duplicate key error&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Will trigger the `post(&#x27;save&#x27;)` error handler</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">create</span>([&#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125;]);</span><br></pre></td></tr></table></figure>

<p>Error handling middleware는 query middleware와도 동작한다. 예를 들어 update() 호출시 키 중철 에러를 처리하는 훅를 고려하면:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The same E11000 error can occur when you call `update()`</span></span><br><span class="line"><span class="comment">// This function **must** take 3 parameters. If you use the</span></span><br><span class="line"><span class="comment">// `passRawResult` function, this function **must** take 4</span></span><br><span class="line"><span class="comment">// parameters</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;update&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;MongoError&#x27;</span> &amp;&amp; error.<span class="property">code</span> === <span class="number">11000</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;There was a duplicate key error&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> people = [&#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">&#x27;Slash&#x27;</span> &#125;];</span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">create</span>(people, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">update</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Slash&#x27;</span> &#125;, &#123; <span class="attr">$set</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125; &#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// `error.message` will be &quot;There was a duplicate key error&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
<br>
## 참조

<ul>
<li><a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/middleware.html">mongoose middleware</a></li>
<li><a target="_blank" rel="noopener" href="http://github.com/Automattic/mongoose">plugins</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-07-12T03:00:00.000Z" title="2017-7-12 12:00:00">2017-07-12</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:14:19.331Z" title="2022-2-25 1:14:19">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/NodeJS/">NodeJS</a><span> / </span><a class="link-muted" href="/categories/NodeJS/Database/">Database</a></span><span class="level-item">9분안에 읽기 (약 1285 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/07/12/nodejs-2017-07-12-mongodb-mongoose/">NodeJS - mongoose</a></h1><div class="content"><p>이 글은 <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/">mongoose doc</a> 에서 필요한 부분만 요약 정리했다.</p>
<h2 id="MongoDB와-Mongoose"><a href="#MongoDB와-Mongoose" class="headerlink" title="MongoDB와 Mongoose"></a>MongoDB와 Mongoose</h2><p>Node.js에서 Mongodb에 연결하기 위해서 Driver가 필요</p>
<h3 id="mongoose"><a href="#mongoose" class="headerlink" title="mongoose"></a>mongoose</h3><p>MongoDb를 위한 Node.js 커넥터로 Object Data Mapping (ODM)을 통해 MVC를 구현해 준다. </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dzone.com/articles/using-mongodb-and-mongoose">using-mongodb-and-mongoose</a></li>
</ul>
<h4 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h4><p>프로젝트 폴더에서 npm으로 mongoose 모듈를 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i mongoose</span><br></pre></td></tr></table></figure>

<blockquote>
<p>npm &lt; 5 이하 버전은 <code>-S</code> 혹은 <code>--save</code> 옵션으로 모듈 의존성을 <em>package.json</em> 에 추가한다.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;body-parser&quot;</span>: <span class="string">&quot;~1.13.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cookie-parser&quot;</span>: <span class="string">&quot;~1.3.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>: <span class="string">&quot;~2.2.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;express&quot;</span>: <span class="string">&quot;~4.13.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jade&quot;</span>: <span class="string">&quot;~1.11.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mongoose&quot;</span>: <span class="string">&quot;^4.4.16&quot;</span>,</span><br><span class="line">    <span class="string">&quot;morgan&quot;</span>: <span class="string">&quot;~1.6.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;serve-favicon&quot;</span>: <span class="string">&quot;~2.3.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scheme-사용"><a href="#Scheme-사용" class="headerlink" title="Scheme 사용"></a>Scheme 사용</h3><p>Scheme 는 <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/models.html">Model</a> 로 변환해야 한다. <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/models.html">^models</a><br><code>mongoose.model()</code> 메서드는 모델 이름과 스키마를 받아 변환한다.</p>
<blockquote>
<p>mongoose.model(modelName, schema);</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">size</span>: <span class="string">&#x27;string&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Tank</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Tank&#x27;</span>, schema);</span><br></pre></td></tr></table></figure>

<p>model()에 전달한 <strong>modelName</strong>은 mongoose가 자동으로 컬렉션에서 복수형으로 찾는다. 예를 들어 위의 <em>Tank</em>는 <em>tanks</em> 컬렉션을 참조한다.</p>
<h3 id="connect"><a href="#connect" class="headerlink" title="connect()"></a>connect()</h3><p>mongoose 에서 mongodb 드라이버에 연결할 때 mongodb 버전에 따라 달리 접근한다. 또한 mongoose 4.x와 5.x 의 몇몇 옵션도 주의해서 사용해야 한다.</p>
<h4 id="mongodb-3-x-연결"><a href="#mongodb-3-x-연결" class="headerlink" title="mongodb 3.x 연결"></a>mongodb 3.x 연결</h4><p>mongoose 4.x 버전 부터는 Promise를 선언하고 connect()를 연결한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mongoose.<span class="property">Promise</span> = <span class="variable language_">global</span>.<span class="property">Promise</span>;</span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/somecollection&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span>  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;connection succesful&#x27;</span>))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(err));</span><br><span class="line"></span><br><span class="line"><span class="comment">//or  mongo client option</span></span><br><span class="line">mongoose.<span class="title function_">connect</span>( <span class="string">&#x27;mongodb://localhost/somecollection&#x27;</span>, &#123; <span class="attr">useMongoClient</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>


<p>mongoose 5.x 버전 부터는 Promise  connect()를 연결한다.</p>
<h4 id="mongodb-2-x-연결"><a href="#mongodb-2-x-연결" class="headerlink" title="mongodb 2.x 연결"></a>mongodb 2.x 연결</h4><p>mongodb 2.x 버전에서 createConnection(), connect() 메서드를 사용해 연결한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>); </span><br><span class="line"><span class="keyword">var</span> connection = mongoose.<span class="title function_">createConnection</span>(<span class="string">&#x27;mongodb://localhost/sensors&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Schemas</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">BookScheme</span> = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">year</span>: <span class="title class_">String</span></span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// Models</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">BookModel</span> = mongoose.<span class="title function_">model</span>( <span class="string">&#x27;Book&#x27;</span>, <span class="title class_">BookScheme</span>);</span><br></pre></td></tr></table></figure>


<h4 id="여러-연결"><a href="#여러-연결" class="headerlink" title="여러 연결"></a>여러 연결</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> conn      = mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/testA&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> conn2     = mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/testB&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">SensorModel</span> = conn.<span class="title function_">model</span>( <span class="string">&#x27;qkboo_sensor&#x27;</span>, <span class="title class_">Sensorcheme</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ModelB</span>    = conn2.<span class="title function_">model</span>(<span class="string">&#x27;Model&#x27;</span>, <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">  title : &#123; type : <span class="title class_">String</span>, <span class="keyword">default</span> : <span class="string">&#x27;model in testB database&#x27;</span> &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>






<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="save"><a href="#save" class="headerlink" title="save()"></a>save()</h4><p><a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/api.html#model_Model-save">Model#save()</a>는 주어진 도큐멘트를 저장한다.</p>
<ul>
<li>return: Promise</li>
</ul>
<h4 id="create"><a href="#create" class="headerlink" title="create()"></a>create()</h4><p><a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/api.html#model_Model.create">Model.create()</a> 는 하나 혹은 그 이상의 도큐멘트를 저장할 수 있다. <code>MyModel.create(docs)</code> 는 주어지는 도큐멘트 마다 <code>new MyModel(doc).save()</code> 를 수행한다.</p>
<h4 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h4><p>Model의 인스턴스는 documents 로 <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/api.html#document-js">내장 메서드</a>가 제공되지만, 사용자가 새로운 메서드를 추가할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animalSchema = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123; <span class="attr">name</span>: <span class="title class_">String</span>, <span class="attr">type</span>: <span class="title class_">String</span> &#125;);</span><br><span class="line"></span><br><span class="line">animalSchema.<span class="property">methods</span>.<span class="property">findSimilarTypes</span> = <span class="keyword">function</span>(<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">model</span>(<span class="string">&#x27;Animal&#x27;</span>).<span class="title function_">find</span>(&#123; <span class="attr">type</span>: <span class="variable language_">this</span>.<span class="property">type</span> &#125;, cb);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>이제 animalSchema 의 인스턴스는 새 메서드 <code>findSimilarTypes</code> 사용이 가능하다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Animal</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Animal&#x27;</span>, animalSchema);</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;dog&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">dog.<span class="title function_">findSimilarTypes</span>(<span class="keyword">function</span>(<span class="params">err, dogs</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(dogs); <span class="comment">// woof</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="Statics"><a href="#Statics" class="headerlink" title="Statics"></a>Statics</h4><p>static method도 추가할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assign a function to the &quot;statics&quot; object of our animalSchema</span></span><br><span class="line">animalSchema.<span class="property">statics</span>.<span class="property">findByName</span> = <span class="keyword">function</span>(<span class="params">name, cb</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">find</span>(&#123; <span class="attr">name</span>: <span class="keyword">new</span> <span class="title class_">RegExp</span>(name, <span class="string">&#x27;i&#x27;</span>) &#125;, cb);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Animal</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Animal&#x27;</span>, animalSchema);</span><br><span class="line"><span class="title class_">Animal</span>.<span class="title function_">findByName</span>(<span class="string">&#x27;fido&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, animals</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(animals);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="Db-prototype-authenticate"><a href="#Db-prototype-authenticate" class="headerlink" title="Db.prototype.authenticate"></a>Db.prototype.authenticate</h4><p>mongodb 3.6 이후는 인증시 Socket을 통한 인증을 거부한다. 그래서 Db.prototype.authenticate 을 사용하지 않고 .MongoClient.connect 에서 인증 서명서와 함께 사용해야 한다.</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(node:24499) DeprecationWarning: Mongoose: mpromise (mongoose&#x27;s default promise library) is deprecated, plug in your own promise library instead: http://mongoosejs.com/docs/promises.html</span><br></pre></td></tr></table></figure>

<p>이것은 <code>.save()</code>, <code>query</code> 결과가  <a target="_blank" rel="noopener" href="https://promisesaplus.com/">Promises&#x2F;A+ conformant promises</a> 를 반환한다는 것이다. 반환된 결과로 MyModel.findOne({}).then() and yield MyModel.findOne({}).exec() 같은 작업을 할 수 있다는 의미가 된다.</p>
<p>Mongoose 4 는 기본으로 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/mpromise">mpromise</a>를 약속한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gnr = <span class="keyword">new</span> <span class="title class_">Band</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Guns N&#x27; Roses&quot;</span>,</span><br><span class="line">  <span class="attr">members</span>: [<span class="string">&#x27;Axl&#x27;</span>, <span class="string">&#x27;Slash&#x27;</span>]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> promise = gnr.<span class="title function_">save</span>();</span><br><span class="line">assert.<span class="title function_">ok</span>(promise <span class="keyword">instanceof</span> <span class="built_in">require</span>(<span class="string">&#x27;mpromise&#x27;</span>));</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">doc</span>) &#123;</span><br><span class="line">  assert.<span class="title function_">equal</span>(doc.<span class="property">name</span>, <span class="string">&quot;Guns N&#x27; Roses&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="Queries-are-not-promises"><a href="#Queries-are-not-promises" class="headerlink" title="Queries are not promises"></a>Queries are not promises</h4><p>Mongoose queries are not promises. 그러나 대신 양보와 비동기&#x2F;대기를 위해 <code>.then()</code> 함수를 가지고 있다. fully-fledged promise 가 필요하다면 <code>.exec()</code> 함수를 사용하라. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> query = <span class="title class_">Band</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Guns N&#x27; Roses&quot;</span>&#125;);</span><br><span class="line">assert.<span class="title function_">ok</span>(!(query <span class="keyword">instanceof</span> <span class="built_in">require</span>(<span class="string">&#x27;mpromise&#x27;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// A query is not a fully-fledged promise, but it does have a `.then()`.</span></span><br><span class="line">query.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="comment">// use doc</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// `.exec()` gives you a fully-fledged promise</span></span><br><span class="line"><span class="keyword">var</span> promise = query.<span class="title function_">exec</span>();</span><br><span class="line">assert.<span class="title function_">ok</span>(promise <span class="keyword">instanceof</span> <span class="built_in">require</span>(<span class="string">&#x27;mpromise&#x27;</span>));</span><br><span class="line"></span><br><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="comment">// use doc</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="Plugging-in-your-own-Promises-Library"><a href="#Plugging-in-your-own-Promises-Library" class="headerlink" title="Plugging in your own Promises Library"></a>Plugging in your own Promises Library</h4><blockquote>
<p>New in Mongoose 4.1.0</p>
</blockquote>
<p>기본 사용에서 mpromise가 만족스러웠지만, 고급 사용자는 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">ES6-style promises</a> 같은 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/bluebird">bluebird</a> 라이브러리를 플러그인으로 넣거나 혹은 네이티브 ES6 를 사용하기를 바랬다. <code>mongoose.Promise</code> 로 좋아하는 ES6 스타일 프로마이즈를 사용할 수 있다.</p>
<blockquote>
<p>Mongoose ES6 native promises, bluebird, and q를 테스트했다. 어떤 라이브러리도 이론적으로<br> Any promise library that exports an ES6-style promise constructor should work in theory, but theory often differs from practice. If you find a bug, open an issue on GitHub</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> query = <span class="title class_">Band</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Guns N&#x27; Roses&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use native promises</span></span><br><span class="line">mongoose.<span class="property">Promise</span> = <span class="variable language_">global</span>.<span class="property">Promise</span>;</span><br><span class="line">assert.<span class="title function_">equal</span>(query.<span class="title function_">exec</span>().<span class="property">constructor</span>, <span class="variable language_">global</span>.<span class="property">Promise</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bluebird</span></span><br><span class="line">mongoose.<span class="property">Promise</span> = <span class="built_in">require</span>(<span class="string">&#x27;bluebird&#x27;</span>);</span><br><span class="line">assert.<span class="title function_">equal</span>(query.<span class="title function_">exec</span>().<span class="property">constructor</span>, <span class="built_in">require</span>(<span class="string">&#x27;bluebird&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use q. Note that you **must** use `require(&#x27;q&#x27;).Promise`.</span></span><br><span class="line">mongoose.<span class="property">Promise</span> = <span class="built_in">require</span>(<span class="string">&#x27;q&#x27;</span>).<span class="property">Promise</span>;</span><br><span class="line">assert.<span class="title function_">ok</span>(query.<span class="title function_">exec</span>() <span class="keyword">instanceof</span> <span class="built_in">require</span>(<span class="string">&#x27;q&#x27;</span>).<span class="property">makePromise</span>);</span><br></pre></td></tr></table></figure>




<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/">mongoose doc</a></li>
<li><a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/api.html">mongoose api doc</a></li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/mpromise">mpromise</a></li>
<li>bluebird](<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/bluebird">https://www.npmjs.com/package/bluebird</a>)</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">ES6-style promises</a></li>
</ul>
<p>[^1]: <a target="_blank" rel="noopener" href="http://programmingsummaries.tistory.com/325">Promise 란</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-21T00:00:00.000Z" title="2017-4-21 9:00:00">2017-04-21</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:42:17.377Z" title="2022-2-25 1:42:17">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">19분안에 읽기 (약 2860 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/21/linux-2017-04-21-mongodb-collections/">mongodb - Collection</a></h1><div class="content"><h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><p>mongoDB는<br>mongoDB는 Collection 이 데이터베이스 테이블과 같은 개념이다. 아래 테이블은 관계형 데이터베이스 MySQL과 MongoDB의 개념을 비교해 주고 있다. [^1]</p>
<table>
<thead>
<tr>
<th>MySQL</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td>Collection</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
</tr>
<tr>
<td>Joins</td>
<td>Embedded documents, linking</td>
</tr>
</tbody></table>
<h3 id="늦은-데이터베이스-생성-Lazy-Creation"><a href="#늦은-데이터베이스-생성-Lazy-Creation" class="headerlink" title="늦은 데이터베이스 생성 Lazy Creation"></a>늦은 데이터베이스 생성 Lazy Creation</h3><p><code>use</code> 명령은 데이터베이스가 존재하지 않으면 새로운 데이터베이스를 생성하고, 그리고 해당 데이터베이스로 전환한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; use mydb</span><br><span class="line">switched to db mydb</span><br></pre></td></tr></table></figure>

<p>그러나 mongodb는 <strong>lazy creation</strong> 방식을 채용해서 실제 데이터가 CRUD로 조작 될 때 컬렉션이 데이터베이스에 생성된다. <code>use DATABASE</code> 명령 만으로는 실제 데이터 저장공간이 만들어 지지 않는다. 아래같이 <code>show dbs</code> 를 실행해도 데이터베이스가 검색되지 않는다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; use first;</span><br><span class="line">switched to db first</span><br><span class="line"></span><br><span class="line">&gt; show dbs;</span><br><span class="line">local   (empty)</span><br><span class="line">test    <span class="number">0.</span>203125GB</span><br></pre></td></tr></table></figure>

<p>아래와 같이 <code>collection.save()</code> 함수로 새로운 컬렉션에 도큐멘트을 생성하면 데이터베이스 저장 공간에 컬렉션 안에 도큐멘트가 생성되면서 실제 데이터가 저장된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">first</span>.<span class="title function_">save</span>(&#123; <span class="attr">hello</span>: <span class="string">&quot;Hello, Mongodb&quot;</span>&#125;);</span><br><span class="line">&gt; show dbs;</span><br><span class="line">first   <span class="number">0.</span>203125GB</span><br><span class="line">local   (empty)</span><br><span class="line">test    <span class="number">0.</span>203125GB</span><br></pre></td></tr></table></figure>

<p>현재 <code>use</code> 로 사용 중인 데이터베이스는 <code>dropDatabase()</code> 함수로 데이터베이스를 삭제할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; use first</span><br><span class="line">switched to db first</span><br><span class="line">&gt; db.<span class="title function_">dropDatabase</span>(<span class="params"></span>)</span><br><span class="line">&#123; <span class="string">&quot;dropped&quot;</span> : <span class="string">&quot;first&quot;</span>, <span class="string">&quot;ok&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&gt; show dbs</span><br></pre></td></tr></table></figure>

<h3 id="Collection과-Documents"><a href="#Collection과-Documents" class="headerlink" title="Collection과 Documents"></a>Collection과 Documents</h3><p>mongoDB에 저장되는 도큐멘트는 JSON ojbect 와 유사하게 <em>속성:값</em> 형태로 구성된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> n = &#123; <span class="attr">name</span>: <span class="string">&quot;Ed&quot;</span>, <span class="attr">languages</span>: [<span class="string">&quot;c&quot;</span>, <span class="string">&quot;ruby&quot;</span>, <span class="string">&quot;js&quot;</span>] &#125;;</span><br><span class="line"><span class="keyword">var</span> student = &#123; <span class="attr">name</span>: <span class="string">&quot;Jim&quot;</span>, <span class="attr">scores</span>: [<span class="number">75</span>, <span class="number">99</span>, <span class="number">87.2</span>] &#125;;</span><br></pre></td></tr></table></figure>

<p>mongoDB는 document를 컬렉션에 저장한다.</p>
<h4 id="collection-save"><a href="#collection-save" class="headerlink" title="collection.save()"></a>collection.save()</h4><p>아래는 <code>collection.save()</code> 함수로 <em>{a: 99}</em> 도큐멘트를 <em>scores</em> 렉션에 저장하라는 명령이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">scores</span>.<span class="title function_">save</span>(&#123; <span class="attr">a</span>: <span class="number">99</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>실제 데이터베이스의 컬렉션에 도큐멘트가 저장될 때는 바이너리 직렬 구조인 <em>Binary JSON</em>이라는 BSON 으로 저장된다.[^5]</p>
<p>그리고 해당 콜렉션의 담긴 도큐멘트를 <code>find()</code> 함수로 출력한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br></pre></td></tr></table></figure>

<p>반복문을 이용해서 여러개의 documents를 저장할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(i=0; i&lt;100; i++) &#123; db.scores.save( &#123;a:  i, exam: 5 &#125; ) &#125;;</span><br></pre></td></tr></table></figure>

<p>컬렉션 내용을 find()를 실행하면 10개의 결과가 출력됩니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;db.<span class="property">scores</span>.<span class="title function_">save</span>(&#123;<span class="attr">a</span>:i,<span class="attr">b</span>:<span class="string">&#x27;bbb&#x27;</span>&#125;)&#125;;</span><br><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>이렇게 데이터베이스에 저장된 컬렉션을 관계형 데이터베이스 처럼 CRUD 명령 셋트를 이용해 질의를 해서 사용한다.</p>
<h3 id="Basic-Queries"><a href="#Basic-Queries" class="headerlink" title="Basic Queries"></a>Basic Queries</h3><p>관계형데이터 베이스와 NoSQL 데이터베이스는 Query Language가 다르다.</p>
<h4 id="SQL과-NoSQL의-CRUD"><a href="#SQL과-NoSQL의-CRUD" class="headerlink" title="SQL과 NoSQL의 CRUD"></a>SQL과 NoSQL의 CRUD</h4><p>SQL의 INSERT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (user_id, age, status) <span class="keyword">VALUES</span> (<span class="string">&#x27;bcd001&#x27;</span>, <span class="number">45</span>, <span class="string">&#x27;A&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>mongoDB의 INSERT</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">insert</span>(&#123;</span><br><span class="line">  <span class="attr">user_id</span>: <span class="string">&quot;bcd001&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">45</span>,</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>SQL의 SELECT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br></pre></td></tr></table></figure>

<p>mongoDB의 <code>find()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br></pre></td></tr></table></figure>

<p>SQL의 UPDATE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p>mongoDB의 <code>update()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">update</span>(</span><br><span class="line">  &#123; <span class="attr">age</span>: &#123; <span class="attr">$gt</span>: <span class="number">25</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">$set</span>: &#123; <span class="attr">status</span>: <span class="string">&quot;C&quot;</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">multi</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>SQL의 DELETE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id<span class="operator">=</span><span class="string">&#x27;bcd001&#x27;</span></span><br></pre></td></tr></table></figure>

<p>mongoDB의 <code>remove()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">remove</span>(&#123;</span><br><span class="line">  <span class="attr">user_id</span>: <span class="string">&quot;bcd0001&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="collection의-주요-CRUD-함수"><a href="#collection의-주요-CRUD-함수" class="headerlink" title="collection의 주요 CRUD 함수"></a>collection의 주요 CRUD 함수</h4><p>컬렉션에 대한 query는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/js-collection/">Collection Method</a> 에 설명되어 있다. 아래 테이블은 주요 CRUD 함수.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>db.collection.find()</td>
<td>컬렉션에서 쿼리를 행하고 결과를 cursor 객체로 반환</td>
</tr>
<tr>
<td>db.collection.findOne()</td>
<td>쿼리를 실행하고 도큐멘트 하나를 반환한다.</td>
</tr>
<tr>
<td>db.collection.findAndModify()</td>
<td>자동으로 수정하고 도큐멘트 하나를 반환한다.</td>
</tr>
<tr>
<td>db.collection.save()</td>
<td>새 도큐멘트를 삽입하기 위해 <code>insert()</code> 와 <code>update()</code>를 묶어 놓은 함수</td>
</tr>
<tr>
<td>db.collection.insert()</td>
<td>컬렉션 안에 새 문서를 생성한다.</td>
</tr>
<tr>
<td>db.collection.insertOne()</td>
<td>컬렉션 안에 새 문서 하나를 생성한다.</td>
</tr>
<tr>
<td>db.collection.insertMany()</td>
<td>컬렉션 안에 새 문서 여러개를 생성한다.</td>
</tr>
<tr>
<td>db.collection.update()</td>
<td>컬렉션 안의 문서를 수정한다</td>
</tr>
<tr>
<td>db.collection.updateOne()</td>
<td>컬렉션 안에 문서 하나를 수정한다</td>
</tr>
<tr>
<td>db.collection.updateMany()</td>
<td>컬렉션 안에 여러 문서를 수정한다</td>
</tr>
<tr>
<td>db.collection.remove()</td>
<td>컬렉션에서 문서(들)을 삭제한다</td>
</tr>
<tr>
<td>db.collection.renameCollection()</td>
<td>컬렉션 이름을 바꾼다</td>
</tr>
</tbody></table>
<h4 id="컬렉션-보기"><a href="#컬렉션-보기" class="headerlink" title="컬렉션 보기"></a>컬렉션 보기</h4><p><code>show collections</code> 명령은 콜렉션의 목록을 볼 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; show collections</span><br><span class="line">foo</span><br><span class="line">scores</span><br><span class="line">system.<span class="property">indexes</span></span><br><span class="line">users</span><br></pre></td></tr></table></figure>

<p><code>collection.renameCollection()</code>로 콜렉션명을 수정 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.[collectionName].renameCollection(&quot;newCollectionName&quot;);</span><br></pre></td></tr></table></figure>

<p>콜렉션의 삭제는 아래와 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.[collectionName].drop()</span><br></pre></td></tr></table></figure>

<h4 id="document-조회-–-find"><a href="#document-조회-–-find" class="headerlink" title="document 조회 – find()"></a>document 조회 – find()</h4><p><code>find()</code>는 컬렉션 안의 도큐멘트 전체 혹은 지정한 도큐멘트의 속성에 해당하는 도큐멘트를 반환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.[collectionName].find([Document]);</span><br></pre></td></tr></table></figure>

<p>데이터베이스 컬렉션 <em>students</em> 안의 도큐멘트를 <code>find()</code> 함수로 보여준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">students</span>.<span class="title function_">find</span>(<span class="params"></span>)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;513b38ad81dc4b8f06062146&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;james&quot;</span>, <span class="string">&quot;age&quot;</span> : <span class="number">24</span>, <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p><code>find()</code>로 콜렉션에 지정한 속성 값만 검색할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">students</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;jessi&#x27;</span>, <span class="attr">age</span>:<span class="number">20</span>, <span class="attr">grade</span>:<span class="string">&#x27;A&#x27;</span>&#125;);</span><br><span class="line">&gt; db.<span class="property">students</span>.<span class="title function_">find</span>(<span class="params">&#123;name:<span class="string">&#x27;james&#x27;</span>&#125;</span>)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;513b38ad81dc4b8f06062146&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;james&quot;</span>, <span class="string">&quot;age&quot;</span> : <span class="number">24</span>, <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 에서 a가 0인 데이터를 출력해 보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:<span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 에서 a:1, b:bbb인 데이터를 출력해 보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="string">&#x27;bbb&#x27;</span>&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592b&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 안의 모든 도큐멘트를 a:1을 기준으로 정렬해서 반환한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>().<span class="title function_">sort</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592b&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 안의 도큐멘트 숫자를 반환한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">count</span>();</span><br><span class="line"><span class="number">110</span></span><br></pre></td></tr></table></figure>

<h4 id="findOne"><a href="#findOne" class="headerlink" title="findOne()"></a>findOne()</h4><p>find()와 동일한 매개변수를 이용할 수 있습니다. 다른점은 find()는 커서를 리턴하지만, findOne()은 데이터베이스에서 첫번째 document나 null을 리턴합니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">a</span>:<span class="number">0</span>&#125;);</span><br><span class="line">&gt; <span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">결국 이 쿼리는</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line">&gt; <span class="title function_">find</span>(&#123;<span class="attr">a</span>:<span class="string">&quot;0&quot;</span>&#125;).<span class="title function_">limit</span>(<span class="number">1</span>).</span><br></pre></td></tr></table></figure>

<p>와 동일한 결과를 얻습니다.</p>
<h4 id="limit"><a href="#limit" class="headerlink" title="limit();"></a>limit();</h4><p>쿼리의 결과의 수를 제한된 수의 결과로 제한하게 해서 처리할 수 있습니다.</p>
<p>MongoDB cursors are not snapshots - operations performed by you or other users on the collection being queried between the first and last call to next() of your cursor may or may not be returned by the cursor. Use explicit locking to perform a snapshotted query.</p>
<p>mongo 쉘 에서 고급 기법에 대해서는 아래 링크를 참조하세요.</p>
<p><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/mongo+-+The+Interactive+Shell">http://www.mongodb.org/display/DOCS/mongo+-+The+Interactive+Shell</a></p>
<h4 id="Cursor-객체"><a href="#Cursor-객체" class="headerlink" title="Cursor 객체"></a>Cursor 객체</h4><p>find()는 cursor 객체를 리턴합니다. cursor 객체는 쿼리의 결과 집합에 대한 포인터라고 한다.[^3]<br>cursor는 여러 데이터의 집합이므로 아래 같이 이용 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> cursor = db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br><span class="line">&gt; <span class="keyword">while</span>(cursor.<span class="title function_">hasNext</span>()) <span class="title function_">printjson</span>(cursor.<span class="title function_">next</span>());</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>printjson()</code> 은 내장 함수로 데이터를 json 형식으로 출력해 준다.</li>
</ul>
<p>mongo 쉘로 사용시 아래 처럼 foreach 콜백 함수를 이용할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>().<span class="title function_">forEach</span>(printjson);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>

<p>또한 cursor를 배열 처럼 이용 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> cursor = db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br><span class="line">&gt; <span class="title function_">printjson</span>(cursor[<span class="number">10</span>]);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>이 시점에 결과가 메모리에 적재되기 때문에 아주 큰 데이터를 다루면 out of memory를 만나게 될 수 있다. 배열 스타일의 접근을 위해 cursor 를 배열로 변경할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> arr = db.<span class="property">scores</span>.<span class="title function_">find</span>().<span class="title function_">toArray</span>();</span><br><span class="line">&gt; arr[<span class="number">10</span>];</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="도큐멘트-update"><a href="#도큐멘트-update" class="headerlink" title="도큐멘트 - update"></a>도큐멘트 - update</h4><p>mongoDB에서 도큐멘트 갱신은 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/update-methods/">update methods</a>를 참고한다.</p>
<p>update() 메서드는 다음 형식으로 되어 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(query, update, options)</span><br></pre></td></tr></table></figure>

<p>아래와 같은 두 개의 document가 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">books</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>,<span class="attr">language</span>:[<span class="string">&#x27;Java&#x27;</span>,<span class="string">&#x27;C++&#x27;</span>]&#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;Jenny&#x27;</span>,<span class="attr">language</span>:[<span class="string">&#x27;HTML5&#x27;</span>,<span class="string">&#x27;Actionscript&#x27;</span>]&#125;);</span><br></pre></td></tr></table></figure>

<p><code>update()</code> 업데이트를 하면 전체 문서에 대해서 갱신이 된다. 아래 쿼리는 <code>Jenny</code> 라는 name 속성을 가진 도큐멘트를 모두 주어진 도큐멘트 속서으로 변경한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>( &#123;<span class="attr">name</span>:<span class="string">&#x27;Jenny&#x27;</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>,<span class="attr">language</span>:[<span class="string">&#x27;Korea&#x27;</span>,<span class="string">&#x27;English&#x27;</span>]&#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc05ff01708cc4a3eadd3c8&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0601d1708cc4a3eadd3c9&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;English&quot;</span> ] &#125;</span><br></pre></td></tr></table></figure>

<p>데이터의 일정부분만 갱신하려면 <code>$set</code> 연산자 및 배열을 위한 <code>$push</code>, <code>$pull</code> 연산자를 함께 사용할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>( &#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>&#125;, &#123;<span class="string">&#x27;$set&#x27;</span>: &#123;<span class="attr">age</span>:<span class="string">&#x27;30&#x27;</span>&#125;&#125; );</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0601d1708cc4a3eadd3c9&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;English&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc060fa1708cc4a3eadd3ca&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc060fe1708cc4a3eadd3cb&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;English&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc05ff01708cc4a3eadd3c8&quot;</span>), <span class="string">&quot;age&quot;</span> : <span class="string">&quot;30&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span> ], <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;Sue&#x27;</span>&#125;, &#123;<span class="string">&#x27;$pull&#x27;</span>: &#123;<span class="string">&#x27;languages&#x27;</span>: <span class="string">&#x27;scala&#x27;</span>&#125; &#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;Sue&#x27;</span>&#125;, &#123;<span class="string">&#x27;$push&#x27;</span>: &#123;<span class="string">&#x27;languages&#x27;</span>: <span class="string">&#x27;ruby&#x27;</span>&#125; &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="collection-remove"><a href="#collection-remove" class="headerlink" title="collection.remove()"></a>collection.remove()</h4><p>도큐멘트의 항목을 삭제할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">remove</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>&#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br></pre></td></tr></table></figure>

<p>모든 데이터를 제거하려면 remove()만 호출합니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">remove</span>();</span><br></pre></td></tr></table></figure>

<p>index 생성</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">scores</span>.<span class="title function_">encureIndex</span>( &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:’bbb’&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">group</span>(), <span class="title function_">min</span>(), <span class="title function_">max</span>(), $where</span><br></pre></td></tr></table></figure>

<h3 id="Query와-Projection-연산자"><a href="#Query와-Projection-연산자" class="headerlink" title="Query와 Projection 연산자"></a>Query와 Projection 연산자</h3><p>쿼리에 제약 혹은 확장을 할 수 있는 쿼리 선택자 (Query selector)는 비교, 논리, 요소, 배열 등에 대한 연산자로 지원된다. Projection 연산자는 쿼리의 특정 부분만을 투영할 수 있는 연산자를 지원하고 있다. [^4]</p>
<p>자세하고 더 많은 내용은 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/">Query and Projection operators</a>를 참조하라.</p>
<h4 id="gt-연산자"><a href="#gt-연산자" class="headerlink" title="$gt 연산자"></a><code>$gt</code> 연산자</h4><p>입력된 데이터에서 20보다 큰 데이터를 찾아 보겠습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$gt&#x27;</span>:<span class="number">30</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005949&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">31</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400594a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">32</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400594b&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">33</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>

<h4 id="gte-연산자"><a href="#gte-연산자" class="headerlink" title="$gte 연산자"></a><code>$gte</code> 연산자</h4><p><code>$gte</code>는 Greater Than or Equal로 크거나 같은 값을 비교하는 연산자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$gte&#x27;</span>:<span class="number">22</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005940&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">22</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005941&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">23</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="lt-lte-연산자"><a href="#lt-lte-연산자" class="headerlink" title="$lt, $lte 연산자"></a><code>$lt</code>, <code>$lte</code> 연산자</h4><p><code>$lte</code> 연산자는 작거나 같은 값을 비교하는 연산자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>( &#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$lte&#x27;</span>:<span class="number">5</span>&#125;&#125; );</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="ne-연산자"><a href="#ne-연산자" class="headerlink" title="$ne 연산자"></a><code>$ne</code> 연산자</h4><p><code>$ne</code> 연산자는 같지 않은 값을 비교하는 연산자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">b</span>:&#123;<span class="string">&#x27;$ne&#x27;</span>:<span class="string">&#x27;bbb&#x27;</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br></pre></td></tr></table></figure>

<p><code>$gte</code> 와 <code>$lte</code>를 동시에 쓰기도 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>: &#123;<span class="string">&#x27;$gte&#x27;</span>:<span class="number">5</span>,<span class="string">&#x27;$lte&#x27;</span>:<span class="number">8</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e32&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">5</span>, <span class="string">&quot;b&quot;</span> : <span class="number">6</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e33&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">6</span>, <span class="string">&quot;b&quot;</span> : <span class="number">7</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e34&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">7</span>, <span class="string">&quot;b&quot;</span> : <span class="number">8</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="in-in-Array"><a href="#in-in-Array" class="headerlink" title="$in in Array"></a><code>$in</code> in Array</h4><p><code>$in</code> 연산자는 주어진 컬렉션 값이 포함되었는지 비교한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$in&#x27;</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>]&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005934&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">10</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400593e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">20</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005948&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">30</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005952&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">40</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>반대로 <code>$nin</code> 연산자는 주어진 컬렉션에 포함 안된 값을 비교한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$nin&#x27;</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>]&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br><span class="line">…</span><br><span class="line">has more</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<!--

#### Query#populate

`query#populate` 는 쿼리 결과에서 특정한 쿼리를 다시 질의할 수 있다.

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query.populate( path, [fields], [model], [cond], [options] )</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Album</span>.<span class="title function_">findOne</span>().<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err, doc</span>) &#123;</span><br><span class="line">   <span class="comment">// print undefind</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( doc.<span class="property">artist</span>.<span class="property">name</span>) ;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Album</span>.<span class="title function_">findOne</span>().<span class="title function_">populate</span>(<span class="string">&#x27;artist&#x27;</span>).<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err, doc</span>) &#123;</span><br><span class="line">   <span class="comment">// print fink flod</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( doc.<span class="property">artist</span>.<span class="property">name</span>) ;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://www.mongodb.com/compare/mongodb-mysql?jmp=docs">Terminology and Concepts</a><br>[^3]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/glossary/#term-cursor">Cursor</a><br>[^4]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/">Query and Projection operators</a><br>[^5]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/glossary/#term-bson">Term of BSON</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-20T00:00:00.000Z" title="2017-4-20 9:00:00">2017-04-20</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:37:02.491Z" title="2022-2-25 1:37:02">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">11분안에 읽기 (약 1577 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/20/linux-2017-04-20-mongodb-user-auth/">MongoDB - Database와 User Authentication</a></h1><div class="content"><blockquote>
<p>2018-06-21 설치 링크로 대체<br>{:.right-history}</p>
</blockquote>
<p>MongoDB 설치후 데이터베이스 위치, 로그, 인증 등에 관련한 서버 구성과 설정을 정리한다.</p>
<blockquote>
<p>MongoDB 2.6 과 MongoDB Community Edition 3.x 버전을 사용했다.</p>
</blockquote>
<h2 id="mongoDB-접근제어"><a href="#mongoDB-접근제어" class="headerlink" title="mongoDB 접근제어"></a>mongoDB 접근제어</h2><p>mongoDB 는 설치과정 중에 인증과 관련해 설정하는 부분이 없어서 설치 후 누구나 DB에 접속 할 수 있다. 인증을 추가해 데이터베이스 관리자와 데이터베이스 사용자로 구분해서 이용하고, 각 데이터베이스의 사용자는 허가된 역할(Role)을 가지고 데이터베이스에 접근 가능하도록 구성한다.</p>
<p>여기서는 다음 두 가지를 다루고 있다.</p>
<ul>
<li><strong>(1) 데이터베이스 관리자 추가</strong></li>
<li><strong>(2) 데이터베이스 사용자 추가</strong></li>
</ul>
<p>Ubuntu&#x2F;Debian 리눅스 배포본에 MongoDB 3.x 버전이 지원되지 않으면, MongoDB Community Edition 를 패키지 혹은 소스로 설치할 수 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC11--">MongoDB Community Edition 3.4 on Armv8</a></li>
<li><a href="!--swig%EF%BF%BC12--">MongoDB Community Edition 3.6</a></li>
</ul>
<h3 id="데이터베이스-관리자"><a href="#데이터베이스-관리자" class="headerlink" title="데이터베이스 관리자"></a>데이터베이스 관리자</h3><p>mongod가 <strong>비인증 모드로 실행</strong>중인 상태에서, <code>mongo</code> 클라이언트로 데이터베이스에 접속한다.접속에 성공하면 <strong>&gt;</strong> 프롬프트가 표시된다. 그리고 접속한 후에 <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><code>mongo</code> 클라이언트로 접속해 mongoDB 데이터베이스 관리자 <strong>admin</strong> 추가해서, 사용자 롤로 <code>userAdminAnyDatabase</code> 롤을 추가해준다.</p>
<h4 id="mongoDB-2-6-이후-관리자-계정-추가"><a href="#mongoDB-2-6-이후-관리자-계정-추가" class="headerlink" title="mongoDB 2.6 이후 관리자 계정 추가"></a>mongoDB 2.6 이후 관리자 계정 추가</h4><p>mongoDB 2.6 이후는 <code>db.createUser()</code> 로 사용자를 추가한다. [^2]<br>다음은 admin 데이터베이스에서 사용자를 관리하는 admin 계정을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;</span><br><span class="line">&gt; db.createUser(&#123; user:&#x27;admin&#x27;,</span><br><span class="line">                   pwd:&#x27;****&#x27;,</span><br><span class="line">                   roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">               &#125;)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers() // 데이터베이스 사용자 확인</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">        &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">        &quot;roles&quot; : [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">                &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>[^2]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v2.6/tutorial/enable-authentication-without-bypass/">Enable Authentication after Creating the User Administrator(v2.6)</a></p>
<h4 id="mongoDB-2-4-이전-관리자-계정-추가"><a href="#mongoDB-2-4-이전-관리자-계정-추가" class="headerlink" title="mongoDB 2.4 이전 관리자 계정 추가"></a>mongoDB 2.4 이전 관리자 계정 추가</h4><p>mongoDB 2.4 까지는 새로운 사용자는 <code>db.addUser()</code> 로 추가한다.[^1]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mongo     // mongo client 로 접속</span><br><span class="line">&gt;use admin  // admin DB 사용</span><br><span class="line">&gt;db.addUser( &#123; user: &quot;&lt;username&gt;&quot;, // admin name</span><br><span class="line">              pwd: &quot;&lt;password&gt;&quot;,</span><br><span class="line">              roles: [ &quot;userAdminAnyDatabase&quot; ] // Database role</span><br><span class="line">          &#125; )</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mongoDB 2.6까지 32bit 버전을 지원하고 있다.</p>
</blockquote>
<p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v2.4/tutorial/add-user-administrator/">Add User Administrator(v2.4 )</a></p>
<p>관리자 계정을 만든후 MongoDB에 <code>mongo</code> 클라이언트로 인증 로그인을 한 후에 데이터베이스를 생성하고 해당 데이터베이스 사용자에 접근 권한을 추가해 준다.</p>
<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<h3 id="데이터-베이스-생성과-롤-기반-인증"><a href="#데이터-베이스-생성과-롤-기반-인증" class="headerlink" title="데이터 베이스 생성과 롤 기반 인증"></a>데이터 베이스 생성과 롤 기반 인증</h3><h4 id="관리자-로그인"><a href="#관리자-로그인" class="headerlink" title="관리자 로그인"></a>관리자 로그인</h4><p>이제 데이터베이스 관리자 계정으로 로그인해서 사용하려는 데이터베이스를 <code>use</code>로 선택하고 해당 데이터베이스 사용자를 추가해준다.</p>
<p><code>mongo</code> 클라이언트 로그인시 <code>-u &lt;username&gt;</code>, <code>-p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u <span class="string">&quot;admin&quot;</span> -p <span class="string">&quot;****&quot;</span> --authenticationDatabase <span class="string">&quot;admin&quot;</span></span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br></pre></td></tr></table></figure>

<p>혹은 인증없이 <code>mongo</code> 클라이언트로 데이터베이스에 접속한 후에 <code>db.auth()</code> 명령을 사용할 수 있다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.auth(<span class="string">&quot;admin&quot;</span><span class="punctuation">,</span> <span class="string">&quot;****&quot;</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; show users</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;5733676238ac1ddf4cf745c2&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;readOnly&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pwd&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;24413999168dccff96dcc735720c85ce&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>이제 각 데이터베이스에 사용자를 생성해서 사용해서 인증한 사용자만 데이터베이스를 사용하게 할 수 있다.</p>
<h3 id="Database-사용자-추가"><a href="#Database-사용자-추가" class="headerlink" title="Database 사용자 추가"></a>Database 사용자 추가</h3><h4 id="mongoDB-v3-x-사용자-관리"><a href="#mongoDB-v3-x-사용자-관리" class="headerlink" title="mongoDB v3.x 사용자 관리"></a>mongoDB v3.x 사용자 관리</h4><p>mongoDB v2.6 히우는 대부분 mongoDB v3.4와 호환되는 사용자 관리 명령을 사용한다. 여기서는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/js-user-management/">User Management Methods (v3.4)</a>를 참고하고 있다.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>db.auth()</td>
<td>데이터베이스에 사용자 인증</td>
</tr>
<tr>
<td>db.createUser()</td>
<td>Creates a new user.</td>
</tr>
<tr>
<td>db.updateUser()</td>
<td>Updates user data.</td>
</tr>
<tr>
<td>db.changeUserPassword()</td>
<td>사용자 패스워드 변경</td>
</tr>
<tr>
<td>db.dropAllUsers()</td>
<td>데이터베이스에 관련된 모든 사용자를 삭제한다.</td>
</tr>
<tr>
<td>db.dropUser()</td>
<td>한 사용자를 삭제한다</td>
</tr>
<tr>
<td>db.grantRolesToUser()</td>
<td>롤과 권한을 사용자에 허용한다</td>
</tr>
<tr>
<td>db.revokeRolesFromUser()</td>
<td>사용자에 부여한 롤을 삭제한다</td>
</tr>
<tr>
<td>db.getUser()</td>
<td>지정한 사용자의 정보를 반환한다</td>
</tr>
<tr>
<td>db.getUsers()</td>
<td>데이터베이스에 관련된 모든 사용자의 정보를 반환한다</td>
</tr>
</tbody></table>
<h4 id="createUser"><a href="#createUser" class="headerlink" title="createUser()"></a>createUser()</h4><p><code>db.createUser()</code> 는 두 개의 도큐멘트를 인자로 사용한다:</p>
<blockquote>
<p>db.createUser(user, writeConcern)</p>
</blockquote>
<p>여기서 <strong>user</strong> 도큐멘트는 아래 같은 형식을 갖는다:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> user<span class="punctuation">:</span> <span class="string">&quot;&lt;name&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  pwd<span class="punctuation">:</span> <span class="string">&quot;&lt;cleartext password&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  customData<span class="punctuation">:</span> <span class="punctuation">&#123;</span> &lt;any information&gt; <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  roles<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> role<span class="punctuation">:</span> <span class="string">&quot;&lt;role&gt;&quot;</span><span class="punctuation">,</span> db<span class="punctuation">:</span> <span class="string">&quot;&lt;database&gt;&quot;</span> <span class="punctuation">&#125;</span> | <span class="string">&quot;&lt;role&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>customData</strong>: 선택적으로 추가할 정보를 담은 도큐멘트.</li>
</ul>
<p>다음은 <em>product</em> 데이터베이스로 전환해서 <em>product</em> 데이터베이스 사용자를 추가하고 있다. <em>customeData</em> 를 주목하자.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; use products</span><br><span class="line">db.createUser( &#123; user: &quot;user1&quot;,</span><br><span class="line">                 pwd: &quot;changeMe&quot;,</span><br><span class="line">                 customData: &#123; employeeId: 12345 &#125;, // prducts</span><br><span class="line">                 roles: [ &#123; role: &quot;clusterAdmin&quot;, db: &quot;admin&quot; &#125;,</span><br><span class="line">                          &#123; role: &quot;readAnyDatabase&quot;, db: &quot;admin&quot; &#125;,</span><br><span class="line">                          &quot;readWrite&quot;] &#125;,</span><br><span class="line">               &#123; w: &quot;majority&quot; , wtimeout: 5000 &#125; )</span><br></pre></td></tr></table></figure>

<p>다양한 사례는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.createUser/#examples">createUser() Exmaple</a> 를 참고하자.</p>
<p>mongoDB v2.4는 사용자 추가 방법이 조금 다르다.</p>
<h4 id="mongoDB-v2-4-사용자-추가"><a href="#mongoDB-v2-4-사용자-추가" class="headerlink" title="mongoDB v2.4 사용자 추가"></a>mongoDB v2.4 사용자 추가</h4><p>사용하려는 데이터베이스의 계정으로 접근제어를 추가해 주어야 한다. mongoDB 2.4 까지는 새로운 사용자는 <code>db.addUser()</code> 로 추가한다.[^3]</p>
<p>[^3]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v2.4/tutorial/add-user-to-database/">Add User To Database(v2.4)</a></p>
<p>아래는 데이터베이스 관리자 계정 <em>admin</em>으로 로그인해서, 필요하면 students 데이터베이스를 생성합니다. 그리고 students 데이터베이스 사용자 <em>student</em> 계정을 추가하고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; use students</span><br><span class="line">switched to db students</span><br><span class="line">&gt; db.<span class="title function_">addUser</span>(<span class="params"><span class="string">&#x27;student&#x27;</span>, <span class="string">&#x27;****&#x27;</span></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;user&quot;</span> : <span class="string">&quot;student&quot;</span>,</span><br><span class="line">    <span class="string">&quot;readOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span> : <span class="string">&quot;7a70591507db46bdd3df47a213d8922f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57336a71c1ef2bed6688d296&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&gt; db.<span class="title function_">auth</span>(<span class="string">&#x27;student&#x27;</span>, <span class="string">&#x27;012345&#x27;</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; db.<span class="property">student</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;qkboo&#x27;</span>, <span class="attr">class</span>:<span class="string">&#x27;Database&#x27;</span>, <span class="attr">grade</span>:<span class="string">&#x27;A&#x27;</span>&#125;)</span><br><span class="line">&gt; db.<span class="property">student</span>.<span class="title function_">find</span>(<span class="params"></span>)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57336b7d1be9091521cbeb36&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;qkboo&quot;</span>, <span class="string">&quot;class&quot;</span> : <span class="string">&quot;IoT&quot;</span>, <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>이제 <code>mongo</code> 클라이언트로 생성한 <em>students</em> 에 데이터베이스 사용자 <em>student</em>로 로그인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mongo student -u student -p ****</span><br><span class="line">MongoDB shell version: 2.4.10</span><br><span class="line">connecting to: student</span><br></pre></td></tr></table></figure>

<p>만약 해당 데이터베이스 사용자가 아닌 계정에서 데이터베이스 접근시 다음 같이 인증되지 않은 접근으로 에러를 발생한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line"><span class="title class_">MongoDB</span> shell <span class="attr">version</span>: <span class="number">2.4</span><span class="number">.10</span></span><br><span class="line">connecting <span class="attr">to</span>: test</span><br><span class="line">&gt; use student</span><br><span class="line">switched to db student</span><br><span class="line">&gt; show dbs</span><br><span class="line"><span class="title class_">Tue</span> <span class="title class_">Sep</span> <span class="number">27</span> <span class="number">23</span>:<span class="number">45</span>:<span class="number">38.269</span> listDatabases <span class="attr">failed</span>:&#123; <span class="string">&quot;ok&quot;</span> : <span class="number">0</span>, <span class="string">&quot;errmsg&quot;</span> : <span class="string">&quot;unauthorized&quot;</span> &#125; at src/mongo/shell/mongo.<span class="property">js</span>:<span class="number">46</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB에-관련-글"><a href="#MongoDB에-관련-글" class="headerlink" title="MongoDB에 관련 글"></a>MongoDB에 관련 글</h2><p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-11T01:00:00.000Z" title="2017-4-11 10:00:00">2017-04-11</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:35:37.606Z" title="2022-2-25 1:35:37">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">15분안에 읽기 (약 2269 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/11/linux-2017-04-11-mongodb-3-4-install-armv8/">mongodb 3.4 on Armbian</a></h1><div class="content"><blockquote>
<p>2018-06-22 내용 정리, User auth 링크<br>{:.right-history}</p>
</blockquote>
<p>이 문서는 MongoDB Community Edition 3.4 버전을 <em>64bit OS</em>인 <em>Amd64</em>, <em>Arm64</em> 지원 OS에 설치해 사용하기 위해서 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v3.4/tutorial/install-mongodb-on-ubuntu/">Install MongoDB Community Edition, on-ubuntu</a>를 따라서 진행했다.</p>
<p>여기서는 Arm을 사용하는 SBC[^2] 컴퓨터에 mongodb 3.4 버전을, <em>Hardkernel Odroid C2</em>를 사용해서 설치를 진행했다.</p>
<ul>
<li>Odroid C2 for 64bit</li>
<li>Armbian Ubuntu Xeniel</li>
</ul>
<h2 id="MongoDB-Community-edition"><a href="#MongoDB-Community-edition" class="headerlink" title="MongoDB Community edition"></a>MongoDB Community edition</h2><p>테스트한 Arm64 기반의 Odroic C2 에서는 <em>MongoDB Community Edition</em>을 설치한 후에 <code>systemd</code> 관련 스크립트와 설정 파일등이 적절히 설치되지 않아서, 이 부분에 대한 언급을 추가했다.</p>
<h3 id="사전준비"><a href="#사전준비" class="headerlink" title="사전준비"></a>사전준비</h3><p>여기서는 Odroid C2 를 사용하고 Armbian 배포본에서 Ubuntu Xeniel 버전을 사용했다.</p>
<ul>
<li>Armbian 배포본 Debian Jessie 에는 아직 mongodb 64bit 를 제공하지 않고 있다.</li>
</ul>
<h4 id="레포지토리-등록"><a href="#레포지토리-등록" class="headerlink" title="레포지토리 등록"></a>레포지토리 등록</h4><p>아래 같이 키 서버를 등록하고 apt source list에 mongodb 를 등록한다.</p>
<blockquote>
<p>여러분 시스템이 적용되는 지는 [^1]에 잘 설명되어 있다.</p>
</blockquote>
<p><em>키서버 등록</em></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6</span><br></pre></td></tr></table></figure>

<p>Mongodb 3.4 는 <code>/etc/apt/sources.list.d/mongodb-org-3.4.list</code> 파일 생성하고 아래 같이 해당 리눅스 버전에 맞는 소스 목록을 추가한다.</p>
<p><em>Ubuntu 16.04</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list</span><br></pre></td></tr></table></figure>

<p><em>Ubuntu 14.04</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list</span><br></pre></td></tr></table></figure>

<h4 id="remove-key-amp-ppa"><a href="#remove-key-amp-ppa" class="headerlink" title="remove key &amp; ppa"></a>remove key &amp; ppa</h4><p>설치 후 필요 없어서 키 서버, 저장소 목록을 지우려면,</p>
<p>삭제할 키 해시 코드 확인: 다음 같이 8자리 코드로 나오거나</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key list</span><br><span class="line"></span><br><span class="line">pub   4096R/A15703C6 2016-01-11 [expires: 2018-01-10]</span><br><span class="line">uid                  MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br></pre></td></tr></table></figure>

<p>다음 같이 긴 해시 코드로 나온다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--------------------</span><br><span class="line">pub   rsa4096 2016-01-11 [SC] [expires: 2018-01-10]</span><br><span class="line">      0C49 F373 0359 A145 1858  5931 BC71 1F9B A157 03C6</span><br><span class="line">uid           [ unknown] MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br><span class="line"></span><br><span class="line">/etc/apt/trusted.gpg.d/debian-archive-jessie-automatic.gpg```</span><br></pre></td></tr></table></figure>

<p>이 키를</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key del A15703C6</span><br></pre></td></tr></table></figure>

<h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><p>그리고 <code>apt</code> 명령으로 소스 캐시를 갱신하고 mongodb-org 커뮤니티 버전의 mongodb를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install mongodb-org</span><br></pre></td></tr></table></figure>

<blockquote>
<p>설치전 mongodb 3.x 버전은 데이터 저장 파일 시스템으로 xfs 를 권장하고 있다.</p>
</blockquote>
<br/>
<br/>

<h4 id="create-systemd-x2F-service-entry"><a href="#create-systemd-x2F-service-entry" class="headerlink" title="create systemd &#x2F; service entry"></a>create systemd &#x2F; service entry</h4><p><strong>mongodb-org</strong> 설치후 <code>systemctl</code> 스크립트가 <code>/etc/init.d</code>에 복사되지 않았다.</p>
<blockquote>
<p>여기서는 odroid-c2 armbian 설치 상태, 일반 리눅스 배포본은 잘 된다.</p>
</blockquote>
<p>아래 명령을 실행해 <strong>mongodb.service</strong> 가 없으면 새로 생성해야 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --<span class="built_in">type</span>=service |grep mongodb</span><br></pre></td></tr></table></figure>

<p>만약 <strong>mongodb.service</strong> 가 없다면, <code>/lib/systemd/system/mongod.service</code> 파일을 다음 같이 활성화 시켜준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /lib/systemd/system</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> mongodb.service</span><br></pre></td></tr></table></figure>

<p><strong>mongodb.service</strong> 가 있고,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --<span class="built_in">type</span>=service |grep mongodb</span><br><span class="line">mongodb.service             disabled</span><br></pre></td></tr></table></figure>

<p><em>disable</em> 상태면 <code>systemctl</code> 명령으로 <em>enable</em> 시킨다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> mongodb.service</span><br></pre></td></tr></table></figure>

<p>그리고 서비스를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br><span class="line">● mongod.service - High-performance, schema-free document-oriented database</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Tue 2017-07-18 09:17:53 UTC; 1s ago</span><br><span class="line">     Docs: https://docs.mongodb.org/manual</span><br><span class="line"> Main PID: 7234 (mongod)</span><br><span class="line">   CGroup: /system.slice/mongod.service</span><br><span class="line">           └─7234 /usr/bin/mongod --config /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">Jul 18 09:17:53 odroidc2 systemd[1]: Started High-performance, schema-free document-oriented database.</span><br></pre></td></tr></table></figure>

<p>mongod 서비스가 제대로 실행됐으면 <strong>mongo</strong> 클라이언트로 테스트해 볼 수 있으면 접속해 볼 수 있다.</p>
<br/>
<br/>

<h3 id="Mongo-Database-설정"><a href="#Mongo-Database-설정" class="headerlink" title="Mongo Database 설정"></a>Mongo Database 설정</h3><ul>
<li>mongodb 사용자와 디렉토리 퍼미션 확인</li>
<li>mongod.conf 설정</li>
<li>mongo client 접속 테스트</li>
<li>mongodb 인증</li>
</ul>
<h4 id="mongodb-사용자-확인"><a href="#mongodb-사용자-확인" class="headerlink" title="mongodb 사용자 확인"></a>mongodb 사용자 확인</h4><p><em>mongodb-org</em> 설치하면 사용자 <em>mongodb</em>가 만들어 지지만, 혹시 생성되지 않았으면 시스템에 사용자 <strong>mongodb</strong> 가 없으면 새로 만든다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser --disabled-password --gecos &quot;&quot; --no-create-home --disabled-password --disabled-login mongodb</span><br></pre></td></tr></table></figure>

<p><strong>로그 디렉토리</strong> <em>&#x2F;var&#x2F;log&#x2F;mongo</em> 그리고 <strong>데이터 디렉토리</strong> <em>&#x2F;data&#x2F;mongodata</em> 라면 해당 디렉토리에 몽고디비 사용자가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> mongo.daemon /var/log/mongodb</span><br><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h4 id="mongod-conf-설정"><a href="#mongod-conf-설정" class="headerlink" title="mongod.conf 설정"></a>mongod.conf 설정</h4><p>MongoDB의 <code>systemd</code> 서비스는 데이터베이스 구성 파일 <code>/etc/mongod.conf</code> 을 참조한다.</p>
<p><code>/etc/mongod.conf</code> 파일에 <strong>인증</strong>을 제외한 <strong>데이터 디렉토리</strong>, <strong>bindIp</strong>, <strong>로그</strong> 부분만 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 127.0.0.1,192.168.0.2</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbPath</strong> : 데이터베이스 스토리지 위치</li>
<li><strong>bindIp</strong>: 서버 외에서 mongo 클라이언트가 접근하려면 IP 를 입력한다.</li>
</ul>
<p>현재는 <code>mongo.conf</code> 설정 파일에 접근 제어가 없는 상태에서 <strong>mongo</strong> 클라이언트로 접속한다</p>
<h4 id="Admin-사용자"><a href="#Admin-사용자" class="headerlink" title="Admin 사용자"></a>Admin 사용자</h4><p><code>mongo</code> 클라이언트로 접속에 성공하면 <strong>&gt;</strong> 프롬프트가 나온다. <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$mongo</span><br><span class="line">&gt;</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><em>admin</em> 데이터베이스에서 관리자 role을 가진 사용자를 추가하고, 사용할 데이터베이스의 사용자와 접근 제어를 추가해서 사용하기 위해서 작업한다.</p>
<h4 id="user-administrator"><a href="#user-administrator" class="headerlink" title="user administrator"></a>user administrator</h4><p><code>userAdmin role</code> 혹은 <code>userAdminAnyDatabase role</code>을 가진 사용자 만든다. 다음은 <em>admin</em> 데이터베이스에서 사용자를 관리하는 <strong>admin 계정</strong>을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user:&#x27;admin&#x27;,</span><br><span class="line">    pwd:&#x27;****&#x27;,</span><br><span class="line">    roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers()</span><br></pre></td></tr></table></figure>

<p>admin <code>사용자 패스워드 변경</code>은</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.changeUserPassword(&quot;accountUser&quot;, &quot;SOh3TbYhx8ypJPxmt1oOfL&quot;)</span><br></pre></td></tr></table></figure>

<p>사용자의 <code>role</code> 을 변경,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.grantRolesToUser( &#x27;admin&#x27;, [&#123;role: &#x27;userAdmin&#x27;, db:&#x27;admin&#x27;&#125;])</span><br><span class="line">&gt; db.getUsers()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdmin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>혹은 updateUser 를 사용할 수 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( &quot;appClient01&quot;, ...</span><br></pre></td></tr></table></figure>

<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<p>systemd 로 서비스를 재시작 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>이제 인증 모드에서 데이터베이스에 접속해야 한다.</p>
<h4 id="인증모드로-접속"><a href="#인증모드로-접속" class="headerlink" title="인증모드로 접속"></a>인증모드로 접속</h4><p>데이터베이스 시스템에 접근제어가 활성화 되면 <code>mongo</code> 클라이언트 접속시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<br/>
### `mongod` 명령 사용

<p>명령 <code>mongod</code> 로 MongoDB를 시작해 설정 파일 등이 제대로 동작하는지 확인할 수 있다.</p>
<h4 id="비인증-모드-시작"><a href="#비인증-모드-시작" class="headerlink" title="비인증 모드 시작"></a>비인증 모드 시작</h4><p>다음 같이 <code>mongod</code> 를 시작해 동작을 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /data/mongodata</span><br><span class="line">...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h4 id="인증-모드-시작"><a href="#인증-모드-시작" class="headerlink" title="인증 모드 시작"></a>인증 모드 시작</h4><p>앞서 시작한 명령행 <strong>mongodb</strong>를 종료하고 명령라인에서 재시작 <code>--auth</code> 옵션을 붙여 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>접근제어 <code>--auth</code> 옵션으로 데이터베이스를 시작하면 로그인시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>명령행으로 시작한 mongod 는 종료하고 설정 파일에 인증을 넣자.</p>
<h3 id="데이터베이스-생성과-인증"><a href="#데이터베이스-생성과-인증" class="headerlink" title="데이터베이스 생성과 인증"></a>데이터베이스 생성과 인증</h3><p>새 데이터베이스에 컬렉션을 생성하고 데이터베이스 사용자를 접근제어할 수 있는 내용은 <a href="!--swig%EF%BF%BC33--">MongoDB User Authentication</a> 에서 다루고 있다.</p>
<br/>
<br/>
### 기타

<h4 id="WiredTiger-library-panic"><a href="#WiredTiger-library-panic" class="headerlink" title="WiredTiger library panic"></a>WiredTiger library panic</h4><p>ext4 파일시스템에서 wiredTiger engine으로 실행중 아래 같은 에러가 발생, 여기[^10] 에서 <code>--repair</code> 로 재구성한 후 사용하도록 권장한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-07-21T23:26:57.991+0900 E STORAGE  [conn31] WiredTiger error (-31804) [1500647217:991504][803:0x7f</span><br><span class="line">5794fc20], file:collection-0--8962566541221692692.wt, WT_CURSOR.next: the process must exit and restart</span><br><span class="line">: WT_PANIC: WiredTiger library panic</span><br><span class="line">2017-07-21T23:26:57.992+0900 I -        [conn31] Fatal Assertion 28558 at src/mongo/db/storage/wiredtig</span><br><span class="line">er/wiredtiger_util.cpp 361</span><br></pre></td></tr></table></figure>

<p><code>--repair</code> 로 재구성</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --storageEngine wiredTiger --repair --dbpath /data/dbdata/</span><br></pre></td></tr></table></figure>

<p>repaire를 sudo로 진행해서 <em>&#x2F;data&#x2F;dbdata</em> 안의 index 파일들이 root 소유권으로 바뀐다. 그래서 <em>&#x2F;data&#x2F;dbdata</em> 저장소를 chown으로 mongodb 사용자로 다시 설정</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> -R mongodb.mongodb /data/dbdata</span><br></pre></td></tr></table></figure>

<p>이제 재시작 하면 된다.</p>
<h4 id="XFS-warning"><a href="#XFS-warning" class="headerlink" title="XFS warning"></a>XFS warning</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strong$y recommended with the WiredTiger storage engine</span><br></pre></td></tr></table></figure>

<h4 id="USB-Memory-디스크-사용시"><a href="#USB-Memory-디스크-사용시" class="headerlink" title="USB Memory 디스크 사용시"></a>USB Memory 디스크 사용시</h4><p>Odroid C2에 64GB USB Memory를 외부 저장장치로 구성할 때 아래 같이 에러를 발생하며 <em>diagnostic.data 폴더 에러</em>, mongodb 가 다운된다. 아마 ext3 파일 시스템을 사용해서 그런 것 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FTDC     [ftdc] Uncaught exception in &#x27;FileNotOpen: Failed to open interim file /data/mongodata/diagnostic.data/metrics.interim.temp&#x27; in full-time diagnostic data capture subsys</span><br><span class="line">tem. Shutting down the full-time diagnostic data capture subsystem.</span><br><span class="line">2017-04-03T15:00:01.659+0900 E STORAGE  [WTJournalFlusher] WiredTiger error (30) [1491199201:659123][877:0x7f7ccfec90], WT_SESSION.log_flush: /data/mongodata/journal/WiredTigerLog.0000000048: handle-write: pw</span><br><span class="line">rite: failed to write 128 bytes at offset 19456: Read-only file system</span><br><span class="line">2017-04-03T15:00:01.662+0900 E STORAGE  [WTJournalFlusher] WiredTiger error (30) [1491199201:662709][877:0x7f7ccfec90], WT_SESSION.log_flush: journal/WiredTigerLog.0000000048: fatal log failure: Read-only fil</span><br><span class="line">e system</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/35351958/mongo-exception">stackoverflow</a> 에 diagnostic-data 폴더를 지우고 다시 시작하도록 제시되고 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rm -f  /var/lib/mongo/diagnostic.data/*</span><br></pre></td></tr></table></figure>

<p>그리고 <code>/etc/mongod.conf</code>에 full time diagnostic을 비활성화 했다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setParameter:</span><br><span class="line">    diagnosticDataCollectionEnabled: false</span><br></pre></td></tr></table></figure>

<br>
<br/>
## MongoDB 관련 글


<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
<li><a href="dev.paran.com/2011/10/13/why-guardian-chose-mongodb/">왜 Guardian은 MongoDB를 선택했나?</a></li>
<li><a href="dev.paran.com/2011/07/08/mongodb-atfoursquare-biggest-reason-auto-sharding/">포스퀘어가 MongoDB를 선택한 이유</a></li>
</ul>
<p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a><br>[^2]: SBC Sigle Board Computer. Raspberry Pi, Odroid 등등…<br>[^3]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-enterprise-on-debian/">mongodb installation on Debian</a><br>[^10]: <a target="_blank" rel="noopener" href="https://jira.mongodb.org/browse/SERVER-16975">UnsupportedFormat fatal assertion in wiredTiger following</a></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/qkboo_400.png" alt="Gangtai"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gangtai</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Paju, South Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">53</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">95</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/thinkbee" target="_blank" rel="noopener">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/gtko"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">링크</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">26</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/NodeJS/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Photoshop/"><span class="level-start"><span class="level-item">Photoshop</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Angular/"><span class="level-start"><span class="level-item">Angular</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Angularjs/"><span class="level-start"><span class="level-item">Angularjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Raspberry-Pi/"><span class="level-start"><span class="level-item">Raspberry Pi</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-23T15:47:59.802Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/hello-world/">blog.thinkbee.kr 이전 작업중입니다.</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-02T09:00:00.000Z">2020-02-02</time></p><p class="title"><a href="/2020/02/02/linux/2020-02-02-letsencrypt%EB%B0%9C%EA%B8%89/">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T03:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-config/">MongoDB 구성 설정과 사용자 인증 사용</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T01:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-4-2-install-arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu/Debian Armbian</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-09-05T11:00:00.000Z">2019-09-05</time></p><p class="title"><a href="/2019/09/05/python/2019-09-05-OpenSuse-JupyterNotebook_scientific/">openSUSE - 과학계산을 위한 Python, Jupyter Notebook</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Programming/">Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">아카이브</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">2월 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">2월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">12월 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">9월 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">10월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">8월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">7월 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">6월 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">12월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">11월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">10월 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">9월 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">7월 2017</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">5월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">4월 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">12월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">2월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">태그</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Armbian/"><span class="tag">Armbian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Artificial-Intelligence/"><span class="tag">Artificial Intelligence</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian/"><span class="tag">Debian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian-Strech/"><span class="tag">Debian Strech</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JSON-Web-Token/"><span class="tag">JSON Web Token</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT-Toekn/"><span class="tag">JWT Toekn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-15-0/"><span class="tag">LEAP 15.0</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-42-3/"><span class="tag">LEAP 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Numpy/"><span class="tag">Numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid/"><span class="tag">Odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid-C2/"><span class="tag">Odroid C2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Orange-Pi/"><span class="tag">Orange Pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi/"><span class="tag">Raspberry Pi</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi-3/"><span class="tag">Raspberry Pi 3</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspbian/"><span class="tag">Raspbian</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SD-Card/"><span class="tag">SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scientific/"><span class="tag">Scientific</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript-Tutorials/"><span class="tag">TypeScript Tutorials</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/X11/"><span class="tag">X11</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/amd64/"><span class="tag">amd64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angular4/"><span class="tag">angular4</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/arm64/"><span class="tag">arm64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/armbian/"><span class="tag">armbian</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/banana-pi/"><span class="tag">banana pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/certificate-ssl/"><span class="tag">certificate ssl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/clipping-mask/"><span class="tag">clipping-mask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collages/"><span class="tag">collages</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cross-compiler/"><span class="tag">cross compiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian/"><span class="tag">debian</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewall/"><span class="tag">firewall</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewalld/"><span class="tag">firewalld</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/https/"><span class="tag">https</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/install/"><span class="tag">install</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jasmine/"><span class="tag">jasmine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter/"><span class="tag">jupyter</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter notebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter-notebook</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/karma/"><span class="tag">karma</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-15/"><span class="tag">leap 15</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-42-3/"><span class="tag">leap 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm/"><span class="tag">lvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm2/"><span class="tag">lvm2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/micro-SD-Card/"><span class="tag">micro SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongoose/"><span class="tag">mongoose</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs-tutorials/"><span class="tag">nodejs tutorials</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nvm/"><span class="tag">nvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid/"><span class="tag">odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid c2</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid-c2</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openSUSE/"><span class="tag">openSUSE</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse/"><span class="tag">opensuse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse-leap-15/"><span class="tag">opensuse leap 15</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/orange-pi/"><span class="tag">orange pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/photoshop/"><span class="tag">photoshop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry pi</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/synergy/"><span class="tag">synergy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unit-testing/"><span class="tag">unit testing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenv/"><span class="tag">virtualenv</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenvwrapper/"><span class="tag">virtualenvwrapper</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webdav/"><span class="tag">webdav</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EB%B9%84%EC%95%88/"><span class="tag">데비안</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/"><span class="tag">데이안</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/"><span class="tag">라즈베리파이</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/"><span class="tag">라즈비안</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%A6%AC%EB%88%85%EC%8A%A4/"><span class="tag">리눅스</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%94%EB%82%98%EB%82%98%ED%8C%8C%EC%9D%B4/"><span class="tag">바나나파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%A9%ED%99%94%EB%B2%BD/"><span class="tag">방화벽</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%98%A4%EB%A0%8C%EC%A7%80%ED%8C%8C%EC%9D%B4/"><span class="tag">오렌지파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/"><span class="tag">우분투</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/"><span class="tag">웹토큰</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9D%B8%EA%B3%B5%EC%A7%80%EB%8A%A5/"><span class="tag">인공지능</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/"><span class="tag">전원관리</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%8D%AC/"><span class="tag">파이썬</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%96%B4%EC%9B%94/"><span class="tag">파이어월</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">업데이트 소식 받기</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1465716454138955" data-ad-slot="4883770640" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a><p class="is-size-7"><span>&copy; 2022 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>