<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>카테고리: Linux - Blogging through Programming</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="thinkbee blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="thinkbee blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Blogging through Programming"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Blogging through Programming"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Blogging through Programming","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"publisher":{"@type":"Organization","name":"Blogging through Programming","logo":{"@type":"ImageObject","url":"http://example.com/images/thinkbee_logo.png"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1465716454138955" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 6.0.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">카테고리</a></li><li class="is-active"><a href="#" aria-current="page">Linux</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-02-02T09:00:00.000Z" title="2020-2-2 18:00:00">2020-02-02</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:15:34.968Z" title="2022-2-25 1:15:34">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">16분안에 읽기 (약 2335 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/02/02/linux/2020-02-02-letsencrypt%EB%B0%9C%EA%B8%89/">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</a></h1><div class="content"><blockquote>
<p>2020-06-02: 매뉴얼 방식 수정<br><br>2020-02-02: 최초 작성<br>{:.right-history}</p>
</blockquote>
<p>Nginx 서버에서 HTTPS 사용할 수 있는 공인인증서를 발급해 설치하려고 한다.</p>
<ul>
<li>여기서는 Lets Encrypt 무료 공인인증서 발급을 다룬다.</li>
<li>letsecrypt 공인인증서는 3개월 정도 기간만 사용 가능하고 갱신해야 한다.</li>
<li>**<em>단독 도메인을 호스팅하는 개인 서버에서 Nginx</em>**에 적용해 본다.</li>
</ul>
<p>인증서는 <strong>개별 도메인</strong> 혹은 <strong>와일드카드 인증서</strong> 로 도메인 안의 모든 호스트를 포함하는 두 종류로 발급이 가능하다.</p>
<h1 id="Let’s-Encrypt"><a href="#Let’s-Encrypt" class="headerlink" title="Let’s Encrypt"></a>Let’s Encrypt</h1><p>Let’s Encrypt 는 <a target="_blank" rel="noopener" href="https://letsencrypt.org/">https://letsencrypt.org</a> 에서 여러 인터넷 관련 업체의 후원을 받아 운영하고 있다.</p>
<img src='https://image.status.io/ZsUlrVAwD16p.png' width='200'>

<h2 id="LetsEncrypt-발급"><a href="#LetsEncrypt-발급" class="headerlink" title="LetsEncrypt 발급"></a>LetsEncrypt 발급</h2><p>발급을 위해 리눅스&#x2F;맥 쉘 기반의 Certbot 유틸리티를 사용하거나 웹 기반으로 가능하다. 여기서는 Certbot 를 사용해서 Let’s Encrypt 와일드 카드 인증서를 발급해 보겠다.</p>
<p>인증서를 발급 받기위해서는 Let’s Encrypt 인증서를 자동으로 생성하고 관리하는 패키지인 certbot 를 먼저 설치해야 한다.</p>
<h3 id="우분투-x2F-데비안에서-설치"><a href="#우분투-x2F-데비안에서-설치" class="headerlink" title="우분투&#x2F;데비안에서 설치"></a>우분투&#x2F;데비안에서 설치</h3><p>우분투&#x2F;데이안 같은 리눅스 환경에서 설치하고 구성했다. 기타 다른 오에스 배포판은 아래 사이트에서 설치 명령어를 참고하자.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://certbot.eff.org/">https://certbot.eff.org/</a></li>
</ul>
<p>Certbot 설치:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install software-properties-common</span><br><span class="line">$ sudo add-apt-repository ppa:certbot/certbot</span><br><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>certbot 관련 Apache, Nginx 용 파이썬 모듈을 설치한다.</p>
<p>Nginx 를 운영한다면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-certbot3-nginx   #python3</span><br><span class="line">$ sudo apt-get install python-certbot-nginx</span><br></pre></td></tr></table></figure>

<p>Apache2 를 운영한다면,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-certbot3-apache   #python3</span><br><span class="line">$ sudo apt-get install python-certbot-apache</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="와일드카드-인증서-발급"><a href="#와일드카드-인증서-발급" class="headerlink" title="와일드카드 인증서 발급"></a>와일드카드 인증서 발급</h2><p>와일드카드 인증서는 도메인의 호스트 단위에서 여러 서브 도메인까지 지원하는 인증서이다. 예를 들어 <code>example1.kr</code> 도메인의 하위 도메인 <code>abc.example1.kr</code>, <code>1234.example1.kr</code> 등에 모두 적용하고자 할 때 와일드 카드 인증서를 발급하는 것이다. 이 인증서를 발급 하기 위해서는 도메인 서버를 다루거나 호스팅 기관의 도메인 관리 도구를 통해서 *DNS 레코드* 에 부가적인 정보를 추가해야 한다.</p>
<p>발급 요청시 letsencrypt 는 세 가지 방법으로 webroot와 Standalone, DNS의 3가지 방식으로 적절한 요청을 확인하는 검증 절차를 통해 발급을 인증서를 인가한다.</p>
<ul>
<li>webroot : 도메인 호스트 서버에 임의 Url에 접근해 검증.</li>
<li>standalon:</li>
<li>DNS: 도메인의 DNS 서버에 TXT 필드에 임의의 값 통해 검증.</li>
</ul>
<h3 id="webroot-방식"><a href="#webroot-방식" class="headerlink" title="webroot 방식"></a>webroot 방식</h3><p>웹루트 방식으로 진행하기 전에 먼저 nginx 를 종료해 둔다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl stop nginx</span></span><br></pre></td></tr></table></figure>

<p>다음 certbot 명령에서 수동모드로 도메인 <code>example1.kr</code> 도메인의 와일드카드 인증서와 호스트 example1.kr 에 대해 명령을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># certbot certonly --manual -d &quot;*.example1.kr&quot; -d &quot;example1.kr&quot;</span></span><br></pre></td></tr></table></figure>

<p>수동모드 진행을 시작하면 IP 로깅을 묻는다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">NOTE: The IP of this machine will be publicly logged as having requested this</span><br><span class="line">certificate. If you<span class="string">&#x27;re running certbot in manual mode on a machine that is not</span></span><br><span class="line"><span class="string">your server, please ensure you&#x27;</span>re okay with that.</span><br><span class="line"></span><br><span class="line">Are you OK with your IP being logged?</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">(Y)es/(N)o: Y</span><br></pre></td></tr></table></figure>

<p>이어서 다음 같이 웹 사이트 접근 URL을 통해서 인증하도록 요구한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Create a file containing just this data:</span><br><span class="line"></span><br><span class="line">AyTml9aa0IXw0RjNHERtktSxIxjFAkJvUOVis8dDRLQ.dSiF50fKKa4aji-OuIlgg62idngOi4nR6yzEHRaTLsI</span><br><span class="line"></span><br><span class="line">And make it available on your web server at this URL:</span><br><span class="line"></span><br><span class="line">http://example1.kr/.well-known/acme-challenge/kyTAl9aa0IXw0RjNHERtktSxIxjFAkJvUOVis8dDRLO</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Enter</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>웹 서비스에 파일을 추가하고 내용에 데이터를 넣은후 ngixn 를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start nginx</span></span><br></pre></td></tr></table></figure>

<p>서버측에 검증을 위해 <code>http://example1.kr/.well-known/acme-challenge/kyTAl9aa0IXw0RjNHERtktSxIxjFAkJvUOVis8dDRLO</code> 경로에 텍스트 파일에 내용을 입력한다.</p>
<p>URL 준비가 되면 터미널에서 enter 를 입력하고 정상적으로 인증이 되면 아래 같이 결과를 출력해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waiting <span class="keyword">for</span> verification...</span><br><span class="line">Cleaning up challenges</span><br><span class="line"></span><br><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">   /etc/letsencrypt/live/example1.kr/fullchain.pem</span><br><span class="line">   Your key file has been saved at:</span><br><span class="line">   /etc/letsencrypt/live/example1.kr/privkey.pem</span><br><span class="line">   Your cert will expire on 2020-09-01. To obtain a new or tweaked</span><br><span class="line">   version of this certificate <span class="keyword">in</span> the future, simply run certbot</span><br><span class="line">   again. To non-interactively renew *all* of your certificates, run</span><br><span class="line">   <span class="string">&quot;certbot renew&quot;</span></span><br><span class="line"> - If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG / Let<span class="string">&#x27;s Encrypt:   https://letsencrypt.org/donate</span></span><br><span class="line"><span class="string">   Donating to EFF:                    https://eff.org/donate-le</span></span><br></pre></td></tr></table></figure>

<p>정상적으로 진행되면 인증서와 개인키 파일이 저장된다:</p>
<ul>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;fullchain.pem</li>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;privkey.pem</li>
</ul>
<p>이 파일을 nginx 서버에 설정에 구성하면 된다.</p>
<hr>
<h3 id="DNS-방식-와일드카드-인증서-요청"><a href="#DNS-방식-와일드카드-인증서-요청" class="headerlink" title="DNS 방식 와일드카드 인증서 요청"></a>DNS 방식 와일드카드 인증서 요청</h3><p>다음 certbot 명령은 도메인 <code>*.example1.com</code> 의 와일드카드 인증서를 요청한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># certbot certonly --manual --preferred-challenges dns -d &quot;*.example1.com&quot; -d &quot;example1.com&quot;</span><br><span class="line"></span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Enter email address (used for urgent renewal and security notices) (Enter &#x27;c&#x27; to</span><br><span class="line">cancel): gangtai.goh@gmail.com</span><br><span class="line"></span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">dns-01 challenge for example1.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>IP 로깅을 묻는다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line">NOTE: The IP of this machine will be publicly logged as having requested this</span><br><span class="line">certificate. If you&#x27;re running certbot in manual mode on a machine that is not</span><br><span class="line">your server, please ensure you&#x27;re okay with that.</span><br><span class="line"></span><br><span class="line">Are you OK with your IP being logged?</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">(Y)es/(N)o: y</span><br></pre></td></tr></table></figure>

<p>IP정보 수집 이후에 DNS의 TXT 레코드에 입력할 코드가 발급된다. 이 코드를 도메인 관리 도구에서 주어지 호스트명에 TXT 레코드에 입력한다.</p>
<ul>
<li>예) 아래는 <code>_acme-challenge.example1.kr</code> 라는 호스트</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">\_acme-challenge.example1.kr with the following value:</span><br><span class="line"></span><br><span class="line">aOVF_X388V8fYECoTJyArawJ95VpUffyUWqH8Q8bJAa</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Press Enter to Continue</span><br><span class="line">Waiting for verification...</span><br><span class="line">Cleaning up challenges</span><br></pre></td></tr></table></figure>

<p><strong><em>DNS 관리하는 곳에서 서브 도메인 <code>_acme-challenge.example1.kr</code> 에 위에 출력된 해시코드를 TXT 레코드 추가해 준다.</em></strong></p>
<p>적용한 후 아래 같이 <code>dig</code> 같은 네임서버 명령으로 txt 레코드에 추가한 해시코드가 나오는지 확인하고 엔터로 진행한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dig txt _acme-challenge.example1.kr</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">_acme-challenge.example1.kr. 180 IN	TXT	&quot;aOVF_X388V8fYECoTJyArawJ95VpUffyUWqH8Q8bJAa&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>그리고 발급된 도메인 인증서가 저장된 위치가 나타난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT NOTES:</span><br><span class="line"></span><br><span class="line">- Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">  /etc/letsencrypt/live/example1.com/fullchain.pem</span><br><span class="line">  Your key file has been saved at:</span><br><span class="line">  /etc/letsencrypt/live/example1.com/privkey.pem</span><br><span class="line">  Your cert will expire on 2020-05-23. To obtain a new or tweaked</span><br><span class="line">  version of this certificate in the future, simply run certbot</span><br><span class="line">  again. To non-interactively renew _all_ of your certificates, run</span><br><span class="line">  &quot;certbot renew&quot;</span><br><span class="line">- If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">  Donating to ISRG / Let&#x27;s Encrypt: https://letsencrypt.org/donate</span><br><span class="line">  Donating to EFF: https://eff.org/donate-le</span><br></pre></td></tr></table></figure>

<p>정상적으로 진행되면 인증서와 개인키 파일이 저장된다:</p>
<ul>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;fullchain.pem</li>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;privkey.pem</li>
</ul>
<p>이 파일을 nginx 서버에 설정에 구성하면 된다.</p>
<hr>
<h3 id="Let’s-Encrypt-자동갱신"><a href="#Let’s-Encrypt-자동갱신" class="headerlink" title="Let’s Encrypt 자동갱신"></a>Let’s Encrypt 자동갱신</h3><p>Let’s Encrypt 인증서는 발급받으면 기간이 사용할 수 있는 기간이 3개월이다. 계속해서 HTTPS 서비스를 운영하려면 인증서가 만료되기 전에 갱신을 해야 한다.</p>
<p><code>certbot</code> 명령으로 자동으로 갱신할 수 있는데 보통 크론에 등록해 두고 사용할 수 있다. root 권한이 필요하므로 root 계정의 cronttab에 아래와 같은 내용을 추가한다.</p>
<p>아래는 3개월 후 달의 1일에 명령을 실행을 등록했다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 1-12/3 * /bin/bash -l -c <span class="string">&#x27;certbot renew --quiet&#x27;</span></span><br></pre></td></tr></table></figure>

<p>혹은 매달 실행하려면 아래 같이 매달 1일 인증서 갱신 명령어를 실행하도록 해도 될 것 같다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /bin/bash -l -c <span class="string">&#x27;certbot renew --quiet&#x27;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Nginx-설정"><a href="#Nginx-설정" class="headerlink" title="Nginx 설정"></a>Nginx 설정</h2><p>nginx에 와일드 카드 도메인을 사용할 여러 가상호스트가 구성되어 있다는 가정에서 시작한다.</p>
<h3 id="HTTPS-적용하기"><a href="#HTTPS-적용하기" class="headerlink" title="HTTPS 적용하기"></a>HTTPS 적용하기</h3><p>와일드 카드</p>
<p><code>nginx.conf</code> 파일에 SSL이 활성화 되었는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">##</span><br><span class="line"># SSL Settings</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br></pre></td></tr></table></figure>

<p>실제 적용할 가상호스트 파일의 server 섹션에 다음 같이 인증서 파일을 활성화 한다. 가상호스트 파일이 여러개고 같은 서브 도메인이면 똑같이 적용해 주면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen [::]:443 ssl http2 ipv6only=on;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line"></span><br><span class="line">  	server_name www.exmaple1.com example1.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate  /etc/letsencrypt/live/example1.kr/fullchain.pem;</span><br><span class="line">    ssl_certificate_key  /etc/letsencrypt/live/example1.kr/privkey.pem;</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="http-요청을-https에-리다이렉트"><a href="#http-요청을-https에-리다이렉트" class="headerlink" title="http 요청을 https에 리다이렉트"></a>http 요청을 https에 리다이렉트</h3><p>다음 구성은 <code>http://example1.com</code> 로 들어오는 모든 연결을 <code>https://example1.com</code> 으로 전환하는 구성이다.</p>
<ul>
<li>VirtualHost 별로 아래와 같이 Port 80 에 대한 Server설정과 443에 대한 Server설정을 분리</li>
<li>Port 80 에 대해서는 301 Redirect 설정</li>
<li>Nignx 재시작</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen         80;</span><br><span class="line">    server_name    example1.com example2.com;</span><br><span class="line">    return         301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen [::]:443 ssl http2 ipv6only=on;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name    example1.com example2.com;</span><br><span class="line">     ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ol>
<li><a target="_blank" rel="noopener" href="https://certbot.eff.org/lets-encrypt/debianbuster-nginx">Certbot: Debian Instruction</a></li>
<li><a target="_blank" rel="noopener" href="https://letsencrypt.org/ko/getting-started/">Getting Started 문서</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/nabbisen/let-s-encrypt-wildcard-certificate-with-certbot-plo">Let’s Encrypt Wildcard-certificate-with-certbot</a></li>
<li><a target="_blank" rel="noopener" href="https://community.letsencrypt.org/t/wildcard-domain-step-by-step/58250/4">Wildcard-domain step-by-step</a></li>
<li><a target="_blank" rel="noopener" href="https://www.securesign.kr/guides/NGINX-SSL-Certificate-Install">nginx ssl 설정</a></li>
<li><a target="_blank" rel="noopener" href="https://jootc.com/p/201901062488">Let’s Encrypt 인증서 발급 - Anapche&#x2F;Nginx</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-12-20T03:00:00.000Z" title="2019-12-20 12:00:00">2019-12-20</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:43:48.206Z" title="2022-2-25 1:43:48">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">14분안에 읽기 (약 2163 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/20/linux-2019-12-20-mongodb-config/">MongoDB 구성 설정과 사용자 인증 사용</a></h1><div class="content"><p>MongoDB에 관련 글</p>
<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<hr>
<br>

<h1 id="Mongo-Database-설정과-사용자-인증-사용"><a href="#Mongo-Database-설정과-사용자-인증-사용" class="headerlink" title="Mongo Database 설정과 사용자 인증 사용"></a>Mongo Database 설정과 사용자 인증 사용</h1><p>이 문서는 <strong>MongoDB Community Edition</strong> 를 리눅스 플랫폼에서 시작과 운영에 필요한 구성 파일 <code>mongod.conf</code> 의 설정을 다루고 있다. 이를 통해 데이터베이스 서비스를 동작시키고, 인증한 사용자로서 클라이언트 프로그램으로 접속하기 위한 <strong>기본 인증방식을 구성</strong>하는 것을 정리하고 있다.</p>
<ol>
<li><a href="#Mongo-Database-%EC%84%A4%EC%A0%95">Mongo Database 설정</a></li>
<li>기본인증 구성</li>
</ol>
<blockquote>
<p>이 글의 내용은 MongoDB Community Edition 3.6 이후 4.2 까지 사용이 가능하다.</p>
</blockquote>
<br/>

<h2 id="Mongo-Database-설정"><a href="#Mongo-Database-설정" class="headerlink" title="Mongo Database 설정"></a>Mongo Database 설정</h2><p>우분투&#x2F;데비안 계열은 설치시 <code>mongod</code> 데몬이 데이터베이스 운영에 필요한 여러 구성에 대한 설정을 위해서 <code>/etc/mongod.conf</code> 구성 파일을 사용한다. 구성 파일에 데이터베이스 구성에 필요한 여러 설정을 지정할 수 있다.</p>
<ul>
<li>mongodb 사용자와 디렉토리 퍼미션 확인</li>
<li>외부 접속 허용 여부</li>
<li>mongo client 접속 테스트</li>
<li>mongodb 인증</li>
</ul>
<p>이제 실제 파일에 구성 내용을 설정하는데, 여기서는 mongod 의 기본인증 방법과 데이터 저장소에 대해서만 다룬다.</p>
<h3 id="mongod-설정"><a href="#mongod-설정" class="headerlink" title="mongod 설정"></a>mongod 설정</h3><p>MongoDB의 <code>systemd</code> 서비스는 보통 데이터베이스 구성 파일 <code>/etc/mongod.conf</code> 을 참조한다. mongod 서비스 상태를 확인해 보면 <code>--config /etc/mongod.conf</code> 옵션으로 구성 파일을 지시하고 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status mongod.service</span><br><span class="line">* mongod.service - MongoDB Database Server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mongod.service; disabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2019-12-19 15:38:14 UTC; 3 weeks 6 days ago</span><br><span class="line">     Docs: https://docs.mongodb.org/manual</span><br><span class="line"> Main PID: 2051 (mongod)</span><br><span class="line">   Memory: 191.3M</span><br><span class="line">   CGroup: /system.slice/mongod.service</span><br><span class="line">           `-2051 /usr/bin/mongod --config /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p>mongod.conf 파일을 살펴보자,</p>
<h4 id="mongod-conf-파일"><a href="#mongod-conf-파일" class="headerlink" title="mongod.conf 파일"></a>mongod.conf 파일</h4><p>먼저 <code>/etc/mongod.conf</code> 파일에 <strong>인증</strong>을 제외한 <strong>데이터 디렉토리</strong>, <strong>bindIp</strong>, <strong>로그</strong> 부분만 설정한다.</p>
<ul>
<li>storage: 데이터 베이스 파일 저장 위치 및 방법<ul>
<li><strong>dbPath</strong> : 데이터베이스 스토리지 위치</li>
</ul>
</li>
<li>systemlog: 로그 파일 및 로그 조작 방법</li>
<li>net: 네트워크 관련<ul>
<li><strong>bindIp</strong>: 서버 외에서 mongo 클라이언트가 접근하려면 IP 를 입력한다.</li>
</ul>
</li>
</ul>
<p>먼저 <strong>인증을 비활성화</strong> 한 구성을 하는데, 다음은 기본적인 mongod.conf 를 구성한 내용이다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 127.0.0.1,192.168.0.2</span><br></pre></td></tr></table></figure>

<p>이제 <code>mongo.conf</code> 구성 파일이 준비되었으면 systemctl 로 mongod 데몬을 재시작한다..</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>간단한 구성 설정, 아직은 인증이 비활성화된 상태를 마련 했으면 사용자 인증을 통한 원격 접속을 살펴보자,</p>
<hr>
<br>

<h2 id="mongo-기본인증"><a href="#mongo-기본인증" class="headerlink" title="mongo 기본인증"></a>mongo 기본인증</h2><p>보통 mongo 클라이언트 등에서 MongoDatabase 를 사용하기 위해서 클라이언트를 위한 인증을 제공해야 한다. 클라이언트를 위한 인증은 관리용 데이터베이스에서 데이터베이스 사용자를 등록하고 클라이언트가 등록한 사용자로 데이터베이스에 접속하는 방법을 사용한다.</p>
<p>인증을 추가하기 위해서 mongod의 <code>mongo.conf</code> 설정 파일에 접근 제어를 하지 않는 상태에서 <strong>mongo</strong> 클라이언트로 접속해서 기본인증을 위한 데이터베이스 사용자를 추가해 준다.</p>
<h3 id="Admin-사용자-생성"><a href="#Admin-사용자-생성" class="headerlink" title="Admin 사용자 생성"></a>Admin 사용자 생성</h3><p><code>mongod</code>에 인증이 비활성화 상태에서 mongo 클라이언트로 접속에 성공하면 <strong><code>&gt;</code></strong> 프롬프트가 나온 후 use 명령으로 <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">&gt;</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>1). <em>admin</em> 데이터베이스에서 관리자 role을 가진 사용자를 추가하고, 2). 사용할 데이터베이스의 사용자와 접근 제어를 추가해서 사용하기 위해서 작업한다.</p>
<h4 id="user-administrator"><a href="#user-administrator" class="headerlink" title="user administrator"></a>user administrator</h4><p><em>admin</em> 데이터베이스에 <code>userAdmin role</code> 혹은 <code>userAdminAnyDatabase role</code>을 가진 사용자 만든다.</p>
<p>다음은 <em>admin</em> 데이터베이스에서 사용자 <strong><code>admin</code></strong> 계정를 생성하고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.<span class="title function_">createUser</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">user</span>:<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="attr">pwd</span>:<span class="string">&#x27;****&#x27;</span>,</span><br><span class="line">    <span class="attr">roles</span>:[<span class="string">&#x27;userAdminAnyDatabase&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"><span class="title class_">Successfully</span> added <span class="attr">user</span>: &#123; <span class="string">&quot;user&quot;</span> : <span class="string">&quot;admin&quot;</span>, <span class="string">&quot;roles&quot;</span> : [ <span class="string">&quot;userAdminAnyDatabase&quot;</span> ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.<span class="title function_">getUsers</span>()</span><br></pre></td></tr></table></figure>

<p>사용자 패스워드 변경은 <code>.changeUserPassword()</code> 메서드를 사용한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="title function_">changeUserPassword</span>(<span class="string">&quot;accountUser&quot;</span>, <span class="string">&quot;SOh3TbYhx8ypJPxmt1oOfL&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>사용자의 <code>role</code> 변경은 <code>.grantRolesToUser()</code> 메서드를 사용한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="title function_">grantRolesToUser</span>( <span class="string">&#x27;admin&#x27;</span>, [&#123;<span class="attr">role</span>: <span class="string">&#x27;userAdmin&#x27;</span>, <span class="attr">db</span>:<span class="string">&#x27;admin&#x27;</span>&#125;])</span><br></pre></td></tr></table></figure>

<p>혹은 <code>updateUser()</code> 를 사용할 수 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( &quot;appClient01&quot;, ...</span><br></pre></td></tr></table></figure>

<p>현재 데이터베이스의 사용자를 출력한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="title function_">getUsers</span>()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;admin.admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;user&quot;</span> : <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;roles&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span> : <span class="string">&quot;userAdmin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;role&quot;</span> : <span class="string">&quot;userAdminAnyDatabase&quot;</span>,</span><br><span class="line">        <span class="string">&quot;db&quot;</span> : <span class="string">&quot;admin&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>admin 데이터베이스에 새로 생성한 admin 사용자로 로그인을 해보자. 그러기 위해서는 admin 데이터베이스에 인증 로그인을 한 후에 데이터 베이스를 생성하거나 사용할 수 있다.</p>
<br>

<h2 id="인증-활성화"><a href="#인증-활성화" class="headerlink" title="인증 활성화"></a>인증 활성화</h2><p><strong><code>mongod.conf</code></strong> 파일 안의 security 섹션에서 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<blockquote>
<p>인증 활성화는 MongoDB v2.4이전에는 인증모드를 명령행의 <code>--auth</code> 옵션을 사용하고, v2.6 이후에서 <em>mongod.conf</em> 파일 사용할 때 <code>security.authorization</code> 를 활성화 하고 있다.</p>
</blockquote>
<p>systemd 로 서비스를 재시작 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>이렇게 인증모드로 데이터베이스를 시작하면 인증 정보로 로그인해야 한다. 아래 같이 인증 정보없이 로그인 하면 데이터베이스 사용시 에러를 만난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">&gt; show dbs;</span><br><span class="line">Tue Sep 27 23:22:40.683 listDatabases failed:&#123; &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;unauthorized&quot; &#125; at src/mongo/shell/mongo.js:46</span><br><span class="line">&gt;</span><br><span class="line">&gt; show users</span><br><span class="line">Tue Sep 27 23:22:44.667 error: &#123; &quot;$err&quot; : &quot;not authorized for query on test.system.users&quot;, &quot;code&quot; : 16550 &#125; at src/mongo/shell/query.js:128</span><br></pre></td></tr></table></figure>

<p>이제 인증 모드에서 데이터베이스에 접속해야 한다.</p>
<h3 id="인증모드로-접속"><a href="#인증모드로-접속" class="headerlink" title="인증모드로 접속"></a>인증모드로 접속</h3><p>데이터베이스 시스템에 접근제어가 활성화 되서 인증모드로 <code>mongo</code> 클라이언트 접속할 때는 옵션으로 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<p>앞서 생성해둔 admin 계정으로 접속해 보자,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u <span class="string">&quot;admin&quot;</span> -p <span class="string">&quot;****&quot;</span> --authenticationDatabase <span class="string">&quot;admin&quot;</span></span><br><span class="line">MongoDB shell version v4.2</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 4.2</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>MongoDatabae는 데이터베이스 마다 인증한 사용자를 통해 조작을 하게 된다. 그래서 인증모드로 접속 되었지만, 어떤 데이터베이스에 비인증된 사용자로 접근하는 경우는 에러가 발생한다. 예를 들어서 admin 사용자로 인증 로그한 mongodb shell에서 아래 같이 비인증인 student 데이터베이스에 접근하면 에러가 난다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;</span><br><span class="line">&gt; use students</span><br><span class="line">switched to db students</span><br><span class="line">&gt; show users</span><br><span class="line">2018-06-25T18:30:38.174+0900 E QUERY    [thread1] Error: not authorized on students to execute command &#123; usersInfo: 1.0, $db: &quot;students&quot; &#125; :</span><br></pre></td></tr></table></figure>

<h4 id="mongo-비인증-접근시"><a href="#mongo-비인증-접근시" class="headerlink" title="mongo 비인증 접근시"></a>mongo 비인증 접근시</h4><p>위와 같이 로컬에서 mongo 클라이언트 접속하는 것 외에 외부에서 mongodb로 접근시 authentication을 적용한 상태라면 다음과 같은 URL로 접근할 수 있다:</p>
<blockquote>
<p>“username:password@HOST_NAME&#x2F;mydb”</p>
</blockquote>
<p>그러나 외부접근시 클라이언트 버전과 서버의 Credential 버전이 맞지 않은 경우 다음 같이 실패 메시지를 확인할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; 2016-05-16T00:53:10.338+0900 I ACCESS [conn2] Failed to authenticate student@student with mechanism MONGODB-CR: AuthenticationFailed: MONGODB-CR credentials missing in the user document</span><br><span class="line">&gt; 2016-05-16T00:53:10.352+0900 I NETWORK [conn2] end connection 220.121.140.59:51634 (0 connections now open)</span><br></pre></td></tr></table></figure>

<br/>
<br/>

<h2 id="mongod-명령-사용"><a href="#mongod-명령-사용" class="headerlink" title="mongod 명령 사용"></a><code>mongod</code> 명령 사용</h2><p>보통 디버깅 목적으로 사용하기 위해서 <code>systemd</code>가 아닌 명령행에서 <code>mongod</code> 명령으로 로 MongoDB를 시작해 설정 파일 등이 제대로 동작하는지 확인할 수 있다.</p>
<blockquote>
<p>다만 데이터베이스가 생성하는 데이터와 로그 파일의 접근권한이 실행한 사용자 계정으로 처리되어 퍼미션 문제가 발생할 수 있다.</p>
</blockquote>
<h4 id="mongoDB-v2-6-이후"><a href="#mongoDB-v2-6-이후" class="headerlink" title="mongoDB v2.6 이후"></a>mongoDB v2.6 이후</h4><p>앞서 시작한 명령행 <strong>mongodb</strong>를 종료하고 명령라인에서 재시작 <code>--auth</code> 옵션을 붙여 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>접근제어 <code>--auth</code> 옵션으로 데이터베이스를 시작하면 로그인시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<hr>
<p>이전 버전의 mongod 명령</p>
<h4 id="mongoDB-v2-4-인증모드로-시작"><a href="#mongoDB-v2-4-인증모드로-시작" class="headerlink" title="mongoDB v2.4 인증모드로 시작"></a>mongoDB v2.4 인증모드로 시작</h4><p>&#96;&#96;mongod&#96; 명령라인으로 시작할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>mongoDB v2.4는 다음 같이 인증 모드로 시작한다. <code>mongod</code> 명령라인에서 <code>--auth</code> 옵션을 붙여 DB 인스턴스(<code>mongod</code>)를 시작 혹은 재시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/db1</span><br></pre></td></tr></table></figure>

<p>혹은 <em>mongod.conf</em> 설정 파일에서 <strong>auth</strong> 를 활성화 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth = true</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-12-20T01:00:00.000Z" title="2019-12-20 10:00:00">2019-12-20</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:43:22.474Z" title="2022-2-25 1:43:22">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">14분안에 읽기 (약 2071 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/20/linux-2019-12-20-mongodb-4-2-install-arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu/Debian Armbian</a></h1><div class="content"><p>MongoDB에 관련 글</p>
<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<hr>
<br>

<h1 id="Install-MongoDB-4-2-Community-edition-설치"><a href="#Install-MongoDB-4-2-Community-edition-설치" class="headerlink" title="Install MongoDB 4.2 Community edition 설치"></a>Install MongoDB 4.2 Community edition 설치</h1><p>이 문서는 Arm64 기반 CPU를 사용하는 Raspberry Pi, Odroid, PINE64, OrangePi 등 SBC 지원 보드 계열 위에서 Ubuntu&#x2F;Debian 에서 설치 및 사용 가능한 <strong>MongoDB Community Edition 4.2</strong> 버전을 설치하고 구성하는 과정을 정리하고 있다.</p>
<p>MongoDB Community Edition 버전 <em>Amd64</em>, <em>Arm64</em> 의 설치는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-debian/">Install MongoDB Community Edition on Debian</a> 에서 제공하고 있다.</p>
<p>하지만 Arm64를 지원하는 Odroid C2, PINE64, OragePi 등 SBC 브드의 Armbian, Ubuntu 오에스에서 <em>MongoDB Community Edition</em> 을 저장소에서 apt 명령으로 직접 설치가 안되서 <strong><em>작은 트릭</em></strong> 이 필요하다.</p>
<ul>
<li>MongoDB Community Edition 4.2 설치</li>
<li>systemd 사용이 가능한 mongod Unit 파일 구성</li>
</ul>
<h3 id="MongoDB-Community-Edition-은"><a href="#MongoDB-Community-Edition-은" class="headerlink" title="MongoDB Community Edition 은"></a>MongoDB Community Edition 은</h3><p>MongoDB Community Edition 은 다음 패키지를 지원하고 있다:</p>
<ul>
<li><code>mongodb-org</code> : 다음 패키지를 설치하기 위한 메타 패키지</li>
<li><code>mongodb-org-server</code> : <code>mongod</code> daemon 과 구성 및 초기 스크립트.</li>
<li><code>mongodb-org-mongos</code> : <code>mongos</code> daemon.</li>
<li><code>mongodb-org-shell</code> : <code>mongo</code> shell.</li>
<li><code>mongodb-org-tools</code> : MongoDB 유틸리티.<ul>
<li>mongoimport, bsondump, mongodump, mongoexport, mongofiles, mongoperf, mongorestore, mongostat, and mongotop.</li>
</ul>
</li>
</ul>
<h3 id="테스트한-플랫폼"><a href="#테스트한-플랫폼" class="headerlink" title="테스트한 플랫폼"></a>테스트한 플랫폼</h3><p>64bit Arm을 지원하는 Armbian&#x2F;Ubuntu 배포본을 사용했다.</p>
<p><strong>Armbian 기반</strong>:</p>
<ul>
<li><strong>PINE64</strong>: 64bit, Armbian</li>
<li><strong>Hardkernel Odroid C2</strong>: 64bit, Armbian</li>
</ul>
<hr>
<h2 id="사전준비"><a href="#사전준비" class="headerlink" title="사전준비"></a>사전준비</h2><p>설치를 위해 MongoDB Community Edition 을 지원하는 저장소를 위한 키 저장소를 구성해</p>
<h3 id="레포지토리-등록"><a href="#레포지토리-등록" class="headerlink" title="레포지토리 등록"></a>레포지토리 등록</h3><p>인증된 <code>.dpkg</code>, <code>.apt</code> 패키지를 설치하기 위해, 아래 처럼 서버의 키를 등록한다.</p>
<h4 id="키-서버-등록"><a href="#키-서버-등록" class="headerlink" title="키 서버 등록"></a>키 서버 등록</h4><p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-debian/">Install MongoDB Community Edition on Debian</a> 에 있는데로 apt 저장소를 위한 키 서버를 등록한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<p>사용한 키가 필요 없어서 키 서버 저장소 목록을 지우려면 apt-key 명령으로 삭제할 키 해시 8자리 코드를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key list</span><br><span class="line"></span><br><span class="line">pub   4096R/A15703C6 2016-01-11 [expires: 2018-01-10]</span><br><span class="line">uid                  MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br></pre></td></tr></table></figure>

<p>이 키를 삭제한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key del A15703C6</span><br></pre></td></tr></table></figure>

<br>

<h4 id="MongoDB용-소스-리스트-추가"><a href="#MongoDB용-소스-리스트-추가" class="headerlink" title="MongoDB용 소스 리스트 추가"></a>MongoDB용 소스 리스트 추가</h4><p>키 서버를 등록했으면 apt의 source list에 mongodb repository를 등록해야 한다. <strong>Ubuntu 16.04, 18.04</strong> 그리고 <strong>Debian Stretch&#x2F;Buster with Armbian</strong> 에서 MongoDB Community Edition에 대한 저장소 source list 를 아래 같이 등록해서 사용하겠다.</p>
<p>아래 명령은 <code>/etc/apt/sources.list.d/mongodb-org-4.2.list</code> 파일을 생성하고 apt 소스 목록을 추가한다. 단, 저장소의 구분 이름인 <strong><em>multiverse</em></strong> 를 꼭 지정해 주자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [ arch=arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.2 multiverse&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/mongodb-org-4.2.list</span><br></pre></td></tr></table></figure>

<blockquote>
<p>보통 APT 계열의 저장소를 위한 소스 리스트는 아래 같이 구성된다.</p>
<p><code>deb URL 배포판명 구분명</code><br>마지막 구분명은 쓰이는 용도에 따라 main, universe, multiverse 등으로 구분이 되어 있다.</p>
</blockquote>
<br>

<hr>
<br>

<h2 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h2><p><code>apt</code> 명령으로 저장소 소스의 캐시를 갱신하고 mongodb-org 커뮤니티 버전 mongodb를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install -y mongodb-org</span><br></pre></td></tr></table></figure>

<p>설치 중에 mongodb 3.x, 4.x 버전은 데이터를 저장하는 파일 시스템으로 xfs 를 권장하고 있어서 경고 메시지를 출력하는데 일단 무시한다.</p>
<blockquote>
<p>apt로 특정 버전을 설치하려면 다음 같이 버전을 명시한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y mongodb-org=4.1</span><br></pre></td></tr></table></figure>
</blockquote>
<p>무사히 설치를 완료하면 systemd 의 유니트가 추가되어 <code>mongod</code> 서비스를 통해 관리할 수 있다.</p>
<h4 id="설치-확인"><a href="#설치-확인" class="headerlink" title="설치 확인"></a>설치 확인</h4><p>systemctl 로 mongod 데몬이 동작을 확인해 보자, systemctl 로 서비스를 종료했다 재시작 해보자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl stop mongod.service</span><br><span class="line">$ sudo systemctl start mongod.service</span><br></pre></td></tr></table></figure>

<p>mongod 가 정상적으로 동작하는지 status 상태를 확인해 보자.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status mongod.service</span><br><span class="line">* mongod.service - MongoDB Database Server</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mongod.service; disabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2019-12-19 15:38:14 UTC; 3 weeks 6 days ago</span><br><span class="line">     Docs: https://docs.mongodb.org/manual</span><br><span class="line"> Main PID: 2051 (mongod)</span><br><span class="line">   Memory: 191.3M</span><br><span class="line">   CGroup: /system.slice/mongod.service</span><br><span class="line">           `-2051 /usr/bin/mongod --config /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p>여기까지 Arm64 기반 Debian Buster인 Armbian 시스템에 Mongodb Community Edition 4.2 버전을 설치하는 과정을 진행했다.</p>
<p><code>mongod</code> 서비스가 제대로 실행됐으면 <strong><code>mongo</code></strong> 클라이언트로 테스트해 볼 수 있으면 접속해 볼 수 있는데, 연결을 위해 mondod.conf 라는 구성 파일을 다루어 보자.</p>
<h4 id="설치-위치"><a href="#설치-위치" class="headerlink" title="설치 위치"></a>설치 위치</h4><p>MongoDB Community Edition이 설치되면 요구되는 파일 및 폴더가 다음 위치에 생성된다.</p>
<ul>
<li><strong>&#x2F;var&#x2F;lib&#x2F;mongodb</strong> : 기본 데이터 파일 위치</li>
<li><strong>&#x2F;var&#x2F;log&#x2F;mongodb</strong> : 기본 로그 저장 폴더</li>
<li><strong>&#x2F;etc&#x2F;mongod.conf</strong> : mongod 구성 파일. 로그, 데이터 위치 등을 변경 가능</li>
</ul>
<p>이제 데이터베이스 시스템을 사용하기 위한 데이터 파일, 네트워크 구성 및 인증 방법을 구성해야 한다. 실제 데이터 베이스 운영을 위해서 구성 파일인 <code>mongod.conf</code> 파일을 사용이 필요하면 이어지는 글을 참조하자.</p>
<ul>
<li><a href="/linux/database/mongodb-config">Mongo Database 설정과 사용자 인증 사용</a></li>
</ul>
<hr>
<br>

<p>만약 MongoDB community edition을 위 방법같이 설치를 했는데 systemctl 명령으로 찾지 못하면 아래 systemd unit 파일에 대한 글을 참조해서 추가해 주면 된다.</p>
<br>
<br>

<h1 id="systemd-unit-파일"><a href="#systemd-unit-파일" class="headerlink" title="systemd unit 파일"></a>systemd unit 파일</h1><p>Armbian 에서 설치중 systemd unit 설정 파일과 MongoDB 시스템 계정 등이 생성되지 않는 경우가 있었다.</p>
<ul>
<li><strong>mongodb-org</strong> 설치후 systemd Unit 파일이 <code>/etc/init.d</code>에 복사되지 않는 경우</li>
<li>여기서는 odroid-c2 armbian 설치 상태, 일반 리눅스 배포본은 잘 된다.</li>
</ul>
<p>systemd 를 사용하기 위해서 MongoDB 서버 Daemon을 위한 Unit 파일을 아래를 따라 손으로 생성해 주면 systemctl 명령으로 서비스를 관리할 수 있다.</p>
<ol>
<li>MongoDB Daemon 사용자 추가</li>
<li>Service Unit File 작성</li>
<li>활성화</li>
<li>퍼미션 확인</li>
<li>Run</li>
</ol>
<br>

<h3 id="1-MongoDB-Daemon-사용자-추가"><a href="#1-MongoDB-Daemon-사용자-추가" class="headerlink" title="1. MongoDB Daemon 사용자 추가"></a>1. MongoDB Daemon 사용자 추가</h3><p><code>mongod</code> 데몬은 mongodb user account 계정으로 실행된다. <code>systemctl</code> 명령으로 <code>mongod</code> 를 시작하고 사용하기 위해서는 mongod-org 서비스를 위해서 사용자 <strong>mongodb</strong> 가 추가되야 한다. 만약 생성되지 않았으면, 새로 만든다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser --disabled-password --gecos &quot;&quot; --no-create-home --disabled-password --disabled-login mongodb</span><br></pre></td></tr></table></figure>

<h3 id="2-systemd-service-entry"><a href="#2-systemd-service-entry" class="headerlink" title="2. systemd service entry"></a>2. systemd service entry</h3><p>데비안&#x2F;우분투 에서 systemd 서비스 파일은 <code>/lib/systemd/system/</code> 밑에 위치한다. Mongodb Community Edition 의 Unit 파일은 <strong><em>mongod.service</em></strong> 이다.</p>
<p>Mongodb Community Edition 설치시 Unit 파일이 복사되는데 파일이 있는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l /lib/systemd/system/mongod.service</span><br></pre></td></tr></table></figure>

<p>만약 <strong>mongod.service</strong> 가 없으면 새로 생성해야 한다.</p>
<br>

<h4 id="Unit-파일"><a href="#Unit-파일" class="headerlink" title="Unit 파일"></a>Unit 파일</h4><p>다음은 Mongodb Community Edition 설치시 기본으로 제공되는 유니트 파일이다. 만약 mongod.service 파일이 없으면 &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongod.service 에 생성해서 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=MongoDB Database Server</span><br><span class="line">Documentation=https://docs.mongodb.org/manual</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mongodb</span><br><span class="line">Group=mongodb</span><br><span class="line">EnvironmentFile=-/etc/default/mongod</span><br><span class="line">ExecStart=/usr/bin/mongod --config /etc/mongod.conf</span><br><span class="line">#PIDFile=/var/run/mongodb/mongod.pid</span><br><span class="line">PIDFile=/run/mongodb/mongod.pid</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE=infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU=infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS=infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE=64000</span><br><span class="line"># processes/threads</span><br><span class="line">LimitNPROC=64000</span><br><span class="line"># locked memory</span><br><span class="line">LimitMEMLOCK=infinity</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax=infinity</span><br><span class="line">TasksAccounting=false</span><br><span class="line"></span><br><span class="line"># Recommended limits for for mongod as specified in</span><br><span class="line"># http://docs.mongodb.org/manual/reference/ulimit/#recommended-settings</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h3 id="3-활성화"><a href="#3-활성화" class="headerlink" title="3. 활성화"></a>3. 활성화</h3><p><strong>mongod.service</strong> 가 있으면 활성화 여부, 즉 systemd 에 <strong>mongod.service</strong> 가 등록 됐는지 확인한다. <code>/lib/systemd/system/mongod.service</code> 파일을 다음 같이 활성화 시켜준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --type=service |grep mongod</span><br><span class="line">mongodb.service             disabled</span><br></pre></td></tr></table></figure>

<p><em>disable</em> 상태면 <code>systemctl</code> 명령으로 <em>enable</em> 시킨다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /lib/systemd/system</span><br><span class="line">$ sudo systemctl enable mongodb.service</span><br></pre></td></tr></table></figure>

<br>

<h3 id="4-퍼미션-확인"><a href="#4-퍼미션-확인" class="headerlink" title="4. 퍼미션 확인"></a>4. 퍼미션 확인</h3><p>MongoDB Community Editon을 소스 빌드로 설치하면 데이터 및 로그 디렉토리를 생성하고 사용자 퍼미션이 설정되야 한다.</p>
<p>예를 들어 <strong>로그 디렉토리</strong> <em>&#x2F;var&#x2F;log&#x2F;mongo</em> 그리고 <strong>데이터 디렉토리</strong> <em>&#x2F;data&#x2F;mongodata</em> 라면 해당 디렉토리에 시스템 몽고디비 사용자 <code>mongodb</code> 가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /var/log/mongodb</span><br><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h3 id="5-Run"><a href="#5-Run" class="headerlink" title="5. Run"></a>5. Run</h3><p><code>systemctl</code> 명령으로 mongod 를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mongod</span><br><span class="line">$ sudo systemctl status mongod</span><br></pre></td></tr></table></figure>

<p>실행한 <code>mongod</code>를 확인해 보면</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef |grep mongod</span><br><span class="line">mongodb  15385     1  1 12:06 ?        00:00:00 /usr/bin/mongod --config /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p><code>mongod</code> 서비스가 제대로 실행됐으면 <strong>mongo</strong> 클라이언트로 테스트해 볼 수 있으면 접속해 볼 수 있다.</p>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-09-05T11:00:00.000Z" title="2019-9-5 20:00:00">2019-09-05</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:16:46.098Z" title="2022-2-25 1:16:46">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Programming/">Programming</a></span><span class="level-item">20분안에 읽기 (약 3014 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/09/05/python/2019-09-05-OpenSuse-JupyterNotebook_scientific/">openSUSE - 과학계산을 위한 Python, Jupyter Notebook</a></h1><div class="content"><p>이 글은 OpenSuse LEAP 15 에서 과학계산을 위한 파이썬 환경을 위한 Jupyter Notebook을 설치하는 과정을 요약하고 있다.</p>
<p>이 글에서는 시스템 패키지로 Python3, jupyter-notebook 을 설치하고, 파이썬 가상환경에서 과학계산 파이썬 모듈을 설치한 후에 Jupyter notebook 을 운영하도록 한다.</p>
<p><strong>과학계산을 위한 <em>Python Jupyter</em> 환경</strong></p>
<p>아래 같은 플랫폼에서 시스템 패키지 소프트웨어와 파이썬 모듈을 설치하는 과정이다.</p>
<ul>
<li>Raspberry Pi 3</li>
<li>openSUSE LEAP 42.3, 15.0, 15.1</li>
<li>Jupyter Notebook</li>
<li>Python 그래프 matplotlib 및 pillow 이미지 라이브러리</li>
<li>과학계산 모듈: numpy, scipy 등</li>
<li>파이썬 가상환경<ul>
<li>pandas</li>
</ul>
</li>
</ul>
<p>Python과 Virtualenv 환경을 더 알고 싶으면 다음 두 링크에 자세한 설명이 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC31--">Python - Install virtualenv on Linux</a></li>
</ul>
<br>

<h2 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h2><p>시스템에 Python2, Python3 가 설치되었는지 확인:</p>
<h4 id="Python-환경"><a href="#Python-환경" class="headerlink" title="Python 환경"></a>Python 환경</h4><p>openSUSE 15.0에서 파이썬은 python2, python3.6 시스템 패키지로 설치되어 있다.</p>
<p>pip를 설치해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper <span class="keyword">in</span> python3-pip</span><br></pre></td></tr></table></figure>

<p>pip 를 여러 버전 사용중이라면,</p>
<blockquote>
<p>만약 python2-pip 도 사용중이고 pip를 pip3로 사용하려면 <code>update-alternatives</code> 를 이용해 <code>pip</code> 를 pip3 로 연결해 준다. 다른 배포본에서 필요시 update-alternatives 사용:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 30</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="시스템-개발-패키지-설치"><a href="#시스템-개발-패키지-설치" class="headerlink" title="시스템 개발 패키지 설치"></a>시스템 개발 패키지 설치</h4><p>컴파일에 필요한 헤더 등이 포함된 개발자 라이브러리를 설치한다. <code>pattern devel</code> 로 검색해 보면,,,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install -t pattern devel</span><br><span class="line"></span><br><span class="line">S | Name                 | Summary                             | Type</span><br><span class="line">--+----------------------+-------------------------------------+--------</span><br><span class="line">  | devel_C_C++          | C/C++ Development                   | pattern</span><br><span class="line">i | devel_basis          | Base Development                    | pattern</span><br><span class="line">  | devel_gnome          | GNOME Development                   | pattern</span><br><span class="line">  | devel_ide            | Integrated Development Environments | pattern</span><br><span class="line">  | devel_java           | Java Development                    | pattern</span><br><span class="line">  | devel_kde            | KDE Development                     | pattern</span><br><span class="line">  | devel_kde_frameworks | KDE Frameworks Development          | pattern</span><br><span class="line">  | devel_kernel         | Linux Kernel Development            | pattern</span><br><span class="line">  | devel_mono           | .NET Development                    | pattern</span><br><span class="line">  | devel_perl           | Perl Development                    | pattern</span><br><span class="line">  | devel_python         | Python Development                  | pattern</span><br><span class="line">  | devel_python3        | Python 3 Development                | pattern</span><br><span class="line">  | devel_qt4            | Qt 4 Development                    | pattern</span><br><span class="line">  | devel_qt5            | Qt 5 Development                    | pattern</span><br><span class="line">  | devel_rpm_build      | RPM Build Environment               | pattern</span><br><span class="line">  | devel_ruby           | Ruby Development                    | pattern</span><br><span class="line">  | devel_tcl            | Tcl/Tk Development                  | pattern</span><br><span class="line">  | devel_web            | Web Development                     | pattern</span><br><span class="line">  | devel_yast           | YaST Development                    | pattern</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>이 중에서 devel_basis, python 관련 개발용 모듈을 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install -t pattern devel_basis</span><br></pre></td></tr></table></figure>

<p>파이썬 개발 모듈을 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install -t pattern devel_python devel_python3</span><br><span class="line">sudo zypper install python-distutils-extra</span><br></pre></td></tr></table></figure>

<p>curses 관련 파이썬 모듈을 설치해야 한다.</p>
<ul>
<li>python-curses: Python이 (N)Curses Libr에 대한 인터페이스이다</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper in python-curses python3-curses</span><br></pre></td></tr></table></figure>

<h4 id="matplotlib"><a href="#matplotlib" class="headerlink" title="matplotlib"></a>matplotlib</h4><p>matplot 을 설치하면 numpy, scipy, pillow python3-tk 등이 함께 설치된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper in python-matplotlib python3-matplotlib</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">다음 새 패키지가 설치됩니다.</span><br><span class="line">  cups cups-client cups-filters ghostscript ghostscript-x11 libICE6 libSM6 libXt6 libavahi-glib1</span><br><span class="line">  libcupscgi1 libcupsimage2 libcupsmime1 libcupsppdc1 libopenjp2-7 libpoppler73 libqhull7-7_2_0 libqpdf21</span><br><span class="line">  libwebp6 libwebpdemux2 libwebpmux2 libxml2-tools parallel-printer-support poppler-data poppler-tools</span><br><span class="line">  python-functools32 python-subprocess32 python-tk python2-Cycler python2-Pillow python2-matplotlib</span><br><span class="line">  python2-matplotlib-tk python2-numpy python2-olefile python2-pyparsing python2-python-dateutil</span><br><span class="line">  python2-pytz python2-six python3-Cycler python3-Pillow python3-matplotlib python3-matplotlib-tk</span><br><span class="line">  python3-olefile python3-tk</span><br><span class="line"></span><br><span class="line">다음 권장 패키지가 자동으로 선택되었습니다.</span><br><span class="line">  cups-filters ghostscript ghostscript-x11 libxml2-tools poppler-data poppler-tools python2-Pillow</span><br><span class="line">  python2-matplotlib-tk python3-Pi</span><br></pre></td></tr></table></figure>

<p>numpy 개발자 패키지를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper in python2-numpy-devel python3-numpy-devel</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h2><p>Jupyter는 웹 브라우저를 통해서 IDE 환경을 제공하고, 다양한 언어&#x2F;문법을 지원하는 Kernel 이라는 해석기를 통해 IDE에서 코딩한 결과를 확인할 수 있다.</p>
<p>여기서는 가상환경을 구성해 Jupyter 관련 패키지를 설치하고 사용하겠다.</p>
<ul>
<li>시스템에 설치된 Python3 와 pip 모듈</li>
<li>가상환경으로 venv 사용</li>
</ul>
<h3 id="설치-1"><a href="#설치-1" class="headerlink" title="설치"></a>설치</h3><p>Zeromq-devel 설치한다.</p>
<ul>
<li>libczmq5은 쥬피터 노트북에서 필요로 한다.</li>
<li>LEAP 14는 libzmq3 다.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install zeromq-devel libzmq5</span><br></pre></td></tr></table></figure>

<p>jupyter notebook 을 시스템 패키지로 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper in python3-jupyter_notebook</span><br><span class="line">...</span><br><span class="line">다음 새 패키지가 설치됩니다.</span><br><span class="line">  ethtool libcmark0_28_3 libgfortran4 libibverbs libibverbs1 liblua5_1-5 libmlx4-1 libmlx5-1 libnuma1</span><br><span class="line">  libopenblas_openmp0 librdmacm1 libucm0 libucp0 libucs0 libuct0 libxslt1 mpi-selector openmpi</span><br><span class="line">  openmpi-config openmpi-libs pandoc python-sip-common python3-Automat python3-Babel python3-Genshi</span><br><span class="line">  python3-Jinja2 python3-MarkupSafe python3-PyNaCl python3-Pygments python3-Send2Trash python3-Twisted</span><br><span class="line">  python3-asn1crypto python3-attrs python3-backcall python3-bcrypt python3-bleach python3-certifi</span><br><span class="line">  python3-cffi python3-constantly python3-cryptography python3-cssselect python3-defusedxml</span><br><span class="line">  python3-entrypoints python3-gevent python3-greenlet python3-html5lib python3-hyperlink python3-idna</span><br><span class="line">  python3-incremental python3-ipython_genutils python3-jedi python3-jsonschema python3-jupyter_client</span><br><span class="line">  python3-jupyter_core python3-jupyter_ipykernel python3-jupyter_ipyparallel python3-jupyter_ipython</span><br><span class="line">  python3-jupyter_ipywidgets python3-jupyter_nbconvert python3-jupyter_nbformat python3-jupyter_notebook</span><br><span class="line">  python3-jupyter_qtconsole python3-jupyter_widgetsnbextension python3-lxml python3-mistune python3-mpi4py</span><br><span class="line">  python3-numpy python3-pandocfilters python3-paramiko python3-parso python3-pexpect python3-pickleshare</span><br><span class="line">  python3-prometheus_client python3-prompt_toolkit python3-psutil python3-ptyprocess python3-py</span><br><span class="line">  python3-pyOpenSSL python3-pyasn1 python3-pyasn1-modules python3-pycparser python3-pycrypto</span><br><span class="line">  python3-pycurl python3-pymongo python3-pyserial python3-python-dateutil python3-pytz python3-pyzmq</span><br><span class="line">  python3-service_identity python3-simplegeneric python3-simplejson python3-sip python3-terminado</span><br><span class="line">  python3-testpath python3-tornado python3-traitlets python3-wcwidth python3-webencodings</span><br><span class="line">  python3-zope.interface rdma-core</span><br><span class="line"></span><br><span class="line">다음 권장 패키지가 자동으로 선택되었습니다.</span><br><span class="line">  ethtool openmpi-config pandoc python3-Genshi python3-Pygments python3-Twisted python3-cffi</span><br><span class="line">  python3-gevent python3-jupyter_client python3-jupyter_ipykernel python3-jupyter_ipyparallel</span><br><span class="line">  python3-jupyter_ipython python3-jupyter_ipywidgets python3-jupyter_nbconvert python3-jupyter_nbformat</span><br><span class="line">  python3-jupyter_notebook python3-jupyter_qtconsole python3-lxml python3-mpi4py python3-numpy</span><br><span class="line">  python3-paramiko python3-pexpect python3-psutil python3-py python3-pycurl python3-pymongo</span><br><span class="line">  python3-service_identity python3-simplejson python3-tornado</span><br><span class="line"></span><br><span class="line">다음 패키지가 제안되지만 설치되지 않습니다.</span><br><span class="line">  python3-jupyter_notebook-latex</span><br></pre></td></tr></table></figure>

<br>

<h3 id="가상환경-구성"><a href="#가상환경-구성" class="headerlink" title="가상환경 구성"></a>가상환경 구성</h3><p>jupyter notebook 을 실행하고 사용할 파이썬 과학계산 모듈을 위한 가상환경을 구성한다.</p>
<p>시스템 <code>pip</code> 모듈을 최신 버전으로 업그레이드한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>가상환경은 사용자 홈디렉토리의 <em>.venv</em> 폴더로 가정한다. <em>python3</em>, 파이썬 시스템 라이브러리를 함께 사용을 위해 <em>–system-site-packages</em> 옵션과 함께 <em>jupyterscfy</em>라는 가상환경을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~&gt; python3 -m venv --system-site-packages .venv/jupyterscfy</span><br><span class="line">~&gt; <span class="built_in">source</span> .venv/jupyterscfy/bin/activate</span><br><span class="line">(jupyterscfy) ~&gt;</span><br><span class="line">(jupyterscfy) ~&gt; python --version</span><br><span class="line">Python 3.6</span><br></pre></td></tr></table></figure>

<p>가상환경의 pip 모듈을 최신버전으로 유지한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(jupyterscfy) ~&gt; pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<br>

<h3 id="실행"><a href="#실행" class="headerlink" title="실행"></a>실행</h3><p><code>jupyter-notebook</code>을 실행해 보고, 서버 관련 구성 내용을 설정해서 사용해 보자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(jupyterscfy) ~&gt; jupyter notebook</span><br><span class="line">[I 01:15:02.799 NotebookApp] Writing notebook server cookie secret to /run/user/1000/jupyter/notebook_cookie_secret</span><br><span class="line">[I 01:15:21.630 NotebookApp] Loading IPython parallel extension</span><br><span class="line">[I 01:15:21.646 NotebookApp] Serving notebooks from <span class="built_in">local</span> directory: /home/qkboo</span><br><span class="line">[I 01:15:21.646 NotebookApp] The Jupyter Notebook is running at:</span><br><span class="line">[I 01:15:21.647 NotebookApp] http://localhost:8888/?token=689ae860106f8a7274b50f68f69895420eab19064ebb8e69</span><br><span class="line">[I 01:15:21.648 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[W 01:15:21.708 NotebookApp] No web browser found: could not locate runnable browser.</span><br><span class="line">[C 01:15:21.710 NotebookApp]</span><br><span class="line"></span><br><span class="line">    To access the notebook, open this file <span class="keyword">in</span> a browser:</span><br><span class="line">        file:///run/user/1000/jupyter/nbserver-8251-open.html</span><br><span class="line">    Or copy and <span class="built_in">paste</span> one of these URLs:</span><br><span class="line">        http://localhost:8888/?token=689ae860106f8a7274b50f68f69895420eab19064ebb8e69</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>jupyter notebook 을 종료하려면 Ctrl+C 로 인터럽트를 걸어준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">^C[I 01:16:41.847 NotebookApp] interrupted</span><br><span class="line">Serving notebooks from <span class="built_in">local</span> directory: /home/qkboo</span><br><span class="line">0 active kernels</span><br><span class="line">The Jupyter Notebook is running at:</span><br><span class="line">http://localhost:8888/?token=689ae860106f8a7274b50f68f69895420eab19064ebb8e69</span><br><span class="line">Shutdown this notebook server (y/[n])? y</span><br><span class="line">[C 01:16:44.757 NotebookApp] Shutdown confirmed</span><br><span class="line">[I 01:16:44.760 NotebookApp] Shutting down 0 kernels</span><br><span class="line">(jupyterscfy) ~&gt;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Scientific-packages"><a href="#Scientific-packages" class="headerlink" title="Scientific packages"></a>Scientific packages</h3><p>numpy<br>scipy<br>matplotlib<br>pillow</p>
<ul>
<li>matplotlib는 외부 이미지를 png 형식만 지원한다. jpeg를 사용하려면 pillow 모듈을 설치한다.</li>
</ul>
<p>pillow 여기까지 설치하면 의존성에 관련한 아래 같은 여러 패키지가 함께 설치된다.</p>
<ul>
<li>requests : Python package provides a graceful interface for making HTTP requests,</li>
<li>pil : provides Python imaging capabilities,</li>
<li>scrapy : is a web scraping framework,</li>
<li>geopy provides geocoding and geodesic distance functions,</li>
<li>shapely provides 2D geometry manipulation,</li>
<li>pyproj: provides cartographic transformations. In the second command, jupyter provides interactive coding notebooks,</li>
<li>geopandas spatializes pandas,</li>
<li>OSMnx lets you work with OpenStreetMap street networks.</li>
</ul>
<p>이 패키지들은 별도로 설치를 하고자 하면 <code>pip</code>로 설치하거나 시스템 패키지로 다음 같이 설치 할 수 있다.</p>
<p>Python2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-requests python-pil python-scrapy python-geopy python-shapely python-pyproj</span><br></pre></td></tr></table></figure>

<p>Python3</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-requests python3-pil python3-scrapy python3-geopy python3-shapely python3-pyproj</span><br></pre></td></tr></table></figure>

<h4 id="symbolic-math"><a href="#symbolic-math" class="headerlink" title="symbolic math"></a>symbolic math</h4><p>symbolic mathematics 관련 패키지도 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install python-sympy python-nose</span><br><span class="line">sudo zypper install python3-sympy python3-nose</span><br></pre></td></tr></table></figure>

<h4 id="Pandas-설치"><a href="#Pandas-설치" class="headerlink" title="Pandas 설치"></a>Pandas 설치</h4><p>pandas 설치시 여러 번들이 필요해서 시스템 패키지가 아닌 conda 혹은 pip 로 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ time pip install pandas</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">real 118m4.118s</span><br><span class="line">user 114m47.176s</span><br><span class="line">sys 1m27.483s</span><br></pre></td></tr></table></figure>

<blockquote>
<p>pandas를 pip로 설치시 Raspberry Pi 3의 OpenSuse 15.2 에서 실제 2시간 정도 걸린다.</p>
</blockquote>
<p>Pandas 로 지오 데이터 셋트를 다룰 예정이라면</p>
<h4 id="백업"><a href="#백업" class="headerlink" title="백업"></a>백업</h4><p>현재까지 설치된 pip 모듈 목록을 저장하자.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; pip freeze --local &gt; jupyter-requirements.txt</span><br></pre></td></tr></table></figure>

<br>

<h2 id="서버로-실행"><a href="#서버로-실행" class="headerlink" title="서버로 실행"></a>서버로 실행</h2><p><code>jupyter-notebook</code> 은 로컬 머신에서 브라우저를 실행한다. 여기서는 원격 사용을 위해 다음 같이 시작할 수 있다. <code>[DIR]</code> 에 jupyter-notebook에서 작성한 노트북 파일이 저장된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~&gt; jupyter-notebook --no-browser --ip=* --port=8000 [DIR]</span><br><span class="line">[I 02:51:04.797 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:04.800 NotebookApp]</span><br><span class="line"></span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8585/?token=a747472bc9a7c6684829267d2ed0a4cd9a722e</span><br></pre></td></tr></table></figure>

<p>시작후 <code>?token=a.....</code> 부분의 토큰을 복사해 브라우저에 입력후 쥬피터 노트북 사용을 시작한다. 브라우저로 노트북에 접속해서 복사한 토큰을 입력한 후 로그인한다.</p>
<p><img src="/images/python/jupyter5-run.png">{:width&#x3D;”650”}</p>
<br>

<h3 id="Jupyter-설정-이용"><a href="#Jupyter-설정-이용" class="headerlink" title="Jupyter 설정 이용"></a>Jupyter 설정 이용</h3><p>jupyter는 설치된 후에 jupyter 시스템 디렉토리와 사용자 <strong>JUPYTER_DATA_DIR</strong>에 필요한 내용을 저장한다.</p>
<ul>
<li><strong>시스템 디렉토리</strong>: &#x2F;usr&#x2F;local&#x2F;share&#x2F;jupyter&#x2F;</li>
<li><strong>JUPYTER_DATA_DIR</strong> 는 보통 ~&#x2F;.jupyter</li>
</ul>
<p>설정 파일을 이용해서 사용자 비밀번호를 이용해 노트북을 사용할 수 있다.</p>
<p>먼저 실행중인 쥬피터 노트북에서 <code>passwd()</code> 를 실행해 <strong>패스워드 해시 값</strong>을 얻는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">In [<span class="number">2</span>]: passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;sha1:67c9e60bb8b6:9ffede0825894254b2e043ea597d771089e11eed&#x27;</span></span><br></pre></td></tr></table></figure>

<p>패스워드 해시 값을 데이터 디렉토리의 설정 파일에 입력해야 한다.</p>
<h4 id="데이터-설정-파일"><a href="#데이터-설정-파일" class="headerlink" title="데이터 설정 파일"></a>데이터 설정 파일</h4><p>먼저 다음 같이 설정 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~&gt; jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /home/foo/.jupyter/jupyter_notebook_config.py</span><br><span class="line">~&gt; <span class="built_in">cd</span> .jupyter &amp;&amp; <span class="built_in">mv</span> jupyter_notebook_config.py mynotebook.py</span><br></pre></td></tr></table></figure>

<p><em>mynotebook.py</em>에 다음을 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#c.NotebookApp.notebook_dir = &#x27;/path/to/notebook_directory&#x27;</span><br><span class="line">c.NotebookApp.base_url = &#x27;http://www.yourdomain.com/notebok&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;&#x27;</span><br><span class="line">c.NotebookApp.port = 8000</span><br><span class="line">c.NotebookApp.port_retries = 50</span><br></pre></td></tr></table></figure>

<p>복사한 패스워드 해시 값을 mynotebook.py 설정 파일 안의 <code>c.NotebookApp.password</code> 항목 주석을 풀고 해시 값을 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = &#x27;sha1:4ee6bb2da3d7:ed76216b87228540e5f5f20fcfa8069cf82686f0&#x27;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 이용해 jupyter-notebook을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; jupyter-notebook --config .jupyter/mybook_config.py [DIR]</span><br></pre></td></tr></table></figure>

<p>이제 jupyter에 접속하려면 다음 같이 패스워드를 묻고 입력한 후에 사용할 수 있다.</p>
<p><img src="/images/python/jupyter-login.png">{:width&#x3D;”650”}</p>
<h4 id="Background-실행"><a href="#Background-실행" class="headerlink" title="Background 실행"></a>Background 실행</h4><p>Jupyter-notebook을 백그라운드로 실행하려면 <code>nohup</code> 을 사용할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&gt; <span class="built_in">nohup</span> jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>nohup은 재시동시 다시 시작해야 하는 불편한 점이 있다.</p>
<h4 id="crontab-으로-실행"><a href="#crontab-으로-실행" class="headerlink" title="crontab 으로 실행"></a>crontab 으로 실행</h4><p>nohup 과 결합해서 사용해도 좋은 방법으로 crontab 을 사용해 재시동 후 자동으로 시작해 줄 수 있다. 사용자 crontab 을 편집해 다음 같이 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot cd /home/foo; jnohup jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>이 방법도 사용자가 시작&#x2F;상태확인&#x2F;종료 같은 직접적인 방법을 사용하기는 좀 불편하다.</p>
<p>그래서 upstart의 init.d 를 사용하거나 systemd 의 unit으로 생성해서 사용하는 것이 좋다.</p>
<h3 id="systemd-에서-실행"><a href="#systemd-에서-실행" class="headerlink" title="systemd 에서 실행"></a>systemd 에서 실행</h3><p>systemd unit으로 새로운 unit 파일을 생성해서 기존 <code>systemctl</code> 명령으로 시작&#x2F;상태&#x2F;종료&#x2F;재시작 등의 작업을 할 수 있다. 물론 재시동 관련해서도 완벽히 동작한다.</p>
<p>systemd의 unit 위치는 OS 마다 조금 다른 것 같다. 여기서는 <em>&#x2F;etc&#x2F;systemd&#x2F;system</em> 밑에 <em>jupyter.service</em> 라는 유닉 파일로 직접 작업한다.</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;jupyter.service</li>
</ul>
<p>가상환경을 사용하고 있으므로 systemd unit의 <code>ExecStart</code> 의 python도 가상환경 위치로 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Jupyter-Notebook</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter-notebook.pid</span><br><span class="line">ExecStart=/home/foo/.virtualenvs/jupyter/bin/jupyter-notebook --config=/home/foo/.jupyter/mynotebook.py</span><br><span class="line">User=foo</span><br><span class="line">Group=foo</span><br><span class="line">WorkingDirectory=/home/foo/notebooks</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>그리고 시스템 유닛을 시작해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable jupyter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart jupyter.service</span><br></pre></td></tr></table></figure>

<h3 id="Upgrade-jupyter"><a href="#Upgrade-jupyter" class="headerlink" title="Upgrade jupyter"></a>Upgrade jupyter</h3><p>다음 같이 install 명령으로 업그레이드 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(jupyter)~&gt; pip install -U jupyter</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/install.html">Pandas Install</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/install.html">Scipy Install</a></li>
<li><a target="_blank" rel="noopener" href="http://geoffboeing.com/2016/03/scientific-python-raspberry-pi/">Scientific Python on Raspberry Pi</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-10-20T00:00:00.000Z" title="2018-10-20 9:00:00">2018-10-20</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:16:46.097Z" title="2022-2-25 1:16:46">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Programming/">Programming</a></span><span class="level-item">13분안에 읽기 (약 1940 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/10/20/python/2018-10-20-jupyter-scitific-macos/">Python 과학계산을 위한 Jupyter Notebook - macOS</a></h1><div class="content"><p>과학계산을 위한 Jupyter 설치 및 구성까지 요약하고 있다.</p>
<h2 id="과학계산을-위한-Python-Jupyter"><a href="#과학계산을-위한-Python-Jupyter" class="headerlink" title="과학계산을 위한 Python Jupyter"></a>과학계산을 위한 Python Jupyter</h2><p>Raspberry Pi 3 위에 설치한 openSUSE LEAP 42.3 과 15.0 에서 과학계산을 위한 Python 개발환경과 Jupyter Notebook 환경을 정리한다. </p>
<ul>
<li>개발 프론트 엔드: Jupyter</li>
<li>과학계산 모듈: numpy, scipy 등</li>
</ul>
<p>Python과 Virtualenv 환경을 더 알고 싶으면 다음 두 링크에 자세한 설명이 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC23--">Python - Install virtualenv on Linux</a></li>
</ul>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>시스템에 Python2, Python3 가 설치되었는지 확인:</p>
<ul>
<li>macOS : Python2.7</li>
</ul>
<h3 id="python-org-설치"><a href="#python-org-설치" class="headerlink" title="python.org 설치"></a>python.org 설치</h3><p>python.org 에서 package 를 다운받아 설치한다.</p>
<h4 id="Uninstall-package-installer"><a href="#Uninstall-package-installer" class="headerlink" title="Uninstall package installer"></a>Uninstall package installer</h4><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3819449/how-to-uninstall-python-2-7-on-a-mac-os-x-10-6-4/3819829#3819829">https://stackoverflow.com/questions/3819449/how-to-uninstall-python-2-7-on-a-mac-os-x-10-6-4/3819829#3819829</a></p>
<h4 id="brew에서-Python-3-설치"><a href="#brew에서-Python-3-설치" class="headerlink" title="brew에서 Python 3 설치"></a>brew에서 Python 3 설치</h4><p>brew로 최신 3.7을 설치</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install python3</span><br></pre></td></tr></table></figure>


<p>You can install Python packages with<br>  pip3 install <package></p>
<p>They will install into the site-package directory</p>
<p>&#x2F;Users&#x2F;qkboo&#x2F;Library&#x2F;Python&#x2F;3.7&#x2F;site-packages</p>
<h3 id="pip-User-Scheme"><a href="#pip-User-Scheme" class="headerlink" title="pip User Scheme"></a>pip User Scheme</h3><p>Python2.6부터 User scheme 개념이 도입되며서 <code>pip</code>로 설치하는 패키지를 개별 사용자 환경 위치에 설치할 수 있다. </p>
<p>install 명령에 <code>--user</code> 옵션을 주고 설치한다.[^2] </p>
<ul>
<li>기본으로 리눅스는 <em>~&#x2F;.local</em> 폴더이고, </li>
<li>Mac OS X 는 <em>~&#x2F;Library&#x2F;Python&#x2F;X.Y</em> 에 위치한다.[^3]</li>
</ul>
<p>그리고 <code>PATH</code> 에 <em>~&#x2F;.local&#x2F;bin</em> 을 추가한다.</p>
<h4 id="virtualenv-와-virtualenvwrapper"><a href="#virtualenv-와-virtualenvwrapper" class="headerlink" title="virtualenv 와 virtualenvwrapper"></a>virtualenv 와 virtualenvwrapper</h4><p>pip 를 업그레이드하고, 가상 개발환경에서 쥬피터 관련 모듈을 설치하고 관리하기 위해 <code>pip</code>로 virtualenv, virtualenvwrapper 설치한다. </p>
<p>시스템 <code>pip</code> 모듈을 최신 버전으로 업그레이드한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>그리고 virtualenv, virtualenvwrapper 설치하는데, 사용자의 <code>.local</code> 폴더에 설치하도록 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --user virtualenv virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>자동으로 추가되지 않으면, 다음 스크립을 <code>.bashrc</code> 에 추가해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set PATH for pip</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$HOME</span>/.local/bin&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    PATH=<span class="string">&quot;<span class="variable">$HOME</span>/.local/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span><br><span class="line"><span class="built_in">export</span> WORKON_HOME=<span class="variable">$HOME</span>/.virtualenvs</span><br><span class="line"><span class="built_in">export</span> PROJECT_HOME=<span class="variable">$HOME</span>/Devel</span><br><span class="line"><span class="built_in">source</span> ~/Library/Python/3.7/bin/virtualenvwrapper.sh</span><br></pre></td></tr></table></figure>

<p>로그아웃했다 로그인하면 <code>mkvirtualenv</code>, <code>rmvirtualenv</code> 등의 명령어 스크립이 설치된다.</p>
<h4 id="Scientific-stack"><a href="#Scientific-stack" class="headerlink" title="Scientific stack"></a>Scientific stack</h4><p>과학계산을 지원하는 Python 패키지를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --user numpy scipy matplotlib jupyter pandas sympy nose</span><br></pre></td></tr></table></figure>


<br>
### Jupyter Notebook

<p>Jupyter는 웹 브라우저를 통해서 IDE 환경을 제공하고, 다양한 언어&#x2F;문법을 지원하는 Kernel 이라는 해석기를 통해 IDE에서 코딩한 결과를 확인할 수 있다. </p>
<p>여기서는 가상환경을 구성해 Jupyter 관련 패키지를 설치하고 사용하겠다.</p>
<ul>
<li>시스템에 설치된 Python3 와 pip 모듈</li>
</ul>
<h4 id="Jupyter-가상환경-사용시"><a href="#Jupyter-가상환경-사용시" class="headerlink" title="Jupyter 가상환경 사용시"></a>Jupyter 가상환경 사용시</h4><p>다음은 <code>mkvirtualenv</code> 명령으로 <em>jupyter</em>라는 가상환경을 <em>python3</em>, 시스템 패키지 사용을 위해 <em>–system-site-packages</em> 옵션으로 생성한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv -p python3 --system-site-packages jupyter</span><br><span class="line">Running virtualenv with interpreter /usr/local/bin/python3</span><br><span class="line">Using base prefix &#x27;/usr/local/Cellar/python/3.7.1/Frameworks/Python.framework/Versions/3.7&#x27;</span><br><span class="line">New python executable in /Users/qkboo/.virtualenvs/jupyter/bin/python3.7</span><br><span class="line">Also creating executable in /Users/qkboo/.virtualenvs/jupyter/bin/python</span><br><span class="line">Installing setuptools, pip, wheel...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(jupyter) $</span><br><span class="line">(jupyter) $ python --version</span><br><span class="line">Python 3.4.6</span><br></pre></td></tr></table></figure>

<p>가상환경 <em>jupyter</em> 에서 필수 모듈 numpy, scipy가 사용 가능한지 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(jupyter) $ python -c <span class="string">&quot;import numpy;print(numpy.__version__)&quot;</span></span><br><span class="line">1.9.3</span><br><span class="line">(jupyter) $ python -c <span class="string">&quot;import scipy;print(scipy.__version__)&quot;</span></span><br><span class="line">0.16.0</span><br></pre></td></tr></table></figure>


<p>그리고 pip로 Jupyter 가상환경에 Jupyter를 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(jupyter)$ pip install jupyter --user</span><br></pre></td></tr></table></figure>

<p>Python User scheme 에 설치시 macOS는 아래 위치에 설치되므로 경로에 추가한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/qkboo/Library/Python/3.7/bin</span><br></pre></td></tr></table></figure>

<p><code>jupyter-notebook</code>을 실행해 보고, 서버 관련 구성 내용을 설정해서 사용해 보자.</p>
<p>현재까지 설치된 pip 모듈 목록을 저장하자.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze --local &gt; jupyter-requirements.txt</span><br></pre></td></tr></table></figure>


<h4 id="서버로-실행"><a href="#서버로-실행" class="headerlink" title="서버로 실행"></a>서버로 실행</h4><p><code>jupyter-notebook</code> 은 로컬 머신에서 브라우저를 실행한다. 여기서는 원격 사용을 위해 다음 같이 시작할 수 있다. <code>[DIR]</code> 에 jupyter-notebook에서 작성한 노트북 파일이 저장된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter-notebook --no-browser --ip=* --port=8000 [DIR]</span><br><span class="line">[I 02:51:04.797 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:04.800 NotebookApp]</span><br><span class="line"></span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8585/?token=a747472bc9a7c6684829267d2ed0a4cd9a722e</span><br></pre></td></tr></table></figure>

<p>시작후 <code>?token=a.....</code> 부분의 토큰을 복사해 브라우저에 입력후 쥬피터 노트북 사용을 시작한다. 브라우저로 노트북에 접속해서 복사한 토큰을 입력한 후 로그인한다.</p>
<p><img src="/images/python/jupyter5-run.png">{:width&#x3D;”650”}</p>
<br>
### Jupyter 설정 이용

<p>jupyter는 설치된 후에 jupyter 시스템 디렉토리와 사용자 <strong>JUPYTER_DATA_DIR</strong>에 필요한 내용을 저장한다.</p>
<ul>
<li><strong>시스템 디렉토리</strong>: &#x2F;usr&#x2F;local&#x2F;share&#x2F;jupyter&#x2F;</li>
<li><strong>JUPYTER_DATA_DIR</strong> 는 보통 ~&#x2F;.jupyter</li>
</ul>
<p>설정 파일을 이용해서 사용자 비밀번호를 이용해 노트북을 사용할 수 있다.</p>
<p>먼저 실행중인 쥬피터 노트북에서 <code>passwd()</code> 를 실행해 <strong>패스워드 해시 값</strong>을 얻는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">In [<span class="number">2</span>]: passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;sha1:67c9e60bb8b6:9ffede0825894254b2e043ea597d771089e11eed&#x27;</span></span><br></pre></td></tr></table></figure>

<p>패스워드 해시 값을 데이터 디렉토리의 설정 파일에 입력해야 한다.</p>
<h4 id="데이터-설정-파일"><a href="#데이터-설정-파일" class="headerlink" title="데이터 설정 파일"></a>데이터 설정 파일</h4><p>먼저 다음 같이 설정 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /home/foo/.jupyter/jupyter_notebook_config.py</span><br><span class="line">$ <span class="built_in">cd</span> .jupyter &amp;&amp; <span class="built_in">mv</span> jupyter_notebook_config.py mynotebook.py</span><br></pre></td></tr></table></figure>

<p><em>mynotebook.py</em>에 다음을 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#c.NotebookApp.notebook_dir = &#x27;/path/to/notebook_directory&#x27;</span><br><span class="line">c.NotebookApp.base_url = &#x27;http://www.yourdomain.com/notebok&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;&#x27;</span><br><span class="line">c.NotebookApp.port = 8000</span><br><span class="line">c.NotebookApp.port_retries = 50</span><br></pre></td></tr></table></figure>

<p>복사한 패스워드 해시 값을 mynotebook.py 설정 파일 안의 <code>c.NotebookApp.password</code> 항목 주석을 풀고 해시 값을 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = &#x27;sha1:4ee6bb2da3d7:ed76216b87228540e5f5f20fcfa8069cf82686f0&#x27;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 이용해 jupyter-notebook을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter-notebook --config .jupyter/mybook_config.py [DIR]</span><br></pre></td></tr></table></figure>

<p>이제 jupyter에 접속하려면 다음 같이 패스워드를 묻고 입력한 후에 사용할 수 있다.</p>
<p><img src="/images/python/jupyter-login.png">{:width&#x3D;”650”}</p>
<h4 id="Background-실행"><a href="#Background-실행" class="headerlink" title="Background 실행"></a>Background 실행</h4><p>Jupyter-notebook을 백그라운드로 실행하려면 <code>nohup</code> 을 사용할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">nohup</span> jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>nohup은 재시동시 다시 시작해야 하는 불편한 점이 있다.</p>
<h4 id="crontab-으로-실행"><a href="#crontab-으로-실행" class="headerlink" title="crontab 으로 실행"></a>crontab 으로 실행</h4><p>nohup 과 결합해서 사용해도 좋은 방법으로 crontab 을 사용해 재시동 후 자동으로 시작해 줄 수 있다. 사용자 crontab 을 편집해 다음 같이 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot cd /home/foo; jnohup jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>


<p>이 방법도 사용자가 시작&#x2F;상태확인&#x2F;종료 같은 직접적인 방법을 사용하기는 좀 불편하다.</p>
<p>그래서 upstart의 init.d 를 사용하거나 systemd 의 unit으로 생성해서 사용하는 것이 좋다.</p>
<h4 id="systemd-에서-실행"><a href="#systemd-에서-실행" class="headerlink" title="systemd 에서 실행"></a>systemd 에서 실행</h4><p>systemd unit으로 새로운 unit 파일을 생성해서 기존 <code>systemctl</code> 명령으로 시작&#x2F;상태&#x2F;종료&#x2F;재시작 등의 작업을 할 수 있다. 물론 재시동 관련해서도 완벽히 동작한다.</p>
<p>systemd의 unit 위치는 OS 마다 조금 다른 것 같다. 여기서는 <em>&#x2F;etc&#x2F;systemd&#x2F;system</em> 밑에 <em>jupyter.service</em> 라는 유닉 파일로 직접 작업한다.</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;jupyter.service</li>
</ul>
<p>가상환경을 사용하고 있으므로 systemd unit의 <code>ExecStart</code> 의 python도 가상환경 위치로 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Jupyter-Notebook</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter-notebook.pid</span><br><span class="line">ExecStart=/home/foo/.virtualenvs/jupyter/bin/jupyter-notebook --config=/home/foo/.jupyter/mynotebook.py</span><br><span class="line">User=foo</span><br><span class="line">Group=foo</span><br><span class="line">WorkingDirectory=/home/foo/notebooks</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>그리고 시스템 유닛을 시작해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable jupyter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart jupyter.service</span><br></pre></td></tr></table></figure>



<h3 id="Upgrade-jupyter"><a href="#Upgrade-jupyter" class="headerlink" title="Upgrade jupyter"></a>Upgrade jupyter</h3><p>여기서는 pip 가상머신을 이용하고 있고, virtualenv, virtualenvwrapper는 여기서 사용자 .local 환경에 설치했으므로 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U --user virtualenv virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>다음 같이 pip install 명령으로 업그레이드 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(jupyter)$ pip install -U jupyter</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze —local &gt; requirements.txt</span><br></pre></td></tr></table></figure>


<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/install.html">Pandas Install</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/install.html">Scipy Install</a></li>
<li><a target="_blank" rel="noopener" href="http://geoffboeing.com/2016/03/scientific-python-raspberry-pi/">Scientific Python on Raspberry Pi</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-07-18T00:00:00.000Z" title="2018-7-18 9:00:00">2018-07-18</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:44:27.522Z" title="2022-2-25 1:44:27">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Programming/">Programming</a></span><span class="level-item">17분안에 읽기 (약 2610 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/07/18/python-2018-07-18-jupyter-scitific-opensuse/">openSUSE - Python 과학계산을 위한 Jupyter Notebook</a></h1><div class="content"><p>Raspberry Pi 3에서 openSUSE LEAP 42.3 에서 과학계산을 위한 Jupyter 설치 및 구성까지 요약하고 있다.</p>
<h2 id="과학계산을-위한-Python-Jupyter"><a href="#과학계산을-위한-Python-Jupyter" class="headerlink" title="과학계산을 위한 Python Jupyter"></a>과학계산을 위한 Python Jupyter</h2><p>Raspberry Pi 3 위에 설치한 openSUSE LEAP 42.3 과 15.0 에서 과학계산을 위한 Python 개발환경과 Jupyter Notebook 환경을 정리한다.</p>
<ul>
<li>개발 프론트 엔드: Jupyter</li>
<li>과학계산 모듈: numpy, scipy 등</li>
</ul>
<p>Python과 Virtualenv 환경을 더 알고 싶으면 다음 두 링크에 자세한 설명이 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC39--">Python - Install virtualenv on Linux</a></li>
</ul>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>시스템에 Python2, Python3 가 설치되었는지 확인:</p>
<ul>
<li>openSUSE : Python2.7</li>
</ul>
<h4 id="Python-3-설치"><a href="#Python-3-설치" class="headerlink" title="Python 3 설치"></a>Python 3 설치</h4><p>openSUSE 는 python3 설치</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper in python3</span><br></pre></td></tr></table></figure>

<p>마지막으로 <code>update-alternatives</code> 를 이용해 <code>pip</code> 를 pip3 로 연결해 준다.</p>
<p>다른 배포본에서 필요시 update-alternatives 사용:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 30</span><br></pre></td></tr></table></figure>

<h4 id="pip-User-Scheme"><a href="#pip-User-Scheme" class="headerlink" title="pip User Scheme"></a>pip User Scheme</h4><p>Python2.6부터 User scheme 개념이 도입되며서 <code>pip</code>로 설치하는 패키지를 개별 사용자 환경 위치에 설치할 수 있다.</p>
<p>install 명령에 <code>--user</code> 옵션을 주고 설치한다.[^2]</p>
<ul>
<li>기본으로 리눅스는 <em>~&#x2F;.local</em> 폴더이고,</li>
<li>Mac OS X 는 <em>~&#x2F;Library&#x2F;Python&#x2F;X.Y</em> 에 위치한다.[^3]</li>
</ul>
<p>그리고 <code>PATH</code> 에 <em>~&#x2F;.local&#x2F;bin</em> 을 추가한다.</p>
<h4 id="시스템-개발-패키지-설치"><a href="#시스템-개발-패키지-설치" class="headerlink" title="시스템 개발 패키지 설치"></a>시스템 개발 패키지 설치</h4><p>컴파일에 필요한 헤더 등이 포함된 개발자 라이브러리를 설치한다. <code>pattern devel</code> 로 검색해 보면,,,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install -t pattern devel</span><br><span class="line"></span><br><span class="line">S | Name                 | Summary                             | Type</span><br><span class="line">--+----------------------+-------------------------------------+--------</span><br><span class="line">  | devel_C_C++          | C/C++ Development                   | pattern</span><br><span class="line">i | devel_basis          | Base Development                    | pattern</span><br><span class="line">  | devel_gnome          | GNOME Development                   | pattern</span><br><span class="line">  | devel_ide            | Integrated Development Environments | pattern</span><br><span class="line">  | devel_java           | Java Development                    | pattern</span><br><span class="line">  | devel_kde            | KDE Development                     | pattern</span><br><span class="line">  | devel_kde_frameworks | KDE Frameworks Development          | pattern</span><br><span class="line">  | devel_kernel         | Linux Kernel Development            | pattern</span><br><span class="line">  | devel_mono           | .NET Development                    | pattern</span><br><span class="line">  | devel_perl           | Perl Development                    | pattern</span><br><span class="line">  | devel_python         | Python Development                  | pattern</span><br><span class="line">  | devel_python3        | Python 3 Development                | pattern</span><br><span class="line">  | devel_qt4            | Qt 4 Development                    | pattern</span><br><span class="line">  | devel_qt5            | Qt 5 Development                    | pattern</span><br><span class="line">  | devel_rpm_build      | RPM Build Environment               | pattern</span><br><span class="line">  | devel_ruby           | Ruby Development                    | pattern</span><br><span class="line">  | devel_tcl            | Tcl/Tk Development                  | pattern</span><br><span class="line">  | devel_web            | Web Development                     | pattern</span><br><span class="line">  | devel_yast           | YaST Development                    | pattern</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>devel_basis, python 관련 개발용 모듈을 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install -t pattern devel_basis</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install -t pattern devel_python devel_python3</span><br><span class="line">The following 3 NEW packages are going to be installed:</span><br><span class="line">  patterns-openSUSE-devel_python patterns-openSUSE-devel_python3 pychecker</span><br><span class="line"></span><br><span class="line">The following 2 NEW patterns are going to be installed:</span><br><span class="line">  devel_python devel_python3</span><br><span class="line"></span><br><span class="line">The following recommended package was automatically selected:</span><br><span class="line">  pychecker</span><br><span class="line"></span><br><span class="line">3 new packages to install.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install python-distutils-extra</span><br></pre></td></tr></table></figure>

<p>Zeromq-devel 설치</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zypper install zeromq-devel libczmq3</span><br><span class="line">zypper install libczmq3</span><br></pre></td></tr></table></figure>

<p>libczmq3은 쥬피터 노트북에서 필요로 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper <span class="keyword">in</span> python-distutils-extra</span><br></pre></td></tr></table></figure>

<p>curses 관련 파이썬 모듈을 설치해야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zypper in python-curses python3-curses</span><br></pre></td></tr></table></figure>

<ul>
<li>python-curses: Python이 (N)Curses Libr에 대한 인터페이스이다</li>
</ul>
<br>

<h2 id="Scientific-stack"><a href="#Scientific-stack" class="headerlink" title="Scientific stack"></a>Scientific stack</h2><p>과학계산을 지원하는 Python 패키지를 설치한다.</p>
<ul>
<li>시스템 패지키로 설치</li>
<li>pip 로 설치</li>
</ul>
<h4 id="시스템-패키지로-설치"><a href="#시스템-패키지로-설치" class="headerlink" title="시스템 패키지로 설치"></a>시스템 패키지로 설치</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo zypper <span class="keyword">in</span> python-numpy python-numpy-devel python-decorator</span><br><span class="line">$ sudo zypper <span class="keyword">in</span> python-scipy</span><br><span class="line">$ sudo zypper install python-matplotlib</span><br></pre></td></tr></table></figure>

<p>Python3 패키지도 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo zypper install python3-numpy python3-numpy-devel python3-decorator</span><br><span class="line">$ sudo zypper install python3-numpy python3-scipy</span><br><span class="line">$ sudo zypper install python3-matplotlib</span><br></pre></td></tr></table></figure>

<p>symbolic mathematics 관련 패키지도 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install python-sympy python-nose</span><br><span class="line">sudo zypper install python3-sympy python3-nose</span><br></pre></td></tr></table></figure>

<p>설치되고 사용이 가능한지 확인한다. 다음 두 모듈이 없으면 jupyter 설치가 제대로 안된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import numpy;print(numpy.__version__)&quot;</span><br><span class="line">1.8.0</span><br><span class="line">python -c &quot;import scipy;print(scipy.__version__)&quot;</span><br><span class="line">0.16.0</span><br></pre></td></tr></table></figure>

<p>matplotlib는 외부 이미지를 png 형식만 지원한다. jpeg를 사용하려면 pillow 모듈을 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pillow</span><br></pre></td></tr></table></figure>

<blockquote>
<p>pil -&gt; pillow</p>
</blockquote>
<p>여기까지 설치하면 의존성에 관련한 아래 같은 여러 패키지가 함께 설치된다.</p>
<ul>
<li>requests : Python package provides a graceful interface for making HTTP requests,</li>
<li>pil : provides Python imaging capabilities,</li>
<li>scrapy : is a web scraping framework,</li>
<li>geopy provides geocoding and geodesic distance functions,</li>
<li>shapely provides 2D geometry manipulation,</li>
<li>pyproj: provides cartographic transformations. In the second command, jupyter provides interactive coding notebooks,</li>
<li>geopandas spatializes pandas,</li>
<li>OSMnx lets you work with OpenStreetMap street networks.</li>
</ul>
<p>이 패키지들은 별도로 설치를 하고자 하면 <code>pip</code>로 설치하거나 시스템 패키지로 다음 같이 설치 할 수 있다.</p>
<p>Python2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-requests python-pil python-scrapy python-geopy python-shapely python-pyproj</span><br></pre></td></tr></table></figure>

<p>Python3</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-requests python3-pil python3-scrapy python3-geopy python3-shapely python3-pyproj</span><br></pre></td></tr></table></figure>

<h4 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h4><p>Pandas 로 지오 데이터 셋트를 다룰 예정이라면</p>
<p>libgdal20</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zypper in python3-gdal python-gdal</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libgdal20</span><br></pre></td></tr></table></figure>

<p>gdal 은 geopandas에서 geospatial analysis 에 필요하다.</p>
<p>pandas 설치시 여러 번들이 필요해서 시스템 패키지가 아닌 conda 혹은 pip 로 설치한다.</p>
<p>Pandas comes bundled and can easily be updated using conda:</p>
<p>conda update pandas</p>
<p>pip install pandas</p>
<!--

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zypper install python-pandas python3-pandas</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<br>

<h2 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h2><p>Jupyter는 웹 브라우저를 통해서 IDE 환경을 제공하고, 다양한 언어&#x2F;문법을 지원하는 Kernel 이라는 해석기를 통해 IDE에서 코딩한 결과를 확인할 수 있다.</p>
<p>여기서는 가상환경을 구성해 Jupyter 관련 패키지를 설치하고 사용하겠다.</p>
<ul>
<li>시스템에 설치된 Python3 와 pip 모듈</li>
</ul>
<h4 id="virtualenv-와-virtualenvwrapper"><a href="#virtualenv-와-virtualenvwrapper" class="headerlink" title="virtualenv 와 virtualenvwrapper"></a>virtualenv 와 virtualenvwrapper</h4><p>pip 를 업그레이드하고, 가상 개발환경에서 쥬피터 관련 모듈을 설치하고 관리하기 위해 <code>pip</code>로 virtualenv, virtualenvwrapper 설치한다.</p>
<p>시스템 <code>pip</code> 모듈을 최신 버전으로 업그레이드한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<p>그리고 virtualenv, virtualenvwrapper 설치하는데, 사용자의 <code>.local</code> 폴더에 설치하도록 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --user virtualenv virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>자동으로 추가되지 않으면, 다음 스크립을 <code>.bashrc</code> 에 추가해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set PATH for pip</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$HOME</span>/.local/bin&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">    PATH=<span class="string">&quot;<span class="variable">$HOME</span>/.local/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span><br><span class="line"><span class="built_in">export</span> WORKON_HOME=<span class="variable">$HOME</span>/.virtualenvs</span><br><span class="line"><span class="built_in">export</span> PROJECT_HOME=<span class="variable">$HOME</span>/Devel</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.local/bin/virtualenvwrapper.sh</span><br></pre></td></tr></table></figure>

<p>로그아웃했다 로그인하면 <code>mkvirtualenv</code>, <code>rmvirtualenv</code> 등의 명령어 스크립이 설치된다.</p>
<h4 id="Jupyter-가상환경"><a href="#Jupyter-가상환경" class="headerlink" title="Jupyter 가상환경"></a>Jupyter 가상환경</h4><p>다음은 <code>mkvirtualenv</code> 명령으로 <em>jupyter</em>라는 가상환경을 <em>python3</em>, 시스템 패키지 사용을 위해 <em>–system-site-packages</em> 옵션으로 생성한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv -p python3 --system-site-packages jupyter</span><br><span class="line">(jupyter) $</span><br><span class="line">(jupyter) $ python --version</span><br><span class="line">Python 3.4.6</span><br></pre></td></tr></table></figure>

<p>가상환경 <em>jupyter</em> 에서 필수 모듈 numpy, scipy가 사용 가능한지 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(jupyter) $ python -c <span class="string">&quot;import numpy;print(numpy.__version__)&quot;</span></span><br><span class="line">1.9.3</span><br><span class="line">(jupyter) $ python -c <span class="string">&quot;import scipy;print(scipy.__version__)&quot;</span></span><br><span class="line">0.16.0</span><br></pre></td></tr></table></figure>

<p>그리고 pip로 Jupyter 가상환경에 Jupyter를 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(jupyter)$ pip install jupyter</span><br></pre></td></tr></table></figure>

<p><code>jupyter-notebook</code>을 실행해 보고, 서버 관련 구성 내용을 설정해서 사용해 보자.</p>
<p>현재까지 설치된 pip 모듈 목록을 저장하자.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze --local &gt; jupyter-requirements.txt</span><br></pre></td></tr></table></figure>

<h4 id="서버로-실행"><a href="#서버로-실행" class="headerlink" title="서버로 실행"></a>서버로 실행</h4><p><code>jupyter-notebook</code> 은 로컬 머신에서 브라우저를 실행한다. 여기서는 원격 사용을 위해 다음 같이 시작할 수 있다. <code>[DIR]</code> 에 jupyter-notebook에서 작성한 노트북 파일이 저장된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter-notebook --no-browser --ip=* --port=8000 [DIR]</span><br><span class="line">[I 02:51:04.797 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:04.800 NotebookApp]</span><br><span class="line"></span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8585/?token=a747472bc9a7c6684829267d2ed0a4cd9a722e</span><br></pre></td></tr></table></figure>

<p>시작후 <code>?token=a.....</code> 부분의 토큰을 복사해 브라우저에 입력후 쥬피터 노트북 사용을 시작한다. 브라우저로 노트북에 접속해서 복사한 토큰을 입력한 후 로그인한다.</p>
<p><img src="/images/python/jupyter5-run.png">{:width&#x3D;”650”}</p>
<br>
### Jupyter 설정 이용

<p>jupyter는 설치된 후에 jupyter 시스템 디렉토리와 사용자 <strong>JUPYTER_DATA_DIR</strong>에 필요한 내용을 저장한다.</p>
<ul>
<li><strong>시스템 디렉토리</strong>: &#x2F;usr&#x2F;local&#x2F;share&#x2F;jupyter&#x2F;</li>
<li><strong>JUPYTER_DATA_DIR</strong> 는 보통 ~&#x2F;.jupyter</li>
</ul>
<p>설정 파일을 이용해서 사용자 비밀번호를 이용해 노트북을 사용할 수 있다.</p>
<p>먼저 실행중인 쥬피터 노트북에서 <code>passwd()</code> 를 실행해 <strong>패스워드 해시 값</strong>을 얻는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">In [<span class="number">2</span>]: passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;sha1:67c9e60bb8b6:9ffede0825894254b2e043ea597d771089e11eed&#x27;</span></span><br></pre></td></tr></table></figure>

<p>패스워드 해시 값을 데이터 디렉토리의 설정 파일에 입력해야 한다.</p>
<h4 id="데이터-설정-파일"><a href="#데이터-설정-파일" class="headerlink" title="데이터 설정 파일"></a>데이터 설정 파일</h4><p>먼저 다음 같이 설정 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /home/foo/.jupyter/jupyter_notebook_config.py</span><br><span class="line">$ <span class="built_in">cd</span> .jupyter &amp;&amp; <span class="built_in">mv</span> jupyter_notebook_config.py mynotebook.py</span><br></pre></td></tr></table></figure>

<p><em>mynotebook.py</em>에 다음을 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#c.NotebookApp.notebook_dir = &#x27;/path/to/notebook_directory&#x27;</span><br><span class="line">c.NotebookApp.base_url = &#x27;http://www.yourdomain.com/notebok&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;&#x27;</span><br><span class="line">c.NotebookApp.port = 8000</span><br><span class="line">c.NotebookApp.port_retries = 50</span><br></pre></td></tr></table></figure>

<p>복사한 패스워드 해시 값을 mynotebook.py 설정 파일 안의 <code>c.NotebookApp.password</code> 항목 주석을 풀고 해시 값을 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = &#x27;sha1:4ee6bb2da3d7:ed76216b87228540e5f5f20fcfa8069cf82686f0&#x27;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 이용해 jupyter-notebook을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter-notebook --config .jupyter/mybook_config.py [DIR]</span><br></pre></td></tr></table></figure>

<p>이제 jupyter에 접속하려면 다음 같이 패스워드를 묻고 입력한 후에 사용할 수 있다.</p>
<p><img src="/images/python/jupyter-login.png">{:width&#x3D;”650”}</p>
<h4 id="Background-실행"><a href="#Background-실행" class="headerlink" title="Background 실행"></a>Background 실행</h4><p>Jupyter-notebook을 백그라운드로 실행하려면 <code>nohup</code> 을 사용할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">nohup</span> jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>nohup은 재시동시 다시 시작해야 하는 불편한 점이 있다.</p>
<h4 id="crontab-으로-실행"><a href="#crontab-으로-실행" class="headerlink" title="crontab 으로 실행"></a>crontab 으로 실행</h4><p>nohup 과 결합해서 사용해도 좋은 방법으로 crontab 을 사용해 재시동 후 자동으로 시작해 줄 수 있다. 사용자 crontab 을 편집해 다음 같이 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot cd /home/foo; jnohup jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>이 방법도 사용자가 시작&#x2F;상태확인&#x2F;종료 같은 직접적인 방법을 사용하기는 좀 불편하다.</p>
<p>그래서 upstart의 init.d 를 사용하거나 systemd 의 unit으로 생성해서 사용하는 것이 좋다.</p>
<h4 id="systemd-에서-실행"><a href="#systemd-에서-실행" class="headerlink" title="systemd 에서 실행"></a>systemd 에서 실행</h4><p>systemd unit으로 새로운 unit 파일을 생성해서 기존 <code>systemctl</code> 명령으로 시작&#x2F;상태&#x2F;종료&#x2F;재시작 등의 작업을 할 수 있다. 물론 재시동 관련해서도 완벽히 동작한다.</p>
<p>systemd의 unit 위치는 OS 마다 조금 다른 것 같다. 여기서는 <em>&#x2F;etc&#x2F;systemd&#x2F;system</em> 밑에 <em>jupyter.service</em> 라는 유닉 파일로 직접 작업한다.</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;jupyter.service</li>
</ul>
<p>가상환경을 사용하고 있으므로 systemd unit의 <code>ExecStart</code> 의 python도 가상환경 위치로 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Jupyter-Notebook</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter-notebook.pid</span><br><span class="line">ExecStart=/home/foo/.virtualenvs/jupyter/bin/jupyter-notebook --config=/home/foo/.jupyter/mynotebook.py</span><br><span class="line">User=foo</span><br><span class="line">Group=foo</span><br><span class="line">WorkingDirectory=/home/foo/notebooks</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>그리고 시스템 유닛을 시작해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable jupyter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart jupyter.service</span><br></pre></td></tr></table></figure>

<h3 id="Upgrade-jupyter"><a href="#Upgrade-jupyter" class="headerlink" title="Upgrade jupyter"></a>Upgrade jupyter</h3><p>여기서는 pip 가상머신을 이용하고 있고, virtualenv, virtualenvwrapper는 여기서 사용자 .local 환경에 설치했으므로</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U --user virtualenv virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>다음 같이 pip install 명령으로 업그레이드 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(jupyter)$ pip install -U jupyter</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze —local &gt; requirements.txt</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/install.html">Pandas Install</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/install.html">Scipy Install</a></li>
<li><a target="_blank" rel="noopener" href="http://geoffboeing.com/2016/03/scientific-python-raspberry-pi/">Scientific Python on Raspberry Pi</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-06-08T09:00:00.000Z" title="2018-6-8 18:00:00">2018-06-08</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:42:51.247Z" title="2022-2-25 1:42:51">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">17분안에 읽기 (약 2497 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/08/linux-2018-06-08-mongodb-3-6-install/">MongoDB Community Edition 3.6 on Ubuntu</a></h1><div class="content"><blockquote>
<p>2018-06-22 내용 정리, User auth 링크<br>{:.right-history}</p>
</blockquote>
<p>이 문서는 Ubuntu&#x2F;Debian 계열 정규 배포본에 3.x 버전을 지원하지 않는 플랫폼에 <strong>MongoDB Community Edition 3.6</strong> 버전을 설치하는 과정을 정리하고 있다. 내용의 기초는 MongoDB Community Edition 3.6 버전을 <em>Amd64</em>, <em>Arm64</em> 지원하는 <em>64bit OS</em>에 설치해 사용하기 위해서 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/">Install MongoDB Community Edition, on-ubuntu</a>를 따라서 진행하고 경험상 필요한 부분을 추가로 정리했다.</p>
<ul>
<li>MongoDB Community Edition 3.6 설치</li>
<li>Mongo Database 구성</li>
</ul>
<h2 id="Install-MongoDB-3-6-Community-edition"><a href="#Install-MongoDB-3-6-Community-edition" class="headerlink" title="Install MongoDB 3.6 Community edition"></a>Install MongoDB 3.6 Community edition</h2><p>문서에 따르면 리눅스 계열은 Ubuntu, Red Hat, SUSE, Amazon, Debian 과 tarball 설치를 지원한다. 또한 macOS, Windows 플랫폼 설치도 지원한다고 한다.</p>
<p>테스트한 플랫폼은</p>
<ul>
<li><strong>64bit Ubuntu 16.04</strong>:</li>
<li><strong>Hardkernel Odroid C2</strong>: 64bit, Armbian</li>
</ul>
<p>MongoDB는 다음 패키지를 지원하고 있다:</p>
<ul>
<li><code>mongodb-org</code> : 다음 패키지를 설치하기 위한 메타 패키지</li>
<li><code>mongodb-org-server</code> : <code>mongod</code> daemon 과 구성 및 초기 스크립트.</li>
<li><code>mongodb-org-mongos</code> : <code>mongos</code> daemon.</li>
<li><code>mongodb-org-shell</code> : <code>mongo</code> shell.</li>
<li><code>mongodb-org-tools</code> : MongoDB 유틸리티: mongoimport bsondump, mongodump, mongoexport, mongofiles, mongoperf, mongorestore, mongostat, and mongotop.</li>
</ul>
<h3 id="사전준비"><a href="#사전준비" class="headerlink" title="사전준비"></a>사전준비</h3><p>여기서는 Odroid C2 같은 64bit Arm을 지원하는 Armbian 배포본, 그리고 PC Linux&#x2F;n-Cloud 등의 플랫폼에서 Ubuntu Xeniel 버전에 설치를 했다.</p>
<ul>
<li>Armbian 배포본 Debian Jessie&#x2F;Stretch 에는 아직 mongodb 64bit 를 제공하지 않고 있다.</li>
</ul>
<h4 id="레포지토리-등록"><a href="#레포지토리-등록" class="headerlink" title="레포지토리 등록"></a>레포지토리 등록</h4><p>인증된 <code>.dpkg</code>, <code>.apt</code> 패키지를 설치하기 위해, 아래 처럼 서버의 키를 등록한다.</p>
<blockquote>
<p>여러분 시스템이 적용되는 지는 [^1]에 잘 설명되어 있다.</p>
</blockquote>
<p><em>키서버 등록</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5</span><br></pre></td></tr></table></figure>

<h4 id="MongoDB용-소스-리스트-추가"><a href="#MongoDB용-소스-리스트-추가" class="headerlink" title="MongoDB용 소스 리스트 추가"></a>MongoDB용 소스 리스트 추가</h4><p>apt의 source list에 mongodb repository를 등록한다. 우분투 계열은 파일 생셩 <code>/etc/apt/sources.list.d/mongodb-org-3.6.list</code> 파일 생성하고 아래 같이 해당 리눅스 버전에 맞는 소스 목록을 추가한다.</p>
<p><strong>Ubuntu 16.04</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.6 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list</span><br></pre></td></tr></table></figure>

<p><strong>Ubuntu 14.04</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.6 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list</span><br></pre></td></tr></table></figure>

<h4 id="remove-key-amp-ppa"><a href="#remove-key-amp-ppa" class="headerlink" title="remove key &amp; ppa"></a>remove key &amp; ppa</h4><p>설치 후 필요 없어서 키 서버 저장소 목록을 지우려면, 삭제할 키 해시 8자리 코드를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key list</span><br><span class="line"></span><br><span class="line">pub   4096R/A15703C6 2016-01-11 [expires: 2018-01-10]</span><br><span class="line">uid                  MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br></pre></td></tr></table></figure>

<p>이 키를 삭제한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key del A15703C6</span><br></pre></td></tr></table></figure>

<h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><p>그리고 <code>apt</code> 명령으로 소스 캐시를 갱신하고 mongodb-org 커뮤니티 버전의 mongodb를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install -y mongodb-org</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mongodb 3.x 버전은 데이터 저장 파일 시스템으로 xfs 를 권장하고 있다.</p>
</blockquote>
<p>만약 특정 버전을 설치하려면 다음 같이 버전을 명시한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y mongodb-org=3.6.5 mongodb-org-server=3.6.5 mongodb-org-shell=3.6.5 mongodb-org-mongos=3.6.5 mongodb-org-tools=3.6.5</span><br></pre></td></tr></table></figure>

<p>이전 mongod-org 3.4를 Armbian 에서 설치중 systemd unit 설정 파일과 MongoDB 시스템 계정 등이 생성되지 않는 경우가 있었다. 아래를 따라 손으로 생성해 주면 된다.</p>
<h4 id="mongodb-사용자"><a href="#mongodb-사용자" class="headerlink" title="mongodb 사용자"></a><em>mongodb</em> 사용자</h4><p>mongod-org 설치후 시스템 사용자 <strong>mongodb</strong> 가 추가되야 한다. 만약 생성되지 않았으면, 새로 만든다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser --disabled-password --gecos &quot;&quot; --no-create-home --disabled-password --disabled-login mongodb</span><br></pre></td></tr></table></figure>

<h4 id="systemd-service-entry"><a href="#systemd-service-entry" class="headerlink" title="systemd service entry"></a>systemd service entry</h4><p>만약 <strong>mongodb-org</strong> 설치후 <code>systemctl</code> 스크립트가 <code>/etc/init.d</code>에 복사되지 않는 경우</p>
<blockquote>
<p>여기서는 odroid-c2 armbian 설치 상태, 일반 리눅스 배포본은 잘 된다.</p>
</blockquote>
<p>systemd 서비스 파일이 <em>&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongod.service</em>에 위치한다. 아래 명령을 실행해 <strong>mongodb.service</strong> 가 없으면 새로 생성해야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --type=service |grep mongodb</span><br></pre></td></tr></table></figure>

<p>만약 <strong>mongodb.service</strong> 가 없다면, <code>/lib/systemd/system/mongod.service</code> 파일을 다음 같이 활성화 시켜준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /lib/systemd/system</span><br><span class="line">$ sudo systemctl enable mongodb.service</span><br></pre></td></tr></table></figure>

<p><strong>mongodb.service</strong> 가 등록됐는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --type=service |grep mongodb</span><br><span class="line">mongodb.service             disabled</span><br></pre></td></tr></table></figure>

<p><em>disable</em> 상태면 <code>systemctl</code> 명령으로 <em>enable</em> 시킨다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl enable mongodb.service</span><br></pre></td></tr></table></figure>

<br>
### Run

<p>MongoDB Community Edition이 설치되면 요구되는 파일 및 폴더가 다음 위치에 생성됟다.</p>
<ul>
<li><strong>&#x2F;var&#x2F;lib&#x2F;mongodb</strong> : 기본 데이터 파일 위치</li>
<li><strong>&#x2F;var&#x2F;log&#x2F;mongodb</strong> : 기본 로그 저장 폴더</li>
<li><strong>&#x2F;etc&#x2F;mongod.conf</strong> : mongod 구성 파일. 로그, 데이터 위치 등을 변경 가능</li>
</ul>
<p><code>mongod</code> 데몬은 mongodb user account 계정으로 실행된다. <code>systemctl</code> 명령으로 <code>mongod</code> 를 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mongod</span><br><span class="line">$ sudo systemctl status mongod</span><br></pre></td></tr></table></figure>

<p>실행한 <code>mongod</code>를 확인해 보면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef |grep mongod</span><br><span class="line">mongodb  15385     1  1 12:06 ?        00:00:00 /usr/bin/mongod --config /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p><code>mongod</code> 서비스가 제대로 실행됐으면 <strong>mongo</strong> 클라이언트로 테스트해 볼 수 있으면 접속해 볼 수 있다.</p>
<br/>
<br/>

<h3 id="Mongo-Database-설정"><a href="#Mongo-Database-설정" class="headerlink" title="Mongo Database 설정"></a>Mongo Database 설정</h3><ul>
<li>mongodb 사용자와 디렉토리 퍼미션 확인</li>
<li>mongod.conf 설정</li>
<li>mongo client 접속 테스트</li>
<li>mongodb 인증</li>
</ul>
<h4 id="퍼미션-확인"><a href="#퍼미션-확인" class="headerlink" title="퍼미션 확인"></a>퍼미션 확인</h4><p><strong>로그 디렉토리</strong> <em>&#x2F;var&#x2F;log&#x2F;mongo</em> 그리고 <strong>데이터 디렉토리</strong> <em>&#x2F;data&#x2F;mongodata</em> 라면 해당 디렉토리에 몽고디비 사용자가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> mongo.daemon /var/log/mongodb</span><br><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h4 id="mongod-conf-설정"><a href="#mongod-conf-설정" class="headerlink" title="mongod.conf 설정"></a>mongod.conf 설정</h4><p>MongoDB의 <code>systemd</code> 서비스는 데이터베이스 구성 파일 <code>/etc/mongod.conf</code> 을 참조한다.</p>
<p>먼저 <code>/etc/mongod.conf</code> 파일에 <strong>인증</strong>을 제외한 <strong>데이터 디렉토리</strong>, <strong>bindIp</strong>, <strong>로그</strong> 부분만 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 127.0.0.1,192.168.0.2</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbPath</strong> : 데이터베이스 스토리지 위치</li>
<li><strong>bindIp</strong>: 서버 외에서 mongo 클라이언트가 접근하려면 IP 를 입력한다.</li>
</ul>
<p>현재는 <code>mongo.conf</code> 설정 파일에 접근 제어가 없는 상태에서 <strong>mongo</strong> 클라이언트로 접속한다</p>
<h4 id="Admin-사용자"><a href="#Admin-사용자" class="headerlink" title="Admin 사용자"></a>Admin 사용자</h4><p><code>mongod</code>에 인증이 비활성화 상태에서 mongo&#96; 클라이언트로 접속에 성공하면 <strong>&gt;</strong> 프롬프트가 나온다. <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$mongo</span><br><span class="line">&gt;</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><em>admin</em> 데이터베이스에서 관리자 role을 가진 사용자를 추가하고, 사용할 데이터베이스의 사용자와 접근 제어를 추가해서 사용하기 위해서 작업한다.</p>
<h4 id="user-administrator"><a href="#user-administrator" class="headerlink" title="user administrator"></a>user administrator</h4><p><code>userAdmin role</code> 혹은 <code>userAdminAnyDatabase role</code>을 가진 사용자 만든다. 다음은 <em>admin</em> 데이터베이스에서 사용자를 관리하는 <strong>admin 계정</strong>을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user:&#x27;admin&#x27;,</span><br><span class="line">    pwd:&#x27;****&#x27;,</span><br><span class="line">    roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers()</span><br></pre></td></tr></table></figure>

<p>admin <code>사용자 패스워드 변경</code>은</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.changeUserPassword(&quot;accountUser&quot;, &quot;SOh3TbYhx8ypJPxmt1oOfL&quot;)</span><br></pre></td></tr></table></figure>

<p>사용자의 <code>role</code> 을 변경,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.grantRolesToUser( &#x27;admin&#x27;, [&#123;role: &#x27;userAdmin&#x27;, db:&#x27;admin&#x27;&#125;])</span><br><span class="line">&gt; db.getUsers()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdmin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>혹은 updateUser 를 사용할 수 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( &quot;appClient01&quot;, ...</span><br></pre></td></tr></table></figure>

<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<blockquote>
<p>인증모드는 v2.4이전에는 <code>--auth</code> 옵션을 사용하고, v2.6 이후에서 <em>mongod.conf</em> 파일 사용할 때 <code>security.authorization</code> 를 활성화 한다.</p>
</blockquote>
<p>systemd 로 서비스를 재시작 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>이제 인증 모드에서 데이터베이스에 접속해야 한다. 만약 인증모드로 시작한 후에 다음 같이 인증 정보없이 로그인 하면 데이터베이스 사용시 에러를 만난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">&gt; show dbs;</span><br><span class="line">Tue Sep 27 23:22:40.683 listDatabases failed:&#123; &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;unauthorized&quot; &#125; at src/mongo/shell/mongo.js:46</span><br><span class="line">&gt;</span><br><span class="line">&gt; show users</span><br><span class="line">Tue Sep 27 23:22:44.667 error: &#123; &quot;$err&quot; : &quot;not authorized for query on test.system.users&quot;, &quot;code&quot; : 16550 &#125; at src/mongo/shell/query.js:128</span><br></pre></td></tr></table></figure>

<h4 id="인증모드로-접속"><a href="#인증모드로-접속" class="headerlink" title="인증모드로 접속"></a>인증모드로 접속</h4><p>데이터베이스 시스템에 접근제어가 활성화 되면 <code>mongo</code> 클라이언트 접속시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>만약 데이터베이스 인증모드로 실행되는데 비인증 클라이언트 접근은 아래 같이 에러를 낸다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MongoDB shell version v3.6.5</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.6.5</span><br><span class="line">&gt; use students</span><br><span class="line">switched to db students</span><br><span class="line">&gt; show users</span><br><span class="line">2018-06-25T18:30:38.174+0900 E QUERY    [thread1] Error: not authorized on students to execute command &#123; usersInfo: 1.0, $db: &quot;students&quot; &#125; :</span><br></pre></td></tr></table></figure>

<h4 id="원격지에서-접근"><a href="#원격지에서-접근" class="headerlink" title="원격지에서 접근"></a>원격지에서 접근</h4><p>외부에서 mongodb로 접근시 authentication을 적용한 상태라면 다음과 같은 URL로 접근할 수 있다:</p>
<blockquote>
<p>“username:password@HOST_NAME&#x2F;mydb”</p>
</blockquote>
<blockquote>
<p>그러나 외부접근시 클라이언트 버전과 서버의 Credential 버전이 맞지 않은 경우 다음 같이 실패 메시지를 확인할 수 있다.</p>
<p>2016-05-16T00:53:10.338+0900 I ACCESS [conn2] Failed to authenticate student@student with mechanism MONGODB-CR: AuthenticationFailed: MONGODB-CR credentials missing in the user document<br>2016-05-16T00:53:10.352+0900 I NETWORK [conn2] end connection 220.121.140.59:51634 (0 connections now open)</p>
</blockquote>
<br/>
### 데이터베이스 생성과 인증

<p>새 데이터베이스에 컬렉션을 생성하고 데이터베이스 사용자를 접근제어할 수 있는 내용은 <a href="!--swig%EF%BF%BC31--">MongoDB User Authentication</a> 에서 다루고 있다.</p>
<br/>
<br/>
## MongoDB에 관련 글


<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<br/>
### `mongod` 명령 사용

<p><code>systemd</code>가 아닌, <code>mongod</code> 명령으로 로 MongoDB를 시작해 설정 파일 등이 제대로 동작하는지 확인할 수 있다.</p>
<p>다만 데이터베이스가 생성하는 데이터와 로그 파일의 접근권한이 실행한 사용자 계정으로 처리되어 퍼미션 문제가 발생할 수 있다.</p>
<h4 id="mongoDB-v2-4-인증모드로-시작"><a href="#mongoDB-v2-4-인증모드로-시작" class="headerlink" title="mongoDB v2.4 인증모드로 시작"></a>mongoDB v2.4 인증모드로 시작</h4><p><code>mongod</code> 명령라인으로 시작할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>mongoDB v2.4는 다음 같이 인증 모드로 시작한다. <code>mongod</code> 명령라인에서 <code>--auth</code> 옵션을 붙여 DB 인스턴스(<code>mongod</code>)를 시작 혹은 재시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/db1</span><br></pre></td></tr></table></figure>

<p>혹은 <em>mongod.conf</em> 설정 파일에서 <strong>auth</strong> 를 활성화 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth = true</span><br></pre></td></tr></table></figure>

<h4 id="mongoDB-v2-6-이후"><a href="#mongoDB-v2-6-이후" class="headerlink" title="mongoDB v2.6 이후"></a>mongoDB v2.6 이후</h4><p>앞서 시작한 명령행 <strong>mongodb</strong>를 종료하고 명령라인에서 재시작 <code>--auth</code> 옵션을 붙여 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>접근제어 <code>--auth</code> 옵션으로 데이터베이스를 시작하면 로그인시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-11-01T01:00:00.000Z" title="2017-11-1 10:00:00">2017-11-01</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T17:18:04.869Z" title="2022-2-25 2:18:04">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">6분안에 읽기 (약 845 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/11/01/linux-2017-11-01-ubuntu-maintain-power/">Ubuntu/시스템 전원관리</a></h1><div class="content"><h2 id="Ubuntu-시스템-전원관리"><a href="#Ubuntu-시스템-전원관리" class="headerlink" title="Ubuntu - 시스템 전원관리"></a>Ubuntu - 시스템 전원관리</h2><p>우분투 시스템을 명령으로 잠자기, 깨우기가 가능하다. 컴퓨터의 BIOS에서 Wake On Lan이 활성화 되어야한다.</p>
<h3 id="WakeOnLan"><a href="#WakeOnLan" class="headerlink" title="WakeOnLan"></a>WakeOnLan</h3><p>wakeonlan을 활성화 하려면 이더넷 인터페이스를 화인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig</span><br><span class="line">enp5s0    Link encap:Ethernet  HWaddr 0f:1a:92:51:70:a9</span><br><span class="line">          inet addr:192.168.0.10  Bcast:192.168.0.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe20::6595:e3fd:ad6:10f1/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:85121 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:11677 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:25916710 (25.9 MB)  TX bytes:1481803 (1.4 MB)</span><br></pre></td></tr></table></figure>

<p>계속 ethtool 로 WakeOnLan이 활성화 되었는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ethtool enp5s0</span><br><span class="line">[sudo] password for USERNAME:</span><br><span class="line">Settings for enp5s0:</span><br><span class="line">  Supported ports: [ TP MII ]</span><br><span class="line">  Supported link modes:   10baseT/Half 10baseT/Full</span><br><span class="line">                          100baseT/Half 100baseT/Full</span><br><span class="line">  Supported pause frame use: No</span><br><span class="line">  Supports auto-negotiation: Yes</span><br><span class="line">  Advertised link modes:  10baseT/Half 10baseT/Full</span><br><span class="line">                          100baseT/Half 100baseT/Full</span><br><span class="line">  Advertised pause frame use: Symmetric Receive-only</span><br><span class="line">  Advertised auto-negotiation: Yes</span><br><span class="line">  Link partner advertised link modes:  10baseT/Half 10baseT/Full</span><br><span class="line">                                       100baseT/Half 100baseT/Full</span><br><span class="line">  Link partner advertised pause frame use: Symmetric Receive-only</span><br><span class="line">  Link partner advertised auto-negotiation: Yes</span><br><span class="line">  Speed: 100Mb/s</span><br><span class="line">  Duplex: Full</span><br><span class="line">  Port: MII</span><br><span class="line">  PHYAD: 0</span><br><span class="line">  Transceiver: internal</span><br><span class="line">  Auto-negotiation: on</span><br><span class="line">  Supports Wake-on: pumbg</span><br><span class="line">  Wake-on: g</span><br><span class="line">  Current message level: 0x00000033 (51)</span><br><span class="line">             drv probe ifdown ifup</span><br><span class="line">  Link detected: yes</span><br></pre></td></tr></table></figure>

<p>내용중에 <em>Supports Wake-on: <letters></em> 항목이 WakeOnLan 지원을 확인할 수 있다. <letters> 문자에 <strong>g</strong> 가 있으면 <em>Magic Packet™</em>을 지원한다. 그러나 <em>d</em> 가 포함되지 않았으면 아래 명령으로 WoL을 활성화 해야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ethtool -s enp5s0 wol g</span><br></pre></td></tr></table></figure>

<p>이 명령은 대부분의 시스템에서 재시동이 필요하다.</p>
<p>시스템이 <em>ifupdown</em> 으로 구성되어 있으면 &#x2F;etc&#x2F;network&#x2F;interfaces 에 아래 같이</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"># The primary network interface</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">        address 10.0.0.1</span><br><span class="line">        netmask 255.255.255.0</span><br><span class="line">        gateway 10.0.0.138</span><br><span class="line">        up ethtool -s eth0 wol g</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/764158/how-to-enable-wake-on-lan-wol-in-ubuntu-16-04">https://askubuntu.com/questions/764158/how-to-enable-wake-on-lan-wol-in-ubuntu-16-04</a></p>
<h3 id="Power-management"><a href="#Power-management" class="headerlink" title="Power management"></a>Power management</h3><p>우분투 14 버전과 이후 버전의 시스템 전력 관리가 다르다.</p>
<h4 id="Ubuntu-14-04-이전"><a href="#Ubuntu-14-04-이전" class="headerlink" title="Ubuntu 14.04 이전"></a>Ubuntu 14.04 이전</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install powermanagement-interface</span><br></pre></td></tr></table></figure>

<p>pmi 명령 혹은 pm-*** 명령을 사용해서 컴퓨터를 재울 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pmi action suspend</span><br><span class="line">pmi action hibernate</span><br></pre></td></tr></table></figure>

<p>노트북에서 다음 명령도 실행된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pm-suspend</span><br><span class="line">sudo pm-hibernate</span><br></pre></td></tr></table></figure>

<h4 id="Ubuntu-15-x2F-16-이상"><a href="#Ubuntu-15-x2F-16-이상" class="headerlink" title="Ubuntu 15 &#x2F; 16 이상"></a>Ubuntu 15 &#x2F; 16 이상</h4><p>대상 컴퓨터를 잠자기 모드 ( suspend)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl suspend</span><br></pre></td></tr></table></figure>

<p>최대절전모드인 Hibernation은 pm-hibernate 명령을 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pm-hibernate</span><br></pre></td></tr></table></figure>

<h4 id="Wake-up-명령"><a href="#Wake-up-명령" class="headerlink" title="Wake-up 명령"></a>Wake-up 명령</h4><p>네트워크에 연결된 장치를 깨우기 위해서 <code>wakeonlan</code> 명령을 사용할 수 있다.</p>
<blockquote>
<p>wakeonlan MAC_ADDRESS</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wakeonlan 00:1d:92:51:70:d8</span><br><span class="line">Sending magic packet to 255.255.255.255:9 with 00:1d:92:51:70:d8</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mac에서는 <strong>homebrew</strong> 로 <code>wakeonlan</code> 명령을 설치해서 사용할 수 있다.</p>
</blockquote>
<h3 id="모니터-다루기"><a href="#모니터-다루기" class="headerlink" title="모니터 다루기"></a>모니터 다루기</h3><p>노트북 화면을 끄거나, 외부 모니터 표시를 잠시 멈출 수 있다.</p>
<h4 id="console-에서"><a href="#console-에서" class="headerlink" title="console 에서"></a>console 에서</h4><p>To turn off monitor in console, the command is the following:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vbetool dpms off    <span class="comment"># turn off</span></span><br><span class="line">sudo vbetool dpms on     <span class="comment"># turn on</span></span><br></pre></td></tr></table></figure>

<p>To regain control of the console on pressing enter key, I suggest</p>
<p>sudo sh -c ‘vbetool dpms off; read ans; vbetool dpms on’</p>
<h4 id="X-windows-상태에서"><a href="#X-windows-상태에서" class="headerlink" title="X windows 상태에서"></a>X windows 상태에서</h4><p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/253818/manually-turn-off-monitor">https://askubuntu.com/questions/253818/manually-turn-off-monitor</a></p>
<p>데스크탑 윈두우 터미널에서 <code>xrandr</code> 을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ xrandr</span><br><span class="line">Screen 0: minimum 8 x 8, current 1280 x 800, maximum 32767 x 32767</span><br><span class="line">LVDS1 connected primary 1280x800+0+0 (normal left inverted right x axis y axis) 331mm x 207mm</span><br><span class="line">   1280x800       59.9*+</span><br><span class="line">   1024x768       60.0</span><br><span class="line">   800x600        60.3     56.2</span><br><span class="line">   640x480        59.9</span><br><span class="line">   640x400        60.0</span><br><span class="line">VGA1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">VIRTUAL1 disconnected (normal left inverted right x axis y axis)</span><br></pre></td></tr></table></figure>

<p>in terminal(your laptop screen is something like LVDS1, and your external monitor is some thing like VGA).</p>
<h5 id="turn-off-laptop-screen"><a href="#turn-off-laptop-screen" class="headerlink" title="turn off laptop screen"></a>turn off laptop screen</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output LVDS1 --off  <span class="comment"># turn off</span></span><br><span class="line">xrandr --output LVDS1 --on   <span class="comment"># turn on</span></span><br></pre></td></tr></table></figure>

<p>If you need to turn on the laptop screen::</p>
<p>노트북 화면 크기를 조정한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output LVDS --mode 1280x800</span><br></pre></td></tr></table></figure>

<p>외부 모니터를 끄려면</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output VGA --off</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/WakeOnLan">WakeOnLan</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-11-01T00:00:00.000Z" title="2017-11-1 9:00:00">2017-11-01</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:33:55.868Z" title="2022-2-25 1:33:55">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">8분안에 읽기 (약 1176 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/11/01/linux-2017-04-04-ubuntu-nginx-ssl/">Nginx - HTTPS and Certificate SSL</a></h1><div class="content"><p>Nginx를 HTTPS를 사용할 수 있도록 사설 인증서와 그리고 공인 인증서를 이용해 SSL을 활성화 하는 과정을 정리했다.</p>
<p>Nginx 설치와 서버, 프락시 등의 사용 방법에 대해서는 <a href="!--swig%EF%BF%BC7--">Nginx on Ubuntu&#x2F;Debian</a> 문서를 참조한다.</p>
<h2 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h2><p>TLS는 SSL의 새로운 이름이다. SSL(Secure Socket Layer)는 대칭키 혹은 공개키 방식의 인증을 이룬후 암호화된 통신이 가능하다. TLS에 대해서는 다음 블로그에 자세히 설명되어 있다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://opentutorials.org/course/228/4894">HTTPS, SSL 설명</a></li>
</ul>
<h3 id="Nginx-HTTPS"><a href="#Nginx-HTTPS" class="headerlink" title="Nginx HTTPS"></a>Nginx HTTPS</h3><p>Nginx 에서 HTTPS를 상용하려면 인증기관을 통해 발급받은 SSL인증서가 필요하다. 여기서는 사용자 개인용 사설 인증서를 만들어 사용한다.</p>
<p>공인 서버 인증서에 대해서는 별도로 다룬다. [^2] 를 참조하면 사설 인증서와 공인 인증서에 대한 설명이 있다.</p>
<h4 id="사설-인증서-설정"><a href="#사설-인증서-설정" class="headerlink" title="사설 인증서 설정"></a>사설 인증서 설정</h4><p>SSL Certificate 파일을 생성하고 저장해 둔다. [^4]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">mkdir</span> /etc/nginx/ssl</span><br><span class="line">$ <span class="built_in">cd</span> /etc/nginx/ssl</span><br></pre></td></tr></table></figure>

<p>OpenSSL을 사용해서 SSL Certificate를 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo openssl genrsa -out privkey.pem 2048</span><br><span class="line">$ sudo openssl req -new -x509 -key privkey.pem -out cacert.pem -days 1095</span><br></pre></td></tr></table></figure>

<p>Generate DH params - 시간이 소요된다 (armv7 1Ghz 에서 30분 이상)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo openssl dhparam 2048 &gt; /etc/nginx/ssl/dhparam.pem</span><br></pre></td></tr></table></figure>

<!--

> $ sudo openssl genrsa -des3 -passout pass:x -out server.pass.key 2048
> $ sudo openssl rsa -passin pass:x -in server.pass.key -out server.key
> $ sudo rm server.pass.key
> $ sudo openssl req -new -key server.key -out server.csr
> $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt

-->

<h4 id="Nginx-설정에-SSL-활성화"><a href="#Nginx-설정에-SSL-활성화" class="headerlink" title="Nginx 설정에 SSL 활성화"></a>Nginx 설정에 SSL 활성화</h4><p>&#x2F;etc&#x2F;nginx&#x2F;site-available&#x2F;yoursite.com</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 80번 요청을 모두 443 SSL 서버로 바꾼다.</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    add_header Strict-Transport-Security max-age=2592000;</span><br><span class="line">    rewrite ^/.*$ https://$host$request_uri? permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># SSL을 이용한 444번 포트 사용 사이트 정의</span><br><span class="line">server &#123;</span><br><span class="line">    listen      443 default;</span><br><span class="line">    server_name my-site.localhost;</span><br><span class="line"></span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /etc/nginx/ssl/cacert.pem;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/privkey.pem;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_session_cache shared:SSL:5m;</span><br><span class="line">    # Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits</span><br><span class="line">    ssl_dhparam /etc/nginx/ssl/dhparam.pem;</span><br><span class="line"></span><br><span class="line">    # secure settings (A+ at SSL Labs ssltest at time of writing)</span><br><span class="line">    # see https://wiki.mozilla.org/Security/Server_Side_TLS#Nginx</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_ciphers &#x27;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-</span><br><span class="line">RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-</span><br><span class="line">SHA256:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:DHE-RSA-AES256-GCM-S</span><br><span class="line">HA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-CAMELLIA256-SHA:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA</span><br><span class="line">256:DHE-RSA-AES128-SHA:DHE-RSA-SEED-SHA:DHE-RSA-CAMELLIA128-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!</span><br><span class="line">DSS&#x27;;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">    add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;;</span><br><span class="line"></span><br><span class="line">    proxy_buffers 16 64k;</span><br><span class="line">    proxy_buffer_size 128k;</span><br><span class="line"></span><br><span class="line">    server_tokens off;</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">        client_max_body_size 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>설정 파일이 제대로 구성됐는지 테스트해본다.[^1]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure>

<h2 id="Certified-SSL"><a href="#Certified-SSL" class="headerlink" title="Certified SSL"></a>Certified SSL</h2><blockquote>
<p>작업: macbook pro의 thinkbee@ ~&#x2F;Documents&#x2F;SslCert$</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://jetmirshatri.com/build-nginx-with-openssl-1-1-0-on-ubuntu-16-04/">https://jetmirshatri.com/build-nginx-with-openssl-1-1-0-on-ubuntu-16-04/</a></p>
<h3 id="Lets’-Encrypt"><a href="#Lets’-Encrypt" class="headerlink" title="Lets’ Encrypt"></a>Lets’ Encrypt</h3><p>Lets’ Encrypt는 HTTPS를 사용하기 위해 SSL을 구매해야 하는 부분이 HTTPS 보급에 방해된다고 생각해서 SSL을 무료로 제공해서 HTTPS를 보급하기 위해 작년 말에 만들어졌다. 초기에는 Mozilla, Cisco, Akamai, EFF, id entrust 등이 모여서 ISRG(Internet Security Research Group)라는 새로운 SSL 인증기관을 만들어서 올해 SSL을 무료로 제공하겠다고 발표했다. 지금은 이 Lets’ Encrypt에 Facebook, 워드프레스를 만드는 Automattic, shopify 등 많은 회사가 스폰서로 참여하고 있다</p>
<p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/">https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/</a></p>
<h4 id="Lets’-Ecrypt-발급"><a href="#Lets’-Ecrypt-발급" class="headerlink" title="Lets’ Ecrypt 발급"></a>Lets’ Ecrypt 발급</h4><p>Lets’ Ecrypt는 Shell 기반의 발급 방법을 권장한다.</p>
<p>웹을 통한 발급은 인증된 도메인 등록지에서 가능하다고 한다. 쉘 기반 발급을 위해서 ACME protocol client를 사용한다. 정식 클라이언트는 Certbot 을 사용한다.</p>
<p>Certbot을 설치할 수 없는 상황에서는 호환 클라이언트를 사용할 수 있다.</p>
<h4 id="getssl"><a href="#getssl" class="headerlink" title="getssl"></a>getssl</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./getssl -c yourdomain.com</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/.getssl</span><br><span class="line">~/.getssl/getssl.cfg</span><br><span class="line">~/.getssl/yourdomain.com</span><br><span class="line">~/.getssl/yourdomain.com/getssl.cfg</span><br></pre></td></tr></table></figure>

<p>~&#x2F;.getssl&#x2F;getssl.cfg 를 필요시 수정한다.</p>
<p>~&#x2F;.getssl&#x2F;yourdomain.com&#x2F;getssl.cfg 을 수정한다.</p>
<h4 id="Recommended-Certbot"><a href="#Recommended-Certbot" class="headerlink" title="Recommended: Certbot"></a>Recommended: Certbot</h4><p><a target="_blank" rel="noopener" href="https://letsencrypt.org/docs/client-options/">https://letsencrypt.org/docs/client-options/</a></p>
<p>여기서 getssl bash 스크립트를 사용해 본다.</p>
<p>openssl req -new -sha256 -key domain.key -subj “&#x2F;“ <br> -reqexts SAN -config &lt;(cat &#x2F;etc&#x2F;ssl&#x2F;openssl.cnf <br> &lt;(printf “[SAN]\nsubjectAltName&#x3D;DNS:thinkbee.kr,DNS:<a href="http://www.thinkbee.kr,DNS:blog.thinkbee.kr&quot;">www.thinkbee.kr,DNS:blog.thinkbee.kr&quot;</a>))</p>
<h4 id="Certbot-auto"><a href="#Certbot-auto" class="headerlink" title="Certbot-auto"></a>Certbot-auto</h4><p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-14-04</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/">https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/</a></p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://btsweet.blogspot.kr/2014/06/tls-ssl.html">TLS&#x2F;SSL에 대해 알아보아요</a></li>
</ul>
<p>[^2]: <a target="_blank" rel="noopener" href="http://it79.egloos.com/1121724">SSL 인증서 종류</a><br>[^3]: <a target="_blank" rel="noopener" href="https://manual.seafile.com/deploy/https_with_nginx.html">Enabling Https with Nginx</a><br>[^4]: <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04">Create Self signed SSL</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-10-30T00:00:00.000Z" title="2017-10-30 9:00:00">2017-10-30</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:16:46.094Z" title="2022-2-25 1:16:46">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Programming/">Programming</a></span><span class="level-item">14분안에 읽기 (약 2093 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/10/30/python/2017-10-30-jupyter-scitific-pip/">Python - 과학계산을 위한 Jupyter(pip)</a></h1><div class="content"><p>과학계산을 위한 Python3 및 pip를 사용한 scipy, jupyter 설치 및 구성을  요약하고 있다.</p>
<p><a target="_blank" rel="noopener" href="https://packaging.python.org/guides/installing-scientific-packages/">https://packaging.python.org/guides/installing-scientific-packages/</a></p>
<h2 id="과학계산을-위한-Python-Jupyter"><a href="#과학계산을-위한-Python-Jupyter" class="headerlink" title="과학계산을 위한 Python Jupyter"></a>과학계산을 위한 Python Jupyter</h2><p>과학계산을 위한 Python 과 Jupyter Notebook 환경을 정리한다. </p>
<ul>
<li>개발 프론트 엔드: Jupyter</li>
<li>과학계산 모듈: numpy, scipy 등</li>
</ul>
<p>Python과 Virtualenv 환경을 더 알고 싶으면 다음 두 링크에 자세한 설명이 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC27--">Python - Install virtualenv on Linux</a></li>
</ul>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>시스템에 Python2, Python3 가 설치되었는지 확인:</p>
<ul>
<li>Ubuntu&#x2F;Debian 계열: Python 2.7, Python 3.5 설치되어 있다.</li>
<li>openSUSE : Python2.7</li>
</ul>
<h4 id="Python-3-설치"><a href="#Python-3-설치" class="headerlink" title="Python 3 설치"></a>Python 3 설치</h4><h4 id="시스템-개발-패키지-설치"><a href="#시스템-개발-패키지-설치" class="headerlink" title="시스템 개발 패키지 설치"></a>시스템 개발 패키지 설치</h4><p>컴파일에 필요한 헤더 등이 포함된 개발자 라이브러리를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install python-dev python-distlib python3-dev python3-distlib</span><br></pre></td></tr></table></figure>

<p>python-dev, python-distlib, apython-setuptools 은 파이썬 개발과 패키징을 지원한다.</p>
<p>apt-get install libfreetype6-dev<br>apt-get install pkg-config<br>apt-get install libpng-dev<br>apt-get install pkg-config</p>
<p>libzmq3-dev은 쥬피터 노트북에서 필요로 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libzmq3-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>python-curses: Python이 (N)Curses Libr에 대한 인터페이스이다</li>
</ul>
<p>Pandas 로 데이터 셋트를 다룰 예정, libgdal-dev 은 geopandas에서 geospatial analysis 에 필요하다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libgdal-dev</span><br></pre></td></tr></table></figure>

<p>For Debian Jessie and Stretch installing the following packages resolves the issue:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libblas3 liblapack3 liblapack-dev libblas-dev</span><br></pre></td></tr></table></figure>

<p>Your next issue is very likely going to be a missing Fortran compiler, resolve this by installing it like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gfortran</span><br></pre></td></tr></table></figure>


<h4 id="pip-설치"><a href="#pip-설치" class="headerlink" title="pip 설치"></a>pip 설치</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python3-pip</span><br></pre></td></tr></table></figure>

<p>python3 설치후 마지막으로 <code>update-alternatives</code> 를 이용해 <code>pip</code> 를 pip3 로 연결해 준다. </p>
<p>다른 배포본에서 필요시 update-alternatives 사용:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 30</span><br></pre></td></tr></table></figure>

<p>시스템 <code>pip</code> 모듈을 최신 버전으로 업그레이드한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install -U pip</span><br><span class="line">sudo pip install -U setuptools</span><br></pre></td></tr></table></figure>



<h3 id="pip로-설치하기"><a href="#pip로-설치하기" class="headerlink" title="pip로 설치하기"></a><code>pip</code>로 설치하기</h3><p>Python2.6부터 User scheme 개념이 도입되며서 <code>pip</code>로 설치하는 패키지를 개별 사용자 환경 위치에 설치할 수 있다. </p>
<p>install 명령에 <code>--user</code> 옵션을 주고 설치한다.[^2] </p>
<ul>
<li>기본으로 리눅스는 <em>~&#x2F;.local</em> 폴더이고, </li>
<li>Mac OS X 는 <em>~&#x2F;Library&#x2F;Python&#x2F;X.Y</em> 에 위치한다.[^3]</li>
<li>그리고 <code>PATH</code> 에 <em>~&#x2F;.local&#x2F;bin</em> 을 추가한다.</li>
</ul>
<h4 id="Scientific-stack"><a href="#Scientific-stack" class="headerlink" title="Scientific stack"></a>Scientific stack</h4><p>아래 같이 사용자 영역에 python3 기반으로 설치해보자, pip 를 파이썬 버전의 site-package 에 모듈을 설치하기 위해서 파이썬 <code>-m</code> 을 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user numpy sympy nose</span><br></pre></td></tr></table></figure>

<p>scipy는 설치 시스템에 따라 시간이 많이 걸린다. 또한 swap 영역을 사용하므로 스왑파일시스템을 활성화 하는 것을 권한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user scipy</span><br></pre></td></tr></table></figure>

<h5 id="error"><a href="#error" class="headerlink" title="error"></a>error</h5><p>스왑 파일시스템을 사용하지 않거나 모자라면 아래 같이 가상메모리 에러 혹은 컴파일 에러가 나는 것 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> #warning &quot;Using deprecated NumPy API, disable it by &quot; \</span><br><span class="line">  ^~~~~~~</span><br><span class="line">virtual memory exhausted: Cannot allocate memory</span><br></pre></td></tr></table></figure>


<blockquote>
<p>글쓴이는 OdroidC2, Armbian Stretch 에서 시도했다.</p>
</blockquote>
<h4 id="pandas-및"><a href="#pandas-및" class="headerlink" title="pandas 및"></a>pandas 및</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user pandas</span><br></pre></td></tr></table></figure>

<p>파이썬이 있고 pip를 사용하여 패키지를 설치하려면 다음 명령을 사용합니다.</p>
<p>matplotlib  pillow graphviz</p>
<p>scikit-learn </p>
<h4 id="conda를-사용한-패키지-설치"><a href="#conda를-사용한-패키지-설치" class="headerlink" title="conda를 사용한 패키지 설치"></a>conda를 사용한 패키지 설치</h4><p>설치된 파이썬이 있다면 conda 패키지 매니저를 사용하여 다음 명령을 실행하면 필요한 패키지를 모두 얻을 수 있습니다.</p>
<p>conda install numpy scipy scikit-learn matplotlib pandas pillow graphviz python-graphviz<br>pip를 사용한 패키지 설치</p>
<h4 id="설치-확인"><a href="#설치-확인" class="headerlink" title="설치 확인"></a>설치 확인</h4><p>설치되고 사용이 가능한지 확인한다. 다음 두 모듈이 없으면 jupyter 설치가 제대로 안된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import numpy;print(numpy.__version__)&quot;</span><br><span class="line">1.9.3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import scipy;print(scipy.__version__)&quot;</span><br><span class="line">0.16.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import numpy;print(matplotlib.__version__)&quot;</span><br></pre></td></tr></table></figure>

<br>
### Jupyter Notebook

<p>Jupyter는 웹 브라우저를 통해서 IDE 환경을 제공하고, 다양한 언어&#x2F;문법을 지원하는 Kernel 이라는 해석기를 통해 IDE에서 코딩한 결과를 확인할 수 있다. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install --user jupyter </span><br></pre></td></tr></table></figure>

<blockquote>
<p>물론 가상환경이 아닌 시스템 패키지로 설치해도 된다.<br>$ sudo pip install jupyter geopandas osmnx</p>
</blockquote>
<p><code>jupyter-notebook</code>을 실행해 보고, 서버 관련 구성 내용을 설정해서 사용해 보자.</p>
<h5 id="Upgrade-jupyter"><a href="#Upgrade-jupyter" class="headerlink" title="Upgrade jupyter"></a>Upgrade jupyter</h5><p>여기서는 pip 가상머신을 이용하고 있어서 다음 같이 pip install 명령으로 업그레이드 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install -U jupyter</span><br></pre></td></tr></table></figure>


<p>python3 -m pip freeze —local &gt; requirements.txt</p>
<h4 id="서버로-실행"><a href="#서버로-실행" class="headerlink" title="서버로 실행"></a>서버로 실행</h4><p><code>jupyter-notebook</code> 은 로컬 머신에서 브라우저를 실행한다. 여기서는 원격 사용을 위해 다음 같이 시작할 수 있다. <code>[DIR]</code> 에 jupyter-notebook에서 작성한 노트북 파일이 저장된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter-notebook --no-browser --ip=* --port=8000 [DIR]</span><br><span class="line">[I 02:51:04.797 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:04.800 NotebookApp]</span><br><span class="line"></span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8585/?token=a747472bc9a7c6684829267d2ed0a4cd9a722e</span><br></pre></td></tr></table></figure>

<p>시작후 <code>?token=a.....</code> 부분의 토큰을 복사해 브라우저에 입력후 쥬피터 노트북 사용을 시작한다. 브라우저로 노트북에 접속해서 복사한 토큰을 입력한 후 로그인한다.</p>
<p><img src="/images/python/jupyter5-run.png">{:width&#x3D;”650”}</p>
<br>
### Jupyter 설정 이용

<p>jupyter는 설치된 후에 jupyter 시스템 디렉토리와 사용자 <strong>JUPYTER_DATA_DIR</strong>에 필요한 내용을 저장한다.</p>
<ul>
<li><strong>시스템 디렉토리</strong>: &#x2F;usr&#x2F;local&#x2F;share&#x2F;jupyter&#x2F;</li>
<li><strong>JUPYTER_DATA_DIR</strong> 는 보통 ~&#x2F;.jupyter</li>
</ul>
<p>설정 파일을 이용해서 사용자 비밀번호를 이용해 노트북을 사용할 수 있다.</p>
<p>먼저 실행중인 쥬피터 노트북에서 <code>passwd()</code> 를 실행해 <strong>패스워드 해시 값</strong>을 얻는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">In [<span class="number">2</span>]: passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;sha1:67c9e60bb8b6:9ffede0825894254b2e043ea597d771089e11eed&#x27;</span></span><br></pre></td></tr></table></figure>

<p>패스워드 해시 값을 데이터 디렉토리의 설정 파일에 입력해야 한다.</p>
<h4 id="데이터-설정-파일"><a href="#데이터-설정-파일" class="headerlink" title="데이터 설정 파일"></a>데이터 설정 파일</h4><p>먼저 다음 같이 설정 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /home/foo/.jupyter/jupyter_notebook_config.py</span><br><span class="line">$ <span class="built_in">cd</span> .jupyter &amp;&amp; <span class="built_in">mv</span> jupyter_notebook_config.py mynotebook.py</span><br></pre></td></tr></table></figure>

<p><em>mynotebook.py</em>에 다음을 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#c.NotebookApp.notebook_dir = &#x27;/path/to/notebook_directory&#x27;</span><br><span class="line">c.NotebookApp.base_url = &#x27;http://www.yourdomain.com/notebok&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;&#x27;</span><br><span class="line">c.NotebookApp.port = 8000</span><br><span class="line">c.NotebookApp.port_retries = 50</span><br></pre></td></tr></table></figure>

<p>복사한 패스워드 해시 값을 mynotebook.py 설정 파일 안의 <code>c.NotebookApp.password</code> 항목 주석을 풀고 해시 값을 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = &#x27;sha1:4ee6bb2da3d7:ed76216b87228540e5f5f20fcfa8069cf82686f0&#x27;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 이용해 jupyter-notebook을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --config .jupyter/mybook_config.py [DIR]</span><br></pre></td></tr></table></figure>

<p>이제 jupyter에 접속하려면 다음 같이 패스워드를 묻고 입력한 후에 사용할 수 있다.</p>
<p><img src="/images/python/jupyter-login.png">{:width&#x3D;”650”}</p>
<h4 id="Background-실행"><a href="#Background-실행" class="headerlink" title="Background 실행"></a>Background 실행</h4><p>Jupyter-notebook을 백그라운드로 실행하려면 <code>nohup</code> 을 사용할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">nohup</span> jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>nohup은 재시동시 다시 시작해야 하는 불편한 점이 있다.</p>
<h4 id="crontab-으로-실행"><a href="#crontab-으로-실행" class="headerlink" title="crontab 으로 실행"></a>crontab 으로 실행</h4><p>nohup 과 결합해서 사용해도 좋은 방법으로 crontab 을 사용해 재시동 후 자동으로 시작해 줄 수 있다. 사용자 crontab 을 편집해 다음 같이 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot cd /home/foo; jnohup jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>


<p>이 방법도 사용자가 시작&#x2F;상태확인&#x2F;종료 같은 직접적인 방법을 사용하기는 좀 불편하다.</p>
<p>그래서 upstart의 init.d 를 사용하거나 systemd 의 unit으로 생성해서 사용하는 것이 좋다.</p>
<h4 id="systemd-에서-실행"><a href="#systemd-에서-실행" class="headerlink" title="systemd 에서 실행"></a>systemd 에서 실행</h4><p>systemd unit으로 새로운 unit 파일을 생성해서 기존 <code>systemctl</code> 명령으로 시작&#x2F;상태&#x2F;종료&#x2F;재시작 등의 작업을 할 수 있다. 물론 재시동 관련해서도 완벽히 동작한다.</p>
<p>systemd의 unit 위치는 OS 마다 조금 다른 것 같다. 여기서는 <em>&#x2F;etc&#x2F;systemd&#x2F;system</em> 밑에 <em>jupyter.service</em> 라는 유닉 파일로 직접 작업한다.</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;jupyter.service</li>
</ul>
<p>가상환경을 사용하고 있으므로 systemd unit의 <code>ExecStart</code> 의 python도 가상환경 위치로 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Jupyter-Notebook</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter-notebook.pid</span><br><span class="line">ExecStart=/home/foo/.virtualenvs/jupyter/bin/jupyter-notebook --config=/home/foo/.jupyter/mynotebook.py</span><br><span class="line">User=foo</span><br><span class="line">Group=foo</span><br><span class="line">WorkingDirectory=/home/foo/notebooks</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>그리고 시스템 유닛을 시작해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable jupyter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart jupyter.service</span><br></pre></td></tr></table></figure>



<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/install.html">Pandas Install</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/install.html">Scipy Install</a></li>
<li><a target="_blank" rel="noopener" href="http://geoffboeing.com/2016/03/scientific-python-raspberry-pi/">Scientific Python on Raspberry Pi</a></li>
</ul>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/categories/Linux/page/0/">이전</a></div><div class="pagination-next"><a href="/categories/Linux/page/2/">다음</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/categories/Linux/">1</a></li><li><a class="pagination-link" href="/categories/Linux/page/2/">2</a></li><li><a class="pagination-link" href="/categories/Linux/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/qkboo_400.png" alt="Gangtai"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gangtai</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Paju, South Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">53</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">95</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/thinkbee" target="_blank" rel="noopener">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/gtko"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">링크</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">26</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/NodeJS/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Photoshop/"><span class="level-start"><span class="level-item">Photoshop</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Angular/"><span class="level-start"><span class="level-item">Angular</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Angularjs/"><span class="level-start"><span class="level-item">Angularjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Raspberry-Pi/"><span class="level-start"><span class="level-item">Raspberry Pi</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-23T15:47:59.802Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/hello-world/">blog.thinkbee.kr 이전 작업중입니다.</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-02T09:00:00.000Z">2020-02-02</time></p><p class="title"><a href="/2020/02/02/linux/2020-02-02-letsencrypt%EB%B0%9C%EA%B8%89/">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T03:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-config/">MongoDB 구성 설정과 사용자 인증 사용</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T01:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-4-2-install-arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu/Debian Armbian</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-09-05T11:00:00.000Z">2019-09-05</time></p><p class="title"><a href="/2019/09/05/python/2019-09-05-OpenSuse-JupyterNotebook_scientific/">openSUSE - 과학계산을 위한 Python, Jupyter Notebook</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Programming/">Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">아카이브</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">2월 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">2월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">12월 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">9월 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">10월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">8월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">7월 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">6월 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">12월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">11월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">10월 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">9월 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">7월 2017</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">5월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">4월 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">12월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">2월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">태그</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Armbian/"><span class="tag">Armbian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Artificial-Intelligence/"><span class="tag">Artificial Intelligence</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian/"><span class="tag">Debian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian-Strech/"><span class="tag">Debian Strech</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JSON-Web-Token/"><span class="tag">JSON Web Token</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT-Toekn/"><span class="tag">JWT Toekn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-15-0/"><span class="tag">LEAP 15.0</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-42-3/"><span class="tag">LEAP 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Numpy/"><span class="tag">Numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid/"><span class="tag">Odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid-C2/"><span class="tag">Odroid C2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Orange-Pi/"><span class="tag">Orange Pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi/"><span class="tag">Raspberry Pi</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi-3/"><span class="tag">Raspberry Pi 3</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspbian/"><span class="tag">Raspbian</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SD-Card/"><span class="tag">SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scientific/"><span class="tag">Scientific</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript-Tutorials/"><span class="tag">TypeScript Tutorials</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/X11/"><span class="tag">X11</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/amd64/"><span class="tag">amd64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angular4/"><span class="tag">angular4</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/arm64/"><span class="tag">arm64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/armbian/"><span class="tag">armbian</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/banana-pi/"><span class="tag">banana pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/certificate-ssl/"><span class="tag">certificate ssl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/clipping-mask/"><span class="tag">clipping-mask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collages/"><span class="tag">collages</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cross-compiler/"><span class="tag">cross compiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian/"><span class="tag">debian</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewall/"><span class="tag">firewall</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewalld/"><span class="tag">firewalld</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/https/"><span class="tag">https</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/install/"><span class="tag">install</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jasmine/"><span class="tag">jasmine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter/"><span class="tag">jupyter</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter notebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter-notebook</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/karma/"><span class="tag">karma</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-15/"><span class="tag">leap 15</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-42-3/"><span class="tag">leap 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm/"><span class="tag">lvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm2/"><span class="tag">lvm2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/micro-SD-Card/"><span class="tag">micro SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongoose/"><span class="tag">mongoose</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs-tutorials/"><span class="tag">nodejs tutorials</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nvm/"><span class="tag">nvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid/"><span class="tag">odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid c2</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid-c2</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openSUSE/"><span class="tag">openSUSE</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse/"><span class="tag">opensuse</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse-leap-15/"><span class="tag">opensuse leap 15</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/orange-pi/"><span class="tag">orange pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/photoshop/"><span class="tag">photoshop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry pi</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/synergy/"><span class="tag">synergy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unit-testing/"><span class="tag">unit testing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenv/"><span class="tag">virtualenv</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenvwrapper/"><span class="tag">virtualenvwrapper</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webdav/"><span class="tag">webdav</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EB%B9%84%EC%95%88/"><span class="tag">데비안</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/"><span class="tag">데이안</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/"><span class="tag">라즈베리파이</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/"><span class="tag">라즈비안</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%A6%AC%EB%88%85%EC%8A%A4/"><span class="tag">리눅스</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%94%EB%82%98%EB%82%98%ED%8C%8C%EC%9D%B4/"><span class="tag">바나나파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%A9%ED%99%94%EB%B2%BD/"><span class="tag">방화벽</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%98%A4%EB%A0%8C%EC%A7%80%ED%8C%8C%EC%9D%B4/"><span class="tag">오렌지파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/"><span class="tag">우분투</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/"><span class="tag">웹토큰</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9D%B8%EA%B3%B5%EC%A7%80%EB%8A%A5/"><span class="tag">인공지능</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/"><span class="tag">전원관리</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%8D%AC/"><span class="tag">파이썬</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%96%B4%EC%9B%94/"><span class="tag">파이어월</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">업데이트 소식 받기</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1465716454138955" data-ad-slot="4883770640" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a><p class="is-size-7"><span>&copy; 2022 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>