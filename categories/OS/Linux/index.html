<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>카테고리: Linux - IT Tech blogging</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="thinkbee blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="thinkbee blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Machine learning, Deep learning, Python, Data science and Mobile Programming like Android"><meta property="og:type" content="website"><meta property="og:title" content="IT Tech blogging"><meta property="og:url" content="https://blog.thinkbee.kr/"><meta property="og:site_name" content="IT Tech blogging"><meta property="og:description" content="Machine learning, Deep learning, Python, Data science and Mobile Programming like Android"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://blog.thinkbee.kr/img/og_image.png"><meta property="article:author" content="Gangtai Goh"><meta property="article:tag" content="Machine learning, Deep learning, Python, Data science, Android, Ubuntu, Linux, macOS"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://blog.thinkbee.kr/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thinkbee.kr"},"headline":"IT Tech blogging","image":["https://blog.thinkbee.kr/img/og_image.png"],"author":{"@type":"Person","name":"Gangtai Goh"},"publisher":{"@type":"Organization","name":"IT Tech blogging","logo":{"@type":"ImageObject","url":"https://blog.thinkbee.kr/images/thinkbee_logo.png"}},"description":"Machine learning, Deep learning, Python, Data science and Mobile Programming like Android"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-5ZH90CZ414" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-5ZH90CZ414');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1465716454138955" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/thinkbee_logo.png" alt="IT Tech blogging" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Blog</a><a class="navbar-item" href="/documents">Doc</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-four-fifths-tablet is-four-fifths-desktop is-four-fifths-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">카테고리</a></li><li><a href="/categories/OS/">OS</a></li><li class="is-active"><a href="#" aria-current="page">Linux</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-07-17T18:00:00.000Z" title="7/18/2023, 3:00:00 AM">2023-07-18</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-08-04T23:39:35.454Z" title="8/5/2023, 8:39:35 AM">2023-08-05</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">4분안에 읽기 (약 635 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/ubuntu-20.04-cheat_sheet-230a7dc631bf/">Ubuntu 20.04 - Cheat sheet</a></p><div class="content"><p>Ubuntu 20.04 를 설치&#x2F;운영하면서 필요한 팁&#x2F;트릭과 쓸모있는 사용법을 정리한다.</p>
<p>비슷한 문서:</p>
<ul>
<li><a href="/docker_cli_summary-84ee2a15f3e2/">Docker CLI Cheat sheet</a></li>
<li><a href="/linux-system-cheat-2be979083953/">Linux system cheat</a></li>
<li><a href="/2017-05-05-tmux-cheatsheet-38c090793298/">Tmux cheat sheet, 2017</a></li>
</ul>
<h1 id="Timezone-관련"><a href="#Timezone-관련" class="headerlink" title="Timezone 관련"></a>Timezone 관련</h1><p>CLI에서 설정을 할 수 있다.</p>
<p><code>timedatectl</code> timedatectl 명령으로</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ timedatectl list-timezones</span><br><span class="line">...</span><br><span class="line">Asia/Seoul</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ sudo timedatectl set-timezone Asia/Seoul</span><br></pre></td></tr></table></figure>

<p>만약 손으로 수정을 한다면, </p>
<p><code>timedatectl</code> 로 지정되는 설정 <strong>Timezone</strong>은 <code>/etc/localtime</code> 이라는 바이너리로 저장되므로<br>명령행에서 지원하는 timezone을 복사할 수 도 있다고 한다..</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp /usr/share/zoneinfo/Europe/London /etc/localtime</span><br></pre></td></tr></table></figure>

<h1 id="LCD-x2F-Screen-off"><a href="#LCD-x2F-Screen-off" class="headerlink" title="LCD&#x2F;Screen off"></a>LCD&#x2F;Screen off</h1><p>기존에 글 <a href="/2017-11-01-ubuntu-maintain-power-edfaa7d1d4f6/">Ubuntu&#x2F;시스템 전원관리, 2017년</a> 에서 Ubuntu 18.x 에서 디스플레이(특히 노트북 LCD)를 끄기 위해서 사용되던 직접 vbetool 명령으로 동작하지 않는다. </p>
<p>그래서 Ubuntu 20.04 에서는 링크 <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1277533/ubuntu-20-04-on-a-laptop-is-there-any-way-toturn-off-the-screen">ubuntu-20-04-on-a-laptop-is-there-any-way-toturn-off-the-screen</a> 에 있는 방법으로 사용하고 있다.</p>
<p>디스플레이를 끄려면 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -o remount,exec /dev</span><br><span class="line">sudo vbetool dpms off</span><br><span class="line">sudo mount -o remount,noexec /dev</span><br></pre></td></tr></table></figure>

<p>다시 디스플레이를 켜려면</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -o remount,exec /dev</span><br><span class="line">sudo vbetool dpms on</span><br><span class="line">sudo mount -o remount,noexec /dev</span><br></pre></td></tr></table></figure>

<h1 id="Network-상태-확인"><a href="#Network-상태-확인" class="headerlink" title="Network 상태 확인"></a>Network 상태 확인</h1><h2 id="ss-명령"><a href="#ss-명령" class="headerlink" title="ss 명령"></a>ss 명령</h2><p>ss 명령은 Socket Statistics 를 출력해 준다. open 된 소켓에 대한 정보를 표시한다. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ss [-a -t -u -l -p -n] [filter]</span><br><span class="line"></span><br><span class="line">-a:</span><br><span class="line">-t: TCP</span><br><span class="line">-u: UDP</span><br><span class="line">-l: LISTEN 상태 포트</span><br><span class="line">-n: 호스트/포트/사용자 이름을 숫자로 표시</span><br><span class="line">-p: 프로세스 이름</span><br><span class="line">-r, --resolve:  resolve host names</span><br><span class="line">-w, --raw    :  display only RAW sockets</span><br><span class="line">-x, --unix   :  display only Unix domain sockets</span><br><span class="line">-4, --ipv4   :  display only IP version 4 sockets</span><br><span class="line">-6, --ipv6   :  display only IP version 6 sockets</span><br><span class="line">-m, --memory :  show socket memory usage</span><br></pre></td></tr></table></figure>

<h3 id="LISTEN-Port-확이"><a href="#LISTEN-Port-확이" class="headerlink" title="LISTEN Port 확이"></a>LISTEN Port 확이</h3><p>netstat 같이 LISTEN 상태 프로세스를 확인할 수 있다. 다음은 t: tcp 포트, l: LISTEN 상태의 소켓 정보를 출력한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ss -lntu</span></span><br><span class="line">Netid      State       Recv-Q      Send-Q                   Local Address:Port            Peer Address:Port     Process</span><br><span class="line">udp        UNCONN      0           0                        127.0.0.53%lo:53                   0.0.0.0:*</span><br><span class="line">udp        UNCONN      0           0                12.42.168.213%enp3s0:68                   0.0.0.0:*</span><br><span class="line">tcp        LISTEN      0           511                            0.0.0.0:80                   0.0.0.0:*</span><br><span class="line">tcp        LISTEN      0           4096                     127.0.0.53%lo:53                   0.0.0.0:*</span><br><span class="line">tcp        LISTEN      0           10                           127.0.0.1:9000                0.0.0.0:*</span><br><span class="line">tcp        LISTEN      0           511                            0.0.0.0:443                  0.0.0.0:*</span><br><span class="line">tcp        LISTEN      0           128                            0.0.0.0:53000                0.0.0.0:*</span><br><span class="line">tcp        LISTEN      0           128                            0.0.0.0:2020                 0.0.0.0:*</span><br></pre></td></tr></table></figure>

<h3 id="IPv4-IPv6-소켓"><a href="#IPv4-IPv6-소켓" class="headerlink" title="IPv4, IPv6 소켓"></a>IPv4, IPv6 소켓</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ss -tl4</span><br><span class="line">State         Recv-Q        Send-Q               Local Address:Port                 Peer Address:Port        Process</span><br><span class="line">LISTEN        0             511                        0.0.0.0:http                      0.0.0.0:*</span><br><span class="line">LISTEN        0             511                        0.0.0.0:https                     0.0.0.0:*</span><br><span class="line">$</span><br><span class="line">$ ss -tl6</span><br><span class="line">State         Recv-Q        Send-Q               Local Address:Port                 Peer Address:Port        Process</span><br><span class="line">LISTEN        0             128                           [::]:2020                         [::]:*</span><br><span class="line">q</span><br></pre></td></tr></table></figure>


<h2 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h2><p>Linux에서 open file을 확인하는데 사용되는 lsof 명령입니다. Unix&#x2F;Linux의 모든 것은 파일로 이루어져있기때문에 스트림이나 네트워크 파일도 lsof 로 확인할 수 있습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ lsof -i</span><br><span class="line">$ lsof -l</span><br></pre></td></tr></table></figure>


<h1 id="—"><a href="#—" class="headerlink" title="—"></a>—</h1><p> <a href="/2017-11-01-ubuntu-maintain-power-edfaa7d1d4f6/">Ubuntu&#x2F;시스템 전원관리, 2017년</a> </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-14T06:00:00.000Z" title="5/14/2023, 3:00:00 PM">2023-05-14</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-08-04T22:10:28.743Z" title="8/5/2023, 7:10:28 AM">2023-08-05</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">7분안에 읽기 (약 1118 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/docker_cli_summary-84ee2a15f3e2/">Docker CLI 요약</a></p><div class="content"><p>docker cli 명령을 정리</p>
<p><img src='https://www.simplilearn.com/ice9/free_resources_article_thumb/DockerArchitecture_1.png' width=600 alt='docker architecture'> <a target="_blank" rel="noopener" href="https://www.simplilearn.com/tutorials/docker-tutorial/docker-architecture">이미지 소스</a></p>
<p>비슷한 문서:</p>
<ul>
<li><a href="/ubuntu-20.04-cheat_sheet-230a7dc631bf/">Ubuntu 20.04 - Cheat sheet</a></li>
<li><a href="/linux-system-cheat-2be979083953/">Linux system cheat</a></li>
<li><a href="/2017-05-05-tmux-cheatsheet-38c090793298/">Tmux cheat sheet, 2017</a></li>
</ul>
<h2 id="docker-cli"><a href="#docker-cli" class="headerlink" title="docker cli"></a>docker cli</h2><p>docker cli는 <code>docker</code> 명령 뒤에 docker commands 로 도커를 제어한다. 그리고 대상 컨테이너를 지정하고 컨테이너에서 실행 할 수 있는 명령형식으로 구성되어 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker [docker commands] [container] [container <span class="built_in">command</span>] </span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/cli/">Use the Docker command line docker</a></p>
<h2 id="search-이미지-검색"><a href="#search-이미지-검색" class="headerlink" title="search 이미지 검색"></a>search 이미지 검색</h2><p>Docker hub에서 이미지를 검색한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search busybox</span><br></pre></td></tr></table></figure>

<p>Docker hub에서 상위 몇개 정도만 검색하고 싶을때 limit 옵션을 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search busybox --<span class="built_in">limit</span> 5</span><br></pre></td></tr></table></figure>

<p>Docker hub에서는 이미지 중 별점을 검색한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 최소 별정 50인 이미지</span></span><br><span class="line">docker search busybox --filter=stars=50</span><br><span class="line"></span><br><span class="line"><span class="comment"># 별점이 3인 이미지</span></span><br><span class="line">docker search --filter stars=50 busybox</span><br></pre></td></tr></table></figure>

<p>정규 빌드 버전만 지시하려면 <code>is-official</code> 옵션 사용</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker search --filter is-official=true --filter stars=50 busybox</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>--format</code> 옵션을 사용해 출력되는 내용을 필터링 할 수 있다. 다음은 별점만 출력하는 예이다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search --format &quot;&#123;&#123;.Name&#125;&#125;: &#123;&#123;.StarCount&#125;&#125;&quot; nginx</span><br></pre></td></tr></table></figure>


<h2 id="pull-이미지를-다운로드-한다"><a href="#pull-이미지를-다운로드-한다" class="headerlink" title="pull 이미지를 다운로드 한다"></a>pull 이미지를 다운로드 한다</h2><p>Docker image를 내려 받는다. 이미지 이름 뒤에 <code>:[version]</code> 을 붙이면 지정한 버전을 내려 받고, latest 를 붙이면 최신 버전을 대상으로 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:latest</span><br></pre></td></tr></table></figure>


<h2 id="images-다운로드-이미지"><a href="#images-다운로드-이미지" class="headerlink" title="images 다운로드 이미지"></a>images 다운로드 이미지</h2><p>Docker에서 다운로드 받는 이미지를 확인한다. docker images는 모든 이미지를 보여준다. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images</span></span><br></pre></td></tr></table></figure>


<p>특정 이미지만 지시할 수 있다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker images nginx</span></span><br></pre></td></tr></table></figure>

<h2 id="run-이미지를-컨테이너로-실행한다"><a href="#run-이미지를-컨테이너로-실행한다" class="headerlink" title="run 이미지를 컨테이너로 실행한다."></a>run 이미지를 컨테이너로 실행한다.</h2><p>Docker image를 컨테이너로 생성하고, 실행합니다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 nginx</span><br></pre></td></tr></table></figure>

<p>옵션:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`-p`: Local과 Container 와 port를 연결하는 옵션</span><br><span class="line">`-i`: interactive (대화방식)</span><br><span class="line">`-t`: Pseudo-tty (콘솔 및 터미널 환경)</span><br><span class="line">`— name`: 실행 컨테이너 이름을 지정합니다.</span><br><span class="line">`-d`: 백그라운드에서 실행되는 옵션입니다.</span><br></pre></td></tr></table></figure>

<p>docker image를 실행하고 bash 쉘을 연다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t --name nginx nginx bash</span><br></pre></td></tr></table></figure>

<h2 id="ps-컨테이너-목록을-확인"><a href="#ps-컨테이너-목록을-확인" class="headerlink" title="ps 컨테이너 목록을 확인"></a>ps 컨테이너 목록을 확인</h2><p>Docker 컨테이너 목록을 확인합니다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker ps -a</span></span><br></pre></td></tr></table></figure>

<p>옵션:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`-a` : 실행 중이 아닌 컨테이너까지 확인</span><br><span class="line">`-q` : 컨테이너의 CONTAINER ID 만 표시</span><br></pre></td></tr></table></figure>

<h2 id="start-컨테이너를-시작한다"><a href="#start-컨테이너를-시작한다" class="headerlink" title="start 컨테이너를 시작한다."></a>start 컨테이너를 시작한다.</h2><p>중단되어 있는 컨테이너를 실행합니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker start nginx</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure>


<h2 id="attach-컨테이너-연결"><a href="#attach-컨테이너-연결" class="headerlink" title="attach 컨테이너 연결"></a>attach 컨테이너 연결</h2><p>실행중인 Docker Container 의  standard input, output,  error streams 에 연결한다. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach nginx</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/attach/">docker attach</a> 명령 사용 사례.</p>
<h2 id="exec-컨테이너-명령-실행"><a href="#exec-컨테이너-명령-실행" class="headerlink" title="exec 컨테이너 명령 실행"></a>exec 컨테이너 명령 실행</h2><p>Docker Container의 쉘의 명령어을 실행할 수 있다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec nginx ls</span><br></pre></td></tr></table></figure>

<p>옵션</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-d, --detach : 명령을 detach mode, 백그라운드로 실행</span><br><span class="line">-e, --env : 환경변수 설정하고 실행</span><br><span class="line">-it [SHELL]: iteractive tty 옵션. 사용할 shell을 지시한다, 보통  bash</span><br><span class="line">-u, --user: User ID, UID</span><br><span class="line">-w, --workdir: 작업 디렉토리 지정</span><br></pre></td></tr></table></figure>

<p>다음은 nginx 컨테이너의 bash 쉘을 실행한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it nginx bash</span><br></pre></td></tr></table></figure>

<p>다음은 nginx 컨테이너를 qkboo 사용자 쉘로 연결한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it -u qkboo nginx bash</span><br></pre></td></tr></table></figure>


<h2 id="inspect-컨테이너-상세-정보"><a href="#inspect-컨테이너-상세-정보" class="headerlink" title="inspect 컨테이너 상세 정보"></a>inspect 컨테이너 상세 정보</h2><p>Docker Container에 상세 정보를 확인 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect nginx</span><br></pre></td></tr></table></figure>

<p>옵션</p>
<p><code>--format</code> : 필터링</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect  --format=&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;</span><br></pre></td></tr></table></figure>


<h2 id="logs-명령"><a href="#logs-명령" class="headerlink" title="logs 명령"></a>logs 명령</h2><p>Docker 컨테이너에서 sysout 또는 syserr 로그를 보려면 logs 명령을 사용한다.</p>
<p>docker logs <container_id></p>
<h2 id="stop-컨테이너-종료"><a href="#stop-컨테이너-종료" class="headerlink" title="stop 컨테이너 종료"></a>stop 컨테이너 종료</h2><p>ps 명령으로 실행중인 컨테이너 아이디와 이름을 확인하고 아이디를 준다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line"></span><br><span class="line">docker stop e417951d25fd</span><br></pre></td></tr></table></figure>


<p>이름으로 종료시  <code>--name</code> 옵션 사용</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop --name nginx2</span><br></pre></td></tr></table></figure>


<h2 id="rm-컨테이너를-삭제한다"><a href="#rm-컨테이너를-삭제한다" class="headerlink" title="rm 컨테이너를 삭제한다."></a>rm 컨테이너를 삭제한다.</h2><p>Docker Container 삭제합니다. 삭제할때는 실행 상태가 아닌 컨테이너만 가능합니다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm nginx</span><br></pre></td></tr></table></figure>

<p>강제 삭제시 <code>-f</code> 옵션 사용.</p>
<h2 id="rmi-이미지를-삭제한다"><a href="#rmi-이미지를-삭제한다" class="headerlink" title="rmi 이미지를 삭제한다."></a>rmi 이미지를 삭제한다.</h2><p>Docker image를 삭제 하는데 이미지가 중첩된 경우가 많기 때문에 링크 같이 untag 한 후 사용한다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/rmi/#examples">rim example</a></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rmi fd484f19954f</span><br><span class="line"></span><br><span class="line">docker rmi test2:latest</span><br></pre></td></tr></table></figure>

<p>혹은 <code>-f</code> 옵션으로 중첩된 이미지를 모두 함께 삭제 할 수 있다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f fd484f19954f</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/cli/">Use the Docker command line docker</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@jyson88/docker-cli-%EC%A0%95%EB%A6%AC-cb031c281e2f">Docker CLI 정리, blog</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-28T00:00:00.000Z" title="4/28/2023, 9:00:00 AM">2023-04-28</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:09:15.183Z" title="5/14/2023, 3:09:15 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">7분안에 읽기 (약 1032 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/20230428-HTTPS_Private_SSL-4271241fb2d7/">HTTPS 를 위한 Private SSL</a></p><div class="content"><p>Web server certificates 과정</p>
<img src='https://ronnyvandenbroeck.files.wordpress.com/2019/10/web-server-certificate.png' width=600>


<h1 id="Securing-a-web-site-with-a-server-certificate-단계"><a href="#Securing-a-web-site-with-a-server-certificate-단계" class="headerlink" title="Securing a web site with a server certificate 단계"></a>Securing a web site with a server certificate 단계</h1><ol>
<li>비밀키를 생성한다.</li>
<li>비밀키로 CSR certificate siging requests 을 생성한다.</li>
<li>CSR 을 CA 로 사인한다.</li>
<li>사인한 CERT 를 받고 설치한다.</li>
</ol>
<h2 id="1-비밀키를-생성한다"><a href="#1-비밀키를-생성한다" class="headerlink" title="1. 비밀키를 생성한다."></a>1. 비밀키를 생성한다.</h2><p>rsa 를 사용해 4096크기 비밀키를 생성한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /etc/ssl/private </span></span><br><span class="line"><span class="comment"># openssl genrsa -out my_rsa.key 4096</span></span><br><span class="line">Generating RSA private key, 4096 bit long modulus (2 primes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod 0600 private/my_rsa.key</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chmod 0600 private/my_rsa.key</span></span><br></pre></td></tr></table></figure>


<h2 id="Public-Key-생성"><a href="#Public-Key-생성" class="headerlink" title="Public Key 생성"></a>Public Key 생성</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">명령: openssl rsa -in [private key 파일명] -pubout -out [파일명]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openssl rsa -in my_rsa.key -pubout -out my_rsa.pub </span></span><br></pre></td></tr></table></figure>



<h2 id="2-Create-a-CSR-certificate-signing-request-from-this-key"><a href="#2-Create-a-CSR-certificate-signing-request-from-this-key" class="headerlink" title="2. Create a CSR(certificate signing request) from this key,"></a>2. Create a CSR(certificate signing request) from this key,</h2><p>인증서 발급을 위한 필요한 정보를 담고 있는 인증서 신청서를 작성한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">명령어 : openssl req -new -key [private key 파일명] -out [파일명]</span><br></pre></td></tr></table></figure>


<p>비밀키에서 CSR 파일 작성을 요청하면 아래 내용을 묻는다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openssl req -new -sha256 -key ./my_rsa.key -out ./my_rsa.csr </span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openssl req -new -key private.key -out private.csr</span></span><br></pre></td></tr></table></figure>

<p>인증서 발급을 위한 필요한 정보를 담고 있는 인증서 신청 형식 데이터 이다. </p>
<ul>
<li>Country Name (국가코드) 	 KR</li>
<li>State or Province Name (시&#x2F;도의 전체이름)	 Seoul</li>
<li>Locality Name (시&#x2F;군&#x2F;구 등의 이름)	 Songpa-gu </li>
<li>Organization (회사이름)	 XXXX</li>
<li>Organization Unit (부서명)	 Server</li>
<li>Common Name (SSL 인증서를 설치할 서버의 Full Domain)	 <a target="_blank" rel="noopener" href="http://www.xxxx.com/">www.xxxx.com</a><ul>
<li><ul>
<li>Common Name 에는 인증서를 설치할 사이트의 도메인의 이름을 넣어야 한다. (ip, port, http, https 포함불가능)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4-CA-인증한-CRT-인증서-만들기"><a href="#4-CA-인증한-CRT-인증서-만들기" class="headerlink" title="4. CA 인증한 CRT 인증서 만들기"></a>4. CA 인증한 CRT 인증서 만들기</h2><p>CSR 을 CA에서 인증해 CRT 파일을 생성한다. 여기서는 비밀키와 CSR 요청서를 바탕으로 CRT 인증서를 생성한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">명령어 : openssl req -x509 -days [기간] -key [private key 파일명] -in [csr 파일명] -out [파일명] -days [기간]</span><br></pre></td></tr></table></figure>

<p>x509 를 이용하고 365일 사용 가능한 crt 인증서를 생성한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -days 365 -key my_rsa.key -<span class="keyword">in</span> my_rsa.csr -out my_rsa.crt -days 365</span><br></pre></td></tr></table></figure>

<p>생성한 혹은 CA에서 받은 CRT 파일은 아래 같이 확인해 볼 수 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -text -<span class="keyword">in</span> yourdomain.crt -noout</span><br></pre></td></tr></table></figure>

<h2 id="5-CRT-파일을-PEM-파일로-변환한다"><a href="#5-CRT-파일을-PEM-파일로-변환한다" class="headerlink" title="5. CRT 파일을 PEM 파일로 변환한다."></a>5. CRT 파일을 PEM 파일로 변환한다.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> mycommoncrt.crt -out mycommonpem.pem -outform PEM </span><br></pre></td></tr></table></figure>


<h2 id="Tip-인증서-Config-파일-test-conf"><a href="#Tip-인증서-Config-파일-test-conf" class="headerlink" title="[Tip] 인증서 Config 파일 (test.conf)"></a>[Tip] 인증서 Config 파일 (test.conf)</h2><p>위에서 만들다 보면 계속 같은 내용을 써야 한다. 그래서 그 부분을 파일로 만들어 놓고 csr, crt 생성할때 사용하면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[req]</span><br><span class="line">default_bits = 2048</span><br><span class="line">prompt = no</span><br><span class="line">default_md = sha256</span><br><span class="line">req_extensions = req_ext</span><br><span class="line">distinguished_name = dn</span><br><span class="line"></span><br><span class="line">[dn]</span><br><span class="line">C=KR</span><br><span class="line">ST=Seoul</span><br><span class="line">L=Seoul</span><br><span class="line">O=COMPANY</span><br><span class="line">OU=DEV</span><br><span class="line">emailAddress=test@test.com</span><br><span class="line">CN = testmachine</span><br><span class="line"></span><br><span class="line">[req_ext]</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[alt_names]</span><br><span class="line">IP.1 = 111.111.111.111</span><br><span class="line">DNS.1 = test.com</span><br></pre></td></tr></table></figure>

<p>csr 을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key private.key -out private.csr -config test.conf</span><br></pre></td></tr></table></figure>

<p>csr, crt 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -days 365 -key private.key -<span class="keyword">in</span> private.csr -out mycommoncrt.crt -days 365 -config test.conf</span><br></pre></td></tr></table></figure>


<p>그리고 이렇게 해서 인증서를 만들었을때 subjectAltName 이 안들어간다 . 그 부분이 필요할 경우에는 이렇게 명령어를 사용하면 된다. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -days 365 -key private.key -<span class="keyword">in</span> private.csr -out mycommoncrt.crt -days 365 -config test.conf -extensions req_ext</span><br></pre></td></tr></table></figure>


<h2 id="openssl-팁-몇가지"><a href="#openssl-팁-몇가지" class="headerlink" title="openssl 팁 몇가지"></a>openssl 팁 몇가지</h2><h3 id="CRT-파일-확인"><a href="#CRT-파일-확인" class="headerlink" title="CRT 파일 확인"></a>CRT 파일 확인</h3><p>openssl x509 -text -noout -in &lt;인증서파일&gt;  : 인증서 내용을 볼수 있다.</p>
<h3 id="Verifying-Your-Keys-Match"><a href="#Verifying-Your-Keys-Match" class="headerlink" title="Verifying Your Keys Match"></a>Verifying Your Keys Match</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl pkey -pubout -<span class="keyword">in</span> .\private.key | openssl sha256</span><br><span class="line">openssl req -pubkey -<span class="keyword">in</span> .\request.csr -noout | openssl sha256</span><br><span class="line">openssl x509 -pubkey -<span class="keyword">in</span> .\certificate.crt -noout | openssl sha256</span><br></pre></td></tr></table></figure>


<h1 id="NGINX-웹-서버-TLS-암호화-추가"><a href="#NGINX-웹-서버-TLS-암호화-추가" class="headerlink" title="NGINX 웹 서버 TLS 암호화 추가"></a>NGINX 웹 서버 TLS 암호화 추가</h1><p>개인키와 TLS 인증서 crt 파일을 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir /etc/nginx/tls/private</span><br><span class="line">$ mv my_rsa.key my_rsa.crt /etc/nginx/tls/private</span><br></pre></td></tr></table></figure>

<ol>
<li>개인 키는 &#x2F;etc&#x2F;nginx&#x2F;tls&#x2F;private&#x2F;my_rsa.key 파일에 저장됩니다.</li>
<li>개인 키 및 CSR(인증서 서명 요청) 생성 및 CA(인증 기관)에서 인증서 TLS 인증서는 <ul>
<li>&#x2F;etc&#x2F;nginx&#x2F;tls&#x2F;private&#x2F;example.com.crt 파일에 저장됩니다.</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen              443 ssl;</span><br><span class="line">    server_name         www.thinkbee.kr;</span><br><span class="line">    root                /home/qkboo/Home/www/thinkbee.kr/;</span><br><span class="line">    ssl_certificate     /etc/nginx/tls/private/my_rsa.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/tls/private/my_rsa.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<br>

<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.ronnyvdb.net/2019/10/02/howto-install-company-signed-web-server-certificate/">Howto – Install a self signed web server certificate</a></li>
<li><a target="_blank" rel="noopener" href="https://www.digicert.com/kb/ssl-support/openssl-quick-reference-guide.htm">openssl quick reference guide</a></li>
<li><a target="_blank" rel="noopener" href="https://blusky10.tistory.com/352">Openssl로 SSL 을 위한 인증서 발급하기 (HTTPS),blog</a></li>
<li><a href="/2017/04/04/linux/2017-04-04-ubuntu-nginx-ssl/">Nginx - HTTPS and Certificate SSL,blog</a></li>
<li><a href="/2017/04/01/nodejs/nodejs-nginx/">NodeJS와 Nginx 웹 서버,blog</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-05T00:00:00.000Z" title="4/5/2023, 9:00:00 AM">2023-04-05</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:06:19.743Z" title="5/14/2023, 3:06:19 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">5분안에 읽기 (약 824 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/linux-disk-partition_format-a1ed845ba2be/">parted로 Partition, Format하기</a></p><div class="content"><p>새 디스크 &#x2F; USB 저장장치를 리눅스 계열에서 사용하고자 할 때.</p>
<h2 id="디스크-확인-lsblk"><a href="#디스크-확인-lsblk" class="headerlink" title="디스크 확인 lsblk"></a>디스크 확인 lsblk</h2><p>lsblk 명령은 디바이스 장치가 마운트 된 곳을 출력해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">loop0                       7:0    0  63.3M  1 loop /snap/core20/1828</span><br><span class="line">loop1                       7:1    0  91.8M  1 loop /snap/lxd/23991</span><br><span class="line">sda                         8:0    0 119.2G  0 disk</span><br><span class="line">├─sda1                      8:1    0     1M  0 part</span><br><span class="line">├─sda2                      8:2    0     1G  0 part /boot</span><br><span class="line">└─sda3                      8:3    0 118.2G  0 part</span><br><span class="line">  └─ubuntu--vg-ubuntu--lv 253:0    0 118.1G  0 lvm  /</span><br></pre></td></tr></table></figure>

<p>새 디스크 장치(SSD, HDD, USB 등) 를 붙이고 다시 확인하면 새로운 디스크는 sd[a-z] 형식으로 표현된다.</p>
<blockquote>
<p>아래 sdb 는 현재 파티션이 1개 존재하는 상태이다.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">loop0                       7:0    0  63.3M  1 loop /snap/core20/1828</span><br><span class="line">loop1                       7:1    0  91.8M  1 loop /snap/lxd/23991</span><br><span class="line">sda                         8:0    0 119.2G  0 disk</span><br><span class="line">├─sda1                      8:1    0     1M  0 part</span><br><span class="line">├─sda2                      8:2    0     1G  0 part /boot</span><br><span class="line">└─sda3                      8:3    0 118.2G  0 part</span><br><span class="line">  └─ubuntu--vg-ubuntu--lv 253:0    0 118.1G  0 lvm  /</span><br><span class="line">sdb                         8:16   0 931.5G  0 disk</span><br><span class="line">└─sdb1                      8:17   0 931.5G  0 part</span><br></pre></td></tr></table></figure>

<p><strong>[USB 장치]</strong></p>
<p>USB 장치는 <code>mmcblk[0-9]</code> 형식으로 표시된다. 참고 <a href="/2019/07/12/raspberrypi/sdcard-mmcblk/">Raspberry Pi:mmcblk</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda           8:0    0 119.2G  0 disk</span><br><span class="line">├─sda1        8:1    0  84.5G  0 part</span><br><span class="line">└─sda6        8:6    0  28.9G  0 part /</span><br><span class="line">mmcblk0     179:0    0   7.5G  0 disk</span><br><span class="line">├─mmcblk0p2 179:2    0   6.8G  0 part /media/qkboo/ROOT</span><br><span class="line">├─mmcblk0p3 179:3    0 486.1M  0 part</span><br><span class="line">└─mmcblk0p1 179:1    0   200M  0 part /media/qkboo/EFI</span><br></pre></td></tr></table></figure>


<h2 id="parted-사용"><a href="#parted-사용" class="headerlink" title="parted 사용"></a>parted 사용</h2><p>파티션 및 포맷을 위해 마운트된 파티션을 언마운트 한다. parted 는 상호작용 프롬프트에서 사용하거나 단일 명령어로 사용할 수 있다.</p>
<h3 id="parted-프롬프트-사용"><a href="#parted-프롬프트-사용" class="headerlink" title="parted 프롬프트 사용"></a>parted 프롬프트 사용</h3><p><strong>[ext4 파티션 생성]</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo parted /dev/sdb</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      0.00GB  32.0GB  32.0GB</span><br><span class="line"></span><br><span class="line">(parted) mklabel gpt</span><br><span class="line">Warning: The existing disk label on /dev/sda will be destroyed and all data on</span><br><span class="line">this disk will be lost. Do you want to <span class="built_in">continue</span>?</span><br><span class="line">Yes/No? y</span><br><span class="line"></span><br><span class="line">(parted) unit GB</span><br><span class="line">(parted) mkpart primary 0 1000.0GB     <span class="comment">#디스크 크기 입력</span></span><br><span class="line"></span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      0.00GB  32.0GB  32.0GB               primary  lvm</span><br><span class="line">(parted) quit</span><br></pre></td></tr></table></figure>


<p><strong>[fat32 파티션 생성]</strong></p>
<p>USB 스토리지는 아래 같이 나타난다. 다음은 USB 파티션에 fat32 파일시스템을 프롬프트로 생성하고 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo parted /dev/mmcblk0</span><br><span class="line">(parted) mklabel msdos</span><br><span class="line">(parted) mkpart primary fat32 1MiB 100%</span><br><span class="line">(parted) <span class="built_in">set</span> 1 boot on</span><br><span class="line">(parted) quit</span><br></pre></td></tr></table></figure>



<h3 id="쉘에서-parted-명령-사용"><a href="#쉘에서-parted-명령-사용" class="headerlink" title="쉘에서 parted 명령 사용"></a>쉘에서 parted 명령 사용</h3><p>parted 를 쉘 명령으로 사용해 단계별로 파티션을 생성할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo parted /dev/mmcblk0 <span class="built_in">rm</span> 1</span><br><span class="line">sudo parted /dev/mmcblk0 <span class="built_in">rm</span> 2</span><br><span class="line">sudo parted /dev/sdc mkpart primary ext3 4MiB 100%</span><br></pre></td></tr></table></figure>


<h2 id="Format-Mount-amp-fstab"><a href="#Format-Mount-amp-fstab" class="headerlink" title="Format, Mount &amp; fstab"></a>Format, Mount &amp; fstab</h2><p>생성한 파티션에 시스템 지원 파일 시스템을 생성해야 한다. 해당 파일 시스템으로 파티션을 포맷한 후에 지정한 디렉토리에 마운트를 해서 사용하면 된다. 지속적인 사용을 위해서 <code>/etc/fstab</code> 에 파티션을 마운트 포인트로 등록하면 재시동 후에도 동일한 폴더에 마운트 된다.</p>
<h3 id="mkfs"><a href="#mkfs" class="headerlink" title="mkfs"></a>mkfs</h3><p>mkfs 명령은 파일 시스템에 따랴서 <code>-t</code> 옵션에 파일시스템을 지시하거나 <code>mkfs.[FS]</code> 형식을 명령을 바로 쓰기도 한다.</p>
<p>다음을 sdb1 파티션을 ext4 로 포맷하고 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkfs -t ext4 /dev/sdb1</span><br></pre></td></tr></table></figure>


<p><strong>[USB vfat 파일시스템 생성]</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkfs -V -t vfat /dev/mmcblk0p1</span><br></pre></td></tr></table></figure>

<h3 id="fstab-에-등록"><a href="#fstab-에-등록" class="headerlink" title="fstab 에 등록"></a>fstab 에 등록</h3><p>&#x2F;etc&#x2F;fstab 에 새로 포맷한 디스크 경로를 추가 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># HDD</span><br><span class="line">/dev/sdb1           /Home2 ext4 defaults 0 1</span><br><span class="line"></span><br><span class="line"># USB LV volume</span><br><span class="line">/dev/vg_usb/dbvol   /data ext4 defaults 0 1</span><br><span class="line">/dev/vg_usb/workvol /home/pi/work ext4 defaults 0 1</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a href="/2019/07/12/raspberrypi/sdcard-mmcblk/">Raspberry Pi:mmcblk, qkboo</a></li>
<li><a href="/2016/12/20/raspberrypi/sdcard-usage/">SD Card 포맷 및 디스크 이미지 사용하기, qkboo</a></li>
<li><a href="/2017/04/03/linux/2017-04-03-odroid-lvm2/">Linux LVM2,qkboo</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-02-02T09:00:00.000Z" title="2/2/2020, 6:00:00 PM">2020-02-02</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:14:22.603Z" title="5/14/2023, 3:14:22 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">16분안에 읽기 (약 2336 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/Lets_Encrypt%EB%B0%9C%EA%B8%89-c616baa21b02/">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</a></p><div class="content"><blockquote>
<p>2020-06-02: 매뉴얼 방식 수정<br><br>2020-02-02: 최초 작성<br>{:.right-history}</p>
</blockquote>
<p>Nginx 서버에서 HTTPS 사용할 수 있는 공인인증서를 발급해 설치하려고 한다.</p>
<ul>
<li>여기서는 Lets Encrypt 무료 공인인증서 발급을 다룬다.</li>
<li>letsecrypt 공인인증서는 3개월 정도 기간만 사용 가능하고 갱신해야 한다.</li>
<li>**<em>단독 도메인을 호스팅하는 개인 서버에서 Nginx</em>**에 적용해 본다.</li>
</ul>
<p>인증서는 <strong>개별 도메인</strong> 혹은 <strong>와일드카드 인증서</strong> 로 도메인 안의 모든 호스트를 포함하는 두 종류로 발급이 가능하다.</p></div><a class="article-more button is-small is-size-7" href="/Lets_Encrypt%EB%B0%9C%EA%B8%89-c616baa21b02/#more">자세히 보기</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-12-10T00:00:00.000Z" title="12/10/2019, 9:00:00 AM">2019-12-10</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:09:40.803Z" title="5/14/2023, 3:09:40 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">8분안에 읽기 (약 1129 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/firewalld-92b3fc2b8647/">openSUSE: firewalld</a></p><div class="content"><p><strong>firewalld</strong> 를 이용해서 방화벽을 구성해 보자.</p>
<ul>
<li>RedHat, Ubuntu, OpenSUSE LEAP 15.0 등은 시스템 기본 파이어월 관리자로 firewalld 를 제공한다고 한다.</li>
</ul>
<h2 id="firewalld"><a href="#firewalld" class="headerlink" title="firewalld"></a>firewalld</h2><p>firewalld 는 ….</p>
<p>firewalld는 ufw 처럼 <code>iptables</code> 을 구성할 수 있다.</p>
<p><img src="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-7-Security_Guide-en-US/images/eee9192950e07b21f5c95b3ced63ae09/RHEL_Security-Guide_453350_0717_ECE_firewalld-comparison-rhel7.png"></p>
<figure>[그림. Firewall Stack (redhat.com)]</figure>

<p>네트워크를 지역 관리가 가능해서 다른 네트워크, 지역에 따라 다른 규칙으로 구성해서 사용할 수 있다.<br>For example “Home” and “Office” where all communications with local machines are allowed, and “Public Wi-Fi” where no communication with the same subnet would be allowed.</p>
<p><a target="_blank" rel="noopener" href="https://www.ctrl.blog/entry/ufw-vs-firewalld">https://www.ctrl.blog/entry/ufw-vs-firewalld</a></p>
<h3 id="firewalld-설치"><a href="#firewalld-설치" class="headerlink" title="firewalld 설치"></a>firewalld 설치</h3><p>OpenSUSE LEAP 15.0, RedHat, Ubuntu 등은 시스템 기본 파이어월 관리자로 firewalld 를 제공한다고 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install firewalld</span><br></pre></td></tr></table></figure>

<h3 id="Start-firewalld"><a href="#Start-firewalld" class="headerlink" title="Start firewalld"></a>Start <code>firewalld</code></h3><p>To start firewalld, enter the following command as root:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld</span><br></pre></td></tr></table></figure>

<p>root 사용자로 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable firewalld</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>

<p>For more information about the service status, use the systemctl status sub-command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status firewalld</span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Thu 1970-01-01 09:01:48 KST; 48 years 6 months ago</span><br><span class="line"></span><br><span class="line">sudo firewall-cmd --state</span><br></pre></td></tr></table></figure>

<h4 id="Stop-firewalld"><a href="#Stop-firewalld" class="headerlink" title="Stop firewalld"></a>Stop <code>firewalld</code></h4><p>To stop firewalld, enter the following command as root:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure>

<p>To prevent firewalld from starting automatically at system start, enter the following command as root:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<p>To make sure firewalld is not started by accessing the firewalld D-Bus interface and also if other services require firewalld, enter the following command as root:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl mask firewalld</span><br></pre></td></tr></table></figure>

<h3 id="사용해-보기"><a href="#사용해-보기" class="headerlink" title="사용해 보기"></a>사용해 보기</h3><p><code>firewalld</code> 는 명령라인 firewall-cmd 와 GUI로 firewall-config 명령을 지원한다.</p>
<h4 id="Zone-설정"><a href="#Zone-설정" class="headerlink" title="Zone 설정"></a>Zone 설정</h4><p>Get a list of all supported zones</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-zones</span><br></pre></td></tr></table></figure>

<p>List all zones with the enabled features.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ firewall-cmd --list-all-zones</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">public</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces:</span><br><span class="line">  sources:</span><br><span class="line">  services: ssh dhcpv6-client http https</span><br><span class="line">  ports:</span><br><span class="line">  protocols:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure>

<p>기본으로 제공하는 Zone</p>
<ul>
<li>drop: Any incoming network packets are dropped, there is no reply. Only outgoing network connections are possible.</li>
<li>block: Any incoming network connections are rejected with an icmp-host-prohibited message for IPv4 and icmp6-adm-prohibited for IPv6. Only network connections initiated within this system are possible.</li>
<li>public: For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</li>
<li>external: For use on external networks with masquerading enabled especially for routers. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</li>
<li>dmz: For computers in your demilitarized zone that are publicly-accessible with limited access to your internal network. Only selected incoming connections are accepted.</li>
<li>work<br>For use in work areas. You mostly trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</li>
<li>home<br>For use in home areas. You mostly trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</li>
<li>internal<br>For use on internal networks. You mostly trust the other computers on the networks to not harm your computer. Only selected incoming connections are accepted.</li>
<li>trusted<br>All network connections are accepted.</li>
</ul>
<p>Zone</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --get-default-zone</span><br><span class="line">public</span><br></pre></td></tr></table></figure>

<h4 id="서비스"><a href="#서비스" class="headerlink" title="서비스"></a>서비스</h4><p>This command prints a space separated list.</p>
<p>Get a list of all supported services</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ firewall-cmd --get-services</span><br></pre></td></tr></table></figure>

<p>This command prints a space separated list.</p>
<p>Get a list of all supported icmptypes</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --get-icmptypes</span><br></pre></td></tr></table></figure>

<p>서비스를 제거하려면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># firewall-cmd --zone=public --remove-service=http</span><br><span class="line">success</span><br><span class="line">root@odroidc2:/home/qkboo# firewall-cmd --zone=public --remove-service=https</span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<h4 id="Http-Ssh-방화벽-활성화"><a href="#Http-Ssh-방화벽-활성화" class="headerlink" title="Http, Ssh 방화벽 활성화"></a>Http, Ssh 방화벽 활성화</h4><p>http, https 를 공개 서비스를 지원하는 기본 존인 public에 추가한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --add-service=ssh</span><br><span class="line">sudo firewall-cmd --add-service=http</span><br><span class="line">sudo firewall-cmd --add-service=https</span><br></pre></td></tr></table></figure>

<p>sudo firewall-cmd –zone&#x3D;public –add-service&#x3D;http –permanent</p>
<p>방화벽을 갱신한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --state</span><br></pre></td></tr></table></figure>

<p>혹은 zone을 지정해 추가한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=web --add-service=ssh</span><br><span class="line">sudo firewall-cmd --zone=web --add-service=http</span><br><span class="line">sudo firewall-cmd --zone=web --add-service=https</span><br><span class="line">sudo firewall-cmd --zone=web --list-all</span><br></pre></td></tr></table></figure>

<p>Likewise, we can add the DNS service to our “privateDNS” zone:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=privateDNS --add-service=dns</span><br><span class="line">sudo firewall-cmd --zone=privateDNS --list-all</span><br></pre></td></tr></table></figure>

<p>Zone 에 구성한 서비스 등은 런타임 혹은 완전히 방화벽에 구성할 수 있다.</p>
<p>To change settings in both modes, you can use two methods:<br>Change runtime settings and then make them permanent as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd &lt;other options&gt;</span><br><span class="line">firewall-cmd --runtime-to-permanent</span><br></pre></td></tr></table></figure>

<p>Set permanent settings and reload the settings into runtime mode:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent &lt;other options&gt;</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>모든 구성 내용 확인:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo firewall-cmd --list-all</span><br><span class="line">public</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces:</span><br><span class="line">  sources:</span><br><span class="line">  services: ssh dhcpv6-client http https</span><br><span class="line">  ports:</span><br><span class="line">  protocols:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure>

<p>특정 zone 에 대한 내역을 출력한다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ sudo firewall-cmd --zone=public --list-all</span><br><span class="line">public</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces:</span><br><span class="line">  sources:</span><br><span class="line">  services: ssh dhcpv6-client http https</span><br><span class="line">  ports:</span><br><span class="line">  protocols:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p><a target="_blank" rel="noopener" href="https://www.linode.com/docs/security/firewalls/introduction-to-firewalld-on-centos/">https://www.linode.com/docs/security/firewalls/introduction-to-firewalld-on-centos/</a></p>
<p><a target="_blank" rel="noopener" href="https://fedoraproject.org/wiki/Firewalld?rd=FirewallD">FirewallD</a></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls#sec-Getting_started_with_firewalld">RedHat: Getting started with firewalld</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-7">How to set up firewalld on CentOS 7</a></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.hogarthuk.com/?q=node/9">Firewalld configuration and usage</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-06-24T14:10:00.000Z" title="6/24/2018, 11:10:00 PM">2018-06-24</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:10:54.953Z" title="5/14/2023, 3:10:54 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">7분안에 읽기 (약 986 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/naver-ncloud-b4e6108ee49b/">Naver ncloud 설정</a></p><div class="content"><h2 id="ncloud-서비스"><a href="#ncloud-서비스" class="headerlink" title="ncloud 서비스"></a>ncloud 서비스</h2><h3 id="sudoer-설정"><a href="#sudoer-설정" class="headerlink" title="sudoer 설정"></a>sudoer 설정</h3><p>새 사용자를 추가하고 suder 로 등록한 후에 사용한다. 우분투&#x2F;데비안 계열 새 사용자 추가는 <a href="https://blog.thinkbee.kr/linux/odroid-install-linux/">Odroid Install</a> 문서를 참고한다.</p>
<h4 id="새-사용자-등록"><a href="#새-사용자-등록" class="headerlink" title="새 사용자 등록"></a>새 사용자 등록</h4><p><code>adduser</code> 추가할 사용자에 대한 정보를 하나씩 묻고, 사용자 홈 디렉토리가 생성된다. 추가한 사용자에 대한 &#x2F;etc&#x2F;passwd, &#x2F;etc&#x2F;shadow, &#x2F;etc&#x2F;group and &#x2F;etc&#x2F;gshadow 편집이 된다</p>
<p>추가하고 패스워드를 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># adduser USERNAME</span><br><span class="line"># sudo passwd USERNAME</span><br></pre></td></tr></table></figure>

<p>그리고 suder로 등록해 준다.</p>
<h4 id="sudoer-등록"><a href="#sudoer-등록" class="headerlink" title="sudoer 등록"></a>sudoer 등록</h4><p><code>usermod</code> 혹은 <code>visudo</code> 를 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># usermod -aG sudo USERNAME</span><br></pre></td></tr></table></figure>

<h4 id="hostname-확인"><a href="#hostname-확인" class="headerlink" title="hostname 확인"></a>hostname 확인</h4><p><code>hostname</code> 명령에 따라 현재 호스트 이름이 &#x2F;etc&#x2F;hosts 혹은 dns resolver에서 검색되야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemcgl status nginx</span><br><span class="line">sudo: unable to resolve host ubuntu-84</span><br></pre></td></tr></table></figure>

<p>위 같은 경고가 나타난다면 호스트 이름을 &#x2F;etc&#x2F;hosts 에 등록해 준다.</p>
<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p>서버에</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;USER@localhost&quot;</span></span><br></pre></td></tr></table></figure>

<p>위 2 과정을 아래 명령 한 줄로 복사-&gt;붙여넣기를 동시에 할 수 있다.</p>
<p><em>클라이언트:</em></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub | ssh &lt;USERNAME&gt;@&lt;IP-ADDRESS&gt; <span class="string">&#x27;cat &gt;&gt; .ssh/authorized_keys&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="mongod-org-설치"><a href="#mongod-org-설치" class="headerlink" title="mongod-org 설치"></a>mongod-org 설치</h3><p>커뮤티티에디션 설치</p>
<p>네이버 NCloud에서 Micro server를 하나 생성한 후에, <em>MongoDB Community Edition</em>을 설치했고, ncloud의 Ubuntu 16.01 이미지로 서버를 생성한 후에 업그레이드해서 16.04.4 LTS 버전에서 설치했다.</p>
<h4 id="설정"><a href="#설정" class="headerlink" title="설정"></a>설정</h4><p>mongodb 설정<br>mongodb auth</p>
<p>현재 실행중인 mongod 를 종료한다.</p>
<p>sudo systemctl stop mongod.service</p>
<p>MongoDB 설정<br>Mongo Database를 사용하기 위해서 데이터 파일 위치, 로그, 포트, Ip 주소 등에 대한 구성을 mongod.conf 에서 할 수 있다. 수정된 구성이 작동하는지 mongo 클라이언트로 접속해서 테스트한다.</p>
<h4 id="mongod-conf"><a href="#mongod-conf" class="headerlink" title="mongod.conf"></a>mongod.conf</h4><p>&#x2F;etc&#x2F;mongod.conf 파일에 인증을 제외한 데이터 디렉토리, bindIp, 로그 부분만 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 0.0.0.0</span><br></pre></td></tr></table></figure>

<p>설정을 저장하고 명령 라인에서 MongoDB를 다시 시작한 후에 mongo client로 접속한다.</p>
<p>모든 인터페이스에 db 접속을 허용하면 <code>bindIpAll: true</code> 를 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /var/lib/mongodb</span><br></pre></td></tr></table></figure>

<p>이어서 클라이언트로 데이터베이스에 접속한다.접속에 성공하면 <strong>&gt;</strong> 프롬프트가 나온다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$mongo</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h4 id="admin-계정"><a href="#admin-계정" class="headerlink" title="admin 계정"></a>admin 계정</h4><p>mongod 에서 데이터베이스 및 사용자를 관리할 admin 이란 관리자를 추가하자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>관자자의 권한과 역할을 선언한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user:&#x27;admin&#x27;,</span><br><span class="line">    pwd:&#x27;****&#x27;,</span><br><span class="line">    roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br></pre></td></tr></table></figure>

<p>사용자의 role 을 변경,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.grantRolesToUser( &#x27;admin&#x27;, [&#123;role: &#x27;userAdmin&#x27;, db:&#x27;admin&#x27;&#125;])</span><br><span class="line">&gt; db.getUsers()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdmin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>관리자 admin 계정을 admin 데이터베이스에 추가한 후에 mongo client로 admin 계정으로 로그인해서 …</p>
<p>터미널에서 시작한 mongod 를 종료한다.</p>
<p>수동으로 mongod 를 시작하면 root 계정으로 데이터 파일이 생성된다. systemctl로 서비스 시작 전에 data 폴더 퍼미션을 맞춰준다.</p>
<p>Directory permissions<br>로그 디렉토리 &#x2F;var&#x2F;log&#x2F;mongo 그리고 데이터 디렉토리 &#x2F;data&#x2F;mongodata 라면 해당 디렉토리에 몽고디비 사용자가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown mongo.daemon /var/log/mongodb</span><br><span class="line">$ sudo chown mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h4 id="데이터베이스-사용자-추가"><a href="#데이터베이스-사용자-추가" class="headerlink" title="데이터베이스 사용자 추가"></a>데이터베이스 사용자 추가</h4><p>데이터베이스를 생성하고 해당 데이터베이스를 접속하는 사용자 계정을 추가하자.</p>
<blockquote>
<p>수동으로 접근제어 –auth 옵션으로 데이터베이스를 시작하면, mongo 클리이언트 로그인시 -u <username>, -p <password> 와 –authenticationDatabase <database> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>The following operation creates accountUser in the products database and gives the user the readWrite and dbAdmin roles.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use products</span><br><span class="line">db.createUser(</span><br><span class="line">   &#123;</span><br><span class="line">     user: &quot;accountUser&quot;,</span><br><span class="line">     pwd: &quot;password&quot;,</span><br><span class="line">     roles: [ &quot;readWrite&quot;, &quot;dbAdmin&quot; ]</span><br><span class="line">   &#125;</span><br><span class="line">)```</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-11-22T14:30:00.000Z" title="11/22/2017, 11:30:00 PM">2017-11-22</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:16:06.093Z" title="5/14/2023, 3:16:06 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">5분안에 읽기 (약 775 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/ubuntu-iptables-22b9c2c518b4/">iptables Firewall on Ubuntu/Debian</a></p><div class="content"><p>일반적인 리눅스 배포본의 기본 방화벽인 <code>iptables</code>를 쉽게 사용할 수 있는 <code>ufw</code> 를 사용해서 리눅스에 방화벽을 구축하는 방법을 기술하고 있다.</p>
<h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><p>iptables로 당연히 방화벽을 관리할 수 있다.</p>
<h4 id="iptables-L-플래그"><a href="#iptables-L-플래그" class="headerlink" title="iptables -L 플래그"></a><code>iptables -L</code> 플래그</h4><p>방화벽 룰, 액션에 대해 INPUT, OUTPUT, FORWARD 정보를 볼 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -L</span><br></pre></td></tr></table></figure>

<h4 id="S-플래그"><a href="#S-플래그" class="headerlink" title="-S 플래그"></a>-S 플래그</h4><p>우리 대신 사용 하 여 각 규칙 및 정책을 사용 하는 데 필요한 명령을 반영 하는 형식으로 출력을 볼 수 있는</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -S</span><br></pre></td></tr></table></figure>

<p>규칙을 모두 리플레시 할 수 있다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -F</span><br></pre></td></tr></table></figure>

<h3 id="방화벽"><a href="#방화벽" class="headerlink" title="방화벽"></a>방화벽</h3><p>모든 규칙은 DENY -&gt; 일부 허용 순서로 한다. 그래서 TCP 로 1번부터 65526번 포트까지 다 막는 방법이다. 만약 UDP도 막고싶다면,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -p tcp --dport 1:65526 -j DROP</span><br></pre></td></tr></table></figure>

<h3 id="ssh-22-자리는-포트"><a href="#ssh-22-자리는-포트" class="headerlink" title="ssh 22 자리는 포트"></a>ssh 22 자리는 포트</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -I INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">sudo iptables -I OUTPUT -p tcp --sport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>혹은 ip address 를 기반으로 설정할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -p tcp --dport 22 -s 222.222.222.222 -j ACCEPT</span><br><span class="line">iptables -I OUTUT -p tcp --dport 22 -d 222.222.222.222 -j ACCEPT</span><br></pre></td></tr></table></figure>

<p>8080번으로 들어오는 포트를 80 번으로 바꾸기</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -i eth0 -p tcp --dport 80 -j ACCEPT</span><br><span class="line">sudo iptables -A INPUT -i eth0 -p tcp --dport 8080 -j ACCEPT</span><br><span class="line">sudo iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080</span><br></pre></td></tr></table></figure>

<p>iptables정보를 저장하고 재부팅 이후에도 동작하도록 설정함. &lt;&#x3D; vi 로 열어서 맨 마지막에 추가함.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo sh -c &quot;iptables-save &gt; /backup/iptables.rules&quot;</span><br><span class="line">sudo vi /etc/network/interfaces</span><br><span class="line">pre-up iptables-restore &lt; /etc/iptables.rules</span><br></pre></td></tr></table></figure>

<h4 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h4><p>기본 httpd 사용을 위한 80번 포트 개방과, node.js, python 등 실습을 위한 8080번 포트를 열어 주기 위해서 <code>/etc/sysconfig/iptables</code> 에 아래와 같이 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m tcp --dport 8080 -j ACCEPT</span><br><span class="line">-A OUTPUT -p tcp -m tcp --dport 8080 -j ACCEPT</span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br></pre></td></tr></table></figure>

<p>iptables 규칙을 만들 때는 순서가 매우 중요하다.<br>이 때 주의해야 할 것은 위의 4개 코드가 빨간 색의 코드보다 반드시 위에 적혀 있어야 한다.</p>
<p>예를 들어 만일 chain에서 로컬 192.168.100.0&#x2F;24 서브넷에서 들어오는 모든 패킷을 drop하도록 지정한 후 (drop 하도록 지정된 서브넷에 포함되는) 192.168.100.13에서 들어오는 패킷을 모드 허용하는 chain (-A)을 그 후에 추가하면 뒤에 추가된 추가 규칙이 무시된다.<br>먼저 192.168.100.13를 허용하는 규칙을 설정한 후 서브넷을 drop하는 규칙을 설정해야한다.</p>
<p>이후에</p>
<blockquote>
<p>service iptables restart</p>
</blockquote>
<p>명령어를 실행해주면 2개의 포트가 열러서 정상적으로 외부접속이 가능해지는 것을 확인할 수 있다.</p>
<p>로그에 있는 IP 목록을 출력</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -o &#x27;[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+&#x27; | sort -u</span><br></pre></td></tr></table></figure>

<h3 id="Check-blocked-ip-addresses"><a href="#Check-blocked-ip-addresses" class="headerlink" title="Check blocked ip addresses"></a>Check blocked ip addresses</h3><p><code>iptables</code> 명령으로 막혀있는 ip address를 출력해 보자. [^3]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -L -n --line</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -L INPUT -v -n</span><br><span class="line">08:43:89:08:00:45:00:00:3c:97:2b:40:00:34:06:4d:8b SRC=90.202.157.25 DST=220.121.141.168 LEN=60 TOS=0x│Chain INPUT (policy DROP 48 packets, 2312 bytes</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^3]: <a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/linux-howto-check-ip-blocked-against-iptables/">Check blocked IP in iptables</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-11-22T14:00:00.000Z" title="11/22/2017, 11:00:00 PM">2017-11-22</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:16:23.743Z" title="5/14/2023, 3:16:23 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">21분안에 읽기 (약 3077 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/ubuntu-fail2ban-5ff4cf69c47c/">Monitoring fail2ban</a></p><div class="content"><h1 id="Monitoring-fail2ban"><a href="#Monitoring-fail2ban" class="headerlink" title="Monitoring fail2ban"></a>Monitoring fail2ban</h1><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><p>로그를 검사해 의심스런 IP 를 찾아 Firewall rule을 관리하기 어렵다 Fail2ban은 정규표현식을 사용해서 로그에서 의심스런 IP를 찾아 Firewall 등록할 수 있도록 해준다.</p>
<h2 id="Fail2ban"><a href="#Fail2ban" class="headerlink" title="Fail2ban"></a>Fail2ban</h2><p>로그를 검사해 의심스런 IP 를 찾아 Firewall rule에 등록해 관리하는 것은 어려운 과정이다. <em>Fail2ban</em>은 정규표현식을 사용해서 로그에서 의심스런 IP를 찾아 Firewall 등록 할 수 있도록 해준다.</p>
<h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><p><code>fail2ban</code> 은 <code>iptables</code> 패키지와 함께 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install iptables fail2ban</span><br></pre></td></tr></table></figure>

<p>그리고 <code>systemctl</code> 로 재대로 서비스가 시작되는지 확인해 본다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart fail2ban.service    <span class="comment"># 재시작</span></span><br><span class="line">$ sudo systemctl status fail2ban.service     <span class="comment"># running 상태 확인</span></span><br></pre></td></tr></table></figure>

<p>설정을 위해서 <code>fail2ban</code> 설정 파일인 fail2ban.conf, 그리고 jail 파일 jail.conf 파일을 <code>.local</code> 파일로 복사한 사용자 정의 파일에서 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /etc/fail2ban</span><br><span class="line">$ sudo <span class="built_in">cp</span> fail2ban.conf fail2ban.local       <span class="comment"># 설정파일</span></span><br><span class="line">$ sudo <span class="built_in">cp</span> jail.conf jail.local               <span class="comment"># jail 설정</span></span><br></pre></td></tr></table></figure>

<h4 id="x2F-etc-x2F-fail2ban-디렉토리"><a href="#x2F-etc-x2F-fail2ban-디렉토리" class="headerlink" title="&#x2F;etc&#x2F;fail2ban 디렉토리"></a>&#x2F;etc&#x2F;fail2ban 디렉토리</h4><p>설치된 후 관련된 설정 파일은 &#x2F;etc&#x2F;fail2ban 디렉토리에 저장됩니다. 관련한 로그 기록은 &#x2F;etc&#x2F;logratate.d&#x2F;fail2ban에 정의되어 &#x2F;var&#x2F;log&#x2F;fail2ban.log 로 저장됩니다.</p>
<p>다음은 설정 디렉토리 구조</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ tree -L 2 fail2ban/</span><br><span class="line">fail2ban/</span><br><span class="line">├── action.d</span><br><span class="line">│   ├── ...</span><br><span class="line">│   ├── ufw.conf</span><br><span class="line">│   └── xarf-login-attack.conf</span><br><span class="line">├── fail2ban.conf</span><br><span class="line">├── fail2ban.local</span><br><span class="line">├── fail2ban.d</span><br><span class="line">├── filter.d</span><br><span class="line">│   ├── ...</span><br><span class="line">│   ├── sshd.conf</span><br><span class="line">│   └── xinetd-fail.conf</span><br><span class="line">├── jail.conf</span><br><span class="line">├── jail.d</span><br><span class="line">│   └── defaults-debian.conf</span><br><span class="line">├── jail.local</span><br><span class="line">├── paths-common.conf</span><br><span class="line">└── paths-debian.conf</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>jail.conf</strong>: <code>jail</code> 이라 불리는 모니터링할 대상에 대한 기본 옵션과 행위를 선언한다.</li>
<li><strong>action.d&#x2F;iptables-multiport.conf</strong>: fila2ban 이 jail에 맞게 거부(Ban)한 IP를 다루는 기본 액션이다.</li>
<li>fail2ban.local : <code>fail2ban</code> 주요 설정 파일</li>
<li>jail.local: jail 설정 파일</li>
<li>jaild.d&#x2F;defaults-debian.conf: jail enable&#x2F;disable</li>
<li>paths-common.conf: 로그 파일 경로</li>
<li>paths-debian.conf: 로그 파일 경로</li>
</ul>
<h2 id="설정"><a href="#설정" class="headerlink" title="설정"></a>설정</h2><p>fail2ban은 jail 을 구성하고 jail의 filter 그리고 action으로 나뉘어 있다.</p>
<h3 id="fail2ban-conf-구성"><a href="#fail2ban-conf-구성" class="headerlink" title="fail2ban.conf 구성"></a>fail2ban.conf 구성</h3><p>fail2ban.conf는 기본 구성 변수로 loggin, socket 그리고 PID 파일 등등이 설정된다. 별도의 파일로 Jail을 구성할 때 fail2ban.local 같은 이름을 사용하고 새로 설정되는 값은 기본 설정 값을 재정의 하게 된다.</p>
<blockquote>
<p>단 같은 [default] 섹션이 존재하면 구성된 내용 적용이 잘 안된다.</p>
</blockquote>
<p>다음 스크립을 사용하면 모둔 변수를 주석 처리하고 수정할 옵션만 복사해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;s/\(^[[:alpha:]]\)/# \1/&#x27; fail2ban.conf | sudo tee fail2ban.local 1&amp;&gt; /dev/null</span><br></pre></td></tr></table></figure>

<p>fail2ban.local 파일은 다음과 같은 내용을 담을 것이다.</p>
<ul>
<li>loglevel: The level of detail that Fail2ban’s logs provide can be set to 1 (error), 2 (warn), 3 (info), or 4 (debug).</li>
<li>logtarget: Logs actions into a specific file. The default value of &#x2F;var&#x2F;log&#x2F;fail2ban.log puts all logging into the defined file. Alternately, you can change the value to STDOUT, which will output any data; STDERR, which will output any errors; SYSLOG, which is message-based logging; and FILE, which outputs to a file.</li>
<li>socket: The location of the socket file.</li>
<li>pidfile: The location of the PID file.</li>
</ul>
<h3 id="jail-conf"><a href="#jail-conf" class="headerlink" title="jail.conf"></a><strong>jail.conf</strong></h3><p>&#x2F;etc&#x2F;fail2ban&#x2F;jail.conf 는 데몬, 서비스에 대한 jail을 구성한다. jail은 log를 읽어 불필요한 것을 찾아 낸다.<br>다음은 jail.conf에서 주석이 달린 jail.local을 생성해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;s/\(^[[:alpha:]]\)/# \1/&#x27; jail.conf | sudo tee jail.local 1&amp;&gt; /dev/null</span><br></pre></td></tr></table></figure>

<p>If using CentOS or Fedora open jail.local and set the backend to systemd. This is not necessary on Debian 8, even though it is a SystemD system.</p>
<p>&#x2F;etc&#x2F;fail2ban&#x2F;jail.local</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backend = systemd</span><br></pre></td></tr></table></figure>

<h4 id="화이트리스트-IP"><a href="#화이트리스트-IP" class="headerlink" title="화이트리스트 IP"></a>화이트리스트 IP</h4><p>먼저 검출된 IP 중에 무시할 영역, 화이트리스트를 선언해 줍니다. 리스트는 ‘,’로 구분하고 서브넷 혹은 IP주소를 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">ignoreip = 127.0.0.1/8 192.168.0.1/24</span><br></pre></td></tr></table></figure>

<h4 id="차단-시간과-재시도-횟수"><a href="#차단-시간과-재시도-횟수" class="headerlink" title="차단 시간과 재시도 횟수"></a>차단 시간과 재시도 횟수</h4><p><code>bantime</code>, <code>findtime</code>, <code>maxretry</code> 은 차단 시간에 대한 구성이다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bantime = 2592000</span><br><span class="line">findtime = 600</span><br><span class="line">maxretry = 3</span><br></pre></td></tr></table></figure>

<ul>
<li>bantime: 검출된 IP가 접속 차단 시간을 초단위로 선언해 준다. <code>-1</code> 이면 영속적으로 밴 된다.</li>
<li>findtime: ban이 설정 전에 로그인 간격 시간</li>
<li>maxretry: 최대 횟수</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://arno0x0x.wordpress.com/2015/12/30/fail2ban-permanent-persistent-bans/">https://arno0x0x.wordpress.com/2015/12/30/fail2ban-permanent-persistent-bans/</a></p>
</blockquote>
<blockquote>
<p>로컬 시스템의 이메일 주소를 sendmail -t <a href="mailto:&#x75;&#115;&#101;&#114;&#64;&#101;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#111;&#109;">&#x75;&#115;&#101;&#114;&#64;&#101;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#111;&#109;</a>, replacing <a href="mailto:&#117;&#115;&#101;&#x72;&#64;&#101;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;">&#117;&#115;&#101;&#x72;&#64;&#101;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#109;</a> with your email address.</p>
</blockquote>
<h4 id="이메일"><a href="#이메일" class="headerlink" title="이메일"></a>이메일</h4><p>fail2ban에 검출되는 jail이 있으면 이메일 설정에 따라 메일로 경고를 받을 수 있다.</p>
<ul>
<li>destemail: The email address where you would like to receive the emails.</li>
<li>sendername: The name under which the email shows up.</li>
<li>sender: The email address from which Fail2ban will send emails.</li>
</ul>
<p>그리고 action 설정을 조절할 필요가 있다, 이것은 ban 상황이 기준점에 닿으면 발생한다. 기본 액션 <code>%(action_)s</code>은 사용자만 ban 한다. action_mw 액션은 ban을 실행하고 WhoIS 리포트로 메일을 보내준다. action_mwl은 모든 로그까지 함께 보내준다.</p>
<p>You will also need to adjudst the action setting, which defines what actions occur when the threshold for ban is met. The default, %(action_)s, only bans the user. action_mw will ban and send an email with a WhoIs report; while action_mwl will ban and send an email with the WhoIs report and all relevant lines in the log file. This can also be changed on a jail-specific basis.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action = %(action_)s</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service fail2ban restart</span><br></pre></td></tr></table></figure>

<h4 id="각-서버스에-대한-Jail-설정"><a href="#각-서버스에-대한-Jail-설정" class="headerlink" title="각 서버스에 대한 Jail 설정"></a>각 서버스에 대한 Jail 설정</h4><p>필터를 이용해 Jail을 만들어 의심스런 접근을 막아 보자. 앞서 복사한 jail.local 파일에는 주요 서비스가 모두 선언되어 있고 sshd 만 활성화 되어 있다.</p>
<p>Jail은 다음 같이 구성된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ssh]</span><br><span class="line"></span><br><span class="line">enabled  = true</span><br><span class="line">port     = ssh</span><br><span class="line">filter   = sshd</span><br><span class="line">logpath  = /var/log/auth.log</span><br><span class="line">maxretry = 6</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>enabled: Determines whether or not the filter is turned on.</li>
<li>port: The port Fail2ban should be referencing in regards to the service. If using the default port, then the service name can be placed here. If using a non-traditional port, this should be the port number. For example, if you moved your SSH port to 3456, you would replace ssh with 3456.</li>
<li>filter: The name of the file located in &#x2F;etc&#x2F;fail2ban&#x2F;filter.d that contains the failregex information used to parse log files appropriately. The .conf suffix need not be included.</li>
<li>logpath: Gives the location of the service’s logs.</li>
<li>maxretry: Will override the global maxretry for the defined service. findtime and bantime can also be added.<br>action: This can be added as an additional setting, if the default action is not suitable for the jail. Additional actions can be found in the action.d folder.</li>
</ul>
<blockquote>
<p>각 서비스에 대한 jail은 <code>jail.d</code>에 설정 파일을 구성해도 된다.</p>
</blockquote>
<p>(1) sshd</p>
<p>Brute-force Attack과 같은 접근을 차단하는 필터로 로그에 아래와 유사한 패턴이 나오면 IP를 검출한다.</p>
<blockquote>
<p>Jul 22 06:56:50 foo sshd[14984]: Failed password for invalid user a from xxx.xxx.xxx.xxx port 55452 ssh2</p>
</blockquote>
<p>jail.config 혹은 jail.local 에서 기본으로 활성화 되어 있다.</p>
<p>(2) ssh-ddos</p>
<p>sshd-ddos Filter를 사용해 SSH Service를 Scanning하거나 telnet으로 접속할 떄 발생하는 Message를 검사하여 해당 IP의 접근을 차단할 수 있습니다.</p>
<p>이 Filter로 검출되는 &#x2F;var&#x2F;log&#x2F;auth.log의 Message는 다음과 같습니다.</p>
<blockquote>
<p>Jul 23 13:16:25 foo sshd[21989]: Did not receive identification string from xxx.xxx.xxx.xxx</p>
</blockquote>
<p>Jail 설정을 위해서 다음과 같이 입력합니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[sshd-ddos]</span><br><span class="line">enabled = true</span><br></pre></td></tr></table></figure>

<p>혹은 $ sudo vi &#x2F;etc&#x2F;fail2ban&#x2F;jail.d&#x2F;sshd-ddos.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service fail2ban restart</span><br></pre></td></tr></table></figure>

<h3 id="Failregrexs"><a href="#Failregrexs" class="headerlink" title="Failregrexs"></a>Failregrexs</h3><p>다양한 필터를 사용할 수있다. 의심스런 동작을 Filter로 선언해서 사용하는데 해당 필터를 점검해야할 필요가 있다. 다음</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf</span><br></pre></td></tr></table></figure>

<p>이 필터를 사용자가 작성할 수 있는데 파이썬의 정규식을 사용해서 사용자 지정 필터를 작성한다.</p>
<h4 id="access-log-필터-작성해-보기"><a href="#access-log-필터-작성해-보기" class="headerlink" title="access.log 필터 작성해 보기"></a>access.log 필터 작성해 보기</h4><p>nginx 로그를 대상으로 200 에러를 검출해 보자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">91.134.232.57 - - [28/Nov/2016:07:30:23 +0900] &quot;GET / HTTP/1.1&quot; 200 1125 &quot;http://hundej</span><br></pre></td></tr></table></figure>

<p>123.143.201.75 - - [28&#x2F;Nov&#x2F;2016:17:29:18 +0900] “HEAD &#x2F; HTTP&#x2F;1.1” 200 0 “-“ “python-requests&#x2F;2.10.0”</p>
<p>fail2ban-regex &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log &#x2F;etc&#x2F;fail2ban&#x2F;filter.d&#x2F;nginx-test.conf</p>
<h3 id="Ban-관리"><a href="#Ban-관리" class="headerlink" title="Ban 관리"></a>Ban 관리</h3><blockquote>
<p>fail2ban-client set YOURJAILNAMEHERE unbanip IPADDRESSHERE</p>
</blockquote>
<p>Use iptables -L -n to find the rule name…<br>…then use fail2ban-client status to get the actual jail names.</p>
<p>룰 이름이 표시된다 <em>f2b-</em> 으로 시작하는 룰을 찾는다</p>
<p>그리고 fail2ban-status 는</p>
<p>fail2ban-client set YOURJAILNAMEHERE unbanip IPADDRESSHERE</p>
<h4 id="HOW-to-fail2ban"><a href="#HOW-to-fail2ban" class="headerlink" title="HOW to fail2ban"></a>HOW to fail2ban</h4><ul>
<li><a target="_blank" rel="noopener" href="http://www.fail2ban.org/wiki/index.php/HOWTOs">http://www.fail2ban.org/wiki/index.php/HOWTOs</a></li>
</ul>
<h2 id="basic-usages"><a href="#basic-usages" class="headerlink" title="basic usages"></a>basic usages</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -L --line-numbers</span><br></pre></td></tr></table></figure>

<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>기본으로 &#x2F;etc&#x2F;fail2ban&#x2F;jail.conf 에 <code>[nginx-http-auth]</code> jail이 하나 선언되어 있다.</p>
<blockquote>
<p>[nginx-http-auth]</p>
<p>enabled &#x3D; true<br>filter &#x3D; nginx-http-auth<br>port &#x3D; http,https<br>logpath &#x3D; &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</p>
</blockquote>
<h3 id="nginx-jail"><a href="#nginx-jail" class="headerlink" title="nginx jail"></a>nginx jail</h3><h4 id="nginx-noscript"><a href="#nginx-noscript" class="headerlink" title="nginx-noscript"></a>nginx-noscript</h4><p>웹 사이트에서 실행되고 침투할 수 있는 코드를 찾아 준다. php 등이 웹 사이트와 연동되지 않았다면 아래 제일을 추가해서 이런 임의의 실행코드 형식 실행을 방지할 수 있다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[nginx-noscript]</span><br><span class="line"></span><br><span class="line">enabled  = true</span><br><span class="line">port     = http,https</span><br><span class="line">filter   = nginx-noscript</span><br><span class="line">logpath  = /var/log/nginx/access.log</span><br><span class="line">maxretry = 6</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="nginx-badbots"><a href="#nginx-badbots" class="headerlink" title="nginx-badbots"></a>nginx-badbots</h4><p>웹 요청에 악의적인 봇을 호출하는 것을 방지한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[nginx-badbots]</span><br><span class="line"></span><br><span class="line">enabled  = true</span><br><span class="line">port     = http,https</span><br><span class="line">filter   = nginx-badbots</span><br><span class="line">logpath  = /var/log/nginx/access.log</span><br><span class="line">maxretry = 2</span><br></pre></td></tr></table></figure>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>추가한 jail 이 동작할 필터를 작업해 주어야 한다. 필터는 &#x2F;etc&#x2F;fail2ban&#x2F;filter.d 디렉토리에 있다.</p>
<h4 id="nginx-http-auth-conf"><a href="#nginx-http-auth-conf" class="headerlink" title="nginx-http-auth.conf"></a>nginx-http-auth.conf</h4><p>기본으로 제공하는 nginx-http-auth.conf 필터에 하나를 더 추가해 준다. 아래는 사용자가 아이디와 비밀번호를 입력하지 않는 경우에 대해 필터한다. 아래의 <strong>no user&#x2F;password</strong> 패턴을 추가한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">failregex = ^ \[error\] \d+#\d+: \*\d+ user &quot;\S+&quot;:? (password mismatch|was not found in &quot;.*&quot;), client: &lt;HOST&gt;, server: \S+, request: &quot;\S+ \S+ HTTP/\d+\.\d+&quot;, host: &quot;\S+&quot;\s*$</span><br><span class="line">            ^ \[error\] \d+#\d+: \*\d+ no user/password was provided for basic authentication, client: &lt;HOST&gt;, server: \S+, request: &quot;\S+ \S+ HTTP/\d+\.\d+&quot;, host: &quot;\S+&quot;\s*$</span><br><span class="line"></span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure>

<h4 id="nginx-badbots-conf"><a href="#nginx-badbots-conf" class="headerlink" title="nginx-badbots.conf"></a>nginx-badbots.conf</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp apache-badbots.conf nginx-badbots.conf</span><br></pre></td></tr></table></figure>

<h4 id="nginx-noscript-1"><a href="#nginx-noscript-1" class="headerlink" title="nginx-noscript"></a>nginx-noscript</h4><p>[nginx-noscript] jail 은 다음 내용을 입력한다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line">failregex = ^&lt;HOST&gt; -.*GET.*(\.php|\.asp|\.exe|\.pl|\.cgi|\.scgi)</span><br><span class="line"></span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure>

<h4 id="nginx-nohome"><a href="#nginx-nohome" class="headerlink" title="nginx-nohome"></a>nginx-nohome</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line">failregex = ^&lt;HOST&gt; -.*GET .*/~.*</span><br><span class="line"></span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure>

<h4 id="nginx-noproxy"><a href="#nginx-noproxy" class="headerlink" title="nginx-noproxy"></a>nginx-noproxy</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Definition]</span><br><span class="line"></span><br><span class="line">failregex = ^&lt;HOST&gt; -.*GET http.*</span><br><span class="line"></span><br><span class="line">ignoreregex =</span><br></pre></td></tr></table></figure>

<h4 id="Jail-실행-확인"><a href="#Jail-실행-확인" class="headerlink" title="Jail 실행 확인"></a>Jail 실행 확인</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-client status</span><br><span class="line">Status</span><br><span class="line">|- Number of jail:  6</span><br><span class="line">`- Jail list:   nginx-noproxy, nginx-noscript, nginx-nohome, nginx-badbots, ssh-ddos, ssh</span><br></pre></td></tr></table></figure>

<p>그리고 iptable의 서비스로 방화벽 규칙에 fail2ban 규칙이 동작중인지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> $ sudo iptables -S</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">-A fail2ban-nginx-badbots -j RETURN</span><br><span class="line">-A fail2ban-nginx-nohome -j RETURN</span><br><span class="line">-A fail2ban-nginx-noproxy -j RETURN</span><br><span class="line">-A fail2ban-nginx-noscript -j RETURN</span><br><span class="line">-A fail2ban-ssh -j RETURN</span><br><span class="line">-A fail2ban-ssh-ddos -j RETURN</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>그리고 fail2ban 의 jail 실행 상태를 자세히 보고 싶므면 status 뒤에 jail 이름을 주면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-client status nginx-badbots</span><br><span class="line">Status for the jail: nginx-badbots</span><br><span class="line">|- filter</span><br><span class="line">|  |- File list:  /var/log/nginx/access.log</span><br><span class="line">|  |- Currently failed: 0</span><br><span class="line">|  `- Total failed: 0</span><br><span class="line">`- action</span><br><span class="line">   |- Currently banned: 0</span><br><span class="line">   |  `- IP list:</span><br><span class="line">   `- Total banned: 0</span><br></pre></td></tr></table></figure>

<h3 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h3><p>의심스런 동작을 Filter로 선언해서 사용하는데 해당 필터를 점검해야할 필요가 있다. 다음</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf</span><br></pre></td></tr></table></figure>

<h4 id="Ban-관리-1"><a href="#Ban-관리-1" class="headerlink" title="Ban 관리"></a>Ban 관리</h4><p>nginx 인증 요구시 잘못된 인증을 시도하면 fail2ban 규칙에 따라 접근이 금지당한다. 그리고 jail 규칙이 잘 적용 됐는지 결과를 다음 같이 확인할 수 있다:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-client status nginx-http-auth</span><br><span class="line">Output</span><br><span class="line">Status <span class="keyword">for</span> the jail: nginx-http-auth</span><br><span class="line">|- filter</span><br><span class="line">|  |- File list:        /var/log/nginx/error.log</span><br><span class="line">|  |- Currently failed: 0</span><br><span class="line">|  \- Total failed:     12</span><br><span class="line">\- action</span><br><span class="line">   |- Currently banned: 1</span><br><span class="line">   |  \- IP list:       111.111.111.111</span><br><span class="line">   \- Total banned:     1</span><br></pre></td></tr></table></figure>

<p>인증 규칙에 어긋나는 접근을 시도한 IP인 <code>111.111.111.111</code>을 확인 할 수 잇다.<br>금지된 IP는 해당 jail을 이용해 다음 같이 해제할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-client <span class="built_in">set</span> nginx-http-auth unbanip 111.111.111.111</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://easyengine.io/tutorials/nginx/fail2ban/">nginx-req-limit</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.ricardomacas.com/index.php?controller=post&action=view&id_post=3">http://blog.ricardomacas.com/index.php?controller=post&amp;action=view&amp;id_post=3</a></p>
<h2 id="fail2squared"><a href="#fail2squared" class="headerlink" title="fail2squared"></a>fail2squared</h2><p><a target="_blank" rel="noopener" href="https://supine.com/posts/2012/08/fail2ban-monitoring-itself-recursively/">https://supine.com/posts/2012/08/fail2ban-monitoring-itself-recursively/</a></p>
<h3 id="TO-COMPLETELY-FLUSH-THE-FAIL2BAN-LOG-FILE-AND-CLEAR-OUR-BLACKLIST-FILE"><a href="#TO-COMPLETELY-FLUSH-THE-FAIL2BAN-LOG-FILE-AND-CLEAR-OUR-BLACKLIST-FILE" class="headerlink" title="TO COMPLETELY FLUSH THE FAIL2BAN LOG FILE AND CLEAR OUR BLACKLIST FILE"></a>TO COMPLETELY FLUSH THE FAIL2BAN LOG FILE AND CLEAR OUR BLACKLIST FILE</h3><p>sudo service fail2ban stop<br>sudo truncate -s 0 &#x2F;var&#x2F;log&#x2F;fail2ban.log<br>sudo truncate -s 0 &#x2F;etc&#x2F;fail2ban&#x2F;ip.blacklist<br>sudo rm &#x2F;var&#x2F;lib&#x2F;fail2ban&#x2F;fail2ban.sqlite3<br>sudo service fail2ban restart</p>
<p><a target="_blank" rel="noopener" href="https://ubuntu101.co.za/security/fail2ban/fail2ban-persistent-bans-ubuntu/">https://ubuntu101.co.za/security/fail2ban/fail2ban-persistent-bans-ubuntu/</a></p>
<h3 id="sqlite3"><a href="#sqlite3" class="headerlink" title="sqlite3"></a>sqlite3</h3><p><em>fail2ban.conf</em> file, I found the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfile = /var/lib/fail2ban/fail2ban.sqlite3</span><br></pre></td></tr></table></figure>

<p>So, I did a little research to try to find out how access the database.</p>
<p>To open or connect to the database:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite3 /var/lib/fail2ban/fail2ban.sqlite3</span><br></pre></td></tr></table></figure>

<p>To list all the tables in the database:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .tables</span><br><span class="line">bans fail2banDb jails logs</span><br></pre></td></tr></table></figure>

<p>To query a table:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; SELECT * FROM logs;</span><br></pre></td></tr></table></figure>

<p>Another table:</p>
<p>sqlite&gt; SELECT * FROM bans;</p>
<p>To disconnect from the database:</p>
<p>sqlite&gt; .quit</p>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><blockquote>
<p>참조: <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-debian-7">https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-debian-7</a></p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://snippets.aktagon.com/snippets/554-how-to-secure-an-nginx-server-with-fail2ban">How to protect Nginx Server with fail2ban</a></li>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-debian-7">How to proect ssh with fail2ban on Debian</a></li>
<li><a target="_blank" rel="noopener" href="http://www.the-art-of-web.com/system/fail2ban/">fail2ban 과 iptables</a></li>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-protect-an-nginx-server-with-fail2ban-on-ubuntu-14-04">Nginx fail2ban jails</a></li>
<li><a target="_blank" rel="noopener" href="http://www.fail2ban.org/wiki/index.php/NginX">Fail2ban Wiki</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-11-22T12:00:00.000Z" title="11/22/2017, 9:00:00 PM">2017-11-22</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:10:15.393Z" title="5/14/2023, 3:10:15 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">3분안에 읽기 (약 386 단어)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/ubuntu-fail2ban-log-0aea850b9007/">fail2ban log</a></p><div class="content"><h1 id="fail2ban-log"><a href="#fail2ban-log" class="headerlink" title="fail2ban log"></a>fail2ban log</h1><p>fail2ban 로그는 아래 형태로</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2016-08-28 12:35:56,163 fail2ban.actions[860]: WARNING [ssh] Ban 103.237.147.19</span><br><span class="line">2016-08-28 12:36:09,215 fail2ban.actions[860]: WARNING [ssh] Ban 115.248.186.3</span><br><span class="line">2016-08-28 17:39:47,806 fail2ban.actions[860]: WARNING [ssh] Ban 117.3.120.94</span><br><span class="line">2016-08-28 23:06:21,291 fail2ban.actions[860]: WARNING [ssh] Ban 155.94.163.64</span><br><span class="line">2016-08-29 19:50:51,400 fail2ban.actions[860]: WARNING [ssh] Ban 182.75.249.110</span><br><span class="line">2016-08-31 14:26:54,093 fail2ban.actions[860]: WARNING [ssh] Ban 103.207.36.36</span><br><span class="line">2016-09-01 02:23:23,790 fail2ban.actions[860]: WARNING [ssh] Ban 45.32.60.93</span><br><span class="line">2016-09-01 17:44:35,854 fail2ban.filter [860]: WARNING Determined IP using DNS Lookup: 61-216-182-218.hinet-ip.hinet.net = [&#x27;61.216.182.218&#x27;]</span><br><span class="line">2016-09-01 17:47:18,004 fail2ban.actions[860]: WARNING [ssh] Ban 61.216.182.218</span><br></pre></td></tr></table></figure>

<h3 id="awk-이용-ip-주소-추출"><a href="#awk-이용-ip-주소-추출" class="headerlink" title="awk 이용 ip 주소 추출"></a>awk 이용 ip 주소 추출</h3><p>awk 를 사용해서 로그에서 ip주소를 추출해 보자. 로그 내용에서 ‘Ban’을 포함한 줄을 만나면 $NF 변수에 각 컨럼을 저장한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$sudo awk &#x27;($(NF-1) = /Ban/)&#123;print $NF&#125;&#x27; /var/log/fail2ban.log</span><br><span class="line">103.237.147.19</span><br><span class="line">115.248.186.3</span><br><span class="line">117.3.120.94</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="IP주소를-정렬"><a href="#IP주소를-정렬" class="headerlink" title="IP주소를 정렬"></a>IP주소를 정렬</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> awk <span class="string">&#x27;($(NF-1) = /Ban/)&#123;print $NF&#125;&#x27;</span> /var/log/fail2ban.<span class="built_in">log</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -n</span><br><span class="line">      1 103.207.36.36</span><br><span class="line">      1 103.237.147.19</span><br><span class="line">      1 115.248.186.3</span><br></pre></td></tr></table></figure>

<ul>
<li>각 거부당한 IP 주소는 최대 실패 횟수 이후 ban 하므로 30회 이상의 시도가 있을</li>
</ul>
<h4 id="모든-백업-로그에서-IP-주소-추출"><a href="#모든-백업-로그에서-IP-주소-추출" class="headerlink" title="모든 백업 로그에서 IP 주소 추출"></a>모든 백업 로그에서 IP 주소 추출</h4><p>백업된 로그 파일을 모두 사용하려면 zgrep 명령을 사용해도 좋다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo zgrep -h &quot;Ban &quot; /var/log/fail2ban.log* | awk &#x27;&#123;print $NF&#125;&#x27; | sort | uniq -c | sort -n</span><br></pre></td></tr></table></figure>

<p>다음은 아주 위험한 서브넷을 출력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$sudo zgrep -h &quot;Ban &quot; /var/log/fail2ban.log* | awk &#x27;&#123;print $NF&#125;&#x27; | awk -F\. &#x27;&#123;print $1&quot;.&quot;$2&quot;.&quot;&#125;&#x27; | sort | uniq -c  | sort -n | tail</span><br><span class="line">      2 222.186.</span><br><span class="line">      3 111.74.</span><br><span class="line">      3 116.100.</span><br><span class="line">      3 182.100.</span><br><span class="line">      3 195.154.</span><br><span class="line">      3 42.117.</span><br><span class="line">      7 115.239.</span><br><span class="line">      8 91.224.</span><br><span class="line">     14 103.207.</span><br><span class="line">     39 221.229.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$sudo zgrep -c 221.229 /var/log/fail2ban.log*</span><br><span class="line">/var/log/fail2ban.log:0</span><br><span class="line">/var/log/fail2ban.log.1:2</span><br><span class="line">/var/log/fail2ban.log.2.gz:0</span><br><span class="line">/var/log/fail2ban.log.3.gz:2</span><br><span class="line">/var/log/fail2ban.log.4.gz:68</span><br></pre></td></tr></table></figure>

<h4 id="전체-로그에-순위-매기기"><a href="#전체-로그에-순위-매기기" class="headerlink" title="전체 로그에 순위 매기기"></a>전체 로그에 순위 매기기</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zcat /var/log/auth.log* | grep <span class="string">&#x27;Failed password&#x27;</span> | grep sshd | awk <span class="string">&#x27;&#123;print $1,$2&#125;&#x27;</span> | <span class="built_in">sort</span> -k 1,1M -k 2n | <span class="built_in">uniq</span> -c</span><br><span class="line"></span><br><span class="line">    161 Mar 20</span><br><span class="line">    202 Mar 21</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h5><ul>
<li><a target="_blank" rel="noopener" href="http://www.the-art-of-web.com/system/fail2ban-log/">http://www.the-art-of-web.com/system/fail2ban-log/</a></li>
</ul>
<h5 id="Multiple-log-file"><a href="#Multiple-log-file" class="headerlink" title="Multiple log file"></a>Multiple log file</h5><p><a target="_blank" rel="noopener" href="http://serverfault.com/questions/486301/how-to-set-up-fail2ban-to-read-multi-log-in-a-jail">http://serverfault.com/questions/486301/how-to-set-up-fail2ban-to-read-multi-log-in-a-jail</a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/categories/OS/Linux/page/0/">이전</a></div><div class="pagination-next"><a href="/categories/OS/Linux/page/2/">다음</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/categories/OS/Linux/">1</a></li><li><a class="pagination-link" href="/categories/OS/Linux/page/2/">2</a></li><li><a class="pagination-link" href="/categories/OS/Linux/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/qkboo_400.png" alt="Gangtai"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gangtai</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Paju, South Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">159</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">238</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/thinkbee" target="_blank" rel="noopener">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/gangtaigoh"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-26T13:00:00.000Z">2024-01-26</time></p><p class="title"><a href="/git_autocrlf-4760600f2cc5/">git 에서 줄바꿈 문제 - CRLF, LF</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/git/">git</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-25T00:40:00.000Z">2023-10-25</time></p><p class="title"><a href="/git-swallow-branch-e1aedce9cb6d/">[git] Swallow clone 과 브랜치</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/git/">git</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-21T00:00:00.000Z">2023-10-21</time></p><p class="title"><a href="/mariadb-json_datatype-4ec2cb4ce08f/">MariaDB - json_datatype 사용</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-20T05:40:00.000Z">2023-10-20</time></p><p class="title"><a href="/git-clone-swallow-010171f10347/">[git] Swallow clone</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/git/">git</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-04T05:00:00.000Z">2023-10-04</time></p><p class="title"><a href="/understranding_unicode-f121f811ea9f/">유니코드 이해하기</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/Python/">Python</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1465716454138955" data-ad-slot="4441624809" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/ETC/"><span class="level-start"><span class="level-item">ETC</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/IT/"><span class="level-start"><span class="level-item">IT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">55</span></span></a><ul><li><a class="level is-mobile" href="/categories/OS/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/Raspberry-Pi/"><span class="level-start"><span class="level-item">Raspberry Pi</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/Windows/"><span class="level-start"><span class="level-item">Windows</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">86</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Angularjs/"><span class="level-start"><span class="level-item">Angularjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/C-C/"><span class="level-start"><span class="level-item">C/C++</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Nodejs/"><span class="level-start"><span class="level-item">Nodejs</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/R/"><span class="level-start"><span class="level-item">R</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/github/"><span class="level-start"><span class="level-item">github</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/thinkbee_logo.png" alt="IT Tech blogging" height="28"></a><p class="is-size-7"><span>&copy; 2024 Gangtai Goh</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-right",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>