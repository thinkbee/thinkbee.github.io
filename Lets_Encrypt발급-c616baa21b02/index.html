<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급 - IT Tech blogging</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="thinkbee blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="thinkbee blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="2020-06-02: 매뉴얼 방식 수정2020-02-02: 최초 작성{:.right-history}  Nginx 서버에서 HTTPS 사용할 수 있는 공인인증서를 발급해 설치하려고 한다.  여기서는 Lets Encrypt 무료 공인인증서 발급을 다룬다. letsecrypt 공인인증서는 3개월 정도 기간만 사용 가능하고 갱신해야 한다. **단독 도메인을 호스"><meta property="og:type" content="article"><meta property="og:title" content="HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급"><meta property="og:url" content="https://blog.thinkbee.kr/Lets_Encrypt%EB%B0%9C%EA%B8%89-c616baa21b02/"><meta property="og:site_name" content="IT Tech blogging"><meta property="og:description" content="2020-06-02: 매뉴얼 방식 수정2020-02-02: 최초 작성{:.right-history}  Nginx 서버에서 HTTPS 사용할 수 있는 공인인증서를 발급해 설치하려고 한다.  여기서는 Lets Encrypt 무료 공인인증서 발급을 다룬다. letsecrypt 공인인증서는 3개월 정도 기간만 사용 가능하고 갱신해야 한다. **단독 도메인을 호스"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://image.status.io/ZsUlrVAwD16p.png"><meta property="article:published_time" content="2020-02-02T09:00:00.000Z"><meta property="article:modified_time" content="2023-05-14T06:14:22.603Z"><meta property="article:author" content="Gangtai Goh"><meta property="article:tag" content="nginx"><meta property="article:tag" content="ssl"><meta property="article:tag" content="https"><meta property="article:tag" content="apache"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://image.status.io/ZsUlrVAwD16p.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thinkbee.kr/Lets_Encrypt%EB%B0%9C%EA%B8%89-c616baa21b02/"},"headline":"HTTPS를 위한 공인인증서 - Let's Encrypt 발급","image":["https://image.status.io/ZsUlrVAwD16p.png"],"datePublished":"2020-02-02T09:00:00.000Z","dateModified":"2023-05-14T06:14:22.603Z","author":{"@type":"Person","name":"Gangtai Goh"},"publisher":{"@type":"Organization","name":"IT Tech blogging","logo":{"@type":"ImageObject","url":"https://blog.thinkbee.kr/images/thinkbee_logo.png"}},"description":"2020-06-02: 매뉴얼 방식 수정2020-02-02: 최초 작성{:.right-history}  Nginx 서버에서 HTTPS 사용할 수 있는 공인인증서를 발급해 설치하려고 한다.  여기서는 Lets Encrypt 무료 공인인증서 발급을 다룬다. letsecrypt 공인인증서는 3개월 정도 기간만 사용 가능하고 갱신해야 한다. **단독 도메인을 호스"}</script><link rel="canonical" href="https://blog.thinkbee.kr/Lets_Encrypt%EB%B0%9C%EA%B8%89-c616baa21b02/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-5ZH90CZ414" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-5ZH90CZ414');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1465716454138955" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/thinkbee_logo.png" alt="IT Tech blogging" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Blog</a><a class="navbar-item" href="/documents">Doc</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="카탈로그" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-four-fifths-tablet is-four-fifths-desktop is-four-fifths-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-02-02T09:00:00.000Z" title="2/2/2020, 6:00:00 PM">2020-02-02</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2023-05-14T06:14:22.603Z" title="5/14/2023, 3:14:22 PM">2023-05-14</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/OS/">OS</a><span> / </span><a class="link-muted" href="/categories/OS/Linux/">Linux</a></span><span class="level-item">16분안에 읽기 (약 2336 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</h1><div class="content"><blockquote>
<p>2020-06-02: 매뉴얼 방식 수정<br><br>2020-02-02: 최초 작성<br>{:.right-history}</p>
</blockquote>
<p>Nginx 서버에서 HTTPS 사용할 수 있는 공인인증서를 발급해 설치하려고 한다.</p>
<ul>
<li>여기서는 Lets Encrypt 무료 공인인증서 발급을 다룬다.</li>
<li>letsecrypt 공인인증서는 3개월 정도 기간만 사용 가능하고 갱신해야 한다.</li>
<li>**<em>단독 도메인을 호스팅하는 개인 서버에서 Nginx</em>**에 적용해 본다.</li>
</ul>
<p>인증서는 <strong>개별 도메인</strong> 혹은 <strong>와일드카드 인증서</strong> 로 도메인 안의 모든 호스트를 포함하는 두 종류로 발급이 가능하다.</p>
<span id="more"></span>

<h1 id="Let’s-Encrypt"><a href="#Let’s-Encrypt" class="headerlink" title="Let’s Encrypt"></a>Let’s Encrypt</h1><p>Let’s Encrypt 는 <a target="_blank" rel="noopener" href="https://letsencrypt.org/">https://letsencrypt.org</a> 에서 여러 인터넷 관련 업체의 후원을 받아 운영하고 있다.</p>
<img src='https://image.status.io/ZsUlrVAwD16p.png' width='200'>

<h2 id="LetsEncrypt-발급"><a href="#LetsEncrypt-발급" class="headerlink" title="LetsEncrypt 발급"></a>LetsEncrypt 발급</h2><p>발급을 위해 리눅스&#x2F;맥 쉘 기반의 Certbot 유틸리티를 사용하거나 웹 기반으로 가능하다. 여기서는 Certbot 를 사용해서 Let’s Encrypt 와일드 카드 인증서를 발급해 보겠다.</p>
<p>인증서를 발급 받기위해서는 Let’s Encrypt 인증서를 자동으로 생성하고 관리하는 패키지인 certbot 를 먼저 설치해야 한다.</p>
<h3 id="우분투-x2F-데비안에서-설치"><a href="#우분투-x2F-데비안에서-설치" class="headerlink" title="우분투&#x2F;데비안에서 설치"></a>우분투&#x2F;데비안에서 설치</h3><p>우분투&#x2F;데이안 같은 리눅스 환경에서 설치하고 구성했다. 기타 다른 오에스 배포판은 아래 사이트에서 설치 명령어를 참고하자.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://certbot.eff.org/">https://certbot.eff.org/</a></li>
</ul>
<p>Certbot 설치:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install software-properties-common</span><br><span class="line">$ sudo add-apt-repository ppa:certbot/certbot</span><br><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>certbot 관련 Apache, Nginx 용 파이썬 모듈을 설치한다.</p>
<p>Nginx 를 운영한다면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-certbot3-nginx   #python3</span><br><span class="line">$ sudo apt-get install python-certbot-nginx</span><br></pre></td></tr></table></figure>

<p>Apache2 를 운영한다면,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-certbot3-apache   #python3</span><br><span class="line">$ sudo apt-get install python-certbot-apache</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="와일드카드-인증서-발급"><a href="#와일드카드-인증서-발급" class="headerlink" title="와일드카드 인증서 발급"></a>와일드카드 인증서 발급</h2><p>와일드카드 인증서는 도메인의 호스트 단위에서 여러 서브 도메인까지 지원하는 인증서이다. 예를 들어 <code>example1.kr</code> 도메인의 하위 도메인 <code>abc.example1.kr</code>, <code>1234.example1.kr</code> 등에 모두 적용하고자 할 때 와일드 카드 인증서를 발급하는 것이다. 이 인증서를 발급 하기 위해서는 도메인 서버를 다루거나 호스팅 기관의 도메인 관리 도구를 통해서 *DNS 레코드* 에 부가적인 정보를 추가해야 한다.</p>
<p>발급 요청시 letsencrypt 는 세 가지 방법으로 webroot와 Standalone, DNS의 3가지 방식으로 적절한 요청을 확인하는 검증 절차를 통해 발급을 인증서를 인가한다.</p>
<ul>
<li>webroot : 도메인 호스트 서버에 임의 Url에 접근해 검증.</li>
<li>standalon:</li>
<li>DNS: 도메인의 DNS 서버에 TXT 필드에 임의의 값 통해 검증.</li>
</ul>
<h3 id="webroot-방식"><a href="#webroot-방식" class="headerlink" title="webroot 방식"></a>webroot 방식</h3><p>웹루트 방식으로 진행하기 전에 먼저 nginx 를 종료해 둔다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl stop nginx</span></span><br></pre></td></tr></table></figure>

<p>다음 certbot 명령에서 수동모드로 도메인 <code>example1.kr</code> 도메인의 와일드카드 인증서와 호스트 example1.kr 에 대해 명령을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># certbot certonly --manual -d &quot;*.example1.kr&quot; -d &quot;example1.kr&quot;</span></span><br></pre></td></tr></table></figure>

<p>수동모드 진행을 시작하면 IP 로깅을 묻는다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">NOTE: The IP of this machine will be publicly logged as having requested this</span><br><span class="line">certificate. If you<span class="string">&#x27;re running certbot in manual mode on a machine that is not</span></span><br><span class="line"><span class="string">your server, please ensure you&#x27;</span>re okay with that.</span><br><span class="line"></span><br><span class="line">Are you OK with your IP being logged?</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">(Y)es/(N)o: Y</span><br></pre></td></tr></table></figure>

<p>이어서 다음 같이 웹 사이트 접근 URL을 통해서 인증하도록 요구한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Create a file containing just this data:</span><br><span class="line"></span><br><span class="line">AyTml9aa0IXw0RjNHERtktSxIxjFAkJvUOVis8dDRLQ.dSiF50fKKa4aji-OuIlgg62idngOi4nR6yzEHRaTLsI</span><br><span class="line"></span><br><span class="line">And make it available on your web server at this URL:</span><br><span class="line"></span><br><span class="line">http://example1.kr/.well-known/acme-challenge/kyTAl9aa0IXw0RjNHERtktSxIxjFAkJvUOVis8dDRLO</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Enter</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>웹 서비스에 파일을 추가하고 내용에 데이터를 넣은후 ngixn 를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start nginx</span></span><br></pre></td></tr></table></figure>

<p>서버측에 검증을 위해 <code>http://example1.kr/.well-known/acme-challenge/kyTAl9aa0IXw0RjNHERtktSxIxjFAkJvUOVis8dDRLO</code> 경로에 텍스트 파일에 내용을 입력한다.</p>
<p>URL 준비가 되면 터미널에서 enter 를 입력하고 정상적으로 인증이 되면 아래 같이 결과를 출력해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Waiting <span class="keyword">for</span> verification...</span><br><span class="line">Cleaning up challenges</span><br><span class="line"></span><br><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">   /etc/letsencrypt/live/example1.kr/fullchain.pem</span><br><span class="line">   Your key file has been saved at:</span><br><span class="line">   /etc/letsencrypt/live/example1.kr/privkey.pem</span><br><span class="line">   Your cert will expire on 2020-09-01. To obtain a new or tweaked</span><br><span class="line">   version of this certificate <span class="keyword">in</span> the future, simply run certbot</span><br><span class="line">   again. To non-interactively renew *all* of your certificates, run</span><br><span class="line">   <span class="string">&quot;certbot renew&quot;</span></span><br><span class="line"> - If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG / Let<span class="string">&#x27;s Encrypt:   https://letsencrypt.org/donate</span></span><br><span class="line"><span class="string">   Donating to EFF:                    https://eff.org/donate-le</span></span><br></pre></td></tr></table></figure>

<p>정상적으로 진행되면 인증서와 개인키 파일이 저장된다:</p>
<ul>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;fullchain.pem</li>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;privkey.pem</li>
</ul>
<p>이 파일을 nginx 서버에 설정에 구성하면 된다.</p>
<hr>
<h3 id="DNS-방식-와일드카드-인증서-요청"><a href="#DNS-방식-와일드카드-인증서-요청" class="headerlink" title="DNS 방식 와일드카드 인증서 요청"></a>DNS 방식 와일드카드 인증서 요청</h3><p>다음 certbot 명령은 도메인 <code>*.example1.com</code> 의 와일드카드 인증서를 요청한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># certbot certonly --manual --preferred-challenges dns -d &quot;*.example1.com&quot; -d &quot;example1.com&quot;</span><br><span class="line"></span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Enter email address (used for urgent renewal and security notices) (Enter &#x27;c&#x27; to</span><br><span class="line">cancel): gangtai.goh@gmail.com</span><br><span class="line"></span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">dns-01 challenge for example1.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>IP 로깅을 묻는다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line">NOTE: The IP of this machine will be publicly logged as having requested this</span><br><span class="line">certificate. If you&#x27;re running certbot in manual mode on a machine that is not</span><br><span class="line">your server, please ensure you&#x27;re okay with that.</span><br><span class="line"></span><br><span class="line">Are you OK with your IP being logged?</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">(Y)es/(N)o: y</span><br></pre></td></tr></table></figure>

<p>IP정보 수집 이후에 DNS의 TXT 레코드에 입력할 코드가 발급된다. 이 코드를 도메인 관리 도구에서 주어지 호스트명에 TXT 레코드에 입력한다.</p>
<ul>
<li>예) 아래는 <code>_acme-challenge.example1.kr</code> 라는 호스트</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"></span><br><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">\_acme-challenge.example1.kr with the following value:</span><br><span class="line"></span><br><span class="line">aOVF_X388V8fYECoTJyArawJ95VpUffyUWqH8Q8bJAa</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Press Enter to Continue</span><br><span class="line">Waiting for verification...</span><br><span class="line">Cleaning up challenges</span><br></pre></td></tr></table></figure>

<p><strong><em>DNS 관리하는 곳에서 서브 도메인 <code>_acme-challenge.example1.kr</code> 에 위에 출력된 해시코드를 TXT 레코드 추가해 준다.</em></strong></p>
<p>적용한 후 아래 같이 <code>dig</code> 같은 네임서버 명령으로 txt 레코드에 추가한 해시코드가 나오는지 확인하고 엔터로 진행한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ dig txt _acme-challenge.example1.kr</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">_acme-challenge.example1.kr. 180 IN	TXT	&quot;aOVF_X388V8fYECoTJyArawJ95VpUffyUWqH8Q8bJAa&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>그리고 발급된 도메인 인증서가 저장된 위치가 나타난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT NOTES:</span><br><span class="line"></span><br><span class="line">- Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">  /etc/letsencrypt/live/example1.com/fullchain.pem</span><br><span class="line">  Your key file has been saved at:</span><br><span class="line">  /etc/letsencrypt/live/example1.com/privkey.pem</span><br><span class="line">  Your cert will expire on 2020-05-23. To obtain a new or tweaked</span><br><span class="line">  version of this certificate in the future, simply run certbot</span><br><span class="line">  again. To non-interactively renew _all_ of your certificates, run</span><br><span class="line">  &quot;certbot renew&quot;</span><br><span class="line">- If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">  Donating to ISRG / Let&#x27;s Encrypt: https://letsencrypt.org/donate</span><br><span class="line">  Donating to EFF: https://eff.org/donate-le</span><br></pre></td></tr></table></figure>

<p>정상적으로 진행되면 인증서와 개인키 파일이 저장된다:</p>
<ul>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;fullchain.pem</li>
<li>&#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;example1.kr&#x2F;privkey.pem</li>
</ul>
<p>이 파일을 nginx 서버에 설정에 구성하면 된다.</p>
<hr>
<h3 id="Let’s-Encrypt-자동갱신"><a href="#Let’s-Encrypt-자동갱신" class="headerlink" title="Let’s Encrypt 자동갱신"></a>Let’s Encrypt 자동갱신</h3><p>Let’s Encrypt 인증서는 발급받으면 기간이 사용할 수 있는 기간이 3개월이다. 계속해서 HTTPS 서비스를 운영하려면 인증서가 만료되기 전에 갱신을 해야 한다.</p>
<p><code>certbot</code> 명령으로 자동으로 갱신할 수 있는데 보통 크론에 등록해 두고 사용할 수 있다. root 권한이 필요하므로 root 계정의 cronttab에 아래와 같은 내용을 추가한다.</p>
<p>아래는 3개월 후 달의 1일에 명령을 실행을 등록했다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 1-12/3 * /bin/bash -l -c <span class="string">&#x27;certbot renew --quiet&#x27;</span></span><br></pre></td></tr></table></figure>

<p>혹은 매달 실행하려면 아래 같이 매달 1일 인증서 갱신 명령어를 실행하도록 해도 될 것 같다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 * * /bin/bash -l -c <span class="string">&#x27;certbot renew --quiet&#x27;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Nginx-설정"><a href="#Nginx-설정" class="headerlink" title="Nginx 설정"></a>Nginx 설정</h2><p>nginx에 와일드 카드 도메인을 사용할 여러 가상호스트가 구성되어 있다는 가정에서 시작한다.</p>
<h3 id="HTTPS-적용하기"><a href="#HTTPS-적용하기" class="headerlink" title="HTTPS 적용하기"></a>HTTPS 적용하기</h3><p>와일드 카드</p>
<p><code>nginx.conf</code> 파일에 SSL이 활성화 되었는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">##</span><br><span class="line"># SSL Settings</span><br><span class="line">##</span><br><span class="line"></span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br></pre></td></tr></table></figure>

<p>실제 적용할 가상호스트 파일의 server 섹션에 다음 같이 인증서 파일을 활성화 한다. 가상호스트 파일이 여러개고 같은 서브 도메인이면 똑같이 적용해 주면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen [::]:443 ssl http2 ipv6only=on;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line"></span><br><span class="line">  	server_name www.exmaple1.com example1.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate  /etc/letsencrypt/live/example1.kr/fullchain.pem;</span><br><span class="line">    ssl_certificate_key  /etc/letsencrypt/live/example1.kr/privkey.pem;</span><br><span class="line">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="http-요청을-https에-리다이렉트"><a href="#http-요청을-https에-리다이렉트" class="headerlink" title="http 요청을 https에 리다이렉트"></a>http 요청을 https에 리다이렉트</h3><p>다음 구성은 <code>http://example1.com</code> 로 들어오는 모든 연결을 <code>https://example1.com</code> 으로 전환하는 구성이다.</p>
<ul>
<li>VirtualHost 별로 아래와 같이 Port 80 에 대한 Server설정과 443에 대한 Server설정을 분리</li>
<li>Port 80 에 대해서는 301 Redirect 설정</li>
<li>Nignx 재시작</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen         80;</span><br><span class="line">    server_name    example1.com example2.com;</span><br><span class="line">    return         301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen [::]:443 ssl http2 ipv6only=on;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name    example1.com example2.com;</span><br><span class="line">     ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ol>
<li><a target="_blank" rel="noopener" href="https://certbot.eff.org/lets-encrypt/debianbuster-nginx">Certbot: Debian Instruction</a></li>
<li><a target="_blank" rel="noopener" href="https://letsencrypt.org/ko/getting-started/">Getting Started 문서</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/nabbisen/let-s-encrypt-wildcard-certificate-with-certbot-plo">Let’s Encrypt Wildcard-certificate-with-certbot</a></li>
<li><a target="_blank" rel="noopener" href="https://community.letsencrypt.org/t/wildcard-domain-step-by-step/58250/4">Wildcard-domain step-by-step</a></li>
<li><a target="_blank" rel="noopener" href="https://www.securesign.kr/guides/NGINX-SSL-Certificate-Install">nginx ssl 설정</a></li>
<li><a target="_blank" rel="noopener" href="https://jootc.com/p/201901062488">Let’s Encrypt 인증서 발급 - Anapche&#x2F;Nginx</a></li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</p><p><a href="https://blog.thinkbee.kr/Lets_Encrypt발급-c616baa21b02/">https://blog.thinkbee.kr/Lets_Encrypt발급-c616baa21b02/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Gangtai Goh</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-02-02</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-05-14</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/nginx/">nginx</a><a class="link-muted mr-2" rel="tag" href="/tags/ssl/">ssl</a><a class="link-muted mr-2" rel="tag" href="/tags/https/">https</a><a class="link-muted mr-2" rel="tag" href="/tags/apache/">apache</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=63bf627f1bc5280019aabbcc&amp;product=sop" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">이 글이 마음에 드시나요? 다음을 통해 후원하실 수 있습니다: </h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/gangtaigoh" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>커피 한 잔 사주기</span></a><a class="button donate" href="/patreon.com/user?u=86716526" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020-03-06-jekyll-mmtheme-macos-2dc78e96c76c/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">macOS에서 Jekyll 설치와 Minimalmistake Theme</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/docker-mongodb-8c17318072e6/"><span class="level-item">Docker 기반 mongodb</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">댓글</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://blog.thinkbee.kr/Lets_Encrypt%EB%B0%9C%EA%B8%89-c616baa21b02/';
            this.page.identifier = 'Lets_Encrypt발급-c616baa21b02/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'qkboo-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">카탈로그</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Let’s-Encrypt"><span class="level-left"><span class="level-item">1</span><span class="level-item">Let’s Encrypt</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#LetsEncrypt-발급"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">LetsEncrypt 발급</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#우분투-x2F-데비안에서-설치"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">우분투/데비안에서 설치</span></span></a></li></ul></li><li><a class="level is-mobile" href="#와일드카드-인증서-발급"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">와일드카드 인증서 발급</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#webroot-방식"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">webroot 방식</span></span></a></li><li><a class="level is-mobile" href="#DNS-방식-와일드카드-인증서-요청"><span class="level-left"><span class="level-item">1.2.2</span><span class="level-item">DNS 방식 와일드카드 인증서 요청</span></span></a></li><li><a class="level is-mobile" href="#Let’s-Encrypt-자동갱신"><span class="level-left"><span class="level-item">1.2.3</span><span class="level-item">Let’s Encrypt 자동갱신</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Nginx-설정"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">Nginx 설정</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#HTTPS-적용하기"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">HTTPS 적용하기</span></span></a></li><li><a class="level is-mobile" href="#http-요청을-https에-리다이렉트"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">http 요청을 https에 리다이렉트</span></span></a></li></ul></li><li><a class="level is-mobile" href="#참고"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">참고</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-27T12:00:00.000Z">2023-07-27</time></p><p class="title"><a href="/jupyterlab_upgrade_3_to_4-10265c5617ef/">Jupyterlab 4 업그레이드 주의 사항.</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/Python/">Python</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-18T04:00:00.000Z">2023-07-18</time></p><p class="title"><a href="/2022-03-01-oracle_xe_installation-b90fe1d48548/">Oracle XE Database 설치 - Windows</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-17T18:00:00.000Z">2023-07-18</time></p><p class="title"><a href="/ubuntu-20.04-cheat_sheet-230a7dc631bf/">Ubuntu 20.04 - Cheat sheet</a></p><p class="categories"><a href="/categories/OS/">OS</a> / <a href="/categories/OS/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-17T10:00:00.000Z">2023-07-17</time></p><p class="title"><a href="/hexo04-modification1-e97f98e3fc30/">hexo 의 icarus theme 수정하기</a></p><p class="categories"><a href="/categories/ETC/">ETC</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-07-17T00:00:00.000Z">2023-07-17</time></p><p class="title"><a href="/mysqlclient_SSH_Tunneling-59f215a18e7e/">MySQL/MariaDB Server SSH Over Tunneling</a></p><p class="categories"><a href="/categories/Programming/">Programming</a> / <a href="/categories/Programming/Database/">Database</a></p></div></article></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1465716454138955" data-ad-slot="4441624809" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/qkboo_400.png" alt="Gangtai"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gangtai</p><p class="is-size-6 is-block">Your title</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">153</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">234</p></a></div></div></nav></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/thinkbee_logo.png" alt="IT Tech blogging" height="28"></a><p class="is-size-7"><span>&copy; 2023 Gangtai Goh</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-right",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>