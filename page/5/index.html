<!doctype html>
<html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Blogging through Programming</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="thinkbee blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="thinkbee blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="website"><meta property="og:title" content="Blogging through Programming"><meta property="og:url" content="https://blog.thinkbee.kr/"><meta property="og:site_name" content="Blogging through Programming"><meta property="og:locale" content="ko_KR"><meta property="og:image" content="https://blog.thinkbee.kr/img/og_image.png"><meta property="article:author" content="Gangtai"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thinkbee.kr"},"headline":"Blogging through Programming","image":["https://blog.thinkbee.kr/img/og_image.png"],"author":{"@type":"Person","name":"Gangtai"},"publisher":{"@type":"Organization","name":"Blogging through Programming","logo":{"@type":"ImageObject","url":"https://blog.thinkbee.kr/images/thinkbee_logo.png"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-1465716454138955" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="navbar-item search" title="검색" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-05-05T00:00:00.000Z" title="2017-5-5 9:00:00">2017-05-05</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:15:34.963Z" title="2022-2-25 1:15:34">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">6분안에 읽기 (약 939 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/05/05/linux-2017-05-05-tmux-cheatsheet/">Tmux cheatsheet</a></h1><div class="content"><blockquote>
<ul>
<li>2017-07-14: 윈도우에서 session 관리</li>
<li>2017-07-10: tmux copy &amp; paste<br>{:.right-history}</li>
</ul>
</blockquote>
<p>터미널 명령은 <code>$ tmux</code> 로 표현하고, Tmux window 에서 Prefix key 키 조합은 는 <em>C</em>{:.keyword} 표기하고, Meta key인 <code>Alt</code>는 <em>M</em>{:.keyword}으로 표기한다 - <a target="_blank" rel="noopener" href="http://localhost:4000/linux/tmux/2017/05/04/tmux-start.html">Tmux Start</a> 참조.</p>
<p>여기서는 <em>.tmux.conf</em> 에서 기능키&#x2F;메타키 연결해서 기본 Prefix key인 <code>Ctrl+b</code> 를 <code>Ctrl+a</code>로 묶었다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g prefix C-a</span><br><span class="line"><span class="built_in">bind</span> C-a send-prefix</span><br><span class="line">unbind C-b</span><br></pre></td></tr></table></figure>



<h2 id="Tmux-명령"><a href="#Tmux-명령" class="headerlink" title="Tmux 명령"></a>Tmux 명령</h2><p>tmux는 세션을 만들고, 세션에서 window를 구성하고, window 안에 pane을 사용한다.</p>
<h3 id="새로운-세션-시작하기"><a href="#새로운-세션-시작하기" class="headerlink" title="새로운 세션 시작하기"></a>새로운 세션 시작하기</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux                        <span class="comment">#새로운 새션</span></span><br><span class="line">$ tmux new -s session_name    <span class="comment">#session_name으로 새로운 세션</span></span><br></pre></td></tr></table></figure>

<p>세션을 dettach하면 세션은 저장된다. 사용하지 않으면 <strong>kill</strong>로 종료한다.</p>
<h3 id="세션-이용하기"><a href="#세션-이용하기" class="headerlink" title="세션 이용하기"></a>세션 이용하기</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tmux <span class="built_in">ls</span></span><br><span class="line">$ tmux list-session</span><br><span class="line">$ tmux list-windows         <span class="comment"># Window 목록</span></span><br></pre></td></tr></table></figure>

<h4 id="열린-세션에-붙기"><a href="#열린-세션에-붙기" class="headerlink" title="열린 세션에 붙기."></a>열린 세션에 붙기.</h4><ul>
<li>세션 번호중 낮은 번호에 우선해서 접속한다.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tmux attach</span><br><span class="line">$ tmux at</span><br><span class="line">$ tmux a</span><br></pre></td></tr></table></figure>

<h4 id="특정-세션에-접속하기"><a href="#특정-세션에-접속하기" class="headerlink" title="특정 세션에 접속하기"></a>특정 세션에 접속하기</h4><ul>
<li>세션 번호 혹은 이름으로 접속한다.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux a -t session_name</span><br></pre></td></tr></table></figure>

<h4 id="세션-마감하기"><a href="#세션-마감하기" class="headerlink" title="세션 마감하기"></a>세션 마감하기</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux kill-session session_name</span><br></pre></td></tr></table></figure>

<p>Tmux로 접속한 session은 처음 한개의 Window를 갖는다. window 안에서 session, window, pane을 관리한다. 각 윈도우는 한 개 이상의 Pane 구획으로 나누어 사용할 수 있다.</p>
<br/>

<h2 id="Tmux-Window"><a href="#Tmux-Window" class="headerlink" title="Tmux Window"></a>Tmux Window</h2><p>현재 세션 이용</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C-s            #Session 목록</span><br><span class="line">C-$            #Session 이름 변경</span><br></pre></td></tr></table></figure>

<h3 id="window-사용하기"><a href="#window-사용하기" class="headerlink" title="window 사용하기"></a>window 사용하기</h3><p>세션에서 여러 윈도우를 추가 해서 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C-c          #새로운 윈도우 생성</span><br></pre></td></tr></table></figure>

<p>여러 윈도우는 윈도우 순서에 따라 현재 윈도우 화면을 교환 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C-w          #윈도우 목록</span><br><span class="line">C-1 ...      #지정 윈도우 번호로 전환: 0,1,...</span><br><span class="line">C-p          #이전 윈도우로 이동</span><br><span class="line">C-n          #다음 윈도우로 이동</span><br><span class="line">C-l          #가장 마지막 윈도우로 이동</span><br><span class="line">C-,          #현재 윈도우 이름 변경</span><br><span class="line">C-&amp;          #현재 윈도우 제거</span><br></pre></td></tr></table></figure>

<p>현재 세션에서 나온다. 세션은 백그라운드에서 실행된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C-d          #현재 세션을 빠져 나온다 (detach)</span><br><span class="line">C-D          #빠져나올 세션을 선택할 수 있다.</span><br></pre></td></tr></table></figure>

<h3 id="Tmux-pane"><a href="#Tmux-pane" class="headerlink" title="Tmux pane"></a>Tmux pane</h3><p>Tmux window를 여러 분할면 pane으로 나눠 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C-%          #수직으로 나누기</span><br><span class="line">C-&quot;          #수평으로 나누기</span><br><span class="line">C-z          #현재 pane 확대 및 돌아오기</span><br><span class="line">C-&#123;          #현재 pane을 이전 pane 위치로 이동</span><br><span class="line">C-&#125;          #현재 pane을 다음 pane 위치로 이동</span><br><span class="line">C-Arrow      #앞,뒤 pane을 방향키로 이동</span><br><span class="line">C-M+Arrow    #pane 크기를 방향키에 따라 변경</span><br><span class="line">C-spacebar   #pane 방향 전환 (수직&lt;-&gt;수평)</span><br><span class="line">C-!          #현재 pane을 새 window로 분리</span><br><span class="line">C-x          #pane 종료</span><br><span class="line">C-[          #pane에서 스크롤 기능을 활성화</span><br></pre></td></tr></table></figure>


<h3 id="Session-transition"><a href="#Session-transition" class="headerlink" title="Session transition"></a>Session transition</h3><p>Tmux window 상태에서 여러 세션 사이의 전환 단축키;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C-$          # 현재 세션 이름 바꾸기</span><br><span class="line">C-(          # 이전 세션으로 전환</span><br><span class="line">C-)          # 다음 세션으로 전환</span><br><span class="line">C-L          # 사용한 세션중 마지막 세션으로 전환</span><br><span class="line">C-s          # 사용 가능한 세션 목록</span><br></pre></td></tr></table></figure>


<h3 id="Tmux-copy-amp-paste"><a href="#Tmux-copy-amp-paste" class="headerlink" title="Tmux copy &amp; paste"></a>Tmux copy &amp; paste</h3><p><code>tmux</code> 는 자체 버퍼에 터미널에서 선택한 영역의 텍스트를 복사해서 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C-[         # copy mode</span><br><span class="line">Ctrl+space  # 복사할 영역을 선택한다. 터미널에 영역이 선택되어 보인다.</span><br><span class="line">Ctrl+w      # 선택한 영역을 복사한다.</span><br><span class="line">C-]         # 붙여 넣는다.</span><br></pre></td></tr></table></figure>

<p>단, 시스템 버퍼는 별도의 플러그인을 사용한다.</p>
<h4 id="Copy-with-mouse-drag"><a href="#Copy-with-mouse-drag" class="headerlink" title="Copy with mouse drag"></a>Copy with mouse drag</h4><p><strong>mouse mode</strong>를 활성화 하면 터미널에서 마우스 드래그로 텍스트를 선택하면 tmux buffer에 복사되게 한다. <em>.tmux.conf</em> 파일에 다음 구성을 추가한다:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g mouse on</span><br></pre></td></tr></table></figure>


<!--
## 참조

 [spicycode/tmux.conf](https://gist.github.com/spicycode/1229612) 
 [My Tmux Configuration](http://zanshin.net/2013/09/05/my-tmux-configuration/)--></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-05-03T22:00:00.000Z" title="2017-5-4 7:00:00">2017-05-04</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:15:34.962Z" title="2022-2-25 1:15:34">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">18분안에 읽기 (약 2733 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/05/04/linux-2017-05-04-tmux-start/">Tmux Start</a></h1><div class="content"><blockquote>
<p>2017-07-10: tmux-continum 추가<br>{:.right-history}</p>
</blockquote>
<p>Tmux는 terminal multiplexer로 서버에 여러 프로그램을 세션에 저장하고, 다른 작업 혹은 연결을 끊었다 다시 접속해서 세션을 열어 작업을 이어갈 수 있다.</p>
<p><img src="https://tmux.github.io/ss-tmux2.png">{: width&#x3D;”600”}</p>
<p>[그림. Tmux 실행 모습  (tmux.github.io)]</p>
<h2 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h2><p>여기서는 tmux 2.x 이상을 사용한다.</p>
<ul>
<li>Ubuntu 14.04, Raspbian Jessie, Armbian 등에서 tmux가 1.8, 1.9 버전이 제공</li>
<li>Ubuntu 15, 16 Xenivior 버전은 Tmux 2.1</li>
<li>macOS는 <code>brew</code> 를 사용한다.</li>
</ul>
<h3 id="Tmux-2-3-설치"><a href="#Tmux-2-3-설치" class="headerlink" title="Tmux 2.3 설치"></a>Tmux 2.3 설치</h3><p>이전 Ubuntu 14.04, Raspbian 등에서 tmux가 1.8, 1.9 버전이 제공되는데 package manager 같은 기능을 사용할 수 없다. 소스로 빌드해서 사용할 수 있다.</p>
<blockquote>
<p>Ubuntu 14.04 desktop, orangepi plus, raspberry pi jessie 초기 버전에서 빌드</p>
</blockquote>
<h4 id="소스-설치"><a href="#소스-설치" class="headerlink" title="소스 설치"></a>소스 설치</h4><p>혹시 모르니 기존 낮은 버전의 tmux를 삭제하고 시작해 보자.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt remove --purge tmux</span><br></pre></td></tr></table></figure>

<p>소스를 <a target="_blank" rel="noopener" href="https://github.com/tmux/tmux/releases/">https://github.com/tmux/tmux/releases/</a> 에서 최신 버전으로 다운로드 하고 빌드한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y libevent-dev libncurses-dev</span><br><span class="line">wget https://github.com/tmux/tmux/releases/download/2.3/tmux-2.3.tar.gz</span><br><span class="line">tar xvzf tmux-2.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> tmux-2.3/</span><br><span class="line">./configure &amp;&amp; make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>


<h4 id="deb-바이너리-설치"><a href="#deb-바이너리-설치" class="headerlink" title="deb 바이너리 설치"></a>deb 바이너리 설치</h4><blockquote>
<p>단, libtinfo5 6.x 설치시 의존성 라이브러리 문제로 패키지 삭제 문제 발생!!!</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://launchpad.net/ubuntu/yakkety/amd64/tmux/2.2-3">https://launchpad.net/ubuntu/yakkety/amd64/tmux/2.2-3</a> 에 빌드되어 있는 바이너리를 Ubuntu 14.04 설치하기 위해서 다음 패키지 버전이 필요하다.</p>
<p>Depends on:</p>
<ul>
<li>libc6 (&gt;&#x3D; 2.14)</li>
<li>libevent-2.0-5 (&gt;&#x3D; 2.0.10-stable)</li>
<li>libtinfo5 (&gt;&#x3D; 6)</li>
<li>libutempter0 (&gt;&#x3D; 1.1.5)</li>
</ul>
<blockquote>
<p>기본 설치후 업그레이드를 했다면 libc6 버전은 문제가 없는듯.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-cache show libc6</span><br><span class="line">$ sudo apt-cache show libtinfo5</span><br></pre></td></tr></table></figure>

<p>Ubuntu14.04.4 LTS 버전의 libtinfo5는 5.9로 다음 같이 설치해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://launchpadlibrarian.net/271601076/libtinfo5_6.0+20160625-1ubuntu1_amd64.deb</span><br></pre></td></tr></table></figure>

<p>그리고 tmux 2.2 버전의 deb 를 다운로드한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://launchpadlibrarian.net/263289132/tmux_2.2-3_amd64.deb</span><br></pre></td></tr></table></figure>

<p>설치</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkb -i libtinfo5_6.0+20160625-1ubuntu1_amd64.deb</span><br><span class="line">$ sudo dpkb -i tmux_2.2-3_amd64.deb</span><br></pre></td></tr></table></figure>

<p>이제 <code>tmux</code> 명령으로 다중 터미널 명령을 사용할 수 있다.</p>
<h4 id="macOS에서-tmux-설치"><a href="#macOS에서-tmux-설치" class="headerlink" title="macOS에서 tmux 설치"></a>macOS에서 tmux 설치</h4><p>homebrew를 사용해서 tmux를 설치한다. 2017년 현재 2.4 버전이 설치된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install tmux</span><br></pre></td></tr></table></figure>

<p>이제 tmux 명령으로 시작할 수 있다.</p>
<h2 id="시작"><a href="#시작" class="headerlink" title="시작"></a>시작</h2><p>tmux 를 시작하면 하나의 세션에 하나의 윈도우가 만들어 진다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux                   # 세션을 시작하고 참가한다.</span><br><span class="line">$ tmux new -s foo        # 세션 foo를 시작하고 참가한다</span><br></pre></td></tr></table></figure>

<p>세션에 참가하면 하나 혹은 그 이상의 윈도우에서 Pane을 배치해 사용할 수 있다.</p>
<p><img src="/images/tmux/tmux-screen-layout.png">{: width&#x3D;”600”}<br>[그림. Tmux window layout]</p>
<h4 id="Control와-Meta-key"><a href="#Control와-Meta-key" class="headerlink" title="Control와 Meta key"></a>Control와 Meta key</h4><p>Tmux 세션 참가후 Window에서는 Prefix key로 Session, Window, Pane 관련 명령을 키로 조합해 사용한다. 기본 Prefix key는 <code>Control+b</code> key고 옵션으로 사용하는 Meta key는 <code>Alt</code> 키 이다. </p>
<p>여기서 Prefix key는 <strong>C</strong>와 조합으로 표기하고, Meta key인 <code>Alt</code>는 <strong>M</strong>으로 표기한다.</p>
<p>윈도우 명령 control, meta 키 조합과 병행해 윈도우에서 명령모드를 사용할 수 있다. 명령모드는 <strong>C-:</strong> 키로 시작하고, 명령모드에서 <strong>명령 자동 완성</strong>을 지원한다.</p>
<p><img src="/images/tmux/tmux-screen-command-window2.png">{: width&#x3D;”600”}<br>[그림. Window command mode]</p>
<h4 id="Pane-다루기"><a href="#Pane-다루기" class="headerlink" title="Pane 다루기"></a>Pane 다루기</h4><p>윈도우는 수직&#x2F;수평으로 구획을 나눌수 있다. <strong>C-“</strong> 키로 현재 Pane 아래에 수평으로 새 Pane을 나눈다. 그리고 **C-%**키로 수직으로 새 Pane을 나눌 수 있다.</p>
<p><img src="/images/tmux/tmux-screen-pane.png">{: width&#x3D;”600”}<br>[그림. Tmux Window Pane]</p>
<ul>
<li>C-q : pane 번호를 표시하고 번호를 눌러서 이동</li>
<li>C-o : pane을 순서대로 이동</li>
<li>C-방향키 : 해당 방향으로 이동</li>
<li>C-M-방향키 : 해당 방향으로 크기 조절</li>
<li>C-M-1~5 : 몇 가지 미리 설정된 레이아웃을 고를 수 있고, prefix space로 이 레이아웃을 순서대로 - 돌아가며 선택 가능</li>
<li>C-z : 특정화면만 확대하기 다시 예전 Panes상태로 돌아오기</li>
</ul>
<p>Pane을 지우려면 터미널 <code>exit</code> 명령 혹은 <strong>C-x</strong> 키로 빠져 나올 수 있다.</p>
<h4 id="Window-다루기"><a href="#Window-다루기" class="headerlink" title="Window 다루기"></a>Window 다루기</h4><p>윈도우는 명령모드에서 <code>new-window</code> 혹은 <strong>C-c</strong> 키로 새 윈도우를 추가할 수 있다.</p>
<p><img src="/images/tmux/tmux-screen-new-window2.png">{: width&#x3D;”600”}<br>[그림. new Window ]</p>
<p>윈도우 사이의 이동은 윈도우 번호에 따라 단축키 <strong>C-0,1,2…9</strong>를 사용하거나 <strong>C-w</strong>로 윈도우 목록에서 선택해 이동할 수 있다.</p>
<ul>
<li>C-n, C-p : 다음 윈도우, 이전 윈도우로 이동</li>
<li>C-l : 직전 사용하던 윈도우로 이동</li>
<li>C-w : 윈도우 리스트를 띄우고 선택</li>
<li>C-, : 윈도우 이름 바꾸기</li>
</ul>
<p>세션 사용중에 세션을 빠져 나오려면 <strong>C-d</strong> 로 detach 하거나, 명령모드 <code>C-:</code>에서 detach 명령을 준다.</p>
<h4 id="복사와-스크롤"><a href="#복사와-스크롤" class="headerlink" title="복사와 스크롤"></a>복사와 스크롤</h4><p>Tmux 화면 버퍼는 한 화면분 밖에 안되서, 이전 화면 내용을 보려면 스크롤 기능을 켜야 한다. <strong>C+[</strong> 키는 스크롤 키고, 우측상단에 페이지 표시가 나타난다. 키보드 방향키나 Page Up&#x2F;Down키로 스크롤이 가능하다.</p>
<p><img src="/images/tmux/tmux-scroll.png"></p>
<h4 id="세션-연결"><a href="#세션-연결" class="headerlink" title="세션 연결"></a>세션 연결</h4><p>세션은 하나 혹은 그 이상 만들고 <code>attach</code> 명령으로 세션에 참가할 수 있다. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tmux new -s foo -d     # 세션 foo를 시작하고 빠져나온다.</span><br><span class="line">$ tmux ls                # 세션 목록을 출력한다.</span><br><span class="line">0: 1 windows (created Fri May 12 10:26:00 2017) [80x24] (attached)</span><br><span class="line">foo: 1 windows (created Fri May 12 10:34:18 2017) [80x24]</span><br></pre></td></tr></table></figure>

<p>터미널에서 세션에 참가하려면 <code>attach</code> 명령과 대상 세션을 지정해 준다. 대상 세션은 <code>tmux ls</code> 명령에 표시되는 세션번호 혹은 세션이름을 지정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tmux attach</span><br><span class="line">$ tmux attach -t 0       # 세션 0번에 참여한다</span><br><span class="line">$ tmux attach -t foo     # 세션 foo에 참여한다.</span><br></pre></td></tr></table></figure>

<p>세션을 완전히 종료 시키려면, tmux 세션에서 명령모드 <strong>C-:</strong> 에서 <em>kill-session</em> 명령을 실행한다.<br>혹은 다른 터미널에서 세션번호 혹은 세션 이름으로 종료한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux kill-session -t 3   # 세션번호 3을 종료한다.</span><br></pre></td></tr></table></figure>



<h3 id="설정파일-tmux-conf"><a href="#설정파일-tmux-conf" class="headerlink" title="설정파일 .tmux.conf"></a>설정파일 <strong>.tmux.conf</strong></h3><p>사용자 홈디렉토리에 <em>.tmux.conf</em> 파일에 tmux에 대한 설정을 명시할 수 있다.</p>
<h4 id="Control-a-사용하기"><a href="#Control-a-사용하기" class="headerlink" title="Control + a 사용하기"></a>Control + a 사용하기</h4><p>Capslock키를 Control 키로 대체해 사용하면, Control+a 키 조합이 편하다. .tmux.conf 에 키 조합을 변경한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#Control+a에 &#x27;prefix&#x27; 연결</span><br><span class="line">set -g prefix C-a</span><br><span class="line">#send-prefix를 Control+a에 전달</span><br><span class="line">bind C-a send-prefix</span><br><span class="line">unbind C-b</span><br></pre></td></tr></table></figure>

<p>위에서 prefix는 <strong>C-a</strong> 로 재배치된다.</p>
<h4 id="Mouse-On-x2F-Off"><a href="#Mouse-On-x2F-Off" class="headerlink" title="Mouse On&#x2F;Off"></a>Mouse On&#x2F;Off</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Toggle mouse on with META m</span><br><span class="line">bind m \</span><br><span class="line">    set-option -g mouse on \;\</span><br><span class="line">    display &#x27;Mouse: ON&#x27;</span><br><span class="line"></span><br><span class="line"># Toggle mouse off with META M</span><br><span class="line">bind M \</span><br><span class="line">    set-option -g mouse off \;\</span><br><span class="line">    display &#x27;Mouse: OFF&#x27;</span><br></pre></td></tr></table></figure>




<h2 id="Plugin-manager"><a href="#Plugin-manager" class="headerlink" title="Plugin manager"></a>Plugin manager</h2><p><a target="_blank" rel="noopener" href="https://github.com/tmux-plugins/tpm">Tmux Pluin Manager</a> 를 설치하고, tmux 기능을 확장할 수 있다.</p>
<h3 id="tpm-설치"><a href="#tpm-설치" class="headerlink" title="tpm 설치"></a>tpm 설치</h3><p>먼저 사용자 홈 디렉토리에 저장한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm</span><br></pre></td></tr></table></figure>

<p>다음 설정을 tmux.conf 에 저장한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># List of plugins</span><br><span class="line">set -g @plugin &#x27;tmux-plugins/tpm&#x27;</span><br><span class="line">set -g @plugin &#x27;tmux-plugins/tmux-sensible&#x27;</span><br><span class="line">set -g @plugin &#x27;tmux-plugins/tmux-resurrect&#x27;</span><br><span class="line"></span><br><span class="line"># Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)</span><br><span class="line">run &#x27;~/.tmux/plugins/tpm/tpm&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="plugin-관리"><a href="#plugin-관리" class="headerlink" title="plugin 관리"></a>plugin 관리</h4><p>플러그인 설치를 위해서 <strong>C-I</strong> (대문자) 를 실행<br>플러그인 업그레이드를 위해서 <strong>C-U</strong> 를 실행</p>
<ul>
<li>플러그인 목록에서 플러그인을 선택하고 C-M-u (소문자)</li>
</ul>
<h3 id="Tmux-Resurrection"><a href="#Tmux-Resurrection" class="headerlink" title="Tmux-Resurrection"></a>Tmux-Resurrection</h3><p><em>tmux-resurrect</em>{:.keyword}는 tmux 세션을 백업&#x2F;복구 할 수 있는 플러그인이다. tmux.conf에 다음을 추가</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g @plugin <span class="string">&#x27;tmux-plugins/tmux-resurrect&#x27;</span></span><br></pre></td></tr></table></figure>

<p>플러그인 설치를 위해서 <strong>C-I</strong> 를 실행하면 설치를 시작한다.</p>
<p>Resurrection 플러그인으로 백업&#x2F;복구하는 키는 다음 같이 지정되어 있다:</p>
<ul>
<li>C-s : save</li>
<li>C-r : restore</li>
</ul>
<h3 id="Tmux-continuum"><a href="#Tmux-continuum" class="headerlink" title="Tmux-continuum"></a>Tmux-continuum</h3><p><em>tmux-resurrect</em>{:.keyword} 에서 저장한 환경을 자동으로 저장&#x2F;복구할 수 있는 플러그인이다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/tmux-plugins/tmux-continuum">tmux-continuum</a></li>
</ul>
<p><em>tmux-continuum</em>{:.keyword} 의 주요 기능은:</p>
<ul>
<li><em>tmux</em>{:.keyword} 환경을 15분 마다 자동 저장</li>
<li>컴퓨터&#x2F;서버 시작시 <em>tmux</em>{:.keyword} 자동 시작</li>
<li><em>tmux</em>{:.keyword} 시작시 자동 복구</li>
<li><strong>tmux 1.9</strong> 이상, bash, <strong>tmux-resurrect</strong> plugin</li>
</ul>
<h4 id="설치-1"><a href="#설치-1" class="headerlink" title="설치"></a>설치</h4><p><strong>.tmux.conf</strong> 파일에 아래 플러그인을 추가:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g @plugin <span class="string">&#x27;tmux-plugins/tmux-resurrect&#x27;</span></span><br><span class="line"><span class="built_in">set</span> -g @plugin <span class="string">&#x27;tmux-plugins/tmux-continuum&#x27;</span></span><br></pre></td></tr></table></figure>

<p>tmux 에서 플러그인 설치를 위해서 <strong>C-I</strong> (대문자) 를 실행</p>
<p>그리고 <strong>.tmux.conf</strong> 파일에 continuum-restore 을 on으로 해준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g @continuum-restore <span class="string">&#x27;on&#x27;</span></span><br></pre></td></tr></table></figure>

<p>tmux 세션을 모두 나와서 tmux 서버를 모두 <code>kill-session</code> 같은 명령으로 종료시킨후 tmux를 다시 시작하면 <code>.tmux/resurrect</code> 에 저장된 마지막 세션이 복구되는 것을 확인할 수 있다.</p>
<p>이제부터 15분 마다 자동 저장하고 서버를 재시작한 후에 tmux를 다시 시작하면 저장한 환경을 자동으로 복구해 준다.</p>
<h4 id="tmux-status-표시"><a href="#tmux-status-표시" class="headerlink" title="tmux status 표시"></a>tmux status 표시</h4><p>tmux-continuum 의 상태를 tmux status line에 표시할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g status-right <span class="string">&#x27;Continuum status: #&#123;continuum_status&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="Linux에서-tmux-자동-시작"><a href="#Linux에서-tmux-자동-시작" class="headerlink" title="Linux에서 tmux 자동 시작"></a>Linux에서 tmux 자동 시작</h4><p>tmux-continuum 은 Linux systemd, macOS 에서 자동 시작을 지원한다.</p>
<p>Linux는 <code>.tmux.conf</code> 파일에 다음 부트 옵션을 추가한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g @continuum-boot <span class="string">&#x27;on&#x27;</span></span><br></pre></td></tr></table></figure>

<p>그리고 현재 실행중인 세션에 변경한 설정을 적용하려면</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux source-file ~/.tmux.conf</span><br></pre></td></tr></table></figure>


<h4 id="macOS에서-tmux-자동-시작"><a href="#macOS에서-tmux-자동-시작" class="headerlink" title="macOS에서 tmux 자동 시작"></a>macOS에서 tmux 자동 시작</h4><p><code>.tmux.conf</code> 파일에 다음 부트 옵션을 추가한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g @continuum-boot <span class="string">&#x27;on&#x27;</span></span><br></pre></td></tr></table></figure>

<p>그리고 현재 실행중인 세션에 변경한 설정을 적용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux source-file ~/.tmux.conf</span><br></pre></td></tr></table></figure>

<p>맥이 재시작 하면 자동으로 <code>Terminal.app</code> 이 실행된다. 터미널 크기는 다음 옵션으로 지정한다:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -g @continuum-boot-options <span class="string">&#x27;fullscreen&#x27;</span> <span class="comment"># terminal window will go fullscreen</span></span><br><span class="line"><span class="built_in">set</span> -g @continuum-boot-options <span class="string">&#x27;iterm&#x27;</span>    <span class="comment"># start iTerm instead of Terminal.app</span></span><br><span class="line"><span class="built_in">set</span> -g @continuum-boot-options <span class="string">&#x27;iterm,fullscreen&#x27;</span> <span class="comment"># start iTerm in fullscreen</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="다중-tmux-서버는-지원하지-않는다"><a href="#다중-tmux-서버는-지원하지-않는다" class="headerlink" title="다중 tmux 서버는 지원하지 않는다."></a>다중 tmux 서버는 지원하지 않는다.</h4><p>tmux 로 서버를 하나 시작하고, <code>tmux -S /tmp/foo</code> 같이 다른 소켓을 사용했다고 자동 저장&#x2F;복구가 별도로 진행되지 않는다. [^10]</p>
<blockquote>
<p>여기까지 설정한 내용은 <a target="_blank" rel="noopener" href="https://gist.github.com/qkboo/9915a6f76cd9b7e4986965e8f5e95f2e">qkboo&#x2F;tmux.conf</a> gist 에서 확인 가능.</p>
</blockquote>
<br/>
### 설정 저장

<p>tmux 설정을 위힌 default 파일이 존재하지 않는다는 점이다. 그래서 tmux 기본 설정을 어딘가 추출해서 보관해두면 다시 돌아오는데 편리하다. 현재 tmux에 설정된 값은 다음 명령어로 추출할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux show -g | sed &#x27;s/^/set-option -g /&#x27; &gt; ~/.tmux.current.conf</span><br></pre></td></tr></table></figure>

<p>tmux.conf를 적용하는 명령은 source-file이다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tmux source-file ~/.tmux.current.conf</span><br></pre></td></tr></table></figure>



<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://blog.hawkhost.com/2010/06/28/tmux-the-terminal-multiplexer/">Tmux-Part1</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.hawkhost.com/2010/07/02/tmux-%E2%80%93-the-terminal-multiplexer-part-2/">Tmux-Part2</a></li>
<li><a target="_blank" rel="noopener" href="http://gypark.pe.kr/wiki/Tmux">Tmux 소개</a></li>
<li><a target="_blank" rel="noopener" href="http://haruair.com/blog/3437">tmux 사용에 도움되는 설정과 플러그인 정리</a></li>
<li><a target="_blank" rel="noopener" href="http://superuser.com/questions/209437/how-do-i-scroll-in-tmux">스크롤에 대한 의견</a></li>
<li><a target="_blank" rel="noopener" href="http://seonhyu-blog.tumblr.com/post/34612062806/%EB%A7%A5%EC%97%90%EC%84%9C-tmux-%ED%95%9C%EA%B8%80-%ED%8C%8C%EC%9D%BC%EB%AA%85-%EC%B6%9C%EB%A0%A5-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0">tmux-한글-파일명-출력-문제-해결하기</a></li>
</ul>
<p>[^10]: <a target="_blank" rel="noopener" href="https://github.com/tmux-plugins/tmux-continuum/blob/master/docs/multiple_tmux_servers.md">Behaviro when running multiple tmux servers</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-21T00:00:00.000Z" title="2017-4-21 9:00:00">2017-04-21</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:42:17.377Z" title="2022-2-25 1:42:17">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">19분안에 읽기 (약 2860 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/21/linux-2017-04-21-mongodb-collections/">mongodb - Collection</a></h1><div class="content"><h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><p>mongoDB는<br>mongoDB는 Collection 이 데이터베이스 테이블과 같은 개념이다. 아래 테이블은 관계형 데이터베이스 MySQL과 MongoDB의 개념을 비교해 주고 있다. [^1]</p>
<table>
<thead>
<tr>
<th>MySQL</th>
<th>MongoDB</th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td>Collection</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
</tr>
<tr>
<td>Joins</td>
<td>Embedded documents, linking</td>
</tr>
</tbody></table>
<h3 id="늦은-데이터베이스-생성-Lazy-Creation"><a href="#늦은-데이터베이스-생성-Lazy-Creation" class="headerlink" title="늦은 데이터베이스 생성 Lazy Creation"></a>늦은 데이터베이스 생성 Lazy Creation</h3><p><code>use</code> 명령은 데이터베이스가 존재하지 않으면 새로운 데이터베이스를 생성하고, 그리고 해당 데이터베이스로 전환한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; use mydb</span><br><span class="line">switched to db mydb</span><br></pre></td></tr></table></figure>

<p>그러나 mongodb는 <strong>lazy creation</strong> 방식을 채용해서 실제 데이터가 CRUD로 조작 될 때 컬렉션이 데이터베이스에 생성된다. <code>use DATABASE</code> 명령 만으로는 실제 데이터 저장공간이 만들어 지지 않는다. 아래같이 <code>show dbs</code> 를 실행해도 데이터베이스가 검색되지 않는다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; use first;</span><br><span class="line">switched to db first</span><br><span class="line"></span><br><span class="line">&gt; show dbs;</span><br><span class="line">local   (empty)</span><br><span class="line">test    <span class="number">0.</span>203125GB</span><br></pre></td></tr></table></figure>

<p>아래와 같이 <code>collection.save()</code> 함수로 새로운 컬렉션에 도큐멘트을 생성하면 데이터베이스 저장 공간에 컬렉션 안에 도큐멘트가 생성되면서 실제 데이터가 저장된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">first</span>.<span class="title function_">save</span>(&#123; <span class="attr">hello</span>: <span class="string">&quot;Hello, Mongodb&quot;</span>&#125;);</span><br><span class="line">&gt; show dbs;</span><br><span class="line">first   <span class="number">0.</span>203125GB</span><br><span class="line">local   (empty)</span><br><span class="line">test    <span class="number">0.</span>203125GB</span><br></pre></td></tr></table></figure>

<p>현재 <code>use</code> 로 사용 중인 데이터베이스는 <code>dropDatabase()</code> 함수로 데이터베이스를 삭제할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; use first</span><br><span class="line">switched to db first</span><br><span class="line">&gt; db.<span class="title function_">dropDatabase</span>(<span class="params"></span>)</span><br><span class="line">&#123; <span class="string">&quot;dropped&quot;</span> : <span class="string">&quot;first&quot;</span>, <span class="string">&quot;ok&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&gt; show dbs</span><br></pre></td></tr></table></figure>

<h3 id="Collection과-Documents"><a href="#Collection과-Documents" class="headerlink" title="Collection과 Documents"></a>Collection과 Documents</h3><p>mongoDB에 저장되는 도큐멘트는 JSON ojbect 와 유사하게 <em>속성:값</em> 형태로 구성된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> n = &#123; <span class="attr">name</span>: <span class="string">&quot;Ed&quot;</span>, <span class="attr">languages</span>: [<span class="string">&quot;c&quot;</span>, <span class="string">&quot;ruby&quot;</span>, <span class="string">&quot;js&quot;</span>] &#125;;</span><br><span class="line"><span class="keyword">var</span> student = &#123; <span class="attr">name</span>: <span class="string">&quot;Jim&quot;</span>, <span class="attr">scores</span>: [<span class="number">75</span>, <span class="number">99</span>, <span class="number">87.2</span>] &#125;;</span><br></pre></td></tr></table></figure>

<p>mongoDB는 document를 컬렉션에 저장한다.</p>
<h4 id="collection-save"><a href="#collection-save" class="headerlink" title="collection.save()"></a>collection.save()</h4><p>아래는 <code>collection.save()</code> 함수로 <em>{a: 99}</em> 도큐멘트를 <em>scores</em> 렉션에 저장하라는 명령이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">scores</span>.<span class="title function_">save</span>(&#123; <span class="attr">a</span>: <span class="number">99</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>실제 데이터베이스의 컬렉션에 도큐멘트가 저장될 때는 바이너리 직렬 구조인 <em>Binary JSON</em>이라는 BSON 으로 저장된다.[^5]</p>
<p>그리고 해당 콜렉션의 담긴 도큐멘트를 <code>find()</code> 함수로 출력한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br></pre></td></tr></table></figure>

<p>반복문을 이용해서 여러개의 documents를 저장할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(i=0; i&lt;100; i++) &#123; db.scores.save( &#123;a:  i, exam: 5 &#125; ) &#125;;</span><br></pre></td></tr></table></figure>

<p>컬렉션 내용을 find()를 실행하면 10개의 결과가 출력됩니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;db.<span class="property">scores</span>.<span class="title function_">save</span>(&#123;<span class="attr">a</span>:i,<span class="attr">b</span>:<span class="string">&#x27;bbb&#x27;</span>&#125;)&#125;;</span><br><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>이렇게 데이터베이스에 저장된 컬렉션을 관계형 데이터베이스 처럼 CRUD 명령 셋트를 이용해 질의를 해서 사용한다.</p>
<h3 id="Basic-Queries"><a href="#Basic-Queries" class="headerlink" title="Basic Queries"></a>Basic Queries</h3><p>관계형데이터 베이스와 NoSQL 데이터베이스는 Query Language가 다르다.</p>
<h4 id="SQL과-NoSQL의-CRUD"><a href="#SQL과-NoSQL의-CRUD" class="headerlink" title="SQL과 NoSQL의 CRUD"></a>SQL과 NoSQL의 CRUD</h4><p>SQL의 INSERT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (user_id, age, status) <span class="keyword">VALUES</span> (<span class="string">&#x27;bcd001&#x27;</span>, <span class="number">45</span>, <span class="string">&#x27;A&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>mongoDB의 INSERT</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">insert</span>(&#123;</span><br><span class="line">  <span class="attr">user_id</span>: <span class="string">&quot;bcd001&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">45</span>,</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>SQL의 SELECT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users</span><br></pre></td></tr></table></figure>

<p>mongoDB의 <code>find()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br></pre></td></tr></table></figure>

<p>SQL의 UPDATE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> status <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>

<p>mongoDB의 <code>update()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">update</span>(</span><br><span class="line">  &#123; <span class="attr">age</span>: &#123; <span class="attr">$gt</span>: <span class="number">25</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">$set</span>: &#123; <span class="attr">status</span>: <span class="string">&quot;C&quot;</span> &#125; &#125;,</span><br><span class="line">  &#123; <span class="attr">multi</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>SQL의 DELETE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> user_id<span class="operator">=</span><span class="string">&#x27;bcd001&#x27;</span></span><br></pre></td></tr></table></figure>

<p>mongoDB의 <code>remove()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">users</span>.<span class="title function_">remove</span>(&#123;</span><br><span class="line">  <span class="attr">user_id</span>: <span class="string">&quot;bcd0001&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="collection의-주요-CRUD-함수"><a href="#collection의-주요-CRUD-함수" class="headerlink" title="collection의 주요 CRUD 함수"></a>collection의 주요 CRUD 함수</h4><p>컬렉션에 대한 query는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/js-collection/">Collection Method</a> 에 설명되어 있다. 아래 테이블은 주요 CRUD 함수.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>db.collection.find()</td>
<td>컬렉션에서 쿼리를 행하고 결과를 cursor 객체로 반환</td>
</tr>
<tr>
<td>db.collection.findOne()</td>
<td>쿼리를 실행하고 도큐멘트 하나를 반환한다.</td>
</tr>
<tr>
<td>db.collection.findAndModify()</td>
<td>자동으로 수정하고 도큐멘트 하나를 반환한다.</td>
</tr>
<tr>
<td>db.collection.save()</td>
<td>새 도큐멘트를 삽입하기 위해 <code>insert()</code> 와 <code>update()</code>를 묶어 놓은 함수</td>
</tr>
<tr>
<td>db.collection.insert()</td>
<td>컬렉션 안에 새 문서를 생성한다.</td>
</tr>
<tr>
<td>db.collection.insertOne()</td>
<td>컬렉션 안에 새 문서 하나를 생성한다.</td>
</tr>
<tr>
<td>db.collection.insertMany()</td>
<td>컬렉션 안에 새 문서 여러개를 생성한다.</td>
</tr>
<tr>
<td>db.collection.update()</td>
<td>컬렉션 안의 문서를 수정한다</td>
</tr>
<tr>
<td>db.collection.updateOne()</td>
<td>컬렉션 안에 문서 하나를 수정한다</td>
</tr>
<tr>
<td>db.collection.updateMany()</td>
<td>컬렉션 안에 여러 문서를 수정한다</td>
</tr>
<tr>
<td>db.collection.remove()</td>
<td>컬렉션에서 문서(들)을 삭제한다</td>
</tr>
<tr>
<td>db.collection.renameCollection()</td>
<td>컬렉션 이름을 바꾼다</td>
</tr>
</tbody></table>
<h4 id="컬렉션-보기"><a href="#컬렉션-보기" class="headerlink" title="컬렉션 보기"></a>컬렉션 보기</h4><p><code>show collections</code> 명령은 콜렉션의 목록을 볼 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; show collections</span><br><span class="line">foo</span><br><span class="line">scores</span><br><span class="line">system.<span class="property">indexes</span></span><br><span class="line">users</span><br></pre></td></tr></table></figure>

<p><code>collection.renameCollection()</code>로 콜렉션명을 수정 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.[collectionName].renameCollection(&quot;newCollectionName&quot;);</span><br></pre></td></tr></table></figure>

<p>콜렉션의 삭제는 아래와 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.[collectionName].drop()</span><br></pre></td></tr></table></figure>

<h4 id="document-조회-–-find"><a href="#document-조회-–-find" class="headerlink" title="document 조회 – find()"></a>document 조회 – find()</h4><p><code>find()</code>는 컬렉션 안의 도큐멘트 전체 혹은 지정한 도큐멘트의 속성에 해당하는 도큐멘트를 반환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.[collectionName].find([Document]);</span><br></pre></td></tr></table></figure>

<p>데이터베이스 컬렉션 <em>students</em> 안의 도큐멘트를 <code>find()</code> 함수로 보여준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">students</span>.<span class="title function_">find</span>(<span class="params"></span>)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;513b38ad81dc4b8f06062146&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;james&quot;</span>, <span class="string">&quot;age&quot;</span> : <span class="number">24</span>, <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p><code>find()</code>로 콜렉션에 지정한 속성 값만 검색할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">students</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;jessi&#x27;</span>, <span class="attr">age</span>:<span class="number">20</span>, <span class="attr">grade</span>:<span class="string">&#x27;A&#x27;</span>&#125;);</span><br><span class="line">&gt; db.<span class="property">students</span>.<span class="title function_">find</span>(<span class="params">&#123;name:<span class="string">&#x27;james&#x27;</span>&#125;</span>)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;513b38ad81dc4b8f06062146&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;james&quot;</span>, <span class="string">&quot;age&quot;</span> : <span class="number">24</span>, <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 에서 a가 0인 데이터를 출력해 보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:<span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 에서 a:1, b:bbb인 데이터를 출력해 보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="string">&#x27;bbb&#x27;</span>&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592b&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 안의 모든 도큐멘트를 a:1을 기준으로 정렬해서 반환한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>().<span class="title function_">sort</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592b&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>컬렉션 <em>scores</em> 안의 도큐멘트 숫자를 반환한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">count</span>();</span><br><span class="line"><span class="number">110</span></span><br></pre></td></tr></table></figure>

<h4 id="findOne"><a href="#findOne" class="headerlink" title="findOne()"></a>findOne()</h4><p>find()와 동일한 매개변수를 이용할 수 있습니다. 다른점은 find()는 커서를 리턴하지만, findOne()은 데이터베이스에서 첫번째 document나 null을 리턴합니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">a</span>:<span class="number">0</span>&#125;);</span><br><span class="line">&gt; <span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">결국 이 쿼리는</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line">&gt; <span class="title function_">find</span>(&#123;<span class="attr">a</span>:<span class="string">&quot;0&quot;</span>&#125;).<span class="title function_">limit</span>(<span class="number">1</span>).</span><br></pre></td></tr></table></figure>

<p>와 동일한 결과를 얻습니다.</p>
<h4 id="limit"><a href="#limit" class="headerlink" title="limit();"></a>limit();</h4><p>쿼리의 결과의 수를 제한된 수의 결과로 제한하게 해서 처리할 수 있습니다.</p>
<p>MongoDB cursors are not snapshots - operations performed by you or other users on the collection being queried between the first and last call to next() of your cursor may or may not be returned by the cursor. Use explicit locking to perform a snapshotted query.</p>
<p>mongo 쉘 에서 고급 기법에 대해서는 아래 링크를 참조하세요.</p>
<p><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/mongo+-+The+Interactive+Shell">http://www.mongodb.org/display/DOCS/mongo+-+The+Interactive+Shell</a></p>
<h4 id="Cursor-객체"><a href="#Cursor-객체" class="headerlink" title="Cursor 객체"></a>Cursor 객체</h4><p>find()는 cursor 객체를 리턴합니다. cursor 객체는 쿼리의 결과 집합에 대한 포인터라고 한다.[^3]<br>cursor는 여러 데이터의 집합이므로 아래 같이 이용 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> cursor = db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br><span class="line">&gt; <span class="keyword">while</span>(cursor.<span class="title function_">hasNext</span>()) <span class="title function_">printjson</span>(cursor.<span class="title function_">next</span>());</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>printjson()</code> 은 내장 함수로 데이터를 json 형식으로 출력해 준다.</li>
</ul>
<p>mongo 쉘로 사용시 아래 처럼 foreach 콜백 함수를 이용할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>().<span class="title function_">forEach</span>(printjson);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>

<p>또한 cursor를 배열 처럼 이용 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> cursor = db.<span class="property">scores</span>.<span class="title function_">find</span>();</span><br><span class="line">&gt; <span class="title function_">printjson</span>(cursor[<span class="number">10</span>]);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>이 시점에 결과가 메모리에 적재되기 때문에 아주 큰 데이터를 다루면 out of memory를 만나게 될 수 있다. 배열 스타일의 접근을 위해 cursor 를 배열로 변경할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">var</span> arr = db.<span class="property">scores</span>.<span class="title function_">find</span>().<span class="title function_">toArray</span>();</span><br><span class="line">&gt; arr[<span class="number">10</span>];</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400592a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="도큐멘트-update"><a href="#도큐멘트-update" class="headerlink" title="도큐멘트 - update"></a>도큐멘트 - update</h4><p>mongoDB에서 도큐멘트 갱신은 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/update-methods/">update methods</a>를 참고한다.</p>
<p>update() 메서드는 다음 형식으로 되어 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(query, update, options)</span><br></pre></td></tr></table></figure>

<p>아래와 같은 두 개의 document가 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">books</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>,<span class="attr">language</span>:[<span class="string">&#x27;Java&#x27;</span>,<span class="string">&#x27;C++&#x27;</span>]&#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;Jenny&#x27;</span>,<span class="attr">language</span>:[<span class="string">&#x27;HTML5&#x27;</span>,<span class="string">&#x27;Actionscript&#x27;</span>]&#125;);</span><br></pre></td></tr></table></figure>

<p><code>update()</code> 업데이트를 하면 전체 문서에 대해서 갱신이 된다. 아래 쿼리는 <code>Jenny</code> 라는 name 속성을 가진 도큐멘트를 모두 주어진 도큐멘트 속서으로 변경한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>( &#123;<span class="attr">name</span>:<span class="string">&#x27;Jenny&#x27;</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>,<span class="attr">language</span>:[<span class="string">&#x27;Korea&#x27;</span>,<span class="string">&#x27;English&#x27;</span>]&#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc05ff01708cc4a3eadd3c8&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0601d1708cc4a3eadd3c9&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;English&quot;</span> ] &#125;</span><br></pre></td></tr></table></figure>

<p>데이터의 일정부분만 갱신하려면 <code>$set</code> 연산자 및 배열을 위한 <code>$push</code>, <code>$pull</code> 연산자를 함께 사용할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>( &#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>&#125;, &#123;<span class="string">&#x27;$set&#x27;</span>: &#123;<span class="attr">age</span>:<span class="string">&#x27;30&#x27;</span>&#125;&#125; );</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0601d1708cc4a3eadd3c9&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;English&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc060fa1708cc4a3eadd3ca&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc060fe1708cc4a3eadd3cb&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Korea&quot;</span>, <span class="string">&quot;English&quot;</span> ] &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc05ff01708cc4a3eadd3c8&quot;</span>), <span class="string">&quot;age&quot;</span> : <span class="string">&quot;30&quot;</span>, <span class="string">&quot;language&quot;</span> : [ <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C++&quot;</span> ], <span class="string">&quot;name&quot;</span> : <span class="string">&quot;James&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;Sue&#x27;</span>&#125;, &#123;<span class="string">&#x27;$pull&#x27;</span>: &#123;<span class="string">&#x27;languages&#x27;</span>: <span class="string">&#x27;scala&#x27;</span>&#125; &#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">update</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;Sue&#x27;</span>&#125;, &#123;<span class="string">&#x27;$push&#x27;</span>: &#123;<span class="string">&#x27;languages&#x27;</span>: <span class="string">&#x27;ruby&#x27;</span>&#125; &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="collection-remove"><a href="#collection-remove" class="headerlink" title="collection.remove()"></a>collection.remove()</h4><p>도큐멘트의 항목을 삭제할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">remove</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;James&#x27;</span>&#125;);</span><br><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">find</span>();</span><br></pre></td></tr></table></figure>

<p>모든 데이터를 제거하려면 remove()만 호출합니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">users</span>.<span class="title function_">remove</span>();</span><br></pre></td></tr></table></figure>

<p>index 생성</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.<span class="property">scores</span>.<span class="title function_">encureIndex</span>( &#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:’bbb’&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">group</span>(), <span class="title function_">min</span>(), <span class="title function_">max</span>(), $where</span><br></pre></td></tr></table></figure>

<h3 id="Query와-Projection-연산자"><a href="#Query와-Projection-연산자" class="headerlink" title="Query와 Projection 연산자"></a>Query와 Projection 연산자</h3><p>쿼리에 제약 혹은 확장을 할 수 있는 쿼리 선택자 (Query selector)는 비교, 논리, 요소, 배열 등에 대한 연산자로 지원된다. Projection 연산자는 쿼리의 특정 부분만을 투영할 수 있는 연산자를 지원하고 있다. [^4]</p>
<p>자세하고 더 많은 내용은 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/">Query and Projection operators</a>를 참조하라.</p>
<h4 id="gt-연산자"><a href="#gt-연산자" class="headerlink" title="$gt 연산자"></a><code>$gt</code> 연산자</h4><p>입력된 데이터에서 20보다 큰 데이터를 찾아 보겠습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$gt&#x27;</span>:<span class="number">30</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005949&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">31</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400594a&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">32</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400594b&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">33</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>

<h4 id="gte-연산자"><a href="#gte-연산자" class="headerlink" title="$gte 연산자"></a><code>$gte</code> 연산자</h4><p><code>$gte</code>는 Greater Than or Equal로 크거나 같은 값을 비교하는 연산자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$gte&#x27;</span>:<span class="number">22</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005940&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">22</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005941&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">23</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="lt-lte-연산자"><a href="#lt-lte-연산자" class="headerlink" title="$lt, $lte 연산자"></a><code>$lt</code>, <code>$lte</code> 연산자</h4><p><code>$lte</code> 연산자는 작거나 같은 값을 비교하는 연산자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>( &#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$lte&#x27;</span>:<span class="number">5</span>&#125;&#125; );</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="ne-연산자"><a href="#ne-연산자" class="headerlink" title="$ne 연산자"></a><code>$ne</code> 연산자</h4><p><code>$ne</code> 연산자는 같지 않은 값을 비교하는 연산자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">b</span>:&#123;<span class="string">&#x27;$ne&#x27;</span>:<span class="string">&#x27;bbb&#x27;</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br></pre></td></tr></table></figure>

<p><code>$gte</code> 와 <code>$lte</code>를 동시에 쓰기도 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>: &#123;<span class="string">&#x27;$gte&#x27;</span>:<span class="number">5</span>,<span class="string">&#x27;$lte&#x27;</span>:<span class="number">8</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e32&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">5</span>, <span class="string">&quot;b&quot;</span> : <span class="number">6</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e33&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">6</span>, <span class="string">&quot;b&quot;</span> : <span class="number">7</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e34&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">7</span>, <span class="string">&quot;b&quot;</span> : <span class="number">8</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="in-in-Array"><a href="#in-in-Array" class="headerlink" title="$in in Array"></a><code>$in</code> in Array</h4><p><code>$in</code> 연산자는 주어진 컬렉션 값이 포함되었는지 비교한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$in&#x27;</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>]&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005934&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">10</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f371664400593e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">20</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005948&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">30</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fc0549c58f3716644005952&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">40</span>, <span class="string">&quot;b&quot;</span> : <span class="string">&quot;bbb&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>반대로 <code>$nin</code> 연산자는 주어진 컬렉션에 포함 안된 값을 비교한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.<span class="property">scores</span>.<span class="title function_">find</span>(&#123;<span class="attr">a</span>:&#123;<span class="string">&#x27;$nin&#x27;</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>]&#125;&#125;);</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2d&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">0</span>, <span class="string">&quot;b&quot;</span> : <span class="number">1</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2e&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">1</span>, <span class="string">&quot;b&quot;</span> : <span class="number">2</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;4fbe149b206a4e5abfad0e2f&quot;</span>), <span class="string">&quot;a&quot;</span> : <span class="number">2</span>, <span class="string">&quot;b&quot;</span> : <span class="number">3</span> &#125;</span><br><span class="line">…</span><br><span class="line">has more</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<!--

#### Query#populate

`query#populate` 는 쿼리 결과에서 특정한 쿼리를 다시 질의할 수 있다.

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Query.populate( path, [fields], [model], [cond], [options] )</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Album</span>.<span class="title function_">findOne</span>().<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err, doc</span>) &#123;</span><br><span class="line">   <span class="comment">// print undefind</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( doc.<span class="property">artist</span>.<span class="property">name</span>) ;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Album</span>.<span class="title function_">findOne</span>().<span class="title function_">populate</span>(<span class="string">&#x27;artist&#x27;</span>).<span class="title function_">exec</span>(<span class="keyword">function</span>(<span class="params">err, doc</span>) &#123;</span><br><span class="line">   <span class="comment">// print fink flod</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( doc.<span class="property">artist</span>.<span class="property">name</span>) ;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://www.mongodb.com/compare/mongodb-mysql?jmp=docs">Terminology and Concepts</a><br>[^3]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/glossary/#term-cursor">Cursor</a><br>[^4]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/query/">Query and Projection operators</a><br>[^5]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/glossary/#term-bson">Term of BSON</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-20T00:00:00.000Z" title="2017-4-20 9:00:00">2017-04-20</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:37:02.491Z" title="2022-2-25 1:37:02">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">11분안에 읽기 (약 1577 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/20/linux-2017-04-20-mongodb-user-auth/">MongoDB - Database와 User Authentication</a></h1><div class="content"><blockquote>
<p>2018-06-21 설치 링크로 대체<br>{:.right-history}</p>
</blockquote>
<p>MongoDB 설치후 데이터베이스 위치, 로그, 인증 등에 관련한 서버 구성과 설정을 정리한다.</p>
<blockquote>
<p>MongoDB 2.6 과 MongoDB Community Edition 3.x 버전을 사용했다.</p>
</blockquote>
<h2 id="mongoDB-접근제어"><a href="#mongoDB-접근제어" class="headerlink" title="mongoDB 접근제어"></a>mongoDB 접근제어</h2><p>mongoDB 는 설치과정 중에 인증과 관련해 설정하는 부분이 없어서 설치 후 누구나 DB에 접속 할 수 있다. 인증을 추가해 데이터베이스 관리자와 데이터베이스 사용자로 구분해서 이용하고, 각 데이터베이스의 사용자는 허가된 역할(Role)을 가지고 데이터베이스에 접근 가능하도록 구성한다.</p>
<p>여기서는 다음 두 가지를 다루고 있다.</p>
<ul>
<li><strong>(1) 데이터베이스 관리자 추가</strong></li>
<li><strong>(2) 데이터베이스 사용자 추가</strong></li>
</ul>
<p>Ubuntu&#x2F;Debian 리눅스 배포본에 MongoDB 3.x 버전이 지원되지 않으면, MongoDB Community Edition 를 패키지 혹은 소스로 설치할 수 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC11--">MongoDB Community Edition 3.4 on Armv8</a></li>
<li><a href="!--swig%EF%BF%BC12--">MongoDB Community Edition 3.6</a></li>
</ul>
<h3 id="데이터베이스-관리자"><a href="#데이터베이스-관리자" class="headerlink" title="데이터베이스 관리자"></a>데이터베이스 관리자</h3><p>mongod가 <strong>비인증 모드로 실행</strong>중인 상태에서, <code>mongo</code> 클라이언트로 데이터베이스에 접속한다.접속에 성공하면 <strong>&gt;</strong> 프롬프트가 표시된다. 그리고 접속한 후에 <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><code>mongo</code> 클라이언트로 접속해 mongoDB 데이터베이스 관리자 <strong>admin</strong> 추가해서, 사용자 롤로 <code>userAdminAnyDatabase</code> 롤을 추가해준다.</p>
<h4 id="mongoDB-2-6-이후-관리자-계정-추가"><a href="#mongoDB-2-6-이후-관리자-계정-추가" class="headerlink" title="mongoDB 2.6 이후 관리자 계정 추가"></a>mongoDB 2.6 이후 관리자 계정 추가</h4><p>mongoDB 2.6 이후는 <code>db.createUser()</code> 로 사용자를 추가한다. [^2]<br>다음은 admin 데이터베이스에서 사용자를 관리하는 admin 계정을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;</span><br><span class="line">&gt; db.createUser(&#123; user:&#x27;admin&#x27;,</span><br><span class="line">                   pwd:&#x27;****&#x27;,</span><br><span class="line">                   roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">               &#125;)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers() // 데이터베이스 사용자 확인</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">        &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">        &quot;roles&quot; : [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">                &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>[^2]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v2.6/tutorial/enable-authentication-without-bypass/">Enable Authentication after Creating the User Administrator(v2.6)</a></p>
<h4 id="mongoDB-2-4-이전-관리자-계정-추가"><a href="#mongoDB-2-4-이전-관리자-계정-추가" class="headerlink" title="mongoDB 2.4 이전 관리자 계정 추가"></a>mongoDB 2.4 이전 관리자 계정 추가</h4><p>mongoDB 2.4 까지는 새로운 사용자는 <code>db.addUser()</code> 로 추가한다.[^1]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mongo     // mongo client 로 접속</span><br><span class="line">&gt;use admin  // admin DB 사용</span><br><span class="line">&gt;db.addUser( &#123; user: &quot;&lt;username&gt;&quot;, // admin name</span><br><span class="line">              pwd: &quot;&lt;password&gt;&quot;,</span><br><span class="line">              roles: [ &quot;userAdminAnyDatabase&quot; ] // Database role</span><br><span class="line">          &#125; )</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mongoDB 2.6까지 32bit 버전을 지원하고 있다.</p>
</blockquote>
<p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v2.4/tutorial/add-user-administrator/">Add User Administrator(v2.4 )</a></p>
<p>관리자 계정을 만든후 MongoDB에 <code>mongo</code> 클라이언트로 인증 로그인을 한 후에 데이터베이스를 생성하고 해당 데이터베이스 사용자에 접근 권한을 추가해 준다.</p>
<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<h3 id="데이터-베이스-생성과-롤-기반-인증"><a href="#데이터-베이스-생성과-롤-기반-인증" class="headerlink" title="데이터 베이스 생성과 롤 기반 인증"></a>데이터 베이스 생성과 롤 기반 인증</h3><h4 id="관리자-로그인"><a href="#관리자-로그인" class="headerlink" title="관리자 로그인"></a>관리자 로그인</h4><p>이제 데이터베이스 관리자 계정으로 로그인해서 사용하려는 데이터베이스를 <code>use</code>로 선택하고 해당 데이터베이스 사용자를 추가해준다.</p>
<p><code>mongo</code> 클라이언트 로그인시 <code>-u &lt;username&gt;</code>, <code>-p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u <span class="string">&quot;admin&quot;</span> -p <span class="string">&quot;****&quot;</span> --authenticationDatabase <span class="string">&quot;admin&quot;</span></span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br></pre></td></tr></table></figure>

<p>혹은 인증없이 <code>mongo</code> 클라이언트로 데이터베이스에 접속한 후에 <code>db.auth()</code> 명령을 사용할 수 있다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.auth(<span class="string">&quot;admin&quot;</span><span class="punctuation">,</span> <span class="string">&quot;****&quot;</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; show users</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;5733676238ac1ddf4cf745c2&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;readOnly&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pwd&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;24413999168dccff96dcc735720c85ce&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>이제 각 데이터베이스에 사용자를 생성해서 사용해서 인증한 사용자만 데이터베이스를 사용하게 할 수 있다.</p>
<h3 id="Database-사용자-추가"><a href="#Database-사용자-추가" class="headerlink" title="Database 사용자 추가"></a>Database 사용자 추가</h3><h4 id="mongoDB-v3-x-사용자-관리"><a href="#mongoDB-v3-x-사용자-관리" class="headerlink" title="mongoDB v3.x 사용자 관리"></a>mongoDB v3.x 사용자 관리</h4><p>mongoDB v2.6 히우는 대부분 mongoDB v3.4와 호환되는 사용자 관리 명령을 사용한다. 여기서는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/js-user-management/">User Management Methods (v3.4)</a>를 참고하고 있다.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>db.auth()</td>
<td>데이터베이스에 사용자 인증</td>
</tr>
<tr>
<td>db.createUser()</td>
<td>Creates a new user.</td>
</tr>
<tr>
<td>db.updateUser()</td>
<td>Updates user data.</td>
</tr>
<tr>
<td>db.changeUserPassword()</td>
<td>사용자 패스워드 변경</td>
</tr>
<tr>
<td>db.dropAllUsers()</td>
<td>데이터베이스에 관련된 모든 사용자를 삭제한다.</td>
</tr>
<tr>
<td>db.dropUser()</td>
<td>한 사용자를 삭제한다</td>
</tr>
<tr>
<td>db.grantRolesToUser()</td>
<td>롤과 권한을 사용자에 허용한다</td>
</tr>
<tr>
<td>db.revokeRolesFromUser()</td>
<td>사용자에 부여한 롤을 삭제한다</td>
</tr>
<tr>
<td>db.getUser()</td>
<td>지정한 사용자의 정보를 반환한다</td>
</tr>
<tr>
<td>db.getUsers()</td>
<td>데이터베이스에 관련된 모든 사용자의 정보를 반환한다</td>
</tr>
</tbody></table>
<h4 id="createUser"><a href="#createUser" class="headerlink" title="createUser()"></a>createUser()</h4><p><code>db.createUser()</code> 는 두 개의 도큐멘트를 인자로 사용한다:</p>
<blockquote>
<p>db.createUser(user, writeConcern)</p>
</blockquote>
<p>여기서 <strong>user</strong> 도큐멘트는 아래 같은 형식을 갖는다:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> user<span class="punctuation">:</span> <span class="string">&quot;&lt;name&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  pwd<span class="punctuation">:</span> <span class="string">&quot;&lt;cleartext password&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  customData<span class="punctuation">:</span> <span class="punctuation">&#123;</span> &lt;any information&gt; <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  roles<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> role<span class="punctuation">:</span> <span class="string">&quot;&lt;role&gt;&quot;</span><span class="punctuation">,</span> db<span class="punctuation">:</span> <span class="string">&quot;&lt;database&gt;&quot;</span> <span class="punctuation">&#125;</span> | <span class="string">&quot;&lt;role&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>customData</strong>: 선택적으로 추가할 정보를 담은 도큐멘트.</li>
</ul>
<p>다음은 <em>product</em> 데이터베이스로 전환해서 <em>product</em> 데이터베이스 사용자를 추가하고 있다. <em>customeData</em> 를 주목하자.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; use products</span><br><span class="line">db.createUser( &#123; user: &quot;user1&quot;,</span><br><span class="line">                 pwd: &quot;changeMe&quot;,</span><br><span class="line">                 customData: &#123; employeeId: 12345 &#125;, // prducts</span><br><span class="line">                 roles: [ &#123; role: &quot;clusterAdmin&quot;, db: &quot;admin&quot; &#125;,</span><br><span class="line">                          &#123; role: &quot;readAnyDatabase&quot;, db: &quot;admin&quot; &#125;,</span><br><span class="line">                          &quot;readWrite&quot;] &#125;,</span><br><span class="line">               &#123; w: &quot;majority&quot; , wtimeout: 5000 &#125; )</span><br></pre></td></tr></table></figure>

<p>다양한 사례는 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.createUser/#examples">createUser() Exmaple</a> 를 참고하자.</p>
<p>mongoDB v2.4는 사용자 추가 방법이 조금 다르다.</p>
<h4 id="mongoDB-v2-4-사용자-추가"><a href="#mongoDB-v2-4-사용자-추가" class="headerlink" title="mongoDB v2.4 사용자 추가"></a>mongoDB v2.4 사용자 추가</h4><p>사용하려는 데이터베이스의 계정으로 접근제어를 추가해 주어야 한다. mongoDB 2.4 까지는 새로운 사용자는 <code>db.addUser()</code> 로 추가한다.[^3]</p>
<p>[^3]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v2.4/tutorial/add-user-to-database/">Add User To Database(v2.4)</a></p>
<p>아래는 데이터베이스 관리자 계정 <em>admin</em>으로 로그인해서, 필요하면 students 데이터베이스를 생성합니다. 그리고 students 데이터베이스 사용자 <em>student</em> 계정을 추가하고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; use students</span><br><span class="line">switched to db students</span><br><span class="line">&gt; db.<span class="title function_">addUser</span>(<span class="params"><span class="string">&#x27;student&#x27;</span>, <span class="string">&#x27;****&#x27;</span></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;user&quot;</span> : <span class="string">&quot;student&quot;</span>,</span><br><span class="line">    <span class="string">&quot;readOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;pwd&quot;</span> : <span class="string">&quot;7a70591507db46bdd3df47a213d8922f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57336a71c1ef2bed6688d296&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&gt; db.<span class="title function_">auth</span>(<span class="string">&#x27;student&#x27;</span>, <span class="string">&#x27;012345&#x27;</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; db.<span class="property">student</span>.<span class="title function_">save</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;qkboo&#x27;</span>, <span class="attr">class</span>:<span class="string">&#x27;Database&#x27;</span>, <span class="attr">grade</span>:<span class="string">&#x27;A&#x27;</span>&#125;)</span><br><span class="line">&gt; db.<span class="property">student</span>.<span class="title function_">find</span>(<span class="params"></span>)</span><br><span class="line">&#123; <span class="string">&quot;_id&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57336b7d1be9091521cbeb36&quot;</span>), <span class="string">&quot;name&quot;</span> : <span class="string">&quot;qkboo&quot;</span>, <span class="string">&quot;class&quot;</span> : <span class="string">&quot;IoT&quot;</span>, <span class="string">&quot;grade&quot;</span> : <span class="string">&quot;A&quot;</span> &#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>이제 <code>mongo</code> 클라이언트로 생성한 <em>students</em> 에 데이터베이스 사용자 <em>student</em>로 로그인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mongo student -u student -p ****</span><br><span class="line">MongoDB shell version: 2.4.10</span><br><span class="line">connecting to: student</span><br></pre></td></tr></table></figure>

<p>만약 해당 데이터베이스 사용자가 아닌 계정에서 데이터베이스 접근시 다음 같이 인증되지 않은 접근으로 에러를 발생한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line"><span class="title class_">MongoDB</span> shell <span class="attr">version</span>: <span class="number">2.4</span><span class="number">.10</span></span><br><span class="line">connecting <span class="attr">to</span>: test</span><br><span class="line">&gt; use student</span><br><span class="line">switched to db student</span><br><span class="line">&gt; show dbs</span><br><span class="line"><span class="title class_">Tue</span> <span class="title class_">Sep</span> <span class="number">27</span> <span class="number">23</span>:<span class="number">45</span>:<span class="number">38.269</span> listDatabases <span class="attr">failed</span>:&#123; <span class="string">&quot;ok&quot;</span> : <span class="number">0</span>, <span class="string">&quot;errmsg&quot;</span> : <span class="string">&quot;unauthorized&quot;</span> &#125; at src/mongo/shell/mongo.<span class="property">js</span>:<span class="number">46</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="MongoDB에-관련-글"><a href="#MongoDB에-관련-글" class="headerlink" title="MongoDB에 관련 글"></a>MongoDB에 관련 글</h2><p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-11T01:00:00.000Z" title="2017-4-11 10:00:00">2017-04-11</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:35:37.606Z" title="2022-2-25 1:35:37">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a><span> / </span><a class="link-muted" href="/categories/Linux/Database/">Database</a></span><span class="level-item">15분안에 읽기 (약 2269 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/11/linux-2017-04-11-mongodb-3-4-install-armv8/">mongodb 3.4 on Armbian</a></h1><div class="content"><blockquote>
<p>2018-06-22 내용 정리, User auth 링크<br>{:.right-history}</p>
</blockquote>
<p>이 문서는 MongoDB Community Edition 3.4 버전을 <em>64bit OS</em>인 <em>Amd64</em>, <em>Arm64</em> 지원 OS에 설치해 사용하기 위해서 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/v3.4/tutorial/install-mongodb-on-ubuntu/">Install MongoDB Community Edition, on-ubuntu</a>를 따라서 진행했다.</p>
<p>여기서는 Arm을 사용하는 SBC[^2] 컴퓨터에 mongodb 3.4 버전을, <em>Hardkernel Odroid C2</em>를 사용해서 설치를 진행했다.</p>
<ul>
<li>Odroid C2 for 64bit</li>
<li>Armbian Ubuntu Xeniel</li>
</ul>
<h2 id="MongoDB-Community-edition"><a href="#MongoDB-Community-edition" class="headerlink" title="MongoDB Community edition"></a>MongoDB Community edition</h2><p>테스트한 Arm64 기반의 Odroic C2 에서는 <em>MongoDB Community Edition</em>을 설치한 후에 <code>systemd</code> 관련 스크립트와 설정 파일등이 적절히 설치되지 않아서, 이 부분에 대한 언급을 추가했다.</p>
<h3 id="사전준비"><a href="#사전준비" class="headerlink" title="사전준비"></a>사전준비</h3><p>여기서는 Odroid C2 를 사용하고 Armbian 배포본에서 Ubuntu Xeniel 버전을 사용했다.</p>
<ul>
<li>Armbian 배포본 Debian Jessie 에는 아직 mongodb 64bit 를 제공하지 않고 있다.</li>
</ul>
<h4 id="레포지토리-등록"><a href="#레포지토리-등록" class="headerlink" title="레포지토리 등록"></a>레포지토리 등록</h4><p>아래 같이 키 서버를 등록하고 apt source list에 mongodb 를 등록한다.</p>
<blockquote>
<p>여러분 시스템이 적용되는 지는 [^1]에 잘 설명되어 있다.</p>
</blockquote>
<p><em>키서버 등록</em></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6</span><br></pre></td></tr></table></figure>

<p>Mongodb 3.4 는 <code>/etc/apt/sources.list.d/mongodb-org-3.4.list</code> 파일 생성하고 아래 같이 해당 리눅스 버전에 맞는 소스 목록을 추가한다.</p>
<p><em>Ubuntu 16.04</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list</span><br></pre></td></tr></table></figure>

<p><em>Ubuntu 14.04</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list</span><br></pre></td></tr></table></figure>

<h4 id="remove-key-amp-ppa"><a href="#remove-key-amp-ppa" class="headerlink" title="remove key &amp; ppa"></a>remove key &amp; ppa</h4><p>설치 후 필요 없어서 키 서버, 저장소 목록을 지우려면,</p>
<p>삭제할 키 해시 코드 확인: 다음 같이 8자리 코드로 나오거나</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key list</span><br><span class="line"></span><br><span class="line">pub   4096R/A15703C6 2016-01-11 [expires: 2018-01-10]</span><br><span class="line">uid                  MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br></pre></td></tr></table></figure>

<p>다음 같이 긴 해시 코드로 나온다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--------------------</span><br><span class="line">pub   rsa4096 2016-01-11 [SC] [expires: 2018-01-10]</span><br><span class="line">      0C49 F373 0359 A145 1858  5931 BC71 1F9B A157 03C6</span><br><span class="line">uid           [ unknown] MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br><span class="line"></span><br><span class="line">/etc/apt/trusted.gpg.d/debian-archive-jessie-automatic.gpg```</span><br></pre></td></tr></table></figure>

<p>이 키를</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key del A15703C6</span><br></pre></td></tr></table></figure>

<h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><p>그리고 <code>apt</code> 명령으로 소스 캐시를 갱신하고 mongodb-org 커뮤니티 버전의 mongodb를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install mongodb-org</span><br></pre></td></tr></table></figure>

<blockquote>
<p>설치전 mongodb 3.x 버전은 데이터 저장 파일 시스템으로 xfs 를 권장하고 있다.</p>
</blockquote>
<br/>
<br/>

<h4 id="create-systemd-x2F-service-entry"><a href="#create-systemd-x2F-service-entry" class="headerlink" title="create systemd &#x2F; service entry"></a>create systemd &#x2F; service entry</h4><p><strong>mongodb-org</strong> 설치후 <code>systemctl</code> 스크립트가 <code>/etc/init.d</code>에 복사되지 않았다.</p>
<blockquote>
<p>여기서는 odroid-c2 armbian 설치 상태, 일반 리눅스 배포본은 잘 된다.</p>
</blockquote>
<p>아래 명령을 실행해 <strong>mongodb.service</strong> 가 없으면 새로 생성해야 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --<span class="built_in">type</span>=service |grep mongodb</span><br></pre></td></tr></table></figure>

<p>만약 <strong>mongodb.service</strong> 가 없다면, <code>/lib/systemd/system/mongod.service</code> 파일을 다음 같이 활성화 시켜준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /lib/systemd/system</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> mongodb.service</span><br></pre></td></tr></table></figure>

<p><strong>mongodb.service</strong> 가 있고,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --<span class="built_in">type</span>=service |grep mongodb</span><br><span class="line">mongodb.service             disabled</span><br></pre></td></tr></table></figure>

<p><em>disable</em> 상태면 <code>systemctl</code> 명령으로 <em>enable</em> 시킨다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> mongodb.service</span><br></pre></td></tr></table></figure>

<p>그리고 서비스를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br><span class="line">● mongod.service - High-performance, schema-free document-oriented database</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Tue 2017-07-18 09:17:53 UTC; 1s ago</span><br><span class="line">     Docs: https://docs.mongodb.org/manual</span><br><span class="line"> Main PID: 7234 (mongod)</span><br><span class="line">   CGroup: /system.slice/mongod.service</span><br><span class="line">           └─7234 /usr/bin/mongod --config /etc/mongod.conf</span><br><span class="line"></span><br><span class="line">Jul 18 09:17:53 odroidc2 systemd[1]: Started High-performance, schema-free document-oriented database.</span><br></pre></td></tr></table></figure>

<p>mongod 서비스가 제대로 실행됐으면 <strong>mongo</strong> 클라이언트로 테스트해 볼 수 있으면 접속해 볼 수 있다.</p>
<br/>
<br/>

<h3 id="Mongo-Database-설정"><a href="#Mongo-Database-설정" class="headerlink" title="Mongo Database 설정"></a>Mongo Database 설정</h3><ul>
<li>mongodb 사용자와 디렉토리 퍼미션 확인</li>
<li>mongod.conf 설정</li>
<li>mongo client 접속 테스트</li>
<li>mongodb 인증</li>
</ul>
<h4 id="mongodb-사용자-확인"><a href="#mongodb-사용자-확인" class="headerlink" title="mongodb 사용자 확인"></a>mongodb 사용자 확인</h4><p><em>mongodb-org</em> 설치하면 사용자 <em>mongodb</em>가 만들어 지지만, 혹시 생성되지 않았으면 시스템에 사용자 <strong>mongodb</strong> 가 없으면 새로 만든다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser --disabled-password --gecos &quot;&quot; --no-create-home --disabled-password --disabled-login mongodb</span><br></pre></td></tr></table></figure>

<p><strong>로그 디렉토리</strong> <em>&#x2F;var&#x2F;log&#x2F;mongo</em> 그리고 <strong>데이터 디렉토리</strong> <em>&#x2F;data&#x2F;mongodata</em> 라면 해당 디렉토리에 몽고디비 사용자가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> mongo.daemon /var/log/mongodb</span><br><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h4 id="mongod-conf-설정"><a href="#mongod-conf-설정" class="headerlink" title="mongod.conf 설정"></a>mongod.conf 설정</h4><p>MongoDB의 <code>systemd</code> 서비스는 데이터베이스 구성 파일 <code>/etc/mongod.conf</code> 을 참조한다.</p>
<p><code>/etc/mongod.conf</code> 파일에 <strong>인증</strong>을 제외한 <strong>데이터 디렉토리</strong>, <strong>bindIp</strong>, <strong>로그</strong> 부분만 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 127.0.0.1,192.168.0.2</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbPath</strong> : 데이터베이스 스토리지 위치</li>
<li><strong>bindIp</strong>: 서버 외에서 mongo 클라이언트가 접근하려면 IP 를 입력한다.</li>
</ul>
<p>현재는 <code>mongo.conf</code> 설정 파일에 접근 제어가 없는 상태에서 <strong>mongo</strong> 클라이언트로 접속한다</p>
<h4 id="Admin-사용자"><a href="#Admin-사용자" class="headerlink" title="Admin 사용자"></a>Admin 사용자</h4><p><code>mongo</code> 클라이언트로 접속에 성공하면 <strong>&gt;</strong> 프롬프트가 나온다. <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$mongo</span><br><span class="line">&gt;</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><em>admin</em> 데이터베이스에서 관리자 role을 가진 사용자를 추가하고, 사용할 데이터베이스의 사용자와 접근 제어를 추가해서 사용하기 위해서 작업한다.</p>
<h4 id="user-administrator"><a href="#user-administrator" class="headerlink" title="user administrator"></a>user administrator</h4><p><code>userAdmin role</code> 혹은 <code>userAdminAnyDatabase role</code>을 가진 사용자 만든다. 다음은 <em>admin</em> 데이터베이스에서 사용자를 관리하는 <strong>admin 계정</strong>을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user:&#x27;admin&#x27;,</span><br><span class="line">    pwd:&#x27;****&#x27;,</span><br><span class="line">    roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers()</span><br></pre></td></tr></table></figure>

<p>admin <code>사용자 패스워드 변경</code>은</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.changeUserPassword(&quot;accountUser&quot;, &quot;SOh3TbYhx8ypJPxmt1oOfL&quot;)</span><br></pre></td></tr></table></figure>

<p>사용자의 <code>role</code> 을 변경,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.grantRolesToUser( &#x27;admin&#x27;, [&#123;role: &#x27;userAdmin&#x27;, db:&#x27;admin&#x27;&#125;])</span><br><span class="line">&gt; db.getUsers()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdmin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>혹은 updateUser 를 사용할 수 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( &quot;appClient01&quot;, ...</span><br></pre></td></tr></table></figure>

<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<p>systemd 로 서비스를 재시작 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>이제 인증 모드에서 데이터베이스에 접속해야 한다.</p>
<h4 id="인증모드로-접속"><a href="#인증모드로-접속" class="headerlink" title="인증모드로 접속"></a>인증모드로 접속</h4><p>데이터베이스 시스템에 접근제어가 활성화 되면 <code>mongo</code> 클라이언트 접속시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<br/>
### `mongod` 명령 사용

<p>명령 <code>mongod</code> 로 MongoDB를 시작해 설정 파일 등이 제대로 동작하는지 확인할 수 있다.</p>
<h4 id="비인증-모드-시작"><a href="#비인증-모드-시작" class="headerlink" title="비인증 모드 시작"></a>비인증 모드 시작</h4><p>다음 같이 <code>mongod</code> 를 시작해 동작을 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /data/mongodata</span><br><span class="line">...</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h4 id="인증-모드-시작"><a href="#인증-모드-시작" class="headerlink" title="인증 모드 시작"></a>인증 모드 시작</h4><p>앞서 시작한 명령행 <strong>mongodb</strong>를 종료하고 명령라인에서 재시작 <code>--auth</code> 옵션을 붙여 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>접근제어 <code>--auth</code> 옵션으로 데이터베이스를 시작하면 로그인시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>명령행으로 시작한 mongod 는 종료하고 설정 파일에 인증을 넣자.</p>
<h3 id="데이터베이스-생성과-인증"><a href="#데이터베이스-생성과-인증" class="headerlink" title="데이터베이스 생성과 인증"></a>데이터베이스 생성과 인증</h3><p>새 데이터베이스에 컬렉션을 생성하고 데이터베이스 사용자를 접근제어할 수 있는 내용은 <a href="!--swig%EF%BF%BC33--">MongoDB User Authentication</a> 에서 다루고 있다.</p>
<br/>
<br/>
### 기타

<h4 id="WiredTiger-library-panic"><a href="#WiredTiger-library-panic" class="headerlink" title="WiredTiger library panic"></a>WiredTiger library panic</h4><p>ext4 파일시스템에서 wiredTiger engine으로 실행중 아래 같은 에러가 발생, 여기[^10] 에서 <code>--repair</code> 로 재구성한 후 사용하도록 권장한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-07-21T23:26:57.991+0900 E STORAGE  [conn31] WiredTiger error (-31804) [1500647217:991504][803:0x7f</span><br><span class="line">5794fc20], file:collection-0--8962566541221692692.wt, WT_CURSOR.next: the process must exit and restart</span><br><span class="line">: WT_PANIC: WiredTiger library panic</span><br><span class="line">2017-07-21T23:26:57.992+0900 I -        [conn31] Fatal Assertion 28558 at src/mongo/db/storage/wiredtig</span><br><span class="line">er/wiredtiger_util.cpp 361</span><br></pre></td></tr></table></figure>

<p><code>--repair</code> 로 재구성</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --storageEngine wiredTiger --repair --dbpath /data/dbdata/</span><br></pre></td></tr></table></figure>

<p>repaire를 sudo로 진행해서 <em>&#x2F;data&#x2F;dbdata</em> 안의 index 파일들이 root 소유권으로 바뀐다. 그래서 <em>&#x2F;data&#x2F;dbdata</em> 저장소를 chown으로 mongodb 사용자로 다시 설정</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> -R mongodb.mongodb /data/dbdata</span><br></pre></td></tr></table></figure>

<p>이제 재시작 하면 된다.</p>
<h4 id="XFS-warning"><a href="#XFS-warning" class="headerlink" title="XFS warning"></a>XFS warning</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strong$y recommended with the WiredTiger storage engine</span><br></pre></td></tr></table></figure>

<h4 id="USB-Memory-디스크-사용시"><a href="#USB-Memory-디스크-사용시" class="headerlink" title="USB Memory 디스크 사용시"></a>USB Memory 디스크 사용시</h4><p>Odroid C2에 64GB USB Memory를 외부 저장장치로 구성할 때 아래 같이 에러를 발생하며 <em>diagnostic.data 폴더 에러</em>, mongodb 가 다운된다. 아마 ext3 파일 시스템을 사용해서 그런 것 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FTDC     [ftdc] Uncaught exception in &#x27;FileNotOpen: Failed to open interim file /data/mongodata/diagnostic.data/metrics.interim.temp&#x27; in full-time diagnostic data capture subsys</span><br><span class="line">tem. Shutting down the full-time diagnostic data capture subsystem.</span><br><span class="line">2017-04-03T15:00:01.659+0900 E STORAGE  [WTJournalFlusher] WiredTiger error (30) [1491199201:659123][877:0x7f7ccfec90], WT_SESSION.log_flush: /data/mongodata/journal/WiredTigerLog.0000000048: handle-write: pw</span><br><span class="line">rite: failed to write 128 bytes at offset 19456: Read-only file system</span><br><span class="line">2017-04-03T15:00:01.662+0900 E STORAGE  [WTJournalFlusher] WiredTiger error (30) [1491199201:662709][877:0x7f7ccfec90], WT_SESSION.log_flush: journal/WiredTigerLog.0000000048: fatal log failure: Read-only fil</span><br><span class="line">e system</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/35351958/mongo-exception">stackoverflow</a> 에 diagnostic-data 폴더를 지우고 다시 시작하도록 제시되고 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rm -f  /var/lib/mongo/diagnostic.data/*</span><br></pre></td></tr></table></figure>

<p>그리고 <code>/etc/mongod.conf</code>에 full time diagnostic을 비활성화 했다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setParameter:</span><br><span class="line">    diagnosticDataCollectionEnabled: false</span><br></pre></td></tr></table></figure>

<br>
<br/>
## MongoDB 관련 글


<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
<li><a href="dev.paran.com/2011/10/13/why-guardian-chose-mongodb/">왜 Guardian은 MongoDB를 선택했나?</a></li>
<li><a href="dev.paran.com/2011/07/08/mongodb-atfoursquare-biggest-reason-auto-sharding/">포스퀘어가 MongoDB를 선택한 이유</a></li>
</ul>
<p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a><br>[^2]: SBC Sigle Board Computer. Raspberry Pi, Odroid 등등…<br>[^3]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-enterprise-on-debian/">mongodb installation on Debian</a><br>[^10]: <a target="_blank" rel="noopener" href="https://jira.mongodb.org/browse/SERVER-16975">UnsupportedFormat fatal assertion in wiredTiger following</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-05T00:00:00.000Z" title="2017-4-5 9:00:00">2017-04-05</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:41:41.044Z" title="2022-2-25 1:41:41">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">18분안에 읽기 (약 2691 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/05/linux-2017-04-05-crosscompile-arm/">Ubuntu/Debian ARM Cross compile 환경</a></h1><div class="content"><p>이 글은 우분투, 리눅스 박스에서 GNU ARM Cross compiler 를 설치하고 관리하는 방법을 다루고 있다.</p>
<blockquote>
<p>2018-05-17: sidebar.nav&#x2F;linux 사용<br>{: .right-history}</p>
</blockquote>
<h2 id="ARM-Cross-compiler-설치"><a href="#ARM-Cross-compiler-설치" class="headerlink" title="ARM Cross compiler 설치"></a>ARM Cross compiler 설치</h2><p>우분투&#x2F;데비안 리눅스에서 제공하는 ARM Toolchain 환경은 Linaro 툴체인을 바탕으로 만들어져 있어서 두가지 버전으로 제공된다. <em>Hard Float</em>을 지원하는 버전과 그렇지 않은 버전이다.[^1]</p>
<p><strong>(1) gcc-arm-linux-gnueabi</strong></p>
<p>이 툴체인은 EABI가 gcc의 <code>-mfloat-abi=soft</code> 혹은 <code>-mfloat-abi=softfp</code> 옵션으로 생성한다는 의미이다.</p>
<p><strong>(2) gcc-arm-linux-gnueabihf</strong></p>
<p>이 툴체인은 EABI가 <code>gcc -mfloat-abi=hard</code> 옵션으로 생성한다는 의미이다. 이 의미는 Function Calling Convention이 double, float 사용시 FPU 레지스터에 올려서 전달하고 반환도 FPU 레지스터를 사용하게 된다는 것이다.</p>
<h4 id="update-alternatives"><a href="#update-alternatives" class="headerlink" title="update-alternatives"></a>update-alternatives</h4><p>플랫폼에 따른 gcc 환경을 변경하는 것은 <code>update-alternatives</code>을 사용한다. 링크 <a href="/linux/linux-update-alternatives/">update-alternatives</a>에서 설명을 볼 수 있다.</p>
<h3 id="ARM-toolchain-설치"><a href="#ARM-toolchain-설치" class="headerlink" title="ARM toolchain 설치"></a>ARM toolchain 설치</h3><p>Ubuntu 14.04 에서 테스트했다. 그 이상 버전도 충분히 가능하다. 아래 도구를 설치하면 각 플랫폼에 대한 <em>binutils–arm-linux-</em>, <em>gcc-arm-linux-</em>, <em>g++-arm-linux-</em>, <em>cpp-arm-linux-</em> 도구가 설치된다.</p>
<h4 id="Ubuntu14-04-에서-arm-toolchain-설치"><a href="#Ubuntu14-04-에서-arm-toolchain-설치" class="headerlink" title="Ubuntu14.04 에서 arm toolchain 설치"></a>Ubuntu14.04 에서 arm toolchain 설치</h4><p>Coretex ARM</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc-arm-linux-gnueabihf</span><br><span class="line">sudo apt-get install g++-arm-linux-gnueabihf</span><br></pre></td></tr></table></figure>

<p>ARM</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install gcc-arm-linux-gnueabi</span><br><span class="line">$ sudo apt-get install g++-arm-linux-gnueabi</span><br></pre></td></tr></table></figure>

<p>Bare metal ARM</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install gcc-arm-none-eabi</span><br><span class="line">$ sudo apt-get install g++-arm-none-eabi</span><br></pre></td></tr></table></figure>

<p>필요하면 <em>gfortran-arm-linux-</em>, <em>gobjc++-arm-linux-</em> 등의 도구를 설치한다.</p>
<!--

### Linaro toolchain
 - http://www.linaro.org/downloads/#008

Download
Linaro has been very good at changing the location and availability of just about everything, making it very hard to keep a wiki up to date which refers to it. So the below download locations might be stale already.
Currently, the main selection page is here.
It lists the following toolchains:
gcc-linaro 4.5 (4.5-2012.03): Test me
gcc-linaro 4.6 (4.6-2013.05): Test me
gcc-linaro 4.7 (4.7-2014.06): Test me
gcc-linaro 4.8 (4.8-2014.04): Test me
gcc-linaro 4.9 (4.9-2014.07): Test me (this link will go dead the quickest.)
When in doubt, try 4.7 first.
WARNING: Do not use the 4.8 gcc versions of the linaro toolchain to build legacy kernels (sunxi-3.4 etc.), those seem to have issues building the kernel. Use an earlier version instead. (TODO: Verify that this is still true today).

-->

<h3 id="툴-체인-등록"><a href="#툴-체인-등록" class="headerlink" title="툴 체인 등록"></a>툴 체인 등록</h3><p>여러 개발 보드의 cross compiler를 사용하기 위해서 해당 버전의 접두어를 사용해 보자. arm 을 사용하는 보드는 <strong>arm-linux-gnueabi[hf]</strong> 명칭을 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --list arm-linux-gnueabihf</span><br></pre></td></tr></table></figure>

<p>새로운 <em>arm-linux-gnueabihf-</em> 를 등록하자.</p>
<h4 id="arm-linux-gnueabihf-등록하기"><a href="#arm-linux-gnueabihf-등록하기" class="headerlink" title="arm-linux-gnueabihf 등록하기"></a>arm-linux-gnueabihf 등록하기</h4><p>arm-linux-gnueabihf-gcc-4.8 관련 도구를 <strong>gcc</strong> 그룹에 등록하기</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf /usr/bin/arm-linux-gnueabihf-gcc-4.8 50 \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ /usr/bin/arm-linux-gnueabihf-g++-4.8</span><br></pre></td></tr></table></figure>

<p>arm-linux-gnueabihf-gcc-4.7 관련 도구를 <strong>gcc</strong> 그룹에 등록하기</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf /usr/bin/arm-linux-gnueabihf-gcc-4.7 40 \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ /usr/bin/arm-linux-gnueabihf-g++-4.7</span><br></pre></td></tr></table></figure>

<h4 id="Raspberry-pi-Toolchain-등록하기"><a href="#Raspberry-pi-Toolchain-등록하기" class="headerlink" title="Raspberry pi Toolchain 등록하기"></a>Raspberry pi Toolchain 등록하기</h4><p>Raspberry pi 배포본에서 제공하는 arm gcc compile를 arm-linux-gnueabihf 그룹에 등록해 보자 [^2].</p>
<p>git으로 툴체인을 다운받아 <strong>~&#x2F;raspberrypi&#x2F;tools</strong> 에 설치한다고 가정한다. [^3]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/raspberrypi/tools ~/raspberrypi/tools</span><br></pre></td></tr></table></figure>

<p>다운로드한 tools 밑에 32bit, 64bit 버전의 컴파일러가 있다.</p>
<p>32bit 버전은 <code>tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin</code><br>64bit 버전: <code>tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin</code></p>
<p>다운로드 한 후에 적절한 위치에 놓고, 해당 경로를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/rpi-arm/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/</span><br><span class="line">$ arm-linux-gnueabihf-gcc --version</span><br><span class="line">arm-linux-gnueabihf-gcc (crosstool-NG linaro-1.13.1+bzr2650 - Linaro GCC 2014.03) 4.8.3 20140303 (prerelease)</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure>

<p>64bit Raspberry Pi arm-linux-gnueabihf-gcc- 관련 도구를 <strong>gcc</strong> 그룹에 등록하기</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gcc-4.8.3 30 \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-g++</span><br></pre></td></tr></table></figure>

<!--

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gcc-4.8.3 30 \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-g++ \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-ar arm-linux-gnueabihf-gcc-ar ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gcc-ar \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-nm arm-linux-gnueabihf-gcc-nm ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gcc-nm \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-ranlib arm-linux-gnueabihf-gcc-ranlib ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-gcc-ranlib \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-readelf arm-linux-gnueabihf-readelf ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-readelf</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<p>32bit Raspberry Pi arm-linux-gnueabihf-gcc- 관련 도구를 <strong>gcc</strong> 그룹에 등록하기</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/arm-linux-gnueabihf-gcc arm-linux-gnueabihf ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf-gcc-4.8.3 20 \</span><br><span class="line">--slave /usr/bin/arm-linux-gnueabihf-g++ arm-linux-gnueabihf-g++ ~/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf-g++</span><br></pre></td></tr></table></figure>

<p>크로스 플랫폼 환경에서 소스를 빌드하다 보면 GNU Tools 를 해당 그룹에 추가할 필요가 있다. 여기서 예로 든 python 3.6 빌드시 <code>readelf</code> 유틸리티를 요구하는데 우분투 배포본에 <em>arm-linux-gnueabihf-gcc</em> 그룹에 슬레이브로 <code>arm-linux-gnueabihf-readelf</code> 바이너리를 추가해 준다.</p>
<h4 id="64bit-AArch64"><a href="#64bit-AArch64" class="headerlink" title="64bit AArch64"></a>64bit AArch64</h4><p>64-bit ARM, <strong>AARCH64</strong> 을 지원하는 gcc는 <strong>gcc-aarch64-linux-gnu-*</strong> 로 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install binutils-aarch64-linux-gnu gcc-aarch64-linux-gnu g++-aarch64-linux-gnu</span><br></pre></td></tr></table></figure>

<p>이제 <em>arm-linux-gnueabihf-</em> 버전을 교환할 수 있는 환경이 준비됐다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --display arm-linux-gnueabihf</span><br><span class="line">$ sudo update-alternatives --list arm-linux-gnueabihf</span><br></pre></td></tr></table></figure>

<p>설정된 버전 표기</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --list gcc</span><br><span class="line">/usr/bin/gcc-4.8</span><br><span class="line">/usr/bin/gcc-5</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --display gcc</span><br></pre></td></tr></table></figure>

<h4 id="gcc-버전-교체하기"><a href="#gcc-버전-교체하기" class="headerlink" title="gcc 버전 교체하기"></a>gcc 버전 교체하기</h4><p>이렇게 gcc 버전들을 등록해서 설정한 후에 gcc를 교체해서 사용할 수 있다. <code>--config</code> 옵션을 주고 목록에 있는 gcc 버전을 선택한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --config gcc</span><br><span class="line">There are 2 choices for the alternative gcc (providing /usr/bin/gcc).</span><br><span class="line"></span><br><span class="line">  Selection    Path              Priority   Status</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">* 0            /usr/bin/gcc-4.8   20        auto mode</span><br><span class="line">  1            /usr/bin/gcc-4.8   20        manual mode</span><br><span class="line">  2            /usr/bin/gcc-5     10        manual mode</span><br><span class="line"></span><br><span class="line">Press &lt;enter&gt; to keep the current choice[*], or type selection number: 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ g++ --version</span><br><span class="line">g++ (Ubuntu 5.4.0-6ubuntu1~16.04.4) 5.4.0 20160609</span><br><span class="line">Copyright (C) 2015 Free Software Foundation, Inc.</span><br></pre></td></tr></table></figure>

<h3 id="테스트"><a href="#테스트" class="headerlink" title="테스트"></a>테스트</h3><p><code>update-alternatives --config arm-linux-gnueabihf</code> 로 교체해서 다음을 컴파일 해보자.</p>
<h4 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello world !\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ arm-linux-gnueabihf-gcc hello.c -o hello</span><br></pre></td></tr></table></figure>

<h4 id="hello-world-c"><a href="#hello-world-c" class="headerlink" title="hello world c++"></a>hello world c++</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;iostream&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello world !&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>g++로 컴파일 하고</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ arm-linux-gnueabi-g++ hello.cc -o hello</span><br></pre></td></tr></table></figure>

<h4 id="C-std-14"><a href="#C-std-14" class="headerlink" title="C++ std 14"></a>C++ std 14</h4><p>아래는 std++14 이상 컴파일이 필요한 lambda 제너릭 코드이다.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generic lambda is C++14 code</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> lambda = [](<span class="keyword">auto</span> x)&#123; <span class="keyword">return</span> x; &#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">lambda</span>(<span class="string">&quot;Hello generic lambda!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>현재 g++ 버전,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aarch64-linux-gnu-g++ --version</span><br><span class="line">aarch64-linux-gnu-g++ (Ubuntu/Linaro 4.8.4-2ubuntu1~14.04.1) 4.8.4</span><br></pre></td></tr></table></figure>

<p>위 코드를 시스템 gcc 로 컴파일 하면 아래 같이 구문 분석에서 에러가 난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ arm-linux-gnueabihf-g++ -std=c++1y test_cpp14.cpp</span><br><span class="line">hello_cpp14.cpp:6:27: error: parameter declared ‘auto’</span><br></pre></td></tr></table></figure>

<p>c++14 옵션으로</p>
<h4 id="Hardfloat-확인"><a href="#Hardfloat-확인" class="headerlink" title="Hardfloat 확인"></a>Hardfloat 확인</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ arm-linux-gnueabi-gcc -S -O -o hello_float_gnueabi.s hello_float.c</span><br></pre></td></tr></table></figure>

<p>fadd [s | d] 전후에서 범용 레지스터와 FPU 레지스터의 전송을 실시하고 있습니다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ arm-linux-gnueabi-gcc -S -O -o hello_float_gnueabi.s hello_float.c</span><br></pre></td></tr></table></figure>

<p>컴파일 옵션을 자세히 보려면 gcc에 -v 옵션을 쓰면 내부적으로 실행되는 명령과 옵션을 확인할 수 있습니다.</p>
<p>arm-linux-gnueabihf-gcc 는 기본적으로 -march &#x3D; armv7-a -mthumb이므로 Thumb2 코드가 생성됩니다. fpu 유형은 vfpv3-d16 그래서 NEON 없이도 움직일 수있게되어 있네요.</p>
<h4 id="삭제"><a href="#삭제" class="headerlink" title="삭제"></a>삭제</h4><p>설정한 내역을 지워버리고 싶을 때에는 <code>--remove</code> 옵션을 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --remove &lt;name&gt; &lt;path&gt;</span><br></pre></td></tr></table></figure>

<p>udo update-alternatives –remove-all gcc</p>
<p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/26498/choose-gcc-and-g-version">https://askubuntu.com/questions/26498/choose-gcc-and-g-version</a></p>
<br/>
<br/>
## Build with crosscompile

<p>앞서 구성한 우분투 크로스컴파일 환경에서 타겟용 애플리케이션을 빌드해서 타켓 보드에서 실행해 보자.</p>
<h3 id="hardfloat"><a href="#hardfloat" class="headerlink" title="hardfloat"></a>hardfloat</h3><p>Linaro 툴체인은 <em>Hard Float (hf)</em> 을 지원하는데 크로스 컴파일 시에는 아래 처럼 사용한다:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-</span><br></pre></td></tr></table></figure>

<p>사용하는 툴체인이 <em>hardfloat</em> 이 아리라면 <code>arm-linux-gnueabi-</code> 을 <code>arm-linux-gnueabihf-</code> 로 변경해서 사용한다.</p>
<h3 id="Python3-6-빌드"><a href="#Python3-6-빌드" class="headerlink" title="Python3.6 빌드"></a>Python3.6 빌드</h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/devguide/setup.html">Python build setup</a> 을 참고.</p>
<h4 id="파이썬-의존성-패키지-설치"><a href="#파이썬-의존성-패키지-설치" class="headerlink" title="파이썬 의존성 패키지 설치"></a>파이썬 의존성 패키지 설치</h4><p>우분투에서 <code>build-dep</code> 명령으로 의존성 패키지를 설치할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get build-dep python3.6</span><br></pre></td></tr></table></figure>

<p>호스트 머신에 python3.6 배포본이 없다면 3.5 버전으로 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get build-dep python3.5</span><br></pre></td></tr></table></figure>

<p>Fedora, RHE</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install yum-utils</span><br><span class="line">$ sudo yum-builddep python3</span><br></pre></td></tr></table></figure>

<p>DNF 기반 시스템</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dnf install dnf-plugins-core  <span class="comment"># install this to use &#x27;dnf builddep&#x27;</span></span><br><span class="line">$ sudo dnf builddep python</span><br></pre></td></tr></table></figure>

<h4 id="Python-source"><a href="#Python-source" class="headerlink" title="Python source"></a>Python source</h4><p>소스를 받고, 호스트에 3.6이 없으면 호스트에 3.6 을 설치해야 한다.</p>
<p><code>./configure --help</code> 로 필요한 구성을 알아보자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System types:</span><br><span class="line">  --build=BUILD     configure for building on BUILD [guessed]</span><br><span class="line">  --host=HOST       cross-compile to build programs to run on HOST [BUILD]</span><br><span class="line">  --target=TARGET   configure for building compilers for TARGET [HOST]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd Python-3.6/</span><br><span class="line">./configure</span><br><span class="line">./configure --enable-optimizations</span><br></pre></td></tr></table></figure>

<h4 id="Cross-compile"><a href="#Cross-compile" class="headerlink" title="Cross compile"></a>Cross compile</h4><p>호스트에서 빌드하고 설치한 소스에서 크로스 컴파일을 위해 다음 작업을 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">make python Parser/pgen</span><br><span class="line">mv python hostpython</span><br><span class="line">mv Parser/pgen Parser/hostpgen</span><br><span class="line">make distclean</span><br></pre></td></tr></table></figure>

<p>그리고 빌드를 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CC=arm-linux-gnueabihf-gcc CXX=arm-linux-gnueabihf-g++ AR=arm-linux-gnueabihf-ar RANLIB=arm-linux-gnueabihf-ranlib READELF=arm-linux-gnueabihf-readelf ./configure --host=arm-linux --build=arm-linux-gnueabihf --prefix=../output/python --disable-ipv6 ac_cv_file__dev_ptmx=no ac_cv_file__dev_ptc=no ac_cv_have_long_long_format=yes --enable-shared</span><br></pre></td></tr></table></figure>

<!--

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CC=arm-linux-gnueabihf-gcc CXX=arm-linux-gnueabihf-g++ AR=arm-linux-gnueabihf-ar RANLIB=arm-linux-gnueabihf-ranlib READELF=~/rpi-arm/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/arm-linux-gnueabihf-readelf ./configure --host=arm-linux --build=arm-linux-gnueabihf --prefix=/home/qkboo/Works/rpi-arm/output/python --disable-ipv6 ac_cv_file__dev_ptmx=no ac_cv_file__dev_ptc=no ac_cv_have_long_long_format=yes --enable-shared</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<p>빌드한 결과물은 <em>..&#x2F;output&#x2F;python</em> 에 결과물이 저장된다 이것을 tar로 묶어 라즈베리파이, 오렌지파이 등의 ARM 보드에 올린다.</p>
<p>타겟보드에 업로드한 결과물을 &#x2F;usr&#x2F;local&#x2F;python3.6 폴더로 압축을 푼다.</p>
<h4 id="경로-추가"><a href="#경로-추가" class="headerlink" title="경로 추가"></a>경로 추가</h4><p><code>.profile</code> 에 python3.6 디렉토리에 대한 PATH, LD_LIBRARY_PATH, MANPATH 를 구성해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Python3.6</span><br><span class="line">export PATH=&quot;/usr/local/python3.6/bin:$PATH&quot;</span><br><span class="line">export LD_LIBRARY_PATH=&quot;$LD_LIBRARY_PATH:/usr/local/python3.6/lib&quot;</span><br><span class="line">export MANPATH=&quot;$MANPATH:/usr/local/python3.6/share/man&quot;</span><br></pre></td></tr></table></figure>

<p>쉘을 재시작 혹은 로그아웃후 로그인하면 해당 경로가 설정된다. 이제 파이썬 3.6을 사용할 수 있다.</p>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="https://mentorlinux.files.wordpress.com/2013/02/kernel-compilation-ml.pdf">Linux Kernel Cross Compilation</a></li>
<li><a target="_blank" rel="noopener" href="http://events.linuxfoundation.org/sites/events/files/slides/Shuah_Khan_cross_compile_linux.pdf">http://events.linuxfoundation.org/sites/events/files/slides/Shuah_Khan_cross_compile_linux.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://datko.net/2013/05/10/cross-compiling-python-3-3-1-for-beaglebone-arm-angstrom/">Cross-compiling Python 3.3.1 for Beaglebone (arm-angstrom)</a></li>
</ul>
<p>[^1]: <a target="_blank" rel="noopener" href="http://nairobi-embedded.org/050_linaro_arm_toolchain.html">Linaro Arm Toolchain</a><br>[^2]: <a target="_blank" rel="noopener" href="https://github.com/Yadoms/yadoms/wiki/Cross-compile-for-raspberry-PI">Cross compile for raspberry PI</a><br>[^3]: <a target="_blank" rel="noopener" href="https://www.raspberrypi.org/documentation/linux/kernel/building.md">Building Kernel</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-03T11:00:00.000Z" title="2017-4-3 20:00:00">2017-04-03</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:15:34.955Z" title="2022-2-25 1:15:34">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">21분안에 읽기 (약 3216 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/03/linux-2017-04-03-linux-basic-securities/">Ubuntu/Debian Basic Security settings</a></h1><div class="content"><p>리눅스 시스템을 설치후 기본적인 보안 설정과 도구를 사용하는 과정을 정리했다.</p>
<ul>
<li>firewall 과 sshd</li>
<li>rootkit</li>
<li>fail2ban</li>
</ul>
<h2 id="Firewall과-ssh-보안-구성"><a href="#Firewall과-ssh-보안-구성" class="headerlink" title="Firewall과 ssh 보안 구성"></a>Firewall과 ssh 보안 구성</h2><p>사용자 로그인에 제약을 두고, 원격 접속에 대해서 방화벽과 sshd 보안을 강화한다.</p>
<h3 id="sudoer-등록"><a href="#sudoer-등록" class="headerlink" title="sudoer 등록"></a>sudoer 등록</h3><p>처음 로그인후 새로운 사용자 등록하고 suders에 직접 권한을 줄 수 있다. </p>
<h3 id="sudo-새-사용자-등록"><a href="#sudo-새-사용자-등록" class="headerlink" title="sudo 새 사용자 등록"></a>sudo 새 사용자 등록</h3><p>sudo 사용자를 추가해서 사용하려면, adduser 혹은 useradd 명령을 사용해서 사용자를 등록 할 수 있다. </p>
<h4 id="새-사용자-등록"><a href="#새-사용자-등록" class="headerlink" title="새 사용자 등록"></a>새 사용자 등록</h4><p>먼저 adduser를 사용한 등록은,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># adduser qkboo</span><br><span class="line">Adding user `qkboo&#x27; ...</span><br><span class="line">Adding new group `qkboo&#x27; (1000) ...</span><br><span class="line">Adding new user `qkboo&#x27; (1000) with group `qkboo&#x27; ...</span><br><span class="line">Creating home directory `/home/qkboo&#x27; ...</span><br><span class="line">Copying files from `/etc/skel&#x27; ...</span><br><span class="line">Enter new UNIX password:</span><br><span class="line">Retype new UNIX password:</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the user information for qkboo</span><br><span class="line">Enter the new value, or press ENTER for the default</span><br><span class="line">        Full Name []: Gangtai</span><br><span class="line">        Room Number []:</span><br><span class="line">        Work Phone []:</span><br><span class="line">        Home Phone []:</span><br><span class="line">        Other []:</span><br><span class="line">Is the information correct? [Y/n] y</span><br></pre></td></tr></table></figure>

<p><code>useradd</code> 는 홈 디렉토리, 쉘 등에 대한 옵션을 주고 사용자를 등록한다.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.tecmint.com/add-users-in-linux/">http://www.tecmint.com/add-users-in-linux/</a></p>
</blockquote>
<p>‘useradd‘ 명령은 크게 두가지 일을 한다:</p>
<ul>
<li>추가한 사용자에 대한 &#x2F;etc&#x2F;passwd, &#x2F;etc&#x2F;shadow, &#x2F;etc&#x2F;group and &#x2F;etc&#x2F;gshadow 편집</li>
<li>사용자 홈 디렉토리 생성</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo  useradd -m qkboo</span><br></pre></td></tr></table></figure>

<p>그리고 패스워드를 등록한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo passwd qkboo</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: password updated successfully</span><br></pre></td></tr></table></figure>


<p>userdel 로 사용자 완전 삭제시</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ userdel -r sambaguest</span><br></pre></td></tr></table></figure>



<h4 id="visudo"><a href="#visudo" class="headerlink" title="visudo"></a>visudo</h4><p><strong>visudo</strong> 명령으로 sudoers 파일을 편집할 수 있다. sudoer에 있는 root는 제외하고 사용자로 등록한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo visudo</span><br><span class="line"><span class="comment"># User privilege specification</span></span><br><span class="line">pi  ALL=(ALL:ALL) ALL</span><br></pre></td></tr></table></figure>

<p>sudo 사용자를 sudo 그룹에 등록해 둔다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG sudo pi</span><br></pre></td></tr></table></figure>


<h3 id="ufw를-사용한-방화벽-등록"><a href="#ufw를-사용한-방화벽-등록" class="headerlink" title="ufw를 사용한 방화벽 등록"></a>ufw를 사용한 방화벽 등록</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install ufw</span><br></pre></td></tr></table></figure>

<p>방화벽 기본 규칙을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default deny incoming</span><br><span class="line">$ sudo ufw default allow outgoing</span><br></pre></td></tr></table></figure>

<p>리눅스 방화벽 구성에 대해서는 포스트 <a href="/linux/2017/04/03/ubuntu-firewall.html">UFW Firewall on Ubuntu&#x2F;Debian</a> 에 자세히 설명하고 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow ssh</span><br><span class="line">$ sudo ufw allow http</span><br><span class="line">$ sudo ufw allow https</span><br></pre></td></tr></table></figure>

<p>그리고 ufw로 방화벽을 활성화 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status</span><br><span class="line">Status: inactive</span><br><span class="line"></span><br><span class="line">$ sudo ufw enable</span><br></pre></td></tr></table></figure>

<p>현재 서버의 열린 포트는 다음 같이 <code>netstat</code> 명령으로 확인이 가능하다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -tlnp</span><br></pre></td></tr></table></figure>


<h4 id="ping-icmp-허용-x2F-거부"><a href="#ping-icmp-허용-x2F-거부" class="headerlink" title="ping (icmp) 허용&#x2F;거부"></a>ping (icmp) 허용&#x2F;거부</h4><p>UFW 기본설정은 ping 요청을 허용하도록 되어있다. 이것은 <code>/etc/ufw/before.rules</code> 파일에 정의되어 있는데 여기서 icmp 프로토콜 관련한 항목을 DROP으로 처리하거나 삭제하면 <strong>ping</strong>을 방지할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> # ok icmp codes</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type destination-unreachable -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type source-quench -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type time-exceeded -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type parameter-problem -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type echo-request -j ACCEPT</span><br></pre></td></tr></table></figure>


<p>samba 허용</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow Samba</span><br><span class="line">$ sudo ufw allow from 192.168.0.0/16 to any app Samba</span><br></pre></td></tr></table></figure>

<p>syslog 에 패킷 필터링 결과를 로깅 하려면,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw logging on</span><br><span class="line">Logging enabled</span><br></pre></td></tr></table></figure>

<p>리눅스 방호벽에 ssh 허용한다. ufw를 사용한다면 다음 같이 해준다.</p>
<p>ssh 보안</p>
<p>ssh Brute-force Attack 방어</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw limit ssh</span><br></pre></td></tr></table></figure>


<p>ssh를 특정 IP 주소에만 접속을 허용한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.0.100 to any port 22</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.0.100 to any port 22 proto tcp</span><br></pre></td></tr></table></figure>


<h3 id="sshd-보안-구성"><a href="#sshd-보안-구성" class="headerlink" title="sshd 보안 구성"></a>sshd 보안 구성</h3><p>ssh 사용에 특정한 사용자, 호스트 등에서만 사용하도록 제한하게 구성한다.</p>
<h4 id="sshd-config-수정"><a href="#sshd-config-수정" class="headerlink" title="sshd_config 수정"></a>sshd_config 수정</h4><p> &#x2F;etc&#x2F;ssh&#x2F;sshd_config에서 다음 내용으로 수정한다.</p>
<p>포트, IP, Time out 시간을 지정할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#sshd 포트넘버 변경 (Port)</span><br><span class="line">Port 2222</span><br><span class="line"></span><br><span class="line">#sshd Listen Address</span><br><span class="line">ListenAddress 192.168.0.200</span><br><span class="line"></span><br><span class="line"># alive 메시지 사용 결정</span><br><span class="line">TCPKeepAlive no  # 기본 yes.</span><br><span class="line"></span><br><span class="line"># 클라이언트가 살아있는지 확인하는 간격.</span><br><span class="line">ClientAliveInterval 60  # 기본 0.</span><br><span class="line"># 클라이언트에서 응답이 없을 때 메시지를 보내는 횟수</span><br><span class="line">ClientAliveCountMax 3    # 확인 횟수</span><br><span class="line"></span><br><span class="line"># Login Prompt에서 사용자 입력을 기다리는 시간을 초 단위로 입력.</span><br><span class="line">LoginGraceTime 20  #( 1m: 기본 1분지정, 0은 시간제한없음)</span><br></pre></td></tr></table></figure>

<p>사용자 계정에 대한 접근</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># no로 설정하면 root 계정으로 Login 불가능.</span><br><span class="line">PermitRootLogin no</span><br><span class="line"></span><br><span class="line"># SSH 접속을 통해 Login을 허용할 User를 지정. 지정된 User 외의 접속은 차단됨.</span><br><span class="line"># 여러 계정 입력시 Space로 구분.</span><br><span class="line">AllowUsers foo</span><br><span class="line"></span><br><span class="line"># sudo(관리자)그룹만 로그인가능( 다른 유저들도 ssh로그인을 가능하게 하려면 이부분 삭제 )</span><br><span class="line">AllowGroups sudo</span><br><span class="line"></span><br><span class="line"># 모두 접속이 허용, 여기에 등록된 group만 접속 거부됨</span><br><span class="line">#DenyGroups</span><br><span class="line"># 모두 접속이 허용, 여기에 등록된 계정만 접속 거부됨</span><br><span class="line">#DenyUsers </span><br></pre></td></tr></table></figure>



<h4 id="issue-이용"><a href="#issue-이용" class="headerlink" title="issue 이용"></a>issue 이용</h4><p>ssh 로그인시 <strong>Banner</strong>로 지정한 Text File의 내용을 Login Prompt에 출력한다. 시스템 접근에 대한 사전 경고이다.</p>
<p><em>&#x2F;etc&#x2F;ssh&#x2F;sshd_config</em> 에 Banner를 추가한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 설정한 경로에 존재하는 Text File의 내용을 Login Prompt에 출력.</span><br><span class="line">Banner /etc/issue.net</span><br></pre></td></tr></table></figure>

<p>그리고 <em>&#x2F;etc&#x2F;issue.net</em> 파일에 다음 경고를 넣어준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; ***************************************************************************</span><br><span class="line">&gt;                             NOTICE TO USERS</span><br><span class="line">&gt; </span><br><span class="line">&gt; This computer system is the private property of its owner, whether</span><br><span class="line">&gt; individual, corporate or government.  It is for authorized use only.</span><br><span class="line">&gt; Users (authorized or unauthorized) have no explicit or implicit</span><br><span class="line">&gt; expectation of privacy.</span><br><span class="line">&gt; </span><br><span class="line">&gt; Any or all uses of this system and all files on this system may be</span><br><span class="line">&gt; intercepted, monitored, recorded, copied, audited, inspected, and</span><br><span class="line">&gt; disclosed to your employer, to authorized site, government, and law</span><br><span class="line">&gt; enforcement personnel, as well as authorized officials of government</span><br><span class="line">&gt; agencies, both domestic and foreign.</span><br><span class="line">&gt; </span><br><span class="line">&gt; By using this system, the user consents to such interception, monitoring,</span><br><span class="line">&gt; recording, copying, auditing, inspection, and disclosure at the</span><br><span class="line">&gt; discretion of such personnel or officials.  Unauthorized or improper use</span><br><span class="line">&gt; of this system may result in civil and criminal penalties and</span><br><span class="line">&gt; administrative or disciplinary action, as appropriate. By continuing to</span><br><span class="line">&gt; use this system you indicate your awareness of and consent to these terms</span><br><span class="line">&gt; and conditions of use. LOG OFF IMMEDIATELY if you do not agree to the</span><br><span class="line">&gt; conditions stated in this warning.</span><br><span class="line">&gt; </span><br><span class="line">&gt; ****************************************************************************</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>systemd 를 사용하면,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart sshd.service</span><br><span class="line">$ sudo systemctl status sshd.service</span><br></pre></td></tr></table></figure>

<p>upstart를 사용하면,</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service ssh restart</span><br></pre></td></tr></table></figure>


<h3 id="공개키-방식을-이용"><a href="#공개키-방식을-이용" class="headerlink" title="공개키 방식을 이용"></a>공개키 방식을 이용</h3><p>일반 패스워드를 사용하는 로그인 방식보다 rsa 키를 이용한 접속이 보다 보안에 좋다. 그리고 일단 한번 설정해 놓으면 편하다.</p>
<p>서버에 <code>/etc/ssh/sshd_config </code> 설정에서 rsa키 사용에 대한 설정이 제대로인지 살펴본다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PubkeyAuthentication yes</span><br><span class="line">RSAAuthentication yes</span><br></pre></td></tr></table></figure>

<h4 id="ssh-클라이언트"><a href="#ssh-클라이언트" class="headerlink" title="ssh 클라이언트"></a>ssh 클라이언트</h4><p>클라이언트에서 공개키 생성을 한다. 키의 크기를 높이려면 <code>-b</code> 옵션으로 1024, 2048, 4096 값을 제시한다. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(CLIENT)$ mkdir ~/.ssh</span><br><span class="line">(CLIENT)$ chmod 700 ~/.ssh</span><br><span class="line">(CLIENT)$ ssh-keygen -t rsa -b 4096 -C &quot;USER@CLIENT_HOST&quot;</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/Users/daddy/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /Users/daddy/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /Users/daddy/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:nBbRg+tTnmEbyuqzb0cqeBfzuaj1XOJP3n767Xmj3s0 USER@CLIENT_HOST</span><br><span class="line">The key\&#x27;s randomart image is:</span><br><span class="line">+---[RSA 4096]----+</span><br><span class="line">|        .o       |</span><br><span class="line">|        ..o      |</span><br><span class="line">|        .. .     |</span><br><span class="line">|       ..o=      |</span><br><span class="line">|       oS= =     |</span><br><span class="line">|       .B =      |</span><br><span class="line">|     . ..B..o    |</span><br><span class="line">|    . =.+=+= ..o*|</span><br><span class="line">|     o+Oo.=o++=BE|</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure>

<p>개인 비밀키와 공개키 파일이 <em>~&#x2F;.ssh</em> 폴더에 기본 파일이름 <em>id_rsa.pub</em>, <em>id_rsa.prb</em> 파일로 저장된다.</p>
<h4 id="서버에서-할일"><a href="#서버에서-할일" class="headerlink" title="서버에서 할일"></a>서버에서 할일</h4><p>서버에서 비밀키를 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(SERVER)$ ssh-keygen -t rsa -b 4096 -C <span class="string">&quot;USER@SERVER&quot;</span></span><br><span class="line">(SERVER)$ <span class="built_in">chmod</span> 700 ~/.ssh</span><br></pre></td></tr></table></figure>


<h4 id="클라이언트-공개키를-서버-배포"><a href="#클라이언트-공개키를-서버-배포" class="headerlink" title="클라이언트 공개키를 서버 배포"></a>클라이언트 공개키를 서버 배포</h4><p>서버로 id_rsa.pub를 scp 로 복사해서 authorized_keys 파일에 더해주면 된다. 아래 같이 할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub | ssh USER@SERVER <span class="string">&#x27;cat &gt;&gt; .ssh/authorized_keys&#x27;</span></span><br></pre></td></tr></table></figure>

<p>scp로 복사하고 서버에서 authorized_keys 파일에 더해줄 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(CLIENT)$ scp ~/.ssh/id_rsa.pub USER@SERVER:~/client.pub</span><br><span class="line">(CLIENT)$ ssh userid@SERVER</span><br><span class="line">(SERVER)$ <span class="built_in">cat</span> client.pub &gt;&gt; .ssh/authorized_keys; <span class="built_in">rm</span> client.pub</span><br></pre></td></tr></table></figure>

<p>이제 해당 서버로 로그인해 본다.</p>
<blockquote>
<p>아래 같이 시스템 명칭을 주고 생성할 수 도 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;Raspberry Pi #123&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>권한은 아래와 같이 클라이언트와 서버 모두 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~/.ssh/id_rsa</span><br><span class="line">chmod 644 ~/.ssh/id_rsa.pub</span><br><span class="line">chmod 644 ~/.ssh/authorized_keys</span><br><span class="line">chmod 644 ~/.ssh/known_host</span><br></pre></td></tr></table></figure>

<p>그리고 클라이언트에서 서버로 ssh 접속을 해본다. 로그인 과정 없이 로그인되면 공개키 방식의 인증이 마무리되ㅓㅇㅆ다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(CLIENT)$ ssh USER@SERVER</span><br></pre></td></tr></table></figure>


<h4 id="개인키-파일을-이용한-로그인"><a href="#개인키-파일을-이용한-로그인" class="headerlink" title="개인키 파일을 이용한 로그인"></a>개인키 파일을 이용한 로그인</h4><p><em>-i</em> 옵션을 이용하면 개인키를 여러개 만들어 두고 서버 마다 달리 로그인 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i .ssh/개인키 id@host-Name  </span><br></pre></td></tr></table></figure>


<h2 id="Root-kit"><a href="#Root-kit" class="headerlink" title="Root kit"></a>Root kit</h2><h3 id="chkrootkit"><a href="#chkrootkit" class="headerlink" title="chkrootkit"></a>chkrootkit</h3><ul>
<li>루트킷 탐지 프로그램</li>
<li>일반적인 루트킷, 커널 기반 루트킷, Worm 까지도 탐지 가능</li>
</ul>
<h4 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install chkrootkit</span><br></pre></td></tr></table></figure>


<p>컴파일로 빌드 설치시 <code>http://www.chkrootkit.org/</code> 에서 다운로드후 빌드한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf chkrootkit.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> chkrootkit-0.50</span><br><span class="line">$ make sense</span><br></pre></td></tr></table></figure>

<h4 id="루트킷-실행"><a href="#루트킷-실행" class="headerlink" title="루트킷 실행"></a>루트킷 실행</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chkrootkit</span><br></pre></td></tr></table></figure>

<p><code>not infected</code>, <code>not found</code> 가 아닌 경우 잘 살펴보자.</p>
<h3 id="rkhunter"><a href="#rkhunter" class="headerlink" title="rkhunter"></a>rkhunter</h3><p> Rootkit이 System에 설치되어 있는지 Check합니다. <code>chkrootkit</code> 에서 검사하지 않는 설정 파일들이나 서버 계정 등 을 검사 하기 때문에 chkrootkit 과 함께 사용하면 좋다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install rkhunter</span><br></pre></td></tr></table></figure>

<ul>
<li>설치 시에 MTA(Matil Transfer Agent)인 Postfix가 의존성으로 같이 설치됩니다.</li>
</ul>
<blockquote>
<p>RPi Jessie에서 설치시 <em>rkhunter Invalid SCRIPTWHITELIST configuration option: Non-existent pathname: &#x2F;usr&#x2F;bin&#x2F;lwp-request</em> 경고 발생<br><code>lwp-request</code>는 명령행 HTTP 사용자 에이전트로 사용하지 않는다면 &gt; &#x2F;etc&#x2F;rkhunter.conf에 있는 <strong>SCRIPTWHITELIST &#x2F;usr&#x2F;bin&#x2F;lwp-request</strong> 주석 처리<br>참조: <a target="_blank" rel="noopener" href="http://search.cpan.org/dist/libwww-perl/bin/lwp-request">lwp-request</a></p>
</blockquote>
<h4 id="실행"><a href="#실행" class="headerlink" title="실행"></a>실행</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rkhunter -c</span><br></pre></td></tr></table></figure>


<p>skip</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rkhunter -c --skip-keypress --pkgmgr dpkg</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rkhunter -c -sk                       // --skip-keypress</span><br></pre></td></tr></table></figure>



<h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><p>properties update</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rkhunter --propupd</span><br></pre></td></tr></table></figure>

<p>업데이트 점검</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo rkhunter --update</span><br></pre></td></tr></table></figure>


<h4 id="cron-설정"><a href="#cron-설정" class="headerlink" title="cron 설정"></a>cron 설정</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/default/rkhunter</span><br><span class="line"></span><br><span class="line">CRON_DAILY_RUN=&quot;true&quot;</span><br><span class="line">CRON_DB_UPDATE=&quot;true&quot;</span><br><span class="line">APT_AUTOGEN=&quot;true&quot; </span><br></pre></td></tr></table></figure>


<p>자세한 결과가 저장된 &#x2F;var&#x2F;log&#x2F;rkhunter.log의 내용을 토대로 Google에서 검색하거나 <a target="_blank" rel="noopener" href="https://lists.sourceforge.net/lists/listinfo/rkhunter-users">Rkhunter Users Mailing List</a>를 이용한다.</p>
<blockquote>
<p>&#x2F;var&#x2F;log&#x2F;rkhunter.log</p>
</blockquote>
<br/>
## Fail2ban

<p>로그를 검사해 의심스런 IP 를 찾아 Firewall rule에 등록해 관리하는 것은 어려운 과정이다. <em>Fail2ban</em>은 정규표현식을 사용해서 로그에서 의심스런 IP를 찾아 Firewall 등록 할 수 있도록 해준다.</p>
<h3 id="설치-1"><a href="#설치-1" class="headerlink" title="설치"></a>설치</h3><p><code>fail2ban</code> 은 <code>iptables</code> 패키지와 함께 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install iptables fail2ban</span><br></pre></td></tr></table></figure>

<p>그리고 <code>systemctl</code> 로 재대로 서비스가 시작되는지 확인해 본다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart fail2ban.service    <span class="comment"># 재시작</span></span><br><span class="line">$ sudo systemctl status fail2ban.service     <span class="comment"># running 상태 확인</span></span><br></pre></td></tr></table></figure>

<p>설정을 위해서 <code>fail2ban</code> 설정 파일인 fail2ban.conf, 그리고 jail 파일 jail.conf 파일을 <code>.local</code> 파일로 복사한 사용자 정의 파일에서 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /etc/fail2ban</span><br><span class="line">$ sudo <span class="built_in">cp</span> fail2ban.conf fail2ban.local       <span class="comment"># 설정파일</span></span><br><span class="line">$ sudo <span class="built_in">cp</span> jail.conf jail.local               <span class="comment"># jail 설정</span></span><br></pre></td></tr></table></figure>

<h4 id="x2F-etc-x2F-fail2ban-디렉토리"><a href="#x2F-etc-x2F-fail2ban-디렉토리" class="headerlink" title="&#x2F;etc&#x2F;fail2ban 디렉토리"></a>&#x2F;etc&#x2F;fail2ban 디렉토리</h4><p>주요 파일,</p>
<ul>
<li>fail2ban.local : <code>fail2ban</code> 주요 설정 파일</li>
<li>jail.local: jail 설정 파일</li>
<li>jail.d&#x2F;defaults-debian.conf: jail enable&#x2F;disable </li>
<li>paths-common.conf: 로그 파일 경로</li>
<li>paths-debian.conf: 로그 파일 경로</li>
</ul>
<h4 id="fail2ban-local"><a href="#fail2ban-local" class="headerlink" title="fail2ban.local"></a>fail2ban.local</h4><p>fail2ban 에서 전역 설정을 무선언해 줍니다. 예를 들어 검출된 IP중에 무시할 영역을 선언해 줍니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">ignoreip = 127.0.0.1/8 192.168.0.1/24</span><br><span class="line">bantime = 2592000   # 금지 시간을 늘린다.</span><br><span class="line">maxretry = 3        # 금지된 행위 시도 횟수</span><br></pre></td></tr></table></figure>


<h4 id="jail-local"><a href="#jail-local" class="headerlink" title="jail.local"></a>jail.local</h4><p><strong>jail.d&#x2F;defaults-debian.conf</strong> 파일에 jail 을 활성화 혹은 비활성화 시킨다. 기본으로 <strong>sshd</strong> 만 활성화 되어 있다. 아래는 nginx 에 대해서도 활성화 했다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[sshd]</span><br><span class="line">enabled = true</span><br><span class="line"></span><br><span class="line">[nginx-http-auth]</span><br><span class="line">enabled = true</span><br><span class="line"></span><br><span class="line">[nginx-botsearch]</span><br><span class="line">enabled = true</span><br></pre></td></tr></table></figure>


<h4 id="시스템-서비스-포트-확인"><a href="#시스템-서비스-포트-확인" class="headerlink" title="시스템 서비스 포트 확인"></a>시스템 서비스 포트 확인</h4><p>현재 시스템의 활성화되어 있는 포트는 <code>netstat</code> 명령으로 확인할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo netstat -tulpen</span><br><span class="line">tcp        0      0 127.0.1.1:53            0.0.0.0:*               LISTEN      0          12762       731/dnsmasq</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      0          16387       670/sshd</span><br><span class="line">tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      0          10674       708/nginx -g daemon</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>열려 있는 포트를 fail2ban 의 jail을 활성화해서 방화벽으로 감시하면 된다.</p>
<h3 id="fail2ban-사용"><a href="#fail2ban-사용" class="headerlink" title="fail2ban 사용"></a>fail2ban 사용</h3><p>fail2ban-client, fail2ban-regex 명령을 이용해 jail의 ban 상태를 확인하거나 테스트 할 수 있다.</p>
<h4 id="Jail-실행-확인"><a href="#Jail-실행-확인" class="headerlink" title="Jail 실행 확인"></a>Jail 실행 확인</h4><p>fail2ban-client 명령으로 해당 jail을 확인 할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-client status</span><br><span class="line">Status</span><br><span class="line">|- Number of jail:  6</span><br><span class="line"> - Jail list:   nginx-noproxy, nginx-noscript, nginx-nohome, nginx-badbots, sshd</span><br></pre></td></tr></table></figure>

<p>전체 jail 중에 특정한 것만 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Status for the jail: ssh</span><br><span class="line">|- filter</span><br><span class="line">|  |- File list:        /var/log/auth.log</span><br><span class="line">|  |- Currently failed: 208</span><br><span class="line">|  `- Total failed:     4357</span><br><span class="line">`- action</span><br><span class="line">   |- Currently banned: 679</span><br><span class="line">   |  `- IP list:       2.176.38.209 116.31.116.53 181.21.6.110 153.171.66.99 190.67.247.209 201.179.200.15 103.207...</span><br></pre></td></tr></table></figure>

<h4 id="테스트"><a href="#테스트" class="headerlink" title="테스트"></a>테스트</h4><p>의심스런 동작을 Filter로 선언해서 사용하는데 해당 필터를 점검해야할 필요가 있다. 다음</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fail2ban-regex /var/log/auth.log /etc/fail2ban/filter.d/sshd.conf</span><br></pre></td></tr></table></figure>


<h3 id="lastb"><a href="#lastb" class="headerlink" title="lastb"></a>lastb</h3><h4 id="실패한-로그인-시도"><a href="#실패한-로그인-시도" class="headerlink" title="실패한 로그인 시도"></a>실패한 로그인 시도</h4><p><a target="_blank" rel="noopener" href="https://www.guyrutenberg.com/2014/09/26/view-failed-login-attempts-lastb/">View Failed Login Attempts – lastb</a> 참조.</p>
<p><code>-w</code> 로 사용자 이름을 출력하고 첫번째 열만 자른 후 정렬한 후, <code>uniq</code> 명령으로 중복되는 이름을 제거한 후 출력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lastb -w | cut -d &quot; &quot; -f 1 | sort | uniq | less</span><br></pre></td></tr></table></figure>



<p>이중에서 접속한 IP와 횟수를 출력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lastb -f /var/log/btmp.1 -w -i | awk &#x27;&#123;print $3&#125;&#x27; | sort | uniq --count | sort -nr | less</span><br><span class="line"></span><br><span class="line">[sudo] root의 암호:</span><br><span class="line">   2166 112.85.42.156</span><br><span class="line">   1945 112.85.42.193</span><br><span class="line">   1591 112.85.42.201</span><br><span class="line">   1327 112.85.42.230</span><br><span class="line">   1146 112.85.42.196</span><br></pre></td></tr></table></figure>




<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p> [^1]: <a target="_blank" rel="noopener" href="https://davidhyk.github.io/blog/things-you-should-do-to-secure-ubuntu-part1">Ubuntu Server의 보안을 위해서 해야 할 것들 (Part 1)</a><br> [^2]:  <a target="_blank" rel="noopener" href="https://davidhyk.github.io/blog/things-you-should-do-to-secure-ubuntu-part2">Ubuntu Server의 보안을 위해서 해야 할 것들 (Part 2)</a><br> [^3]:  <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-protect-ssh-with-fail2ban-on-ubuntu-14-04">How To Protect SSH with Fail2Ban on Ubuntu 14.04</a><br> [^4]:  <a target="_blank" rel="noopener" href="http://webdir.tistory.com/206">우분투 방화벽(UFW) 설정  </a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-03T05:00:00.000Z" title="2017-4-3 14:00:00">2017-04-03</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:15:34.958Z" title="2022-2-25 1:15:34">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">13분안에 읽기 (약 1954 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/03/linux-2017-04-03-ubuntu-firewall/">UFW Firewall on Ubuntu/Debian</a></h1><div class="content"><p>일반적인 리눅스 배포본의 방화벽인 ufw&#96; 를 사용해서 리눅스에 방화벽을 구축하는 방법을 기술하고 있다.</p>
<blockquote>
<ul>
<li>2019-12-10: 정리</li>
<li>2017-09-10: Log, export 추가서<br>{:.right-history}</li>
</ul>
</blockquote>
<p>여기서 사용, 테스트한 리눅스 배포본은 Ubuntu 14.04, 15.04, 16.04 계열에서 동작하리라 믿는다. 실제 Raspbian Weezy, Jessie, Armbian Ubuntu 16.04, Debian Jessie 에서 사용중이다.</p>
<br/>
<br/>

<h2 id="UFW-Uncomplicated-Firewall"><a href="#UFW-Uncomplicated-Firewall" class="headerlink" title="UFW - Uncomplicated Firewall"></a>UFW - Uncomplicated Firewall</h2><p>Ubuntu의 기본 방화벽 두고는 UFW이다. 데스크탑을 위한 GUI 버전 <a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/Gufw">Gufw</a> 도 있다. [^2]</p>
<h4 id="ufw-설치"><a href="#ufw-설치" class="headerlink" title="ufw 설치"></a>ufw 설치</h4><p>다음 같이 ufw 패키지를 설치한다.</p>
<blockquote>
<p>내부에서 서버로 운영중인 ARM 계열의 SBC 컴퓨터인 Raspberry Pi, Odroid, OrangePi 등의 배포본에는 ufw가 빠져 있다.</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install ufw</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl status ufw</span><br><span class="line">* ufw.service - Uncomplicated firewall</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/ufw.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: inactive (dead)</span><br></pre></td></tr></table></figure>

<p>방화벽 서비스를 시작한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start ufw</span><br><span class="line">$ sudo systemctl status ufw</span><br><span class="line">* ufw.service - Uncomplicated firewall</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/ufw.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (exited) since Tue 2019-12-10 02:21:19 UTC; 1s ago</span><br><span class="line">     Docs: man:ufw(8)</span><br><span class="line">  Process: 2750 ExecStart=/lib/ufw/ufw-init start quiet (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 2750 (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">Dec 10 02:21:19 rock64 systemd[1]: Starting Uncomplicated firewall...</span><br><span class="line">Dec 10 02:21:19 rock64 systemd[1]: Started Uncomplicated firewall.</span><br></pre></td></tr></table></figure>

<p>이제 ufw 를 활성화 하고 구성 내용을 설정해야 한다.</p>
<h3 id="방화벽-구성-설정"><a href="#방화벽-구성-설정" class="headerlink" title="방화벽 구성 설정"></a>방화벽 구성 설정</h3><p>방화벽은 다음 같이 설정한다</p>
<ul>
<li>기본 규칙</li>
<li>프로토콜, 포트 규칙 추가</li>
<li>방화벽 활성화</li>
</ul>
<h4 id="방화벽-기본-설정"><a href="#방화벽-기본-설정" class="headerlink" title="방화벽 기본 설정"></a>방화벽 기본 설정</h4><p>기본 정책을 설정 한다 - (들어오는 패킷은 차단, 나가는 패킷은 허용)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default deny incoming</span><br><span class="line">$ sudo ufw default allow outgoing</span><br></pre></td></tr></table></figure>

<p>현재 방화벽 기본 정책을 확인한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status</span><br></pre></td></tr></table></figure>

<p>설정한 규칙과 이에 따른 액션을 확인해 보려면 다음과 같이 입력한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status verbose</span><br><span class="line">Status: active</span><br><span class="line">Logging: on (low)</span><br><span class="line">Default: deny (incoming), allow (outgoing)</span><br><span class="line">New profiles: skip</span><br></pre></td></tr></table></figure>

<p><code>Default</code> 부분이 방화벽의 기본 규칙으로 현재 들어오는 것은 막고, 나가는 것은 열어 놓은 상태이다.</p>
<p>iptables 명령의 상태를 확인하려면 status raw 를 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw show raw</span><br></pre></td></tr></table></figure>

<p>먼저 ufw를 활성화하고 규칙을 추가한다.</p>
<h4 id="UFW-활성화"><a href="#UFW-활성화" class="headerlink" title="UFW 활성화"></a>UFW 활성화</h4><p>방화벽은 커널 수준에서 패킷을 다루기 때문에 아래 같이 활성화 명령을 통해 네트워크 패킷을 ufw가 다룰 수 있게 해준다.</p>
<p>ufw 활성화 상태를 확인하고 inactive 상태면 활성화 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status</span><br><span class="line">Status: inactive</span><br><span class="line"></span><br><span class="line">$ sudo ufw <span class="built_in">enable</span></span><br><span class="line">Firewall is active and enabled on system startup</span><br></pre></td></tr></table></figure>

<p>방화벽을 끌 때는 아래와 같은 명령어를 입력한다</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>

<h3 id="방화벽-규칙-허용"><a href="#방화벽-규칙-허용" class="headerlink" title="방화벽 규칙 허용"></a>방화벽 규칙 허용</h3><p>서비스, 포트, 프로토콜, 프로그램등에 예외 규칙을 적용할 액션을 추가한다.</p>
<blockquote>
<p>ufw [allow,deny] <port>&#x2F;&lt;optional: protocal&gt;</p>
</blockquote>
<p>혹은 서비스 이름으로 가능하다</p>
<blockquote>
<p>ufw [allow,deny] <service name></p>
</blockquote>
<h4 id="ssh-http-https-허용"><a href="#ssh-http-https-허용" class="headerlink" title="ssh, http, https 허용"></a>ssh, http, https 허용</h4><p>ssh 포트를 변경해서 사용한다면 반드시 직접 포트를 입력하자</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow ssh</span><br><span class="line">$ sudo ufw allow http</span><br><span class="line">$ sudo ufw allow https</span><br></pre></td></tr></table></figure>

<p>새로운 설정을 적용하려면 disable &gt; enable 해도 좋고 아래와 같이 reload 가 가능하다</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw reload</span><br></pre></td></tr></table></figure>

<h4 id="포트"><a href="#포트" class="headerlink" title="포트"></a>포트</h4><p>포트를 변경해 사용하거나 특정 포트를 허용 할 수 있다. ssh 프로토콜은 tcp 22번 포트를 사용한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow 8080</span><br><span class="line">$ sudo ufw allow 22</span><br></pre></td></tr></table></figure>

<p>규칙과 액션 상태를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status verbose</span><br><span class="line">Status: active</span><br><span class="line">Logging: on (low)</span><br><span class="line">Default: deny (incoming), allow (outgoing)</span><br><span class="line">New profiles: skip</span><br><span class="line"></span><br><span class="line">To                         Action      From</span><br><span class="line">--                         ------      ----</span><br><span class="line">22                         LIMIT IN    Anywhere</span><br><span class="line">22                         LIMIT IN    Anywhere (v6)</span><br></pre></td></tr></table></figure>

<h4 id="ssh-허용"><a href="#ssh-허용" class="headerlink" title="ssh 허용"></a>ssh 허용</h4><p>sh 허용</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow ssh</span><br><span class="line">or</span><br><span class="line">$ sudo ufw allow 22</span><br></pre></td></tr></table></figure>

<p>ssh를 특정 IP 주소에만 접속을 허용한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.0.100 to any port 22</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow from 192.168.0.100 to any port 22 proto tcp</span><br></pre></td></tr></table></figure>

<h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><p>ufw는 Brute-force Attack 방어를 도와주는 Brute-force Attack을 방어하기 위한다면 다음과 같이 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">limit</span> ssh</span><br></pre></td></tr></table></figure>

<br/>

<h4 id="samba-허용"><a href="#samba-허용" class="headerlink" title="samba 허용"></a>samba 허용</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow Samba</span><br><span class="line">$ sudo ufw allow from 192.168.0.0/16 to any app Samba</span><br></pre></td></tr></table></figure>

<p>이렇게 설정하고 실제 열린 포트는 다음 같이 <code>netstat</code> 명령으로 확인이 가능하다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -tlnp</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      5034/python3</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 0.0.0.0:1883            0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp6       0      0 ::1:8080                :::*                    LISTEN      5034/python3</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 :::1883                 :::*                    LISTEN      -</span><br></pre></td></tr></table></figure>

<h4 id="IP-주소-제어"><a href="#IP-주소-제어" class="headerlink" title="IP 주소 제어"></a>IP 주소 제어</h4><p>특정 IP 대역에서 허용&#x2F;거부 하기</p>
<blockquote>
<p>ufw [allow,deny] from <ip address></p>
</blockquote>
<p>특정 IP만 허용할 경우</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow from 192.168.0.100</span><br></pre></td></tr></table></figure>

<p>특정 ip 또는 특정 ip 대역에 대해 특정 포트 허용&#x2F;거부하기</p>
<blockquote>
<p>ufw [allow,deny] from <ip address> to port <port number></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow from 192.168.0.100 to any port 22</span><br><span class="line">$ sudo ufw allow from 192.168.0.100 to any port 22 proto tcp</span><br><span class="line">$ sudo ufw allow from 192.168.0.100 to any port 8080</span><br></pre></td></tr></table></figure>

<p>특정 IP 혹은 IP 범위에 대한 접근 제어도 가능하다.</p>
<blockquote>
<p>ufw allow from <ip address> to <protocol> port <port number><br>ufw allow from <ip address> to <protocol> port <port number> proto <protocol name></p>
</blockquote>
<p>포트의 범위를 규칙으로 사용할 경우</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow 9200:9300/tcp</span><br></pre></td></tr></table></figure>

<p>특정 아이피에만 일정 범위의 포트를 tcp 패킷만 허용할 경우</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow from 192.168.0.101 to any port 9200:9300 proto tcp</span><br></pre></td></tr></table></figure>

<p>서브넷을 특정 포트에 허용할 경우</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow from 192.168.0.0/24 to any port 27017 proto tcp</span><br></pre></td></tr></table></figure>

<h4 id="ping-icmp-허용-x2F-거부"><a href="#ping-icmp-허용-x2F-거부" class="headerlink" title="ping (icmp) 허용&#x2F;거부"></a>ping (icmp) 허용&#x2F;거부</h4><p>UFW 기본설정은 ping 요청을 허용하도록 되어있다. 이것은 <code>/etc/ufw/before.rules</code> 파일에 정의되어 있는데 여기서 icmp 프로토콜 관련한 항목을 DROP으로 처리하거나 삭제하면 <strong>ping</strong>을 방지할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> # ok icmp codes</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type destination-unreachable -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type source-quench -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type time-exceeded -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type parameter-problem -j ACCEPT</span><br><span class="line">-A ufw-before-input -p icmp --icmp-type echo-request -j ACCEPT</span><br></pre></td></tr></table></figure>

<h3 id="방화벽-규칙-삭제"><a href="#방화벽-규칙-삭제" class="headerlink" title="방화벽 규칙 삭제"></a>방화벽 규칙 삭제</h3><p>등록된 규칙을 삭제할 때는 2가지 방법이 있다. 첫번째는 등록 시 사용한 규칙을 그대로 입력하는 방법</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw delete allow ssh</span><br><span class="line">$ sudo ufw delete allow 8080</span><br></pre></td></tr></table></figure>

<p>22&#x2F;tcp 설정이 되어있다고 가정하고, 해당 포트&#x2F;포로토콜을 삭제한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw delete deny 22/tcp</span><br></pre></td></tr></table></figure>

<p>두번째는 각 규칙의 번호를 확인하고 번호로 지우는 방법으로 status numbered 명령으로 규칙 번호를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw status numbered</span><br><span class="line">Status: active</span><br><span class="line"></span><br><span class="line">     To                         Action      From</span><br><span class="line">     --                         ------      ----</span><br><span class="line">[ 1] 22                         ALLOW IN    Anywhere</span><br><span class="line">[ 2] 80/tcp                     ALLOW IN    Anywhere</span><br><span class="line">[ 3] 443/tcp                    ALLOW IN    Anywhere</span><br><span class="line">[ 4] 22 (v6)                    ALLOW IN    Anywhere (v6)</span><br><span class="line">[ 5] 80/tcp (v6)                ALLOW IN    Anywhere (v6)</span><br><span class="line">[ 6] 443/tcp (v6)               ALLOW IN    Anywhere (v6)</span><br></pre></td></tr></table></figure>

<p>등록된 규칙의 번호는 줄 맨앞에 있는 [숫자]로 이 숫자를 delete 명령에 준다.</p>
<p>2번 규칙 80&#x2F;tcp 를 지우려면</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw delete 2</span><br></pre></td></tr></table></figure>

<h4 id="UFW-설정-파일"><a href="#UFW-설정-파일" class="headerlink" title="UFW 설정 파일"></a>UFW 설정 파일</h4><p><strong>&#x2F;etc&#x2F;ufw&#x2F;</strong> 밑에 <code>before.rule</code>, <code>before6.rule</code> 파일이 있다. 기본적으로 ufw 시작시 before.rules, that allows loopback, ping, and DHCP을 활성화 하고</p>
<p>또한 ufw 명령이 실행된 후에 추가되는 룰이 <code>after.rule</code>, IPv6용 <code>after6.rule</code> 파일이 있다.</p>
<p>그리고 <strong>&#x2F;etc&#x2F;default&#x2F;ufw</strong> 파일은 IPv6 를 활성화 하거나 비활서화 한다.</p>
<h3 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw logging on</span><br><span class="line">Logging enabled</span><br></pre></td></tr></table></figure>

<p>로그 수준은 <code>ufw logging low|medium|high</code> 로 지정한다.</p>
<p>기록되는 로그는 <em>&#x2F;var&#x2F;logs&#x2F;ufw</em> 에 위치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sep 16 15:08:14 &lt;hostname&gt; kernel: [UFW BLOCK] IN=eth0 OUT= MAC=00:00:00:00:00:00:00:00:00:00:00:00:00:00 SRC=123.45.67.89 DST=987.65.43.21 LEN=40 TOS=0x00 PREC=0x00 TTL=249 ID=8475 PROTO=TCP SPT=48247 DPT=22 WINDOW=1024 RES=0x00 SYN URGP=0</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>UFW BLOCK</strong>: This location is where the description of the logged event will be located. In this instance, it blocked a connection.</li>
<li><strong>IN</strong>: If this contains a value, then the event was incoming</li>
<li><strong>OUT</strong>: If this contain a value, then the event was outgoing</li>
<li><strong>MAC</strong>: A combination of the destination and source MAC addresses</li>
<li><strong>SRC</strong>: The IP of the packet source</li>
<li><strong>DST</strong>: The IP of the packet destination</li>
<li><strong>LEN</strong>: Packet length</li>
<li><strong>TTL</strong>: The packet TTL, or time to live. How long it will bounce between routers until it expires, if no destination is found.</li>
<li><strong>PROTO</strong>: The packet’s protocol</li>
<li><strong>SPT</strong>: The source port of the package</li>
<li><strong>DPT</strong>: The destination port of the package</li>
<li><strong>WINDOW</strong>: The size of the packet the sender can receive</li>
<li><strong>SYN URGP</strong>: Indicated if a three-way handshake is required. 0 means it is not.</li>
</ul>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p><a target="_blank" rel="noopener" href="https://www.vultr.com/docs/how-to-configure-ufw-firewall-on-ubuntu-14-04">How to configure ufw - Ubuntu 14.04</a></p>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/13552881/can-i-determine-the-current-ip-from-a-known-mac-address">IP address from mac address</a></p>
<p>[^2]: <a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/UFW">UFW Help</a><br>[^3]: <a target="_blank" rel="noopener" href="http://www.cyberciti.biz/faq/linux-howto-check-ip-blocked-against-iptables/">Check blocked IP in iptables</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-03T04:00:00.000Z" title="2017-4-3 13:00:00">2017-04-03</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T21:20:33.416Z" title="2022-2-25 6:20:33">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">7분안에 읽기 (약 1055 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/03/python-2017-04-03-virtualenv-mac/">Python - Install virtualenv on macOS X</a></h1><div class="content"><p>Python 개발환경을 위해서 macOS에 설치된 python2.7 그리고 brew 같은 유틸리티로 python3.x 를 설치하고, <code>pip</code>를 사용해서 패키지를 관리할 수 있다. 그리고 다양한 모듈과 시스템 모듈의 분리를 위해서 버전 관리 도구인 <code>virtualenv</code>와 <code>virtualenvwrapper</code> 를 사용해 가상 개발 환경을 구성하는 방법을 설명한다.</p>
<br/>

<h2 id="macOS에서-Python-virtualenv-개발환경-구축하기"><a href="#macOS에서-Python-virtualenv-개발환경-구축하기" class="headerlink" title="macOS에서 Python virtualenv 개발환경 구축하기"></a>macOS에서 Python virtualenv 개발환경 구축하기</h2><p>macOS 에는 python2.6, python2.7이 설치되어 있다. python3를 설치하려면 HomeBrew, MacPort 같은 시스템 유틸리티 관리자를 이용한다. 여기서는 HomeBrew 를 사용했다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install python3</span><br></pre></td></tr></table></figure>

<h3 id="사전-준비"><a href="#사전-준비" class="headerlink" title="사전 준비"></a>사전 준비</h3><p>파이썬 패키지 도구인 <strong>pip</strong>(Python Package Index, PyPI)는 파이썬 모듈을 검색, 설치, 관리 할 수 있다.<br>설치된 <em>python</em> 버전에 따라 <code>pip</code>가 설치되어 있다. brew로 <code>python3</code>를 설치하면 <code>pip3</code> 버전이 설치된다. <code>pip --version</code> 버전 정보를 출력하면 버전과 <em>site-packages</em> 위치를 확인할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ pip --version</span><br><span class="line">pip 7.1.2 from /Library/Python/2.7/site-packages (python 2.7)</span><br><span class="line">$ pip3 --version</span><br><span class="line">pip 9.0.1 from /usr/local/lib/python3.6/site-packages (python 3.6)</span><br></pre></td></tr></table></figure>

<h4 id="site-packages"><a href="#site-packages" class="headerlink" title="site-packages"></a>site-packages</h4><p><code>pip</code> 로 설치되는 패키지 모듈은 시스템의 <em>site-packages</em> 폴더에 설치된다. </p>
<ul>
<li>python2.7은 &#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;site-packages</li>
<li>python3.4는 &#x2F;usr&#x2F;lib&#x2F;python3.4&#x2F;site-packages</li>
</ul>
<p>그래서 시스템에 설치된 <code>pip</code>는 <code>sudo</code>로 설치한다.</p>
<p><code>brew</code>로 설치한 python3의 pip3는 사용자 환경에서 접근이 가능해서 sudo 없이 설치해도 된다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install --upgrade pip</span><br><span class="line">$ pip3 install --upgrade pip3.6</span><br></pre></td></tr></table></figure>

<p>이후는 특별히 버전을 명시하지 않으면 <code>pip</code>는 <strong>pip3.6</strong>을 사용한다고 가정한다. </p>
<br/>

<h3 id="Python-가상-개발-환경-설치"><a href="#Python-가상-개발-환경-설치" class="headerlink" title="Python 가상 개발 환경 설치"></a>Python 가상 개발 환경 설치</h3><p>앞서 언급한데로 개발을 위해 site-package 모듈을 유지하고 개발을 위해 설치하는 패키지 모듈을 python 버전에 의존해 관리하는 버전 관리자로 <code>pyenv</code>, <code>virtualenv</code> 같은 버전 관리자를 사용한다. 버전 관리자는 사용자 환경에 시스템 모듈을 복사해 새로 설치되는 모듈을 기존 시스템 버전과 혼동되지 않게 해준다.</p>
<h4 id="virtualenv와-virtualenvwrapper"><a href="#virtualenv와-virtualenvwrapper" class="headerlink" title="virtualenv와 virtualenvwrapper"></a>virtualenv와 virtualenvwrapper</h4><p>여기서 <code>pip</code>로 <code>virtualenv</code>와 <code>virtualenvwrapper</code>를 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip3.6 install virtualenv</span><br><span class="line">$ pip3.6 install virtualenvwrapper</span><br></pre></td></tr></table></figure>

<p>쉘 프로파일 <code>.bashrc</code>, <code>.profile</code> 등에 다음 라인을 추가한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> WORKON_HOME=<span class="variable">$HOME</span>/.virtualenvs</span><br><span class="line"><span class="built_in">export</span> PROJECT_HOME=<span class="variable">$HOME</span>/Devel</span><br><span class="line"><span class="built_in">source</span> /usr/local/bin/virtualenvwrapper.sh</span><br></pre></td></tr></table></figure>

<p>그리고 쉘 환경을 로딩하기 위해서 다시 로그인 하거나 다음 같이 source 명령을 이용하면 아래 같이 virtualenvwrapper 에서 제공하는 환경변수가 설정된다.</p>
<p>아래는 <code>source</code> 명령으로 .profile을 컴파일한 결과를 보여준다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> .profile</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/premkproject</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/postmkproject</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/initialize</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/premkvirtualenv</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/postmkvirtualenv</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/prermvirtualenv</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/postrmvirtualenv</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/predeactivate</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/postdeactivate</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/preactivate</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/postactivate</span><br><span class="line">virtualenvwrapper.user_scripts creating /home/pi/.virtualenvs/get_env_details</span><br></pre></td></tr></table></figure>


<p>다음 같이 에러가 발생하면 쉘에 VIRTUALENVWRAPPER_PYTHON 를 추가해 준다.</p>
<blockquote>
<p>&#x2F;usr&#x2F;bin&#x2F;python: No module named virtualenvwrapper<br>virtualenvwrapper.sh: There was a problem running the initialization hooks.</p>
<p>If Python could not import the module virtualenvwrapper.hook_loader,<br>check that virtualenvwrapper has been installed for<br>VIRTUALENVWRAPPER_PYTHON&#x3D;&#x2F;usr&#x2F;bin&#x2F;python and that PATH is</p>
</blockquote>
<h4 id="점검"><a href="#점검" class="headerlink" title="점검"></a>점검</h4><p>I then search for the location of virtualenv and virtualenv wrapper to confirm their locations:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 show virtualenv</span><br><span class="line">Location: /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 show virtualenvwrapper</span><br><span class="line">Location: /Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages</span><br></pre></td></tr></table></figure>


<h4 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick-Start"></a>Quick-Start</h4><p>새로운 가상환경은 <code>mkvirtualenv NAME</code> 명령으로 만든다. 가상환경으로 전환시 프롬프트가 <code>(NAME) $</code> 형태로 표시된다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkvirtualenv django2   <span class="comment">#기본 python 버전의 환경 생성</span></span><br><span class="line">...</span><br><span class="line">(django2):~$               <span class="comment"># 실행 가상 환경 쉘</span></span><br></pre></td></tr></table></figure>

<p><code>mkvirtualenv</code> 명령은 <code>-p</code> 옵션으로 파이썬 버전을 명시할 수 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkvirtualenv -p python3 django3</span><br></pre></td></tr></table></figure>

<p><code>--system-site-packages</code> 옵션은 site-package 시스템 버전을 사용하게 한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkvirtualenv --system-site-packages -p python3 django3</span><br></pre></td></tr></table></figure>


<p><code>workon NAME</code> 명령으로 설치한 가상 환경 목록을 보거나 혹은 해당 가상환경으로 전환할 수 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ workon </span><br><span class="line">django2 django3</span><br><span class="line">$ workon django3</span><br><span class="line">...</span><br><span class="line">(django3):~$</span><br></pre></td></tr></table></figure>


<p>프로젝트 환경을 빠져 나오려면 <code>deactivate</code>를 실행한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(django3):~$ deactivate</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-04-03T00:10:00.000Z" title="2017-4-3 9:10:00">2017-04-03</time>&nbsp;게시 됨</span><span class="level-item"><time dateTime="2022-02-24T16:15:34.957Z" title="2022-2-25 1:15:34">2022-02-25</time>&nbsp;업데이트 됨</span><span class="level-item"><a class="link-muted" href="/categories/Linux/">Linux</a></span><span class="level-item">13분안에 읽기 (약 1887 단어)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/03/linux-2017-04-03-odroid-lvm2/">Linux LVM2</a></h1><div class="content"><blockquote>
<p>2018-09-19 when umount, device busy!<br>2018-06-23 mount 명령<br>{: history-right}</p>
</blockquote>
<h2 id="LVM2"><a href="#LVM2" class="headerlink" title="LVM2"></a>LVM2</h2><p>Odorid C2에 USB Memory를 사용해서 리눅스의 LVM을 이용하고 있다. 여기서는 LVM 설정에 대해서만 다루고 있다.</p>
<blockquote>
<p>Single board computer 종류의 보드는 주 디스크로 SD Card, eMMC 를 사용하고, USB 메모리 등은 디바이스 장치로 &#x2F;dev&#x2F;sd* 이름으로 접근할 수 있다.</p>
</blockquote>
<h3 id="디스크-파티션"><a href="#디스크-파티션" class="headerlink" title="디스크 파티션"></a>디스크 파티션</h3><p>시스템에 사용할 디스크 파티션을 생성한다. 그리고 사용할 디스크 파티션 종류 LVM으로 해야 한다. <code>parted</code> 혹은 <code>fdisk</code> 를 사용해서 디스크 볼륨을 생성하고 사용한다.</p>
<h4 id="parted"><a href="#parted" class="headerlink" title="parted"></a>parted</h4><p>대상 디스크 목록을 통해 디스크의 크기 정보를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo parted -l</span><br></pre></td></tr></table></figure>

<p>parted로 lvm 볼륨 잡기</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo parted /dev/sdb</span><br><span class="line">(parted) mklabel gpt</span><br><span class="line">Warning: The existing disk label on /dev/sda will be destroyed and all data on</span><br><span class="line">this disk will be lost. Do you want to <span class="built_in">continue</span>?</span><br><span class="line">Yes/No? y</span><br><span class="line"></span><br><span class="line">(parted) unit GB</span><br><span class="line">(parted) mkpart primary 0 32.0GB     <span class="comment">#디스크 크기 입력</span></span><br><span class="line">(parted) <span class="built_in">set</span> 1 lvm on</span><br><span class="line"></span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">Number  Start   End     Size    File system  Name     Flags</span><br><span class="line"> 1      0.00GB  32.0GB  32.0GB               primary  lvm</span><br></pre></td></tr></table></figure>

<h4 id="fdisk-사용"><a href="#fdisk-사용" class="headerlink" title="fdisk 사용"></a>fdisk 사용</h4><p>대상 디스크 목록을 통해 디스크의 크기 정보를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure>

<p><code>fdisk</code>로 파티션을 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># fdisk /dev/sda</span><br><span class="line">Command (m for help): p</span><br><span class="line">Command (m for help): g</span><br><span class="line">Command (m for help): n</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2048-125042654, default 125042654): +4G</span><br><span class="line">Command (m for help): t</span><br><span class="line">Hex code (type L to list all codes): 30</span><br><span class="line">Changed type of partition &#x27;Linux filesystem&#x27; to &#x27;Linux LVM&#x27;.</span><br><span class="line">Command (m for help): w</span><br></pre></td></tr></table></figure>

<p>이제 새로운 파티션 ‘&#x2F;dev&#x2F;sda1’ 이 생성됐다.</p>
<h3 id="LVM-생성하기"><a href="#LVM-생성하기" class="headerlink" title="LVM 생성하기"></a>LVM 생성하기</h3><ol>
<li>LVM 종류로 파티션한 볼륨으로 <strong>Pysical volume</strong> 을 생성한다.</li>
<li>Pysical volume을 <strong>Volume Group</strong>으로 등록한다.</li>
<li>실제 사용할 크기 만큼 <strong>Logical Volume</strong>으로 나눠 생성한다.</li>
<li>파일 시스템을 생성하고 마운트 한다.</li>
</ol>
<p>시스템에 <code>lvm2</code> 를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install lvm2</span><br></pre></td></tr></table></figure>

<h4 id="Pysical-Volume-만들기"><a href="#Pysical-Volume-만들기" class="headerlink" title="Pysical Volume 만들기"></a>Pysical Volume 만들기</h4><p>파티션을 Pysical volume으로 만든다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -s</span><br><span class="line"># pvcreate /dev/sda1</span><br><span class="line">  /run/lvm/lvmetad.socket: connect failed: No such file or directory</span><br><span class="line">  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.</span><br><span class="line">  Physical volume &quot;/dev/sda1&quot; successfully created</span><br></pre></td></tr></table></figure>

<p>이제 물리볼륨을 로지컬 볼륨 그룹으로 나누고</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># vgcreate vg_usb /dev/sdb1</span><br><span class="line"> Volume group &quot;vg_usb&quot; successfully created</span><br><span class="line"></span><br><span class="line"># vgdisplay</span><br></pre></td></tr></table></figure>

<blockquote>
<p>볼륨그룹 지우기</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vgremove vg_usb</span><br><span class="line">  Volume group &quot;vg_usb&quot; successfully removed</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Logical-Volume-만들기"><a href="#Logical-Volume-만들기" class="headerlink" title="Logical Volume 만들기"></a>Logical Volume 만들기</h4><p>로지컬 볼륨을 만든다. 용량은 -L 과 -l 옵션을 사용</p>
<ul>
<li><code>-L [GB/KB/B..]</code> 단위 용량</li>
<li><code>-l PE</code> PE 용량 단위 - vgdisplay 에 표시되는 PE 개수</li>
</ul>
<p>여기서 두개의 로지컬 볼륨을 만든다고 가정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># lvcreate -L +20G -n dbvol vg_usb</span><br><span class="line"> Logical volume &quot;dbvol&quot; created.</span><br><span class="line"># lvcreate -L +9GB -n workvol vg_usb</span><br><span class="line">  Logical volume &quot;workvol&quot; created.</span><br></pre></td></tr></table></figure>

<p>생성한 로지컬보륨은 <code>lvdisplay</code>로 자세한 정보를 확인할 수 있다.</p>
<blockquote>
<p>로지컬 볼륨을 지우려면 <code>lvremove</code>로 볼륨그룹 밑에 있는 로지컬보륨을 삭제한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># lvremove /dev/vg_usb/dbvol</span><br></pre></td></tr></table></figure>
</blockquote>
<p>이제 로지컬볼륨이 준비됐고, 실제 파일 시스템을 생성한다.</p>
<h4 id="파일시스템-생성"><a href="#파일시스템-생성" class="headerlink" title="파일시스템 생성"></a>파일시스템 생성</h4><p>mkfs 명령으로 파일 시스템을 생성한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkfs.ext4 /dev/vg_usb/dbvol</span><br><span class="line"># mkfs.ext4 /dev/vg_usb/workvol</span><br></pre></td></tr></table></figure>

<p>부팅시 항상 마운트하기 위해서 fstab에 등록해야 하는데, fstab에 아운트 지점을 지정하는 방법은 디바이스 드라이브의 경로 혹은 UUID를 명시하는 것이다. LVM도 다르지 않는데 먼저 fstab에 등록해서 마운트 하기 위해서 <code>lvdisplay</code> 명령으로 LV path 를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg_usb/dbvol</span><br><span class="line"></span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg_usb/workvol</span><br></pre></td></tr></table></figure>

<p>&#x2F;etc&#x2F;fstab에 <strong>LV Path</strong> 경로를 추가 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/dev/vg_usb/dbvol /data ext4 defaults 0 1</span><br><span class="line">/dev/vg_usb/workvol /home/pi/work ext4 defaults 0 1</span><br></pre></td></tr></table></figure>

<p>UUID를 사용하려면 위에 찾은 LV Path에 해당하는 UUID를 찾아야 한다.<a href="%5Bdebian/fstab%5D(https://wiki.debian.org/fstab)">^1</a> 먼저 LV path 경로를 보면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ll /dev/vg_usb/dbvol</span><br><span class="line">lrwxrwxrwx 1 root root 7 May  2 18:18 /dev/vg_usb/dbvol -&gt; ../dm-0</span><br></pre></td></tr></table></figure>

<p>같이 링크로 나온다. 이 링크 파일의 UUID를 찾으면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l /dev/disk/by-uuid/</span><br><span class="line">lrwxrwxrwx 1 root root 10 May  2 18:18 a7bb8085-0e50-845a-b65b-a6b7e8c86dc9 -&gt; ../../dm-0</span><br></pre></td></tr></table></figure>

<p>찾은 UUID를 fstab에 마운트 지점과 함께 기록한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID=a7bb8085-0e50-845a-b65b-a6b7e8c86dc9 /data ext4 defaults 0 0</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title="     "></a><file system> <dir> <type> <options> <dump> <pass></h1><p>UUID&#x3D;”680C0FE30C0FAAE0” &#x2F;jgdata ntfs user,auto,rw 0 0</p>
<h4 id="LVM-사이즈-키우기"><a href="#LVM-사이즈-키우기" class="headerlink" title="LVM 사이즈 키우기"></a>LVM 사이즈 키우기</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># lvextend -L +10M /dev/um_vg/xfs_lv -r</span><br></pre></td></tr></table></figure>

<br>
### LVM 을 새 시스템에 장착하기

<p>LVM으로 생성한 볼륨그룹을 다른 시스템에서 사용하려면 Volume group을 이용한다.</p>
<ol>
<li>volume group 비활성화</li>
<li>volume group 추출</li>
<li>새 시스템에서 volume group 가져오기</li>
<li>새 시스템에서 volume group 활성화</li>
<li>새 시스템에서 마운트</li>
</ol>
<h4 id="1-vgscan으로-확인"><a href="#1-vgscan으로-확인" class="headerlink" title="1. vgscan으로 확인"></a>1. vgscan으로 확인</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vgscan</span><br><span class="line">  Reading all physical volumes.  This may take a while...</span><br><span class="line">  Found volume group &quot;vg_usb&quot; using metadata type lvm2</span><br></pre></td></tr></table></figure>

<h4 id="2-vg-추출"><a href="#2-vg-추출" class="headerlink" title="2. vg 추출"></a>2. vg 추출</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vgexport vg_usb</span><br><span class="line">  Volume group &quot;vg_usb&quot; successfully exported</span><br></pre></td></tr></table></figure>

<p>이제 새 시스템에서 추출한 volume group을 활성화 한다.</p>
<h4 id="3-PV-파티션-확인"><a href="#3-PV-파티션-확인" class="headerlink" title="3. PV 파티션 확인"></a>3. PV 파티션 확인</h4><p>pvscan으로 파티션을 확인한다. 비활성화하고 추출한 파티션을 확인할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># pvscan</span><br><span class="line">  PV /dev/sda2    is in exported VG vg_usb [55.62 GiB / 25.62 GiB free]</span><br><span class="line">  Total: 1 [55.62 GiB] / in use: 1 [55.62 GiB] / in no VG: 0 [0   ]</span><br></pre></td></tr></table></figure>

<p>vbimport 로 volume group을 가져온다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vgimport vg_usb</span><br><span class="line">  Volume group &quot;vg_usb&quot; successfully imported</span><br></pre></td></tr></table></figure>

<h4 id="4-VG-활성화"><a href="#4-VG-활성화" class="headerlink" title="4. VG 활성화"></a>4. VG 활성화</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vgchange -ay vg_usb</span><br><span class="line">  1 logical volume(s) in volume group &quot;vg_usb&quot; now active</span><br></pre></td></tr></table></figure>

<p>마운트 하기 위해서 볼륨그룹은 장치는 dev 밑에 보륨그룹 이름 <em>&#x2F;dev&#x2F;vg_usb</em> 같이 생성되므로 ls 명령으로 확인 가능</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls /dev/vg_usb/</span><br><span class="line">mongovol  workvol</span><br></pre></td></tr></table></figure>

<p>혹은 <code>lvdisplay</code> 명령으로 LV path 를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># lvdisplay</span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg_usb/dbvol</span><br><span class="line">  LV Name                dbvol</span><br><span class="line">  VG Name                vg_usb</span><br><span class="line">  LV UUID                hTnMaP-6rgM-ePOi-HXs4-X0Ia-h4mP-gpT1JM</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time odroid64, 2016-12-02 15:05:45 +0900</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                30.00 GiB</span><br><span class="line">  Current LE             7680</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     256</span><br><span class="line">  Block device           253:0</span><br></pre></td></tr></table></figure>

<p>mount 명령으로 LV path를 마운트 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mount /dev/vg_usb/dbvol mongodata/</span><br><span class="line">...</span><br><span class="line"># mount</span><br><span class="line">...</span><br><span class="line">/dev/mapper/vg_usb-dbvol on /data type ext4 (rw,relatime,data=ordered)</span><br></pre></td></tr></table></figure>

<p>재시동 후 마운트를 유지하기 위해 마운트한 경로를 &#x2F;etc&#x2F;fstab에 추가한다.</p>
<h5 id="LVM-error"><a href="#LVM-error" class="headerlink" title="LVM error"></a>LVM error</h5><p>기존 LVM 디스크를 사용하던 OS에 타 시스템에서 생성한 LVM을 옮겨와 사용하려면 다음 같이 lvmetad 에러가 난다.</p>
<blockquote>
<p>&#x2F;run&#x2F;lvm&#x2F;lvmetad.socket: connect failed: No such file or directory</p>
</blockquote>
<p>lvm2 서비스를 활성화하고 시작해 주면 된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable lvm2-lvmetad.service</span><br><span class="line">sudo systemctl enable lvm2-lvmetad.socket</span><br><span class="line">sudo systemctl start lvm2-lvmetad.service</span><br><span class="line">sudo systemctl start lvm2-lvmetad.socket</span><br></pre></td></tr></table></figure>

<br>
### Unmount - It's busy

<p>LVM 볼륨을 사용중 마운트를 해제하려고 할 때 다음 같은 경고가 난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /data</span><br><span class="line">umount: /data: target is busy</span><br><span class="line">        (In some cases useful info about processes that</span><br><span class="line">         use the device is found by lsof(8) or fuser(1).)</span><br></pre></td></tr></table></figure>

<p><code>fuser</code> 명령 <code>lsof</code> 명령으로 해당 디렉토리를 사용중인 파일, 프로세스를 확인할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fuser -vm /data</span><br><span class="line">                     USER        PID ACCESS COMMAND</span><br><span class="line">/data:               root     kernel swap  /data/.swap4G</span><br><span class="line">                     root     kernel mount /data</span><br></pre></td></tr></table></figure>

<p>lsof로 어떤 프로세스가 디렉토리를 사용하는지 출력해 볼 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo lsof +D /data</span><br><span class="line">COMMAND   PID  USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">bash    23617 qkboo  cwd    DIR  179,1     4096 129793 .</span><br></pre></td></tr></table></figure>

<h3 id="xfs-파일시스템"><a href="#xfs-파일시스템" class="headerlink" title="xfs 파일시스템"></a>xfs 파일시스템</h3><blockquote>
<p>주의: USB 메모리를 사용한 디스크에서 mongodb에 사용하기 위해서 시작했는데, 최신 mongodb의 storage engine인 WiredTiger는 xfs를 요구한다. 다만 Odroid C2 의 Ubuntu, Ambian 에서 xfsprogs 설치후 xfs 파일 시스템 생성시 문제가 있다.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># apt install xfsprogs</span><br></pre></td></tr></table></figure>

<p>디스크 볼륨을 xfs file system 생성한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkfs.xfs /dev/usb64_vg/db_xfs</span><br></pre></td></tr></table></figure>

<br>
<br>
## 참조

<ul>
<li><a target="_blank" rel="noopener" href="https://www.unixmen.com/create-xfs-file-system-based-lvm-ubuntu/">Create xfs filesystem based LVM</a></li>
<li>[LVM Resize](&gt; <a target="_blank" rel="noopener" href="https://www.rootusers.com/lvm-resize-how-to-decrease-an-lvm-partition/">https://www.rootusers.com/lvm-resize-how-to-decrease-an-lvm-partition/</a>)</li>
</ul>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/4/">이전</a></div><div class="pagination-next"><a href="/page/6/">다음</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><a class="pagination-link is-current" href="/page/5/">5</a></li><li><a class="pagination-link" href="/page/6/">6</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/qkboo_400.png" alt="Gangtai"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Gangtai</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Paju, South Korea</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">포스트</p><a href="/archives"><p class="title">56</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">카테고리</p><a href="/categories"><p class="title">15</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">태그</p><a href="/tags"><p class="title">103</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/thinkbee" target="_blank" rel="noopener">팔로우</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/thinkbee"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/gtko"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">링크</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.thinkbee.kr" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Thinkbee.kr</span></span><span class="level-right"><span class="level-item tag">www.thinkbee.kr</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">업데이트 소식 받기</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">카테고리</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">25</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Linux/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/NodeJS/"><span class="level-start"><span class="level-item">NodeJS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/NodeJS/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Photoshop/"><span class="level-start"><span class="level-item">Photoshop</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/Programming/Angular/"><span class="level-start"><span class="level-item">Angular</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/Angularjs/"><span class="level-start"><span class="level-item">Angularjs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Raspberry-Pi/"><span class="level-start"><span class="level-item">Raspberry Pi</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">10</span></span></a><ul><li><a class="level is-mobile" href="/categories/Raspberry-Pi/Linux/Database/"><span class="level-start"><span class="level-item">Database</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/jekyll/"><span class="level-start"><span class="level-item">jekyll</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">최근 글</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-24T20:50:12.225Z">2022-02-25</time></p><p class="title"><a href="/2022/02/25/hello-world/">blog.thinkbee.kr 이전 작업중입니다.</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-03-06T00:00:00.000Z">2020-03-06</time></p><p class="title"><a href="/2020/03/06/jekyll-2020-03-06-jekyll-mmtheme-macos/">macOS에서 Jekyll 설치와 Minimalmistake Theme</a></p><p class="categories"><a href="/categories/jekyll/">jekyll</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-02-02T09:00:00.000Z">2020-02-02</time></p><p class="title"><a href="/2020/02/02/linux-2020-02-02-letsencrypt%EB%B0%9C%EA%B8%89/">HTTPS를 위한 공인인증서 - Let&#039;s Encrypt 발급</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T03:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-config/">MongoDB 구성 설정과 사용자 인증 사용</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-12-20T01:00:00.000Z">2019-12-20</time></p><p class="title"><a href="/2019/12/20/linux-2019-12-20-mongodb-4-2-install-arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu/Debian Armbian</a></p><p class="categories"><a href="/categories/Linux/">Linux</a> / <a href="/categories/Linux/Database/">Database</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">아카이브</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">2월 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">3월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">2월 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">12월 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">9월 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">10월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">8월 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">7월 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">6월 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">12월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">11월 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">10월 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">9월 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">7월 2017</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">6월 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">5월 2017</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">4월 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/12/"><span class="level-start"><span class="level-item">12월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">2월 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">태그</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ARM/"><span class="tag">ARM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Armbian/"><span class="tag">Armbian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Artificial-Intelligence/"><span class="tag">Artificial Intelligence</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian/"><span class="tag">Debian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Debian-Strech/"><span class="tag">Debian Strech</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JSON-Web-Token/"><span class="tag">JSON Web Token</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JWT-Toekn/"><span class="tag">JWT Toekn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-15-0/"><span class="tag">LEAP 15.0</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEAP-42-3/"><span class="tag">LEAP 42.3</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Numpy/"><span class="tag">Numpy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid/"><span class="tag">Odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Odroid-C2/"><span class="tag">Odroid C2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Orange-Pi/"><span class="tag">Orange Pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi/"><span class="tag">Raspberry Pi</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi-3/"><span class="tag">Raspberry Pi 3</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspbian/"><span class="tag">Raspbian</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SD-Card/"><span class="tag">SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scientific/"><span class="tag">Scientific</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript-Tutorials/"><span class="tag">TypeScript Tutorials</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ubuntu/"><span class="tag">Ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/X11/"><span class="tag">X11</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/amd64/"><span class="tag">amd64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angular4/"><span class="tag">angular4</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angularjs/"><span class="tag">angularjs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/apache/"><span class="tag">apache</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/arm64/"><span class="tag">arm64</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/armbian/"><span class="tag">armbian</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/banana-pi/"><span class="tag">banana pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bootstrap-4/"><span class="tag">bootstrap 4</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/brew/"><span class="tag">brew</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/certificate-ssl/"><span class="tag">certificate ssl</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/clipping-mask/"><span class="tag">clipping-mask</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/collages/"><span class="tag">collages</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cross-compiler/"><span class="tag">cross compiler</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/debian/"><span class="tag">debian</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewall/"><span class="tag">firewall</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewalld/"><span class="tag">firewalld</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/github/"><span class="tag">github</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/https/"><span class="tag">https</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/install/"><span class="tag">install</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jasmine/"><span class="tag">jasmine</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jekyll/"><span class="tag">jekyll</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter/"><span class="tag">jupyter</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter notebook</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jupyter-notebook/"><span class="tag">jupyter-notebook</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/karma/"><span class="tag">karma</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-15/"><span class="tag">leap 15</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/leap-42-3/"><span class="tag">leap 42.3</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm/"><span class="tag">lvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/lvm2/"><span class="tag">lvm2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macos/"><span class="tag">macos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/micro-SD-Card/"><span class="tag">micro SD Card</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/middleware/"><span class="tag">middleware</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongodb/"><span class="tag">mongodb</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mongoose/"><span class="tag">mongoose</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs-tutorials/"><span class="tag">nodejs tutorials</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nvm/"><span class="tag">nvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid/"><span class="tag">odroid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid c2</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/odroid-c2/"><span class="tag">odroid-c2</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openSUSE/"><span class="tag">openSUSE</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse/"><span class="tag">opensuse</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/opensuse-leap-15/"><span class="tag">opensuse leap 15</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/orange-pi/"><span class="tag">orange pi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/photoshop/"><span class="tag">photoshop</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/raspberry-pi/"><span class="tag">raspberry pi</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/security/"><span class="tag">security</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssl/"><span class="tag">ssl</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/synergy/"><span class="tag">synergy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/terminal/"><span class="tag">terminal</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tmux/"><span class="tag">tmux</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/unit-testing/"><span class="tag">unit testing</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenv/"><span class="tag">virtualenv</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/virtualenvwrapper/"><span class="tag">virtualenvwrapper</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/webdav/"><span class="tag">webdav</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EB%B9%84%EC%95%88/"><span class="tag">데비안</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/"><span class="tag">데이안</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/"><span class="tag">라즈베리파이</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/"><span class="tag">라즈비안</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%A6%AC%EB%88%85%EC%8A%A4/"><span class="tag">리눅스</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%A7%88%ED%81%AC%EB%8B%A4%EC%9A%B4/"><span class="tag">마크다운</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%A7%A5%EC%98%A4%EC%97%90%EC%8A%A4/"><span class="tag">맥오에스</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%94%EB%82%98%EB%82%98%ED%8C%8C%EC%9D%B4/"><span class="tag">바나나파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EB%B0%A9%ED%99%94%EB%B2%BD/"><span class="tag">방화벽</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%98%A4%EB%A0%8C%EC%A7%80%ED%8C%8C%EC%9D%B4/"><span class="tag">오렌지파이</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/"><span class="tag">우분투</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/"><span class="tag">웹토큰</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%9D%B8%EA%B3%B5%EC%A7%80%EB%8A%A5/"><span class="tag">인공지능</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/"><span class="tag">전원관리</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%8D%AC/"><span class="tag">파이썬</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8C%8C%EC%9D%B4%EC%96%B4%EC%9B%94/"><span class="tag">파이어월</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">광고</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1465716454138955" data-ad-slot="4883770640" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="구독"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/thinkbee_logo.png" alt="Blogging through Programming" height="28"></a><p class="is-size-7"><span>&copy; 2022 Gangtai</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ko");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="맨 위로" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "이 웹 사이트는 귀하의 경험을 향상시키기 위해 Cookie를 사용합니다.",
          dismiss: "무시",
          allow: "허용",
          deny: "거부",
          link: "더 알아보기",
          policy: "Cookie 정책",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="입력 하세요..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"입력 하세요...","untitled":"(제목 없음)","posts":"포스트","pages":"페이지","categories":"카테고리","tags":"태그"});
        });</script></body></html>