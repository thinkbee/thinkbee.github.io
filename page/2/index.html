<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Blogging through Programming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Blogging through Programming">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Blogging through Programming">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Blogging through Programming" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Blogging through Programming</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="검색"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-raspberrypi-2018-06-22-raspbian-1-prepare" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/22/raspberrypi-2018-06-22-raspbian-1-prepare/" class="article-date">
  <time class="dt-published" datetime="2018-06-22T00:10:00.000Z" itemprop="datePublished">2018-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Raspberry-Pi/">Raspberry Pi</a>►<a class="article-category-link" href="/categories/Raspberry-Pi/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/22/raspberrypi-2018-06-22-raspbian-1-prepare/">Raspberry Pi : Raspbian 설치준비</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>이 글은 Raspberry Pi Programming 과정을 진행하며 강의한 자료를 바탕으로 공개강의를 위한 텍스트로 <em>슬라이드쉐어</em>, <em>blog.thinkbee.kr</em> 그리고 실제 과정을 영상 <em>youtube</em> 채널에 공개할 목적으로 작성한다.</p>
<p>Install Rasbperry Pi 글타래는 아래 같이 구성되며 간단한 소개, Serial console, OS 설치,  Service 구성 및 사용에 대해 작성했다.</p>
<ol>
<li><strong>Raspberry Pi 설치준비</strong></li>
<li><strong><a href="!--swig%EF%BF%BC0--">Install Raspbian OS</a></strong></li>
<li>Managing Service daemon</li>
<li>Basic OS Security for Server</li>
<li><a href="!--swig%EF%BF%BC1--">Install &amp; Configuration - Nginx, Node JS, Jupyter</a></li>
</ol>
<blockquote>
<p>2017-10-30: swap 추가, timezone 수정<br>{:.right-history}</p>
</blockquote>
<h2 id="Raspbery-Pi-OS-설치준비"><a href="#Raspbery-Pi-OS-설치준비" class="headerlink" title="Raspbery Pi OS 설치준비"></a>Raspbery Pi OS 설치준비</h2><p>*Raspberry Pi(라즈베리파이)*에 <em>Serial Console</em> 을 연결하고, Raspbian, Ubuntu 등을 설치한 후에 라즈베리파이를 처음 설정하고 <em>SSH</em> 구성을 활성화 하겠다.</p>
<p>라즈베리파이에 OS를 설치하기 위해서는 <strong>NOOBS</strong>를 사용하거나 <strong>오에스 이미지</strong>를 다운받아 SD Card에 구워서 사용한다. 라즈베리파이는 다음과 같은 OS 배포본을 사용할 수 있다. </p>
<table>
<thead>
<tr>
<th>운영체제</th>
<th>특징</th>
</tr>
</thead>
<tbody><tr>
<td>Raspbian (Debian)</td>
<td>Raspberry Pi + Debian의 합성어, 가장 범용 OS.</td>
</tr>
<tr>
<td>Arch Linux (A non-Linux Distribution)</td>
<td>ARM 프로세서를 지원하는 Arch Linux</td>
</tr>
<tr>
<td>RISC OS</td>
<td>ARM 프로세서를 위한 실시가(RTOS) 운영체제</td>
</tr>
<tr>
<td>OpenElec</td>
<td>XBMC 미디어 센터 지원을 위한 운영체제</td>
</tr>
<tr>
<td>RaspBMC</td>
<td>XBMC 미디어 센터 지원을 위한 운영체제</td>
</tr>
<tr>
<td>Pidora</td>
<td>Pi + Fedora 운영체제</td>
</tr>
</tbody></table>
<p>**Raspbian(라즈비안)**은 라즈베리파이를 위한 데비안 리눅스로 가장 대중적인 데비안 리눅스, 우분투와 같은 사용자 경험을 제공해 주고 있다.</p>
<h3 id="Raspberry-Pi-설치-준비"><a href="#Raspberry-Pi-설치-준비" class="headerlink" title="Raspberry Pi 설치 준비"></a>Raspberry Pi 설치 준비</h3><p>Raspberry Pi의 GPIO에 배치된 UART Rx, Tx 포트와 시리얼 케이블의 Tx, Rx로 크로스 연결하면 시리얼 콘솔로 작동한다.</p>
<p>설치에 앞서 준비해야 할 것이 있다. </p>
<ul>
<li>Raspberry Pi 1, 2, 3</li>
<li>SD Memory Card: 8GB 이상, Class6 이상</li>
<li>USB to Serial Cable</li>
</ul>
<h4 id="Raspberry-Pi"><a href="#Raspberry-Pi" class="headerlink" title="Raspberry Pi"></a>Raspberry Pi</h4><p>Raspberry Pi의 GPIO에 배치된 UART Rx, Tx 포트와 시리얼 케이블의 Tx, Rx로 크로스 연결하면 시리얼 콘솔로 작동한다.</p>
<p><img src="/images/raspberrypi/rapi_config-serial.png">{:with&#x3D;”500”}</p>
<h4 id="SD-Memory-Card"><a href="#SD-Memory-Card" class="headerlink" title="SD Memory Card"></a>SD Memory Card</h4><p>라즈베리파이는 SD Meory Card 카드에서 부팅 및 운영 하도록 되어 있다. </p>
<ul>
<li><strong>NOOBS</strong>를 이용한다면 최소 8GB</li>
<li>다른 버전은 최소 4GB</li>
<li>Class 4는 4MB&#x2F;s 쓰기 속도, Class 10은 10MB&#x2F;s 쓰기가 가능하지만 Class 10이 Class 4를 앞선다는 것을 보장하진 않는다. 라즈베리파이는 Class 6의 8GB 사용을 권장하고 있다.</li>
</ul>
<figure>그림.</figure>

<p>SDCardFormatter</p>
<p><a target="_blank" rel="noopener" href="http://v.media.daum.net/v/20180630101105544">PCIe 지원 SD Card 규격 7.0</a></p>
<h4 id="USB-to-Serial-Cable"><a href="#USB-to-Serial-Cable" class="headerlink" title="USB to Serial Cable"></a>USB to Serial Cable</h4><p>USB 주변기기가 대중화 되면 컴퓨터에 Serial port가 사라진 후에 <em>USB to TTL</em> 혹은 <em>USB to Serial</em> 로 Serial 케이블을 사용해야 한다. </p>
<p>구글 검색을 해보면 DB-9 포트 형태, 보드 형태 및 Raspberry Pi 같은 SBC 보드의 GPIO 포트에 사용하기 좋은 Adarfruit 판매하는 핀 형태의 제품도 있다.</p>
<p><img src="/images/raspberrypi/usb-serial-cables.png">{: width&#x3D;”600” }</p>
<figure>그림.USB to Serial Cable(구글 이미지 검색 캡쳐)</figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/06/22/raspberrypi-2018-06-22-raspbian-1-prepare/" data-id="cl0196xh6003ejs7gh24272on" data-title="Raspberry Pi : Raspbian 설치준비" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raspberry-Pi/" rel="tag">Raspberry Pi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raspberry-Pi-3/" rel="tag">Raspberry Pi 3</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raspbian/" rel="tag">Raspbian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/" rel="tag">라즈베리파이</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/" rel="tag">라즈비안</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-raspberrypi-2018-06-22-raspbian-2-os-install" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/22/raspberrypi-2018-06-22-raspbian-2-os-install/" class="article-date">
  <time class="dt-published" datetime="2018-06-22T00:10:00.000Z" itemprop="datePublished">2018-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Raspberry-Pi/">Raspberry Pi</a>►<a class="article-category-link" href="/categories/Raspberry-Pi/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/22/raspberrypi-2018-06-22-raspbian-2-os-install/">Raspberry Pi : Install Raspbian</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Install Rasbperry Pi OS 글타래는 아래 같이 구성되며 OS 설치, Service 구성 및 사용에 대해 작성한다.</p>
<ol>
<li><strong><a href="!--swig%EF%BF%BC30--">Raspberry Pi 설치준비</a></strong></li>
<li><strong>Install Raspbian OS</strong></li>
<li>Managing Service daemon</li>
<li>Basic OS Security for Server</li>
<li><a href="!--swig%EF%BF%BC31--">Install &amp; Configuration - Nginx, Node JS, Jupyter</a></li>
</ol>
<blockquote>
<p>2017-10-30: swap 추가, timezone 수정<br>{:.right-history}</p>
</blockquote>
<h2 id="Install-Raspbian-OS"><a href="#Install-Raspbian-OS" class="headerlink" title="Install Raspbian OS"></a>Install Raspbian OS</h2><p>Raspberry Pi(라즈베리파이)에 Raspbian, Ubuntu 등을 설치하고 <em>Serial Console</em> 을 이용해서, 라즈베리파이를 처음 설정하고 <em>SSH</em> 구성을 활성화 하겠다.</p>
<p>라즈베리파이에 OS를 설치하기 위해서는 <strong>NOOBS</strong>를 사용하거나 <strong>오에스 이미지</strong>를 다운받아 SD Card에 구워서 사용한다. 라즈베리파이는 다음과 같은 OS 배포본을 사용할 수 있다. </p>
<table>
<thead>
<tr>
<th>운영체제</th>
<th>특징</th>
</tr>
</thead>
<tbody><tr>
<td>Raspbian (Debian)</td>
<td>Raspberry Pi + Debian의 합성어, 가장 범용 OS.</td>
</tr>
<tr>
<td>Arch Linux (A non-Linux Distribution)</td>
<td>ARM 프로세서를 지원하는 Arch Linux</td>
</tr>
<tr>
<td>RISC OS</td>
<td>ARM 프로세서를 위한 실시가(RTOS) 운영체제</td>
</tr>
<tr>
<td>OpenElec</td>
<td>XBMC 미디어 센터 지원을 위한 운영체제</td>
</tr>
<tr>
<td>RaspBMC</td>
<td>XBMC 미디어 센터 지원을 위한 운영체제</td>
</tr>
<tr>
<td>Pidora</td>
<td>Pi + Fedora 운영체제</td>
</tr>
</tbody></table>
<p>**Raspbian(라즈비안)**은 라즈베리파이를 위한 데비안 리눅스로 가장 대중적인 데비안 리눅스, 우분투와 같은 사용자 경험을 제공해 주고 있다.</p>
<h3 id="Raspberry-Pi-준비"><a href="#Raspberry-Pi-준비" class="headerlink" title="Raspberry Pi 준비"></a>Raspberry Pi 준비</h3><p>설치에 앞서 준비해야 할 것 이 있습니다.</p>
<ul>
<li>Raspberry Pi 1, 2, 3</li>
<li>OS 설치 SD Memory Card: 8GB 이상, Class6 이상</li>
<li>USB to Serial Cable</li>
</ul>
<h4 id="SDCard에-대해"><a href="#SDCard에-대해" class="headerlink" title="SDCard에 대해"></a>SDCard에 대해</h4><p>라즈베리파이는 SD 호환 카드에서 작동하도록 되어 있다. </p>
<ul>
<li><p>NOOBS를 이용한다면 최소 8GB</p>
</li>
<li><p>다른 버전은 최소 4GB</p>
</li>
<li><p>Class 4는 4MB&#x2F;s 쓰기 속도, Class 10은 10MB&#x2F;s 쓰기가 가능하지만 Class 10이 Class 4를 앞선다는 것을 보장하진 않는다. 라즈베리파이는 Class 6의 8GB 사용을 권장하고 있다.</p>
</li>
<li><p>Mac: SDCardFormatter</p>
</li>
</ul>
<h4 id="SDCard-사용시-주의"><a href="#SDCard-사용시-주의" class="headerlink" title="SDCard 사용시 주의"></a>SDCard 사용시 주의</h4><ul>
<li>정품 SD Card 사용을 권장</li>
<li>전원은 품질이 좋아야. 라즈베리파이 보드의 TP1, TP2 전력을 측정해서 4.75v 이하면 품질이 좋은 전원으로 바꾸길.</li>
<li>더불어 좋은 품질의 USB 케이블을 사용해야 한다.</li>
<li>종료시 <strong>sudo halt</strong> 를 이용하도록</li>
<li>오버클록은 지양하도록</li>
</ul>
<br>
### Download and Install

<p>OS 설치와 서비스 설치는 크게 아래 과정을 거친다.</p>
<ul>
<li>(1). Download OS Image, Etcher, sdFormatter</li>
<li>(2). OS image 파일을 SD Card에 쓴다.</li>
</ul>
<p>SD Card로 부팅후에</p>
<ul>
<li>(1). 모니터 혹은 시리얼 콘솔에서 <code>raspi-conifg</code> 로 시스템 구성을 마무리</li>
<li>(2). 서비스 설치</li>
</ul>
<h4 id="1-Download-OS-Image-Etcher-sdFormatter"><a href="#1-Download-OS-Image-Etcher-sdFormatter" class="headerlink" title="(1). Download OS Image, Etcher, sdFormatter"></a>(1). Download OS Image, Etcher, sdFormatter</h4><p>라즈베리안 OS를 다운로드,</p>
<p><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/downloads/raspbian/">Raspberry Pi Raspbian Download</a> 링크에서 다운 받을 수 있다. </p>
<blockquote>
<p>토렌트와 zip 형식으로 다운 받을 수 있습니다.</p>
</blockquote>
<p>다운로드된 파일은 <em>yyyy-mm-dd-raspbian-wheezy.zip</em> 형식으로 다운로드가 된다. 디스크 이미지 파일 <em>yyyy-mm-dd-raspbian-wheezy.img</em> 이 zip으로 압축되어 있는데,이 이미지 파일을 SD Card에 복사해야 한다.</p>
<p>디스크 이미지를 쓰기위한 프로그램으로 오에스 이미지를 SD Card, Disk 등에 쓴다. 보통 아래 프로그램을 이용한다.</p>
<ul>
<li>Windows : Win32DiskImager</li>
<li>Linux: ImageWriter</li>
<li>macOS: <code>dd</code> 명령</li>
<li>모든 플랫폼: Etcher</li>
<li>SD Memory Card Formatter 5.0 for SD&#x2F;SDHC&#x2F;SDXC</li>
</ul>
<p>이 글에서는 디스크 이미지 쓰기<a target="_blank" rel="noopener" href="http://etcher.io/">Etcher</a> 프로그램을 이용해서 오에스 이미지 파일을 SD Card에 쓰겠다.</p>
<blockquote>
<p>macOS, Windows, Linux 지원 </p>
</blockquote>
<p>여기까지 필요한 준비 사항은:</p>
<ul>
<li>Raspbian OS Image</li>
<li>SD Card Formatter</li>
</ul>
<h4 id="OS-image-파일을-SD-Card-쓰기"><a href="#OS-image-파일을-SD-Card-쓰기" class="headerlink" title="OS image 파일을 SD Card 쓰기"></a>OS image 파일을 SD Card 쓰기</h4><p>Etcher를 실행하고 </p>
<p><img src="/images/opensuse/etcher-image-writing.png">{:width&#x3D;”640”}</p>
<h5 id="dd-를-사용한다면"><a href="#dd-를-사용한다면" class="headerlink" title="dd 를 사용한다면,"></a><code>dd</code> 를 사용한다면,</h5><p>다운받은 <code>.zip</code> 파일을  <code>unzip</code>으로 풀어 dd&#96;로 SD Card에 이미지를 쓴다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -p 2017-06-21-raspbian-stretch-lite.zip | sudo dd of=/dev/rdisk1 bs=4M; sync</span><br></pre></td></tr></table></figure>

<blockquote>
<p>MacOS는 dd의 bs 옵션이 소문자로 받는다: <code>bs=4m</code></p>
</blockquote>
<p>다쓴 SD Card를 마운트 한다. </p>
<h4 id="ssh-활성화"><a href="#ssh-활성화" class="headerlink" title="ssh 활성화"></a>ssh 활성화</h4><p>Raspbian 2016-11-25일 릴리즈 이후 기본으로 ssh가 비활성화 되어 있다. 그래서 처음 부팅후 ssh 접속이 필요하다면 부트 파티션에 <code>ssh</code> 파일을 생성해 주면된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /boot</span><br><span class="line">$ touch ssh</span><br></pre></td></tr></table></figure>


<br>
#### Serial console

<p>여기서는 <strong>Serial console</strong>에서 네트워크 확인 및 초기 설정을 하고 <strong>ssh</strong> 로 서버에 로그인해서 시스템 구성을 진행한다.</p>
<blockquote>
<p>SD Card를 라즈베리파이에 꽃고 HDMI, Keyboard 및 Mouse 가 별도로 준비되어 있으면 직접 모니터를 보고 작업을 진행하면 좋다. </p>
</blockquote>
<p>USB to Serial 케이블을 사용해서 Raspberry Pi의 Serial Console에 연결한다.</p>
<p><img src="/images/raspberrypi/rpi-usb-serial.png">{:width&#x3D;”640”}</p>
<p>그리고 시리얼 포트를 통해 tty 연결을 위해 터미널 프로그램에서 baud rate 115200 으로 연결한다. 아래는 macOS의 <code>screen</code> CLI 명령으로 usb serial 포트에 연결하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screen /dev/cu.usbserial 115200</span><br></pre></td></tr></table></figure>

<p>이제 SD Card를 넣고 부팅을 하면, 터미널에 부트 단계가 진행되고 처음 5분 정도 소요된다. </p>
<p><img src="/images/opensuse/opensuse-boot33.png">{:width&#x3D;”640”}</p>
<p>Raspberry Pi를 위한 이미지는 처음 계정은 <code>root/linux</code> 이다. </p>
<p>터미널에서 uname 은 <strong>aarch64</strong> 임을 확인 할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root<span class="comment"># uname -a</span></span><br><span class="line">Linux homepi 4.4.90-18.32-default <span class="comment">#1 SMP Fri Oct 6 13:30:08 UTC 2017 (465b410) aarch64 aarch64 aarch64 GNU/Linux</span></span><br></pre></td></tr></table></figure>

<p>처음으로 라즈베리파이에서 64bit 환경으로 운영해 볼 수 있게 됐다.</p>
<h4 id="Raspbian-OS-Image-복사"><a href="#Raspbian-OS-Image-복사" class="headerlink" title="Raspbian OS Image 복사"></a>Raspbian OS Image 복사</h4><p>맥&#x2F;리눅스에서 dd 명령을 이용해서 이미지를 복사할 수 있습니다. </p>
<blockquote>
<p>sudo dd bs&#x3D;1m if&#x3D;path_of_your_image.img of&#x3D;&#x2F;dev&#x2F;diskn</p>
<ul>
<li>bs: 한번에 읽어들일 사이즈를 의미</li>
</ul>
</blockquote>
<p>마지막 옵션인 ‘diskn’의 n은 SD Card의 번호로 SDCard Formater에서 기억하란 번호입니다. 여기서 번호가 2로 가정합니다.<br>그리고 Mac OSX는 디스크가 &#x2F;dev 경로에 두 가지 종류가 있습니다.</p>
<ul>
<li>&#x2F;dev&#x2F;disk# 버퍼 디바이스로 데이터가 부가적인 처리를 통해 사용합니다.</li>
<li>&#x2F;dev&#x2F;rdisk# 저수준 경로로 빠르고 dd 명령을 사용할 때 완벽합니다.</li>
</ul>
<blockquote>
<p>Class 4 SD card는 rdisk 경로를 사용할 때 20배 빠릅니다.</p>
</blockquote>
<p>먼저 포맷터로 포맷한 디스크 마운트를 해제합니다. 맥의 디스크유틸리티를 이용해서 마운트를 해제합니다.<br><img src="/images/mac-diskutility.png"></p>
<p>이미지가 있는 곳에서 dd 명령으로 라즈비안을 복사합니다.3.2GB 크기를 복사해서 9분~15분 정도의 시간이 소요됩니다.</p>
<p>zip 압축 파일을 입력으로 다음 같이 dd 명령으로 sd card에 쓴다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -p 2016-05-27-raspbian-jessie.zip | sudo dd of=/dev/rdisk1 bs=1m</span><br></pre></td></tr></table></figure>

<p>압축을 푼후</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$sudo dd bs=1m if=2015-02-16-raspbian-wheezy.img of=/dev/rdisk2</span><br><span class="line">3125+0 records in</span><br><span class="line">3125+0 records out</span><br><span class="line">3276800000 bytes transferred i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n 551.608702 secs (5940443 bytes/sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>rdisk 이용시 에러가 발생하면 disk를 사용합니다.</p>
</blockquote>
<p>다음 링크에 설명한 방법을 바탕으로 설명해보겠습니다.<br>참조: <a target="_blank" rel="noopener" href="http://elinux.org/RPi_Easy_SD_Card_Setup">http://elinux.org/RPi_Easy_SD_Card_Setup</a></p>
<h5 id="Mac-diskutil-과-dd-이용"><a href="#Mac-diskutil-과-dd-이용" class="headerlink" title="Mac diskutil 과 dd 이용"></a>Mac diskutil 과 dd 이용</h5><p>diskutil로 디스크 목록 확인해 SD카드 번호 확인</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil list</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil unmountDisk /dev/disk1</span><br></pre></td></tr></table></figure>

<p>이미지 쓰기</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd bs=1m if=image.img of=/dev/rdisk[n] conv=noerror,sync</span><br></pre></td></tr></table></figure>

<blockquote>
<p>위 명령으로도 ‘Permission Denied’ 가 나오면, 이것은 SD 카드의 파티션 테이블이 덮어쓰기를 막고 있다는 의미로 이 경우 파티션 테이블을 제거해야 한다. 다음 같이 zero로 SDCard를 덮어쓰면 all partitions, master boot records, and data를 지운다.</p>
</blockquote>
<p>진행 상황을 보려면 <em>status&#x3D;progress</em> 로 알 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd bs=1m if=image.img of=/dev/rdisk[n] conv=noerror,sync status=progress</span><br></pre></td></tr></table></figure>

<p>SD card를 포맷하려면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo dd if=/dev/zero of=/dev/rdisk1 bs=4k count=1</span><br></pre></td></tr></table></figure>
<ul>
<li>bs: 한번에 읽어들일 byte를 의미</li>
<li>count: block 수 입니다.</li>
</ul>
<p>혹은 랜덤 데이터로 지우려면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$dd if=/dev/urandom of=/dev/sda bs=4k</span><br></pre></td></tr></table></figure>

<p>Mac의 diskutil을 사용하면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo diskutil partitionDisk /dev/disk3 1 MBR &quot;Free Space&quot; &quot;%noformat%&quot; 100%</span><br></pre></td></tr></table></figure>


<p>다운로드한 이미지는 zip 압축 파일로 저장된다. 다음 같이 명령 파이프를 이용하면 압축 파일을 풀지않고 디스크에 이미지를 쓸 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -p 2016-09-23-raspbian-jessie.zip* | sudo dd of=/dev/rdisk1 bs=4m</span><br><span class="line">password: ****</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>이미지를 <em>dd</em>  명령으로 작성한 후에 카드를 추출한다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo diskutil eject /dev/rdisk3</span><br></pre></td></tr></table></figure>


<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/documentation/installation/installing-images/mac.md">https://www.raspberrypi.org/documentation/installation/installing-images/mac.md</a></p>
</blockquote>
<h5 id="clone-disk"><a href="#clone-disk" class="headerlink" title="clone disk"></a>clone disk</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd if=/dev/diskX conv=sync,noerror bs=4m | gzip -c  &gt; /path/to/backup.img.gz</span><br></pre></td></tr></table></figure>


<blockquote>
<p>반대로 디스크를 디스크이미지로 만들려면 다음 같이 dd 를 사용할 수 있습니다.<br>쓰기 전에 sd card의 마운트한 파티션을 마운트를 해제해야 합니다.</p>
<p>$sudo dd bs&#x3D;1m if&#x3D;2015-02-16-raspbian-wheezy.img of&#x3D;&#x2F;dev&#x2F;rdisk2</p>
</blockquote>
<h4 id="SDFormatter-이용"><a href="#SDFormatter-이용" class="headerlink" title="SDFormatter 이용"></a>SDFormatter 이용</h4><p>SDCard Formatter 를 이용해서 SD Card를 포맷할 수 있습니다. 윈도우즈, 리눅스 및 맥을 지원합니다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.sdcard.org/downloads/formatter_4/">https://www.sdcard.org/downloads/formatter_4/</a></li>
</ul>
<ol>
<li>오에스에 맞는 버전을 다운로드하고 실행하면 설치를 합니다. </li>
<li>SD Card를 컴퓨터에 삽입합니다.</li>
<li>SDFormatter를 실행하고 다음 화면 처럼 SD card를 포맷할 수 있습니다.</li>
</ol>
<ul>
<li>SDFormatter 라는 프로그램을 설치하여, 옵션의 FORMAT SIZE ADJUSTMENT 설정을 ON 으로 하여 SD카드를 포맷</li>
</ul>
<p><img src="/images/raspberrypi/sdcardformatter-main.png" alt="SDCard Formatter 실행"></p>
<blockquote>
<p>SDCard Formatter에서 디스크 선택시 디스크 번호를 잘 기억해 두세요.</p>
</blockquote>
<h3 id="윈도우즈에서-라즈비안-복사하기"><a href="#윈도우즈에서-라즈비안-복사하기" class="headerlink" title="윈도우즈에서 라즈비안 복사하기"></a>윈도우즈에서 라즈비안 복사하기</h3><p>윈도우XP&#x2F;7&#x2F;8 에서 다운로드한 라즈비안 OS를 SD카드로 복사하겠습니다. 아래 링크에서 ‘Win32 Disk Imager’를 다운받아 사용해야 합니다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://sourceforge.net/projects/win32diskimager/">Win32 Disk Imager</a></li>
</ul>
<p>win32diskimager를 실행하고 다운받은 ‘2015-03-15-raspbian-wheezy.zip’ 파일을 선택하고 SD카드 위치를 선택해 주면 됩니다.</p>
<p><img src="/images/win32diskimager.png"></p>
<p>그리고 Write버튼을 눌러주고 기다리면 복사를 시작합니다.</p>
<h2 id="부팅"><a href="#부팅" class="headerlink" title="부팅"></a>부팅</h2><h3 id="IP-강제-지정"><a href="#IP-강제-지정" class="headerlink" title="IP 강제 지정"></a>IP 강제 지정</h3><p>CD Card를 마운트 하면 boot 파티션이 마운트 된다. boot 파티션에 있는 <em>cmdline.txt</em> 에 <code>ip=</code> 옵션을 추가해 강제로 IP 주소를 지정할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dwc_otg.lpm_enable=0 console=ttyAMA0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait **ip=192.168.0.203**</span><br></pre></td></tr></table></figure>


<h3 id="Serial-Console"><a href="#Serial-Console" class="headerlink" title="Serial Console"></a>Serial Console</h3><p><img src="/images/raspberypi/rpi-usb-serial.png"></p>
<p>Raspbian 은 boot 파티션에 있는 <em>cmdline.txt</em> 옵션으로 기본적으로 serial console을 사용하도록 하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dwc_otg.lpm_enable=0 console=ttyAMA0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait</span><br></pre></td></tr></table></figure>

<h4 id="Mac-Serial"><a href="#Mac-Serial" class="headerlink" title="Mac Serial"></a>Mac Serial</h4><p>보통 FTDI USB 케이브을 다음 두 제품이 대부분이다.</p>
<ul>
<li>Prolific PL2303:   <a target="_blank" rel="noopener" href="http://www.prolific.com.tw/us/showproduct.aspx?p_id=229&pcid=41">PL2303 MacOSX</a></li>
<li>FTDI USB Serial:   FTDIUSBSerialDriver_v2_3.zip</li>
</ul>
<blockquote>
<p>macOS Maverick 이후 FTDI 드라이버가 포함되어 있다.<br>혹시 새 버전을 설치하거나 이전 버전이 설치되어 삭제하려면 [^6]<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd /Library/Extensions/</span><br><span class="line">$ sudo rm -r PL2303.kext</span><br><span class="line">$ sudo rm -r ProlificUsbSerial.kext</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>FTDI 케이블을 사용한다고 가정하고 맥에 USB to Serial 케이블을 연결하면 <em>&#x2F;dev</em> 장치에 <em>cu.</em>, <em>tty.</em> 장치 드라이버가 생성된다. 두 장치는 다른 점이 있다.[^5]</p>
<ul>
<li>&#x2F;dev&#x2F;tty.* 장치는 DCD (data-carrier-detect) 신호를 대기한다, 이것은 누군가 호출해 온다는 의미이다.</li>
<li>&#x2F;dev&#x2F;cu.* 장치는 DCD를 추정하지 않고 항상 즉시 연결한다(응답 혹은 성공)</li>
</ul>
<p>FTDI 로 시리얼을 사용시는 <em>cu.</em> 장치를 사용하면 된다.</p>
<blockquote>
<p>일반적으로 </p>
</blockquote>
<h4 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h4><p>Mac에서 <code>screen</code> 사용시</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen /dev/cu.usbserial-XXXXXXXX 115200</span><br></pre></td></tr></table></figure>

<p>시리얼 터미널에서 빠져나오려면  ‘ctrl-a, ctrl-&#39; 를  순서데로 입력</p>
<h3 id="Linux-Serial-terminal"><a href="#Linux-Serial-terminal" class="headerlink" title="Linux Serial terminal"></a>Linux Serial terminal</h3><p>Linux machine에서 Usb to serial 케이블을 사용할 수 있는지 콘솔 메시지에서 Serial console이 있는 지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | egrep --color &#x27;serial&#x27;</span><br><span class="line">[ 1969.914088] usbcore: registered new interface driver usbserial</span><br><span class="line">[ 1969.914139] usbcore: registered new interface driver usbserial_generic</span><br><span class="line">[ 1969.914175] usbserial: USB Serial support registered for generic</span><br><span class="line">[ 1969.918325] usbserial: USB Serial support registered for pl2303</span><br></pre></td></tr></table></figure>

<p>장치 드라이버는 보통 <em>&#x2F;dev&#x2F;ttyUSB0</em> 장치로 연결된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /dev/ttyUSB*</span><br><span class="line">/dev/ttyUSB0</span><br></pre></td></tr></table></figure>


<h4 id="dterm"><a href="#dterm" class="headerlink" title="dterm"></a>dterm</h4><p>dtermAUR is a tiny serial communication program. If you invoke it without parameters, it will connect to &#x2F;dev&#x2F;ttyS0 at 9600 baud by default. The following example connect to &#x2F;dev&#x2F;ttyS0 at 115200 baud, with 8 data bits, no parity bit and 1 stop bit-times:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dterm 115200 8 n 1</span><br></pre></td></tr></table></figure>

<p>See its homepage[1] for more examples.</p>
<h4 id="Minicom"><a href="#Minicom" class="headerlink" title="Minicom"></a>Minicom</h4><p>minicom can be obtained from the official repositories. Start Minicom in setup mode:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ minicom -s</span><br></pre></td></tr></table></figure>

<p>Using the textual navigation menu, change the serial port settings to the following:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Serial Device: /dev/ttyS0</span><br><span class="line">Bps/Par/Bits: 9600 8N1</span><br></pre></td></tr></table></figure>

<p>Press Enter to exit the menus (pressing Esc will not save changes). Remove the modem Init and Reset strings, as we are not connecting to a modem. To do this, under the Modem and Dialing menu, delete the Init and Reset strings. Optionally save the configuration by choosing save setup as dfl from the main menu. Restart minicom with the serial cable connected to the target machine. To end the session, press Ctrl+A followed by Ctrl+X.</p>
<h4 id="picocom"><a href="#picocom" class="headerlink" title="picocom"></a>picocom</h4><p>picocom is a tiny dumb-terminal emulation program that is very like minicom, but instead of mini, it is pico. The following example connect to ttyS0 at 9600 bps:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ picocom -b 9600 /dev/ttyS0</span><br></pre></td></tr></table></figure>

<p>Note: if the backspace key won’t work properly try out this option: ‘–omap delbs’<br>See its manual for detailed usage.</p>
<h4 id="Screen"><a href="#Screen" class="headerlink" title="Screen"></a>Screen</h4><p>screen is able to connect to a serial port. It will connect at 9600 baud by default:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ screen /dev/ttyS0 115200</span><br></pre></td></tr></table></figure>

<p>To end the session, press Ctrl+a followed by k.</p>
<p>여러 사용자로 열려면 <strong>-R</strong> 옵션을 주고 다시 연다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen -R /dev/tty.usbserial-XXXXXXXX 115200</span><br></pre></td></tr></table></figure>

<p>screen 명령 사용중 어떤 상황에서 세션이 멈춘 경우 종료 명령이 안된다. 이 경우 screen 세션을 찾고 가제 종료를 시도해 본다.</p>
<p>Type screen -list to identify the detached screen session.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~$ screen -list  </span><br><span class="line">    There are screens on:  </span><br><span class="line">         20751.Melvin_Peter_V42  (Detached)  </span><br><span class="line">Note: 20751.Melvin_Peter_V42 is your session id.</span><br></pre></td></tr></table></figure>

<p>Get attached to the detached screen session<br>screen -r 20751.Melvin_Peter_V42<br>Once connected to the session press Ctrl + A then type :quit</p>
<p>Attached session 종료</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ screen -ls</span><br><span class="line">There is a screen on:</span><br><span class="line">  2667.ttys003.gogangtaeui-MacBook-Pro  (Attached)</span><br><span class="line">1 Socket in /var/folders/02/4qk5tfw527b9zqx92gtv4m980000gn/T/.screen.</span><br></pre></td></tr></table></figure>

<p>screen -S sessionname -p 0 -X quit</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><p><a target="_blank" rel="noopener" href="http://www.mostlynetworks.com/2014/11/os-x-yosemite-prolific-usb-drivers/">http://www.mostlynetworks.com/2014/11/os-x-yosemite-prolific-usb-drivers/</a><br><a target="_blank" rel="noopener" href="http://www.mostlynetworks.com/2015/01/fixing-prolific-driver-os-x/">http://www.mostlynetworks.com/2015/01/fixing-prolific-driver-os-x/</a><br><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/disk_cloning">https://wiki.archlinux.org/index.php/disk_cloning</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/working_with_the_serial_console">Archlinux-Working with serial console</a></li>
</ul>
<p>[^5]: <a target="_blank" rel="noopener" href="https://pbxbook.com/other/mac-tty.html">Mac tty</a><br>[^6]: <a target="_blank" rel="noopener" href="http://sewellsupport.com/Uninstall-Pl-2303-on-Mac-OSX.aspx">Uninstall PL-2303 on macOS X</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/06/22/raspberrypi-2018-06-22-raspbian-2-os-install/" data-id="cl0196xk900i7js7g7bxa104m" data-title="Raspberry Pi : Install Raspbian" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raspberry-Pi/" rel="tag">Raspberry Pi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raspberry-Pi-3/" rel="tag">Raspberry Pi 3</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Raspbian/" rel="tag">Raspbian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/" rel="tag">라즈베리파이</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/" rel="tag">라즈비안</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-linux-2018-06-08-mongodb-3-6-install" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/08/linux-2018-06-08-mongodb-3-6-install/" class="article-date">
  <time class="dt-published" datetime="2018-06-08T09:00:00.000Z" itemprop="datePublished">2018-06-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>►<a class="article-category-link" href="/categories/Linux/Database/">Database</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/08/linux-2018-06-08-mongodb-3-6-install/">MongoDB Community Edition 3.6 on Ubuntu</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>2018-06-22 내용 정리, User auth 링크<br>{:.right-history}</p>
</blockquote>
<p>이 문서는 Ubuntu&#x2F;Debian 계열 정규 배포본에 3.x 버전을 지원하지 않는 플랫폼에 <strong>MongoDB Community Edition 3.6</strong> 버전을 설치하는 과정을 정리하고 있다. 내용의 기초는 MongoDB Community Edition 3.6 버전을 <em>Amd64</em>, <em>Arm64</em> 지원하는 <em>64bit OS</em>에 설치해 사용하기 위해서 <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/">Install MongoDB Community Edition, on-ubuntu</a>를 따라서 진행하고 경험상 필요한 부분을 추가로 정리했다.</p>
<ul>
<li>MongoDB Community Edition 3.6 설치</li>
<li>Mongo Database 구성</li>
</ul>
<h2 id="Install-MongoDB-3-6-Community-edition"><a href="#Install-MongoDB-3-6-Community-edition" class="headerlink" title="Install MongoDB 3.6 Community edition"></a>Install MongoDB 3.6 Community edition</h2><p>문서에 따르면 리눅스 계열은 Ubuntu, Red Hat, SUSE, Amazon, Debian 과 tarball 설치를 지원한다. 또한 macOS, Windows 플랫폼 설치도 지원한다고 한다.</p>
<p>테스트한 플랫폼은</p>
<ul>
<li><strong>64bit Ubuntu 16.04</strong>:</li>
<li><strong>Hardkernel Odroid C2</strong>: 64bit, Armbian</li>
</ul>
<p>MongoDB는 다음 패키지를 지원하고 있다:</p>
<ul>
<li><code>mongodb-org</code> : 다음 패키지를 설치하기 위한 메타 패키지</li>
<li><code>mongodb-org-server</code> : <code>mongod</code> daemon 과 구성 및 초기 스크립트.</li>
<li><code>mongodb-org-mongos</code> : <code>mongos</code> daemon.</li>
<li><code>mongodb-org-shell</code> : <code>mongo</code> shell.</li>
<li><code>mongodb-org-tools</code> : MongoDB 유틸리티: mongoimport bsondump, mongodump, mongoexport, mongofiles, mongoperf, mongorestore, mongostat, and mongotop.</li>
</ul>
<h3 id="사전준비"><a href="#사전준비" class="headerlink" title="사전준비"></a>사전준비</h3><p>여기서는 Odroid C2 같은 64bit Arm을 지원하는 Armbian 배포본, 그리고 PC Linux&#x2F;n-Cloud 등의 플랫폼에서 Ubuntu Xeniel 버전에 설치를 했다.</p>
<ul>
<li>Armbian 배포본 Debian Jessie&#x2F;Stretch 에는 아직 mongodb 64bit 를 제공하지 않고 있다.</li>
</ul>
<h4 id="레포지토리-등록"><a href="#레포지토리-등록" class="headerlink" title="레포지토리 등록"></a>레포지토리 등록</h4><p>인증된 <code>.dpkg</code>, <code>.apt</code> 패키지를 설치하기 위해, 아래 처럼 서버의 키를 등록한다.</p>
<blockquote>
<p>여러분 시스템이 적용되는 지는 [^1]에 잘 설명되어 있다.</p>
</blockquote>
<p><em>키서버 등록</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5</span><br></pre></td></tr></table></figure>

<h4 id="MongoDB용-소스-리스트-추가"><a href="#MongoDB용-소스-리스트-추가" class="headerlink" title="MongoDB용 소스 리스트 추가"></a>MongoDB용 소스 리스트 추가</h4><p>apt의 source list에 mongodb repository를 등록한다. 우분투 계열은 파일 생셩 <code>/etc/apt/sources.list.d/mongodb-org-3.6.list</code> 파일 생성하고 아래 같이 해당 리눅스 버전에 맞는 소스 목록을 추가한다.</p>
<p><strong>Ubuntu 16.04</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.6 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list</span><br></pre></td></tr></table></figure>

<p><strong>Ubuntu 14.04</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.6 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list</span><br></pre></td></tr></table></figure>

<h4 id="remove-key-amp-ppa"><a href="#remove-key-amp-ppa" class="headerlink" title="remove key &amp; ppa"></a>remove key &amp; ppa</h4><p>설치 후 필요 없어서 키 서버 저장소 목록을 지우려면, 삭제할 키 해시 8자리 코드를 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key list</span><br><span class="line"></span><br><span class="line">pub   4096R/A15703C6 2016-01-11 [expires: 2018-01-10]</span><br><span class="line">uid                  MongoDB 3.4 Release Signing Key &lt;packaging@mongodb.com&gt;</span><br></pre></td></tr></table></figure>

<p>이 키를 삭제한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-key del A15703C6</span><br></pre></td></tr></table></figure>

<h3 id="설치"><a href="#설치" class="headerlink" title="설치"></a>설치</h3><p>그리고 <code>apt</code> 명령으로 소스 캐시를 갱신하고 mongodb-org 커뮤니티 버전의 mongodb를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install -y mongodb-org</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mongodb 3.x 버전은 데이터 저장 파일 시스템으로 xfs 를 권장하고 있다.</p>
</blockquote>
<p>만약 특정 버전을 설치하려면 다음 같이 버전을 명시한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install -y mongodb-org=3.6.5 mongodb-org-server=3.6.5 mongodb-org-shell=3.6.5 mongodb-org-mongos=3.6.5 mongodb-org-tools=3.6.5</span><br></pre></td></tr></table></figure>

<p>이전 mongod-org 3.4를 Armbian 에서 설치중 systemd unit 설정 파일과 MongoDB 시스템 계정 등이 생성되지 않는 경우가 있었다. 아래를 따라 손으로 생성해 주면 된다.</p>
<h4 id="mongodb-사용자"><a href="#mongodb-사용자" class="headerlink" title="mongodb 사용자"></a><em>mongodb</em> 사용자</h4><p>mongod-org 설치후 시스템 사용자 <strong>mongodb</strong> 가 추가되야 한다. 만약 생성되지 않았으면, 새로 만든다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser --disabled-password --gecos &quot;&quot; --no-create-home --disabled-password --disabled-login mongodb</span><br></pre></td></tr></table></figure>

<h4 id="systemd-service-entry"><a href="#systemd-service-entry" class="headerlink" title="systemd service entry"></a>systemd service entry</h4><p>만약 <strong>mongodb-org</strong> 설치후 <code>systemctl</code> 스크립트가 <code>/etc/init.d</code>에 복사되지 않는 경우</p>
<blockquote>
<p>여기서는 odroid-c2 armbian 설치 상태, 일반 리눅스 배포본은 잘 된다.</p>
</blockquote>
<p>systemd 서비스 파일이 <em>&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongod.service</em>에 위치한다. 아래 명령을 실행해 <strong>mongodb.service</strong> 가 없으면 새로 생성해야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --type=service |grep mongodb</span><br></pre></td></tr></table></figure>

<p>만약 <strong>mongodb.service</strong> 가 없다면, <code>/lib/systemd/system/mongod.service</code> 파일을 다음 같이 활성화 시켜준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /lib/systemd/system</span><br><span class="line">$ sudo systemctl enable mongodb.service</span><br></pre></td></tr></table></figure>

<p><strong>mongodb.service</strong> 가 등록됐는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl list-unit-files --type=service |grep mongodb</span><br><span class="line">mongodb.service             disabled</span><br></pre></td></tr></table></figure>

<p><em>disable</em> 상태면 <code>systemctl</code> 명령으로 <em>enable</em> 시킨다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl enable mongodb.service</span><br></pre></td></tr></table></figure>

<br>
### Run

<p>MongoDB Community Edition이 설치되면 요구되는 파일 및 폴더가 다음 위치에 생성됟다.</p>
<ul>
<li><strong>&#x2F;var&#x2F;lib&#x2F;mongodb</strong> : 기본 데이터 파일 위치</li>
<li><strong>&#x2F;var&#x2F;log&#x2F;mongodb</strong> : 기본 로그 저장 폴더</li>
<li><strong>&#x2F;etc&#x2F;mongod.conf</strong> : mongod 구성 파일. 로그, 데이터 위치 등을 변경 가능</li>
</ul>
<p><code>mongod</code> 데몬은 mongodb user account 계정으로 실행된다. <code>systemctl</code> 명령으로 <code>mongod</code> 를 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start mongod</span><br><span class="line">$ sudo systemctl status mongod</span><br></pre></td></tr></table></figure>

<p>실행한 <code>mongod</code>를 확인해 보면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef |grep mongod</span><br><span class="line">mongodb  15385     1  1 12:06 ?        00:00:00 /usr/bin/mongod --config /etc/mongod.conf</span><br></pre></td></tr></table></figure>

<p><code>mongod</code> 서비스가 제대로 실행됐으면 <strong>mongo</strong> 클라이언트로 테스트해 볼 수 있으면 접속해 볼 수 있다.</p>
<br/>
<br/>

<h3 id="Mongo-Database-설정"><a href="#Mongo-Database-설정" class="headerlink" title="Mongo Database 설정"></a>Mongo Database 설정</h3><ul>
<li>mongodb 사용자와 디렉토리 퍼미션 확인</li>
<li>mongod.conf 설정</li>
<li>mongo client 접속 테스트</li>
<li>mongodb 인증</li>
</ul>
<h4 id="퍼미션-확인"><a href="#퍼미션-확인" class="headerlink" title="퍼미션 확인"></a>퍼미션 확인</h4><p><strong>로그 디렉토리</strong> <em>&#x2F;var&#x2F;log&#x2F;mongo</em> 그리고 <strong>데이터 디렉토리</strong> <em>&#x2F;data&#x2F;mongodata</em> 라면 해당 디렉토리에 몽고디비 사용자가 쓸 수 있는 퍼미션을 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> mongo.daemon /var/log/mongodb</span><br><span class="line">$ sudo <span class="built_in">chown</span> mongodb.mongodb /data/mongodata</span><br></pre></td></tr></table></figure>

<h4 id="mongod-conf-설정"><a href="#mongod-conf-설정" class="headerlink" title="mongod.conf 설정"></a>mongod.conf 설정</h4><p>MongoDB의 <code>systemd</code> 서비스는 데이터베이스 구성 파일 <code>/etc/mongod.conf</code> 을 참조한다.</p>
<p>먼저 <code>/etc/mongod.conf</code> 파일에 <strong>인증</strong>을 제외한 <strong>데이터 디렉토리</strong>, <strong>bindIp</strong>, <strong>로그</strong> 부분만 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">storage:</span><br><span class="line">  dbPath: /data/mongodata/</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: /var/log/mongodb/mongod.log</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">   fork: true</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 127.0.0.1,192.168.0.2</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>dbPath</strong> : 데이터베이스 스토리지 위치</li>
<li><strong>bindIp</strong>: 서버 외에서 mongo 클라이언트가 접근하려면 IP 를 입력한다.</li>
</ul>
<p>현재는 <code>mongo.conf</code> 설정 파일에 접근 제어가 없는 상태에서 <strong>mongo</strong> 클라이언트로 접속한다</p>
<h4 id="Admin-사용자"><a href="#Admin-사용자" class="headerlink" title="Admin 사용자"></a>Admin 사용자</h4><p><code>mongod</code>에 인증이 비활성화 상태에서 mongo&#96; 클라이언트로 접속에 성공하면 <strong>&gt;</strong> 프롬프트가 나온다. <em>admin</em> 데이터베이스로 전환한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$mongo</span><br><span class="line">&gt;</span><br><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><em>admin</em> 데이터베이스에서 관리자 role을 가진 사용자를 추가하고, 사용할 데이터베이스의 사용자와 접근 제어를 추가해서 사용하기 위해서 작업한다.</p>
<h4 id="user-administrator"><a href="#user-administrator" class="headerlink" title="user administrator"></a>user administrator</h4><p><code>userAdmin role</code> 혹은 <code>userAdminAnyDatabase role</code>을 가진 사용자 만든다. 다음은 <em>admin</em> 데이터베이스에서 사용자를 관리하는 <strong>admin 계정</strong>을 생성하고 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user:&#x27;admin&#x27;,</span><br><span class="line">    pwd:&#x27;****&#x27;,</span><br><span class="line">    roles:[&#x27;userAdminAnyDatabase&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">Successfully added user: &#123; &quot;user&quot; : &quot;admin&quot;, &quot;roles&quot; : [ &quot;userAdminAnyDatabase&quot; ] &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; db.getUsers()</span><br></pre></td></tr></table></figure>

<p>admin <code>사용자 패스워드 변경</code>은</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.changeUserPassword(&quot;accountUser&quot;, &quot;SOh3TbYhx8ypJPxmt1oOfL&quot;)</span><br></pre></td></tr></table></figure>

<p>사용자의 <code>role</code> 을 변경,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.grantRolesToUser( &#x27;admin&#x27;, [&#123;role: &#x27;userAdmin&#x27;, db:&#x27;admin&#x27;&#125;])</span><br><span class="line">&gt; db.getUsers()</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_id&quot; : &quot;admin.admin&quot;,</span><br><span class="line">    &quot;user&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;db&quot; : &quot;admin&quot;,</span><br><span class="line">    &quot;roles&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdmin&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,</span><br><span class="line">        &quot;db&quot; : &quot;admin&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>혹은 updateUser 를 사용할 수 있다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( &quot;appClient01&quot;, ...</span><br></pre></td></tr></table></figure>

<h4 id="security-authorization"><a href="#security-authorization" class="headerlink" title="security.authorization"></a><code>security.authorization</code></h4><p><strong>mongodb.conf</strong> 파일에 <code>security.authorization</code> 을 활성화 한다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  authorization: enabled</span><br></pre></td></tr></table></figure>

<blockquote>
<p>인증모드는 v2.4이전에는 <code>--auth</code> 옵션을 사용하고, v2.6 이후에서 <em>mongod.conf</em> 파일 사용할 때 <code>security.authorization</code> 를 활성화 한다.</p>
</blockquote>
<p>systemd 로 서비스를 재시작 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart mongod.service</span><br><span class="line">$ sudo systemctl status mongod.service</span><br></pre></td></tr></table></figure>

<p>이제 인증 모드에서 데이터베이스에 접속해야 한다. 만약 인증모드로 시작한 후에 다음 같이 인증 정보없이 로그인 하면 데이터베이스 사용시 에러를 만난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">&gt; show dbs;</span><br><span class="line">Tue Sep 27 23:22:40.683 listDatabases failed:&#123; &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;unauthorized&quot; &#125; at src/mongo/shell/mongo.js:46</span><br><span class="line">&gt;</span><br><span class="line">&gt; show users</span><br><span class="line">Tue Sep 27 23:22:44.667 error: &#123; &quot;$err&quot; : &quot;not authorized for query on test.system.users&quot;, &quot;code&quot; : 16550 &#125; at src/mongo/shell/query.js:128</span><br></pre></td></tr></table></figure>

<h4 id="인증모드로-접속"><a href="#인증모드로-접속" class="headerlink" title="인증모드로 접속"></a>인증모드로 접속</h4><p>데이터베이스 시스템에 접근제어가 활성화 되면 <code>mongo</code> 클라이언트 접속시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>만약 데이터베이스 인증모드로 실행되는데 비인증 클라이언트 접근은 아래 같이 에러를 낸다:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MongoDB shell version v3.6.5</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.6.5</span><br><span class="line">&gt; use students</span><br><span class="line">switched to db students</span><br><span class="line">&gt; show users</span><br><span class="line">2018-06-25T18:30:38.174+0900 E QUERY    [thread1] Error: not authorized on students to execute command &#123; usersInfo: 1.0, $db: &quot;students&quot; &#125; :</span><br></pre></td></tr></table></figure>

<h4 id="원격지에서-접근"><a href="#원격지에서-접근" class="headerlink" title="원격지에서 접근"></a>원격지에서 접근</h4><p>외부에서 mongodb로 접근시 authentication을 적용한 상태라면 다음과 같은 URL로 접근할 수 있다:</p>
<blockquote>
<p>“username:password@HOST_NAME&#x2F;mydb”</p>
</blockquote>
<blockquote>
<p>그러나 외부접근시 클라이언트 버전과 서버의 Credential 버전이 맞지 않은 경우 다음 같이 실패 메시지를 확인할 수 있다.</p>
<p>2016-05-16T00:53:10.338+0900 I ACCESS [conn2] Failed to authenticate student@student with mechanism MONGODB-CR: AuthenticationFailed: MONGODB-CR credentials missing in the user document<br>2016-05-16T00:53:10.352+0900 I NETWORK [conn2] end connection 220.121.140.59:51634 (0 connections now open)</p>
</blockquote>
<br/>
### 데이터베이스 생성과 인증

<p>새 데이터베이스에 컬렉션을 생성하고 데이터베이스 사용자를 접근제어할 수 있는 내용은 <a href="!--swig%EF%BF%BC31--">MongoDB User Authentication</a> 에서 다루고 있다.</p>
<br/>
<br/>
## MongoDB에 관련 글


<p><strong>MongoDB Community Edition Installations</strong> 시리즈:ㅇ</p>
<ol>
<li><a href="/linux/database/mongodb-4.2-install_arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu&#x2F;Debian Armbian</a></li>
<li><a href="/linux/database/mongodb-config/">MongoDB 구성 설정 과 사용자 인증 사용</a></li>
</ol>
<hr>
<p><strong>MongoDB Tutorials</strong> 시리즈:</p>
<ol>
<li><a href="/linux/database/mongodb-collections/">MongoDB Tutorials: collections</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mongodb.org/display/DOCS/Tutorial">MongoDB Tutorial</a></li>
</ol>
<hr>
<p><strong>MongoDB와 Middleware Platform</strong>:</p>
<ol>
<li><a href="/nodejs/database/mongodb-mongoose/">NodeJS Mongoose</a></li>
<li><a href="/nodejs/database/mongodb-mongoose-middleware/">Mongodb mongoose-middleware</a></li>
</ol>
<hr>
<p>이전 버전과 기타 자료:</p>
<ol>
<li><a href="/linux/database/mongodb-user-auth/">MongoDB User Authentication</a></li>
<li><a href="/linux/database/mongodb-3.6-install/">MongoDB Community Edition 3.6 on Ubuntu(ARM64)</a></li>
<li><a href="/linux/database/mongodb-3.4-install-armv8/">Mongodb 3.4 install on Armv8</a></li>
<li><a href="/raspberry%20pi/linux/database/opensuse-jeos-mongodb/">Raspberry Pi 3 64bit OS openSUSE: Build MongoDB 3.4</a></li>
</ol>
<br/>
### `mongod` 명령 사용

<p><code>systemd</code>가 아닌, <code>mongod</code> 명령으로 로 MongoDB를 시작해 설정 파일 등이 제대로 동작하는지 확인할 수 있다.</p>
<p>다만 데이터베이스가 생성하는 데이터와 로그 파일의 접근권한이 실행한 사용자 계정으로 처리되어 퍼미션 문제가 발생할 수 있다.</p>
<h4 id="mongoDB-v2-4-인증모드로-시작"><a href="#mongoDB-v2-4-인증모드로-시작" class="headerlink" title="mongoDB v2.4 인증모드로 시작"></a>mongoDB v2.4 인증모드로 시작</h4><p><code>mongod</code> 명령라인으로 시작할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>mongoDB v2.4는 다음 같이 인증 모드로 시작한다. <code>mongod</code> 명령라인에서 <code>--auth</code> 옵션을 붙여 DB 인스턴스(<code>mongod</code>)를 시작 혹은 재시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/db1</span><br></pre></td></tr></table></figure>

<p>혹은 <em>mongod.conf</em> 설정 파일에서 <strong>auth</strong> 를 활성화 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth = true</span><br></pre></td></tr></table></figure>

<h4 id="mongoDB-v2-6-이후"><a href="#mongoDB-v2-6-이후" class="headerlink" title="mongoDB v2.6 이후"></a>mongoDB v2.6 이후</h4><p>앞서 시작한 명령행 <strong>mongodb</strong>를 종료하고 명령라인에서 재시작 <code>--auth</code> 옵션을 붙여 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongod --auth --port 27017 --dbpath /data/mongodata</span><br></pre></td></tr></table></figure>

<p>접근제어 <code>--auth</code> 옵션으로 데이터베이스를 시작하면 로그인시 <code>-u &lt;username&gt;, -p &lt;password&gt;</code> 와 <code>--authenticationDatabase &lt;database&gt;</code> 를 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mongo --port 27017 -u &quot;admin&quot; -p &quot;****&quot; --authenticationDatabase &quot;admin&quot;</span><br><span class="line">MongoDB shell version v3.4.0</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.0</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p>[^1]: <a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition">Install mongodb on Ubuntu</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/06/08/linux-2018-06-08-mongodb-3-6-install/" data-id="cl0196xg4001ajs7g1zgwcxdw" data-title="MongoDB Community Edition 3.6 on Ubuntu" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/amd64/" rel="tag">amd64</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arm64/" rel="tag">arm64</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/armbian/" rel="tag">armbian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debian/" rel="tag">debian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/odroid-c2/" rel="tag">odroid-c2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/" rel="tag">데이안</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/" rel="tag">우분투</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs-2018-06-02-restfull-openapi-jwt-token" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/06/02/nodejs-2018-06-02-restfull-openapi-jwt-token/" class="article-date">
  <time class="dt-published" datetime="2018-06-02T00:00:00.000Z" itemprop="datePublished">2018-06-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/06/02/nodejs-2018-06-02-restfull-openapi-jwt-token/">Open API Web Token</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Open-api-key"><a href="#Open-api-key" class="headerlink" title="Open api key"></a>Open api key</h2><p>API keys는 사용자 인증, 요청 API 호출을 위해 필요하다. </p>
<p>보통 RESTFull API 호출시 API keys 와 인증 스킴을 사용한다. 주요 차이는:</p>
<ul>
<li>API keys : 앱 혹은 사이트 호출을 식별해서 API 호출을 만다.</li>
<li>Auth tokens : 앱 혹은 사이트 사용자를 식별한다.</li>
</ul>
<p>이런 인증에 두가지 방식을 사용한다.</p>
<ul>
<li>Session-based Authentication</li>
<li>Token-based Authentication</li>
</ul>
<h3 id="Token-based-Authentication"><a href="#Token-based-Authentication" class="headerlink" title="Token based Authentication"></a>Token based Authentication</h3><p>토큰 기반 인증은</p>
<ol>
<li>Stateless Authentication 이 큰 이유이다. 클라이언트 측 로컬 스토리지 (혹은 세션, 쿠키 가능)에 저장된다.</li>
<li>좋은 예는 싱글 페이지 앱, Web ApIs, IoT가 있다</li>
<li>앱이 확장성이 있고 분리되야 한다면, Token 기반이 좋은 사례가 된다.</li>
</ol>
<blockquote>
<p>Stateless Authentication: 인증에 대해 서버측이 인증 정보를 보존하지 않는다.</p>
</blockquote>
<h3 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h3><p><strong>JWT</strong>(JSON Web Tokens)는 REST API를 사용한 간단하고 보안이 적용된 인증 전략이다. 웹 인증을 위한 표준이고 JSON token 요청을 기반으로 한다. 인증 서버에서 발급한 토큰을 클라이언트가 요청시 마다 헤더에 토큰을 넣어 요구해야 한다.</p>
<p>MEAN 스택 앱에 빠르게 인증을 추가하는 것은 <a target="_blank" rel="noopener" href="http://jwt.io/">JSON Web Token</a> 을 사용할 수 있다.</p>
<h3 id="How-JWT-Works"><a href="#How-JWT-Works" class="headerlink" title="How JWT Works?"></a>How JWT Works?</h3><p><a target="_blank" rel="noopener" href="https://appdividend.com/2018/02/07/node-js-jwt-authentication-tutorial-scratch/">Node Js JWT Authentication Tutorial From Scratch</a></p>
<p>JSON Web Token is the token; we need to put the header in every request to verify the client. The Architecture of JWT Authentication is pretty darn simple.</p>
<ol>
<li>First user attempt to login with their credentials.</li>
<li>After server verifies the credentials, it sends JSON Web Token to the client.</li>
<li>A client then saves that token in local storage or any other storage mechanism.</li>
<li>Again if a client wants to request a protected route or resource, then it sends JWT in a request header.</li>
<li>The server verifies that JWT and if it is correct then return a 200 response with the information, client needs.</li>
<li>If the JWT is invalid, then it gives unauthorized access or any other restricted message.</li>
<li>Node js JWT Authentication</li>
</ol>
<p>In this tutorial, we are not using any front-end framework. We will use POSTMAN  to request the server. We will check the auth using token. So let us get started.</p>
<h4 id="Step-1-Install-node-js-dependencies"><a href="#Step-1-Install-node-js-dependencies" class="headerlink" title="Step 1: Install node js dependencies."></a>Step 1: Install node js dependencies.</h4><p>Create one project folder and go into that folder. Type the following command.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>

<p>Now, install the following dependencies.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express jsonwebtoken mongoose body-parser --save</span><br></pre></td></tr></table></figure>

<p>It will install the express web framework, jsonwebtoken package to authenticate the user, mongoose schema model, and body-parser middleware.</p>
<p>Also, we need to install the nodemon development server to prevent the stop and restart the server process. So let us do that first.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon --save-dev</span><br></pre></td></tr></table></figure>

<p>Rest dependencies we will install as our project grows.</p>
<h4 id="Step-2-Configure-the-Node-Server"><a href="#Step-2-Configure-the-Node-Server" class="headerlink" title="Step 2: Configure the Node Server."></a>Step 2: Configure the Node Server.</h4><p>In the package.json file, change this object to the following.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon server&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>So in the terminal when we type npm start command, we bootstrap the server.js file.<br>In the root folder, make one file called <em>server.js</em>. Configure the node server.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server is running on Port&#x27;</span>,<span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now, go to terminal and hit the following instruction.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p>It will start the server, you can see it on a console. So it is ready to consume any request, either web or API.</p>
<h4 id="Step-3-Send-a-request-to-node-server-via-Postman"><a href="#Step-3-Send-a-request-to-node-server-via-Postman" class="headerlink" title="Step 3: Send a request to node server via Postman."></a>Step 3: Send a request to node server via Postman.</h4><p>First, we define one route and send the JSON response to the client.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/checking&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">   res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="string">&quot;Tutorial&quot;</span>: <span class="string">&quot;Welcome to the Node express JWT Tutorial&quot;</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Open the Postman and send the get request to <a target="_blank" rel="noopener" href="http://localhost:3000/checking">http://localhost:3000/checking</a>. Postman Tutorial</p>
<h4 id="Step-4-Configure-the-MongoDB-Database"><a href="#Step-4-Configure-the-MongoDB-Database" class="headerlink" title="Step 4: Configure the MongoDB Database."></a>Step 4: Configure the MongoDB Database.</h4><p>Write the following code to connect the Node.js application to the MongoDB database.</p>
<p>if below mongoose 3.x, </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/jwtauth&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>Then use above mongoose 4.x, prepare <em>Promise</em> and connect().</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mongodb</span></span><br><span class="line">mongoose.<span class="property">Promise</span> = <span class="variable language_">global</span>.<span class="property">Promise</span>;</span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>( </span><br><span class="line">  <span class="string">&quot;mongodb://student:PW@localhost/students&quot;</span>,</span><br><span class="line">  &#123; <span class="attr">useMongoClient</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Also, write the body-parser middleware to the application.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br></pre></td></tr></table></figure>


<h4 id="Step-5-Create-a-User-model"><a href="#Step-5-Create-a-User-model" class="headerlink" title="Step 5: Create a User model."></a>Step 5: Create a User model.</h4><p>Create one new folder inside root called models. In that, create one file called user.model.js file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.model.js</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">   <span class="comment">//_id: mongoose.Schema.Types.ObjectId,</span></span><br><span class="line">   <span class="attr">email</span>: &#123;<span class="attr">type</span>: <span class="title class_">String</span>, <span class="attr">required</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">   <span class="attr">password</span>: &#123;<span class="attr">type</span>: <span class="title class_">String</span>, <span class="attr">required</span>: <span class="literal">true</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, user);</span><br></pre></td></tr></table></figure>

<p>We have defined the schema for the User collection.</p>
<h4 id="Step-6-Create-the-routes-for-users"><a href="#Step-6-Create-the-routes-for-users" class="headerlink" title="Step 6: Create the routes for users."></a>Step 6: Create the routes for users.</h4><p>In the root, make one folder called routes. In that folder, create one file called user.route.js. Now we need to sign the user up for our application. So let us define the post route to signup the user. We also need a bcrypt module to hash the password. We can not store the plain password. So let us install bcrypt module first.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bcrypt</span><br></pre></td></tr></table></figure>

<p>Next, write the following code into the <em>user.route.js</em> file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.route.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcrypt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/user.model&#x27;</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/signup&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">   bcrypt.<span class="title function_">hash</span>(req.<span class="property">body</span>.<span class="property">password</span>, <span class="number">10</span>, <span class="keyword">function</span>(<span class="params">err, hash</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(err) &#123;</span><br><span class="line">         <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">error</span>: err</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// const user = new User(req.body);</span></span><br><span class="line">         <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;</span><br><span class="line">            <span class="comment">// _id: new  mongoose.Types.ObjectId(),</span></span><br><span class="line">            <span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span>,</span><br><span class="line">            <span class="attr">password</span>: hash    </span><br><span class="line">         &#125;);</span><br><span class="line">         user.<span class="title function_">save</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">               <span class="attr">success</span>: <span class="string">&#x27;New user has been created&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">         &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">               <span class="attr">error</span>: err</span><br><span class="line">            &#125;);</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>What it does is that it tries to hash the incoming request’s password property. If it fails to do so then returns a response with an error in json format. If it successes then it will create a new user and add that to the MongoDB database. Now include this user.route.js file in the server.js file. I am writing the whole file now.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = <span class="built_in">require</span>(<span class="string">&#x27;./routes/user.route&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/jwtauth&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/checking&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">   res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="string">&quot;Tutorial&quot;</span>: <span class="string">&quot;Welcome to the Node express JWT Tutorial&quot;</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/user&#x27;</span>, user);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server is running on Port&#x27;</span>,<span class="variable constant_">PORT</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="Step-7-Send-a-post-request-from-the-Postman"><a href="#Step-7-Send-a-post-request-from-the-Postman" class="headerlink" title="Step 7: Send a post request from the Postman."></a>Step 7: Send a post request from the Postman.</h4><p>postman 에서 POST 방식으로 새 사용자를 추가해 보자, POST에서 Body를 Raw 이고 형식은 <strong>json(application&#x2F;json)</strong> 를 선택하고 작성한다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">  <span class="attr">&quot;firstName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lastName&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/nodejs/auth-jwt-signup-postman.png">{:width&#x3D;”500”}</p>
<figcaption>[그림. Postman에서 JSON 포스트]</figcaption>



<p>You can see here, I have created user successfully. Now, I am using Studio 3T for MongoDB. So here is the newly created user in the database.</p>
<p>이제 실제 암호화된 비밀번호로 생성된 사용자 정보를 확인할 수 있다.</p>
<p><img src="/images/nodejs/auth-jwt-signup-db.png">{:width&#x3D;”500”}</p>
<figcaption>[그림. 새 사용자 정보]</figcaption>


<p>MongoDB Tutorial With An Example</p>
<h4 id="Step-8-Sign-In-the-User"><a href="#Step-8-Sign-In-the-User" class="headerlink" title="Step 8: Sign In the User."></a>Step 8: Sign In the User.</h4><p>사용자가 생성되고 비밀번호로 bcryp로 비밀번호가 생성되면 <code>bcrypt.compare()</code> 를 사용해 사용자 비밀번호를 인증할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.route.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/signin&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">   <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span>&#125;)</span><br><span class="line">   .<span class="title function_">exec</span>()</span><br><span class="line">   .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">user</span>) &#123;</span><br><span class="line">      bcrypt.<span class="title function_">compare</span>(req.<span class="property">body</span>.<span class="property">password</span>, user.<span class="property">password</span>, <span class="keyword">function</span>(<span class="params">err, result</span>)&#123;</span><br><span class="line">         <span class="keyword">if</span>(err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">               <span class="attr">failed</span>: <span class="string">&#x27;Unauthorized Access&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(result) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">               <span class="attr">success</span>: <span class="string">&#x27;Welcome to the JWT Auth&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">failed</span>: <span class="string">&#x27;Unauthorized Access&#x27;</span></span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;)</span><br><span class="line">   .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">         <span class="attr">error</span>: error</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;);;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>사용자 이메일로 허가된 사용자인지 인증하는데, 이메일이 존재하지 않으면 <strong>401 unauthorized access</strong> 에러를 출력한다.</p>
<p><img src="/images/nodejs/auth-jwt-signin-postman.png">{:width&#x3D;”500”}</p>
<figcaption>[그림. Postman에서 Sign 포스트]</figcaption>

<p>First, I have checked if the user’s email exists or not. If not then return 401 unauthorized access. If email is there then check the password with bcrypted database password if match found then welcome to the JWT auth else 401 unauthorized access.</p>
<p>이메일로 사용자 검색이 되고 비밀번호 인증이 되면 환영 JWT auth를 반환하고 아니면 <strong>401 unauthorized access</strong> 를 반환하게 한다.</p>
<h4 id="Step-9-Return-the-JWT-if-auth-attempt-successful"><a href="#Step-9-Return-the-JWT-if-auth-attempt-successful" class="headerlink" title="Step 9: Return the JWT, if auth attempt successful."></a>Step 9: Return the JWT, if auth attempt successful.</h4><p>사용자 증명인 이메일과 패스워드가 유효하면 JWT token을 반환하도록 하자, <code>jwt.sign()</code> 함수는 기본으로 HMAC SHA256 해시 코드를 발생한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jwt.<span class="title function_">sign</span>(&#123;</span><br><span class="line">  <span class="attr">email</span>: user.<span class="property">email</span>,</span><br><span class="line">  <span class="attr">_id</span>: user.<span class="property">_id</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>다른 알고리즘이 필요하면 <em>algorighm</em> 속성을 제시해 준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jwt.<span class="title function_">sign</span>(&#123;</span><br><span class="line">  <span class="attr">email</span>: user.<span class="property">email</span>,</span><br><span class="line">  <span class="attr">_id</span>: user.<span class="property">_id</span>,</span><br><span class="line">  &#123; <span class="attr">algorithm</span>: <span class="string">&#x27;RS256&#x27;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>If the user’s credentials email and password are valid then in response, we need to return a JWT token. So let us generate the token and return to the user.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.route.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(result) &#123;</span><br><span class="line">   <span class="keyword">const</span> <span class="title class_">JWTToken</span> = jwt.<span class="title function_">sign</span>(&#123;</span><br><span class="line">        <span class="attr">email</span>: user.<span class="property">email</span>,</span><br><span class="line">        <span class="attr">_id</span>: user.<span class="property">_id</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;secret&#x27;</span>,</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="attr">expiresIn</span>: <span class="string">&#x27;2h&#x27;</span></span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">         <span class="attr">success</span>: <span class="string">&#x27;Welcome to the JWT Auth&#x27;</span>,</span><br><span class="line">         <span class="attr">token</span>: <span class="title class_">JWTToken</span></span><br><span class="line">       &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>JWT Token의 형식은 HEADER, PAYLOAD, SECRETKEY 조합으로 아래 같다:</p>
<p>The format of JWT Token is as following.</p>
<p><strong>HEADER: ALGORITHM &amp; TOKEN TYPE</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">“alg”<span class="punctuation">:</span> “HS256”<span class="punctuation">,</span></span><br><span class="line">“typ”<span class="punctuation">:</span> “JWT”</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>PAYLOAD:DATA</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">“email”<span class="punctuation">:</span> “krunallathiya10@gmail.com”<span class="punctuation">,</span></span><br><span class="line">“_id”<span class="punctuation">:</span> “<span class="number">5</span>a7c9bd8fc3e501c94aa6035”<span class="punctuation">,</span></span><br><span class="line">“iat”<span class="punctuation">:</span> <span class="number">1518120124</span><span class="punctuation">,</span></span><br><span class="line">“exp”<span class="punctuation">:</span> <span class="number">1518127324</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>VERIFY SIGNATURE</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload)<span class="punctuation">,</span></span><br><span class="line">  secret</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>조합으로 생성한 JWT는 아래 같은 JWT Token을 반환한다.</p>
<p>So it is a combination of header, payload, and secretkey, we are providing. Remember, You need to define your secret key in your environment variable file. I have just shown here for the demo purpose. So it will produce the following JWT token.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImtydW5hbGxhdGhpeWExMEBnbWFpbC5jb20iLCJfaWQiOiI1YTdjOWJkOGZjM2U1MDFjOTRhYTYwMzUiLCJpYXQiOjE1MTgxMjAxMjQsImV4cCI6MTUxODEyNzMyNH0._6qVGQV_KYlonawnaTHG-OhOJLV4tgD-Eob5iRz89AM</span><br></pre></td></tr></table></figure>


<p>이 토큰을 제한된 자원에 접근하는 앱에 사용할 수 있다.</p>
<p>Now use this token to access the protected resources to your application and we are done here. So this is how you can generate the JWT Auth Token. </p>
<h4 id="JWT-Token-verifying"><a href="#JWT-Token-verifying" class="headerlink" title="JWT Token verifying"></a>JWT Token verifying</h4><p><code>jwt.verify()</code>를 사용해 발급한 토큰이 허용되는지 검증할 수 있다.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/auth0/node-jsonwebtoken#jwtverifytoken-secretorpublickey-options-callback">jwt.verify(token, secretOrPublicKey, [options, callback])</a></p>
<ul>
<li><code>token</code>: 발행된 Json Web Token</li>
<li><code>secretOrPublicKey</code>: 토큰 발행시 제공한 시크릿 키</li>
</ul>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/verify&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span>&#125;);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// check expired?</span></span><br><span class="line">   jwt.<span class="title function_">verify</span>(req.<span class="property">body</span>.<span class="property">token</span>, user.<span class="property">secret_key</span>, <span class="keyword">function</span>(<span class="params">err, decoded</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(err);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/jsonwebtoken">npm:JSONWebToken</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://appdividend.com/2018/02/07/node-js-jwt-authentication-tutorial-scratch/">Node Js JWT Authentication Tutorial From Scratch</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://cloud.google.com/endpoints/docs/openapi/when-why-api-key">Why and When to Use API Keys</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://appdividend.com/2018/02/07/node-js-jwt-authentication-tutorial-scratch/">https://appdividend.com/2018/02/07/node-js-jwt-authentication-tutorial-scratch/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://medium.freecodecamp.org/securing-node-js-restful-apis-with-json-web-tokens-9f811a92bb52">Securing Node.js RESTful APIs with JSON Web Tokens</a></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/06/02/nodejs-2018-06-02-restfull-openapi-jwt-token/" data-id="cl0196xgm002ijs7g52vp91q3" data-title="Open API Web Token" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JSON-Web-Token/" rel="tag">JSON Web Token</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JWT-Toekn/" rel="tag">JWT Toekn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/" rel="tag">웹토큰</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-nodejs-2017-12-20-mongodb-mongoose-middleware" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/12/20/nodejs-2017-12-20-mongodb-mongoose-middleware/" class="article-date">
  <time class="dt-published" datetime="2017-12-20T00:00:00.000Z" itemprop="datePublished">2017-12-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/NodeJS/">NodeJS</a>►<a class="article-category-link" href="/categories/NodeJS/Database/">Database</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/12/20/nodejs-2017-12-20-mongodb-mongoose-middleware/">NodeJS - mongoose middleware</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>이 글은  <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/middleware.html">mongoose middleware</a>를 한글로 요약 정리한 것이다. 실제 본문을 요약하여 번역해 정리했으므로 이해가 안되는 부분은 위 링크의 내용을 참조하기 바란다.</p>
<h3 id="mongoose-middleware"><a href="#mongoose-middleware" class="headerlink" title="mongoose middleware"></a>mongoose middleware</h3><p><em>pre</em>, <em>post</em> hook 이라고 불리는 <a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/middleware.html">mongoose middleware</a>는 비동기 함수의 실행중 제어권을 다룰 수 있다. 미들웨어는 스키마 수순에서 사용고 <a target="_blank" rel="noopener" href="http://github.com/Automattic/mongoose">plugins</a> 를 작성하는데 유용하다.</p>
<p>Mongoose 4.x 은 4종류의 미들웨어를 지원한다: </p>
<ul>
<li>document middleware</li>
<li>model middleware</li>
<li>aggregate middleware</li>
<li>query middleware</li>
</ul>
<p>Document middleware는 아래 도큐멘트 함수를 지원한다. 도큐멘트 미들웨어에서 <code>this</code> 는 도큐멘트를 가르킨다.</p>
<ul>
<li>init</li>
<li>validate</li>
<li>save</li>
<li>remove</li>
</ul>
<p>Query middleware 는 아래 모델과 쿼리 함수를 지원한다. 쿼리 미들웨어 함수에서 <code>this</code> 는 쿼리를 가르킨다.</p>
<ul>
<li>count</li>
<li>find</li>
<li>findOne</li>
<li>findOneAndRemove</li>
<li>findOneAndUpdate</li>
<li>update</li>
</ul>
<p>Aggregate middleware 는 <code>MyModel.aggregate()</code> 를 위한것이다. Aggregate middleware는 aggregate 객체에서 <code>exec()</code> 를 호출할 때 실행된다.. 여기서 <code>this</code> 는 aggregation object를 가르킨다.</p>
<ul>
<li>aggregate</li>
</ul>
<p>Model middleware 는 아래 모델 함수에 대해 지원한다. 여기서 <code>this</code>는 모델을 가르킨다.</p>
<ul>
<li>insertMany</li>
</ul>
<blockquote>
<p>Note: There is no query hook for remove(), only for documents. If you set a ‘remove’ hook, it will be fired when you call myDoc.remove(), not when you call MyModel.remove(). Note: The create() function fires save() hooks.</p>
</blockquote>
<p>모든 미들웨어 형식은 <code>pre</code>와 <code>post</code> 훅(hook)을 지원한다.</p>
<br>
<br>
### Pre middleware

<p>Serial과 parallel 이라는 두가지 <code>pre</code> 훅이 있다.</p>
<br>
#### Serial

<p>Serial middleware는 각 미들웨어가 <code>next()</code>를 호출하면 하나 다음 다른 하나를 실행한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(..);</span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">next</span>) &#123;</span><br><span class="line">  <span class="comment">// do stuff</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>그렇지만 <code>next()</code> 함수가 미들웨어의 다음 코드 실행을 멈추지 않기 때문에 <code>return</code> 패턴을 사용해서 코드 진행을 멈추면 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(..);</span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">foo</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;calling next!&#x27;</span>);</span><br><span class="line">    <span class="comment">// `return next();` will make sure the rest of this function doesn&#x27;t run</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;after next&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<br>
#### Parallel

<p>Parallel middleware는 제어를 더욱 정밀하게 할 수 있다.</p>
<p>아래는 Pre 훅에 <code>true</code> 인자를 전달해 parallel 미들웨어를 사용하게 하고, 이것은 <code>save</code> 인 경우 각 미들웨어에서 done 호출 전까지 실행하지 않는다는 의미이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(..);</span><br><span class="line"></span><br><span class="line"><span class="comment">// `true`: parallel middleware.</span></span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="literal">true</span>, <span class="keyword">function</span>(<span class="params">next, done</span>) &#123;</span><br><span class="line">  <span class="comment">// calling next kicks off the next middleware in parallel</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">  <span class="built_in">setTimeout</span>(done, <span class="number">100</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<br>
#### Use Cases

<p>미들웨어는 원자화 모델과 비동기 코드의 중첩을 회피하는데 유용한다. 아래 같은 사례:</p>
<ul>
<li>복합 유효성 확인</li>
<li>의존하는 문서 삭제 (사용자에 관련한 모든 문서를 삭제)</li>
<li>asynchronous defaults</li>
<li>asynchronous tasks that a certain action triggers<ul>
<li>triggering custom events</li>
<li>notifications</li>
</ul>
</li>
</ul>
<br>
#### 에러 처리

<p>미들웨어에서 <code>Error</code> 형식 매개변수로 next(), done() 을 호출할 때 에러로 처리가 가로채지면 콜백 함수에 에러가 전달된다.</p>
<p>아래 같이 에러 발생시 <code>new Error()</code>를 생성해야 다음 <code>next()</code> 가 호출되지 않는다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">next</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;something went wrong&#x27;</span>);</span><br><span class="line">  <span class="title function_">next</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// later...</span></span><br><span class="line">myDoc.<span class="title function_">save</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>) <span class="comment">// something went wrong</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<br>
<br>
### Post middleware

<p>post middleware 는 pre middle 웨어가 완료되어 훅 메서드가 처리된 뒤에 실행된다. post 는 제어를 직접 하지 못한다. 예를 들어 next(), done() callback이 전달되면 post 훅은 이들 메서드를 이벤트 리스너에 등록하는 방법이다. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;init&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been initialized from the db&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;validate&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been validated (but not saved yet)&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been saved&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;remove&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%s has been removed&#x27;</span>, doc.<span class="property">_id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
#### Asynchronous Post Hooks

<p>post가 선언된 순서에 따라 post hook이 비동기 적으로 실행되는데, callback function에 두 개의 인자를 전달하면 mongoose는 두번째를 <code>next()</code> 로 가정하고 순서에 따라 next를 트리거 호출한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Takes 2 parameters: this is an asynchronous post hook</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc, next</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;post1&#x27;</span>);</span><br><span class="line">    <span class="comment">// Kick off the second post hook</span></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;, <span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Will not execute until the first middleware calls `next()`</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">doc, next</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;post2&#x27;</span>);</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
#### Save/Validate Hooks

<p>The <code>save()</code> 함수는 <code>validate()</code> hook을 유발하는데 이것은 <code>pre(&#39;save&#39;)</code> hook이 호출되면서  <code>pre(&#39;validate&#39;)</code> 와 <code>post(&#39;validate&#39;)</code> hook이 호출된다는 것이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;validate&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed first&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;validate&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed second&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed third&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this gets printed fourth&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
#### Notes on findAndUpdate() and Query Middleware

<p>Pre 와 post save() hook은 <code>update()</code>, <code>findOneAndUpdate()</code> 등에서 호출되지 않는다. Mongoose 4.0 은 이들 함수에 다른 훅을 가지고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;find&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> mongoose.<span class="property">Query</span>); <span class="comment">// true</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">start</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;find&#x27;</span>, <span class="keyword">function</span>(<span class="params">result</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> mongoose.<span class="property">Query</span>); <span class="comment">// true</span></span><br><span class="line">  <span class="comment">// prints returned documents</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;find() returned &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span><br><span class="line">  <span class="comment">// prints number of milliseconds the query took</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;find() took &#x27;</span> + (<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">start</span>) + <span class="string">&#x27; millis&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>document middleware에서 <code>this</code> 는 갱신하는 도큐멘트를 가르킨다. 그래서 <code>update()</code> 에 타임스탬프를 추가하고자 하면 아래 pre hook을 사용한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schema.<span class="title function_">pre</span>(<span class="string">&#x27;update&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">update</span>(&#123;&#125;,&#123; <span class="attr">$set</span>: &#123; <span class="attr">updatedAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125; &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h3 id="Error-Handling-Middleware"><a href="#Error-Handling-Middleware" class="headerlink" title="Error Handling Middleware"></a>Error Handling Middleware</h3><blockquote>
<p>New in 4.5.0</p>
</blockquote>
<p>일반적으로 next() 호출시 첫번째 error에서 멈추는데 특별한 post middleware로 “error handling middleware” 가 있다.<br>Error handling middleware는 부가적으로 콜백 함수의 매개변수에 <code>error</code>가 전달되는데, 첫번째 인자로 <code>error</code> 를 전달한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="comment">// Will trigger a MongoError with code 11000 when</span></span><br><span class="line">    <span class="comment">// you save a duplicate</span></span><br><span class="line">    <span class="attr">unique</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handler **must** take 3 parameters: the error that occurred, the document</span></span><br><span class="line"><span class="comment">// in question, and the `next()` function</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;save&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, doc, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;MongoError&#x27;</span> &amp;&amp; error.<span class="property">code</span> === <span class="number">11000</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;There was a duplicate key error&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Will trigger the `post(&#x27;save&#x27;)` error handler</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">create</span>([&#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125;]);</span><br></pre></td></tr></table></figure>

<p>Error handling middleware는 query middleware와도 동작한다. 예를 들어 update() 호출시 키 중철 에러를 처리하는 훅를 고려하면:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The same E11000 error can occur when you call `update()`</span></span><br><span class="line"><span class="comment">// This function **must** take 3 parameters. If you use the</span></span><br><span class="line"><span class="comment">// `passRawResult` function, this function **must** take 4</span></span><br><span class="line"><span class="comment">// parameters</span></span><br><span class="line">schema.<span class="title function_">post</span>(<span class="string">&#x27;update&#x27;</span>, <span class="keyword">function</span>(<span class="params">error, res, next</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;MongoError&#x27;</span> &amp;&amp; error.<span class="property">code</span> === <span class="number">11000</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;There was a duplicate key error&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> people = [&#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">&#x27;Slash&#x27;</span> &#125;];</span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">create</span>(people, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">update</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Slash&#x27;</span> &#125;, &#123; <span class="attr">$set</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;Axl Rose&#x27;</span> &#125; &#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// `error.message` will be &quot;There was a duplicate key error&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<br>
<br>
## 참조

<ul>
<li><a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/middleware.html">mongoose middleware</a></li>
<li><a target="_blank" rel="noopener" href="http://github.com/Automattic/mongoose">plugins</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/12/20/nodejs-2017-12-20-mongodb-mongoose-middleware/" data-id="cl0196xgl002fjs7gfocieh5r" data-title="NodeJS - mongoose middleware" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/middleware/" rel="tag">middleware</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongoose/" rel="tag">mongoose</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-linux-2017-11-01-ubuntu-maintain-power" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/11/01/linux-2017-11-01-ubuntu-maintain-power/" class="article-date">
  <time class="dt-published" datetime="2017-11-01T01:00:00.000Z" itemprop="datePublished">2017-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/11/01/linux-2017-11-01-ubuntu-maintain-power/">Ubuntu/시스템 전원관리</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Ubuntu-시스템-전원관리"><a href="#Ubuntu-시스템-전원관리" class="headerlink" title="Ubuntu - 시스템 전원관리"></a>Ubuntu - 시스템 전원관리</h2><p>우분투 시스템을 명령으로 잠자기, 깨우기가 가능하다. 컴퓨터의 BIOS에서 Wake On Lan이 활성화 되어야한다.</p>
<h3 id="WakeOnLan"><a href="#WakeOnLan" class="headerlink" title="WakeOnLan"></a>WakeOnLan</h3><p>wakeonlan을 활성화 하려면 이더넷 인터페이스를 화인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig</span><br><span class="line">enp5s0    Link encap:Ethernet  HWaddr 0f:1a:92:51:70:a9</span><br><span class="line">          inet addr:192.168.0.10  Bcast:192.168.0.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe20::6595:e3fd:ad6:10f1/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:85121 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:11677 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:25916710 (25.9 MB)  TX bytes:1481803 (1.4 MB)</span><br></pre></td></tr></table></figure>

<p>계속 ethtool 로 WakeOnLan이 활성화 되었는지 확인한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ethtool enp5s0</span><br><span class="line">[sudo] password for USERNAME:</span><br><span class="line">Settings for enp5s0:</span><br><span class="line">  Supported ports: [ TP MII ]</span><br><span class="line">  Supported link modes:   10baseT/Half 10baseT/Full</span><br><span class="line">                          100baseT/Half 100baseT/Full</span><br><span class="line">  Supported pause frame use: No</span><br><span class="line">  Supports auto-negotiation: Yes</span><br><span class="line">  Advertised link modes:  10baseT/Half 10baseT/Full</span><br><span class="line">                          100baseT/Half 100baseT/Full</span><br><span class="line">  Advertised pause frame use: Symmetric Receive-only</span><br><span class="line">  Advertised auto-negotiation: Yes</span><br><span class="line">  Link partner advertised link modes:  10baseT/Half 10baseT/Full</span><br><span class="line">                                       100baseT/Half 100baseT/Full</span><br><span class="line">  Link partner advertised pause frame use: Symmetric Receive-only</span><br><span class="line">  Link partner advertised auto-negotiation: Yes</span><br><span class="line">  Speed: 100Mb/s</span><br><span class="line">  Duplex: Full</span><br><span class="line">  Port: MII</span><br><span class="line">  PHYAD: 0</span><br><span class="line">  Transceiver: internal</span><br><span class="line">  Auto-negotiation: on</span><br><span class="line">  Supports Wake-on: pumbg</span><br><span class="line">  Wake-on: g</span><br><span class="line">  Current message level: 0x00000033 (51)</span><br><span class="line">             drv probe ifdown ifup</span><br><span class="line">  Link detected: yes</span><br></pre></td></tr></table></figure>

<p>내용중에 <em>Supports Wake-on: <letters></em> 항목이 WakeOnLan 지원을 확인할 수 있다. <letters> 문자에 <strong>g</strong> 가 있으면 <em>Magic Packet™</em>을 지원한다. 그러나 <em>d</em> 가 포함되지 않았으면 아래 명령으로 WoL을 활성화 해야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ethtool -s enp5s0 wol g</span><br></pre></td></tr></table></figure>

<p>이 명령은 대부분의 시스템에서 재시동이 필요하다.</p>
<p>시스템이 <em>ifupdown</em> 으로 구성되어 있으면 &#x2F;etc&#x2F;network&#x2F;interfaces 에 아래 같이</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"># The primary network interface</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">        address 10.0.0.1</span><br><span class="line">        netmask 255.255.255.0</span><br><span class="line">        gateway 10.0.0.138</span><br><span class="line">        up ethtool -s eth0 wol g</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/764158/how-to-enable-wake-on-lan-wol-in-ubuntu-16-04">https://askubuntu.com/questions/764158/how-to-enable-wake-on-lan-wol-in-ubuntu-16-04</a></p>
<h3 id="Power-management"><a href="#Power-management" class="headerlink" title="Power management"></a>Power management</h3><p>우분투 14 버전과 이후 버전의 시스템 전력 관리가 다르다.</p>
<h4 id="Ubuntu-14-04-이전"><a href="#Ubuntu-14-04-이전" class="headerlink" title="Ubuntu 14.04 이전"></a>Ubuntu 14.04 이전</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install powermanagement-interface</span><br></pre></td></tr></table></figure>

<p>pmi 명령 혹은 pm-*** 명령을 사용해서 컴퓨터를 재울 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pmi action suspend</span><br><span class="line">pmi action hibernate</span><br></pre></td></tr></table></figure>

<p>노트북에서 다음 명령도 실행된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pm-suspend</span><br><span class="line">sudo pm-hibernate</span><br></pre></td></tr></table></figure>

<h4 id="Ubuntu-15-x2F-16-이상"><a href="#Ubuntu-15-x2F-16-이상" class="headerlink" title="Ubuntu 15 &#x2F; 16 이상"></a>Ubuntu 15 &#x2F; 16 이상</h4><p>대상 컴퓨터를 잠자기 모드 ( suspend)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl suspend</span><br></pre></td></tr></table></figure>

<p>최대절전모드인 Hibernation은 pm-hibernate 명령을 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pm-hibernate</span><br></pre></td></tr></table></figure>

<h4 id="Wake-up-명령"><a href="#Wake-up-명령" class="headerlink" title="Wake-up 명령"></a>Wake-up 명령</h4><p>네트워크에 연결된 장치를 깨우기 위해서 <code>wakeonlan</code> 명령을 사용할 수 있다.</p>
<blockquote>
<p>wakeonlan MAC_ADDRESS</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wakeonlan 00:1d:92:51:70:d8</span><br><span class="line">Sending magic packet to 255.255.255.255:9 with 00:1d:92:51:70:d8</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mac에서는 <strong>homebrew</strong> 로 <code>wakeonlan</code> 명령을 설치해서 사용할 수 있다.</p>
</blockquote>
<h3 id="모니터-다루기"><a href="#모니터-다루기" class="headerlink" title="모니터 다루기"></a>모니터 다루기</h3><p>노트북 화면을 끄거나, 외부 모니터 표시를 잠시 멈출 수 있다.</p>
<h4 id="console-에서"><a href="#console-에서" class="headerlink" title="console 에서"></a>console 에서</h4><p>To turn off monitor in console, the command is the following:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vbetool dpms off    <span class="comment"># turn off</span></span><br><span class="line">sudo vbetool dpms on     <span class="comment"># turn on</span></span><br></pre></td></tr></table></figure>

<p>To regain control of the console on pressing enter key, I suggest</p>
<p>sudo sh -c ‘vbetool dpms off; read ans; vbetool dpms on’</p>
<h4 id="X-windows-상태에서"><a href="#X-windows-상태에서" class="headerlink" title="X windows 상태에서"></a>X windows 상태에서</h4><p><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/253818/manually-turn-off-monitor">https://askubuntu.com/questions/253818/manually-turn-off-monitor</a></p>
<p>데스크탑 윈두우 터미널에서 <code>xrandr</code> 을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~$ xrandr</span><br><span class="line">Screen 0: minimum 8 x 8, current 1280 x 800, maximum 32767 x 32767</span><br><span class="line">LVDS1 connected primary 1280x800+0+0 (normal left inverted right x axis y axis) 331mm x 207mm</span><br><span class="line">   1280x800       59.9*+</span><br><span class="line">   1024x768       60.0</span><br><span class="line">   800x600        60.3     56.2</span><br><span class="line">   640x480        59.9</span><br><span class="line">   640x400        60.0</span><br><span class="line">VGA1 disconnected (normal left inverted right x axis y axis)</span><br><span class="line">VIRTUAL1 disconnected (normal left inverted right x axis y axis)</span><br></pre></td></tr></table></figure>

<p>in terminal(your laptop screen is something like LVDS1, and your external monitor is some thing like VGA).</p>
<h5 id="turn-off-laptop-screen"><a href="#turn-off-laptop-screen" class="headerlink" title="turn off laptop screen"></a>turn off laptop screen</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output LVDS1 --off  <span class="comment"># turn off</span></span><br><span class="line">xrandr --output LVDS1 --on   <span class="comment"># turn on</span></span><br></pre></td></tr></table></figure>

<p>If you need to turn on the laptop screen::</p>
<p>노트북 화면 크기를 조정한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output LVDS --mode 1280x800</span><br></pre></td></tr></table></figure>

<p>외부 모니터를 끄려면</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xrandr --output VGA --off</span><br></pre></td></tr></table></figure>

<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/WakeOnLan">WakeOnLan</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/11/01/linux-2017-11-01-ubuntu-maintain-power/" data-id="cl0196xg30015js7g5xn2dbf3" data-title="Ubuntu/시스템 전원관리" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/" rel="tag">전원관리</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-linux-2017-04-04-ubuntu-nginx-ssl" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/11/01/linux-2017-04-04-ubuntu-nginx-ssl/" class="article-date">
  <time class="dt-published" datetime="2017-11-01T00:00:00.000Z" itemprop="datePublished">2017-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/11/01/linux-2017-04-04-ubuntu-nginx-ssl/">Nginx - HTTPS and Certificate SSL</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Nginx를 HTTPS를 사용할 수 있도록 사설 인증서와 그리고 공인 인증서를 이용해 SSL을 활성화 하는 과정을 정리했다.</p>
<p>Nginx 설치와 서버, 프락시 등의 사용 방법에 대해서는 <a href="!--swig%EF%BF%BC7--">Nginx on Ubuntu&#x2F;Debian</a> 문서를 참조한다.</p>
<h2 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h2><p>TLS는 SSL의 새로운 이름이다. SSL(Secure Socket Layer)는 대칭키 혹은 공개키 방식의 인증을 이룬후 암호화된 통신이 가능하다. TLS에 대해서는 다음 블로그에 자세히 설명되어 있다.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://opentutorials.org/course/228/4894">HTTPS, SSL 설명</a></li>
</ul>
<h3 id="Nginx-HTTPS"><a href="#Nginx-HTTPS" class="headerlink" title="Nginx HTTPS"></a>Nginx HTTPS</h3><p>Nginx 에서 HTTPS를 상용하려면 인증기관을 통해 발급받은 SSL인증서가 필요하다. 여기서는 사용자 개인용 사설 인증서를 만들어 사용한다.</p>
<p>공인 서버 인증서에 대해서는 별도로 다룬다. [^2] 를 참조하면 사설 인증서와 공인 인증서에 대한 설명이 있다.</p>
<h4 id="사설-인증서-설정"><a href="#사설-인증서-설정" class="headerlink" title="사설 인증서 설정"></a>사설 인증서 설정</h4><p>SSL Certificate 파일을 생성하고 저장해 둔다. [^4]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">mkdir</span> /etc/nginx/ssl</span><br><span class="line">$ <span class="built_in">cd</span> /etc/nginx/ssl</span><br></pre></td></tr></table></figure>

<p>OpenSSL을 사용해서 SSL Certificate를 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo openssl genrsa -out privkey.pem 2048</span><br><span class="line">$ sudo openssl req -new -x509 -key privkey.pem -out cacert.pem -days 1095</span><br></pre></td></tr></table></figure>

<p>Generate DH params - 시간이 소요된다 (armv7 1Ghz 에서 30분 이상)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo openssl dhparam 2048 &gt; /etc/nginx/ssl/dhparam.pem</span><br></pre></td></tr></table></figure>

<!--

> $ sudo openssl genrsa -des3 -passout pass:x -out server.pass.key 2048
> $ sudo openssl rsa -passin pass:x -in server.pass.key -out server.key
> $ sudo rm server.pass.key
> $ sudo openssl req -new -key server.key -out server.csr
> $ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt

-->

<h4 id="Nginx-설정에-SSL-활성화"><a href="#Nginx-설정에-SSL-활성화" class="headerlink" title="Nginx 설정에 SSL 활성화"></a>Nginx 설정에 SSL 활성화</h4><p>&#x2F;etc&#x2F;nginx&#x2F;site-available&#x2F;yoursite.com</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 80번 요청을 모두 443 SSL 서버로 바꾼다.</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80 default_server;</span><br><span class="line">    listen [::]:80 default_server;</span><br><span class="line">    add_header Strict-Transport-Security max-age=2592000;</span><br><span class="line">    rewrite ^/.*$ https://$host$request_uri? permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># SSL을 이용한 444번 포트 사용 사이트 정의</span><br><span class="line">server &#123;</span><br><span class="line">    listen      443 default;</span><br><span class="line">    server_name my-site.localhost;</span><br><span class="line"></span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /etc/nginx/ssl/cacert.pem;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/privkey.pem;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_session_cache shared:SSL:5m;</span><br><span class="line">    # Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits</span><br><span class="line">    ssl_dhparam /etc/nginx/ssl/dhparam.pem;</span><br><span class="line"></span><br><span class="line">    # secure settings (A+ at SSL Labs ssltest at time of writing)</span><br><span class="line">    # see https://wiki.mozilla.org/Security/Server_Side_TLS#Nginx</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_ciphers &#x27;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-</span><br><span class="line">RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-</span><br><span class="line">SHA256:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:DHE-RSA-AES256-GCM-S</span><br><span class="line">HA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-CAMELLIA256-SHA:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA</span><br><span class="line">256:DHE-RSA-AES128-SHA:DHE-RSA-SEED-SHA:DHE-RSA-CAMELLIA128-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!</span><br><span class="line">DSS&#x27;;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">    add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;;</span><br><span class="line"></span><br><span class="line">    proxy_buffers 16 64k;</span><br><span class="line">    proxy_buffer_size 128k;</span><br><span class="line"></span><br><span class="line">    server_tokens off;</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">        client_max_body_size 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>설정 파일이 제대로 구성됐는지 테스트해본다.[^1]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure>

<h2 id="Certified-SSL"><a href="#Certified-SSL" class="headerlink" title="Certified SSL"></a>Certified SSL</h2><blockquote>
<p>작업: macbook pro의 thinkbee@ ~&#x2F;Documents&#x2F;SslCert$</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://jetmirshatri.com/build-nginx-with-openssl-1-1-0-on-ubuntu-16-04/">https://jetmirshatri.com/build-nginx-with-openssl-1-1-0-on-ubuntu-16-04/</a></p>
<h3 id="Lets’-Encrypt"><a href="#Lets’-Encrypt" class="headerlink" title="Lets’ Encrypt"></a>Lets’ Encrypt</h3><p>Lets’ Encrypt는 HTTPS를 사용하기 위해 SSL을 구매해야 하는 부분이 HTTPS 보급에 방해된다고 생각해서 SSL을 무료로 제공해서 HTTPS를 보급하기 위해 작년 말에 만들어졌다. 초기에는 Mozilla, Cisco, Akamai, EFF, id entrust 등이 모여서 ISRG(Internet Security Research Group)라는 새로운 SSL 인증기관을 만들어서 올해 SSL을 무료로 제공하겠다고 발표했다. 지금은 이 Lets’ Encrypt에 Facebook, 워드프레스를 만드는 Automattic, shopify 등 많은 회사가 스폰서로 참여하고 있다</p>
<p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/">https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/</a></p>
<h4 id="Lets’-Ecrypt-발급"><a href="#Lets’-Ecrypt-발급" class="headerlink" title="Lets’ Ecrypt 발급"></a>Lets’ Ecrypt 발급</h4><p>Lets’ Ecrypt는 Shell 기반의 발급 방법을 권장한다.</p>
<p>웹을 통한 발급은 인증된 도메인 등록지에서 가능하다고 한다. 쉘 기반 발급을 위해서 ACME protocol client를 사용한다. 정식 클라이언트는 Certbot 을 사용한다.</p>
<p>Certbot을 설치할 수 없는 상황에서는 호환 클라이언트를 사용할 수 있다.</p>
<h4 id="getssl"><a href="#getssl" class="headerlink" title="getssl"></a>getssl</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./getssl -c yourdomain.com</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/.getssl</span><br><span class="line">~/.getssl/getssl.cfg</span><br><span class="line">~/.getssl/yourdomain.com</span><br><span class="line">~/.getssl/yourdomain.com/getssl.cfg</span><br></pre></td></tr></table></figure>

<p>~&#x2F;.getssl&#x2F;getssl.cfg 를 필요시 수정한다.</p>
<p>~&#x2F;.getssl&#x2F;yourdomain.com&#x2F;getssl.cfg 을 수정한다.</p>
<h4 id="Recommended-Certbot"><a href="#Recommended-Certbot" class="headerlink" title="Recommended: Certbot"></a>Recommended: Certbot</h4><p><a target="_blank" rel="noopener" href="https://letsencrypt.org/docs/client-options/">https://letsencrypt.org/docs/client-options/</a></p>
<p>여기서 getssl bash 스크립트를 사용해 본다.</p>
<p>openssl req -new -sha256 -key domain.key -subj “&#x2F;“ <br> -reqexts SAN -config &lt;(cat &#x2F;etc&#x2F;ssl&#x2F;openssl.cnf <br> &lt;(printf “[SAN]\nsubjectAltName&#x3D;DNS:thinkbee.kr,DNS:<a href="http://www.thinkbee.kr,DNS:blog.thinkbee.kr&quot;">www.thinkbee.kr,DNS:blog.thinkbee.kr&quot;</a>))</p>
<h4 id="Certbot-auto"><a href="#Certbot-auto" class="headerlink" title="Certbot-auto"></a>Certbot-auto</h4><p><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-14-04</a></p>
<p><a target="_blank" rel="noopener" href="https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/">https://www.nginx.com/blog/free-certificates-lets-encrypt-and-nginx/</a></p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li><a target="_blank" rel="noopener" href="http://btsweet.blogspot.kr/2014/06/tls-ssl.html">TLS&#x2F;SSL에 대해 알아보아요</a></li>
</ul>
<p>[^2]: <a target="_blank" rel="noopener" href="http://it79.egloos.com/1121724">SSL 인증서 종류</a><br>[^3]: <a target="_blank" rel="noopener" href="https://manual.seafile.com/deploy/https_with_nginx.html">Enabling Https with Nginx</a><br>[^4]: <a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-16-04">Create Self signed SSL</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/11/01/linux-2017-04-04-ubuntu-nginx-ssl/" data-id="cl0196xfs000gjs7ge4fn3d1m" data-title="Nginx - HTTPS and Certificate SSL" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/certificate-ssl/" rel="tag">certificate ssl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssl/" rel="tag">ssl</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-angularjs-2017-11-01-angularjs-test" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/11/01/angularjs-2017-11-01-angularjs-test/" class="article-date">
  <time class="dt-published" datetime="2017-11-01T00:00:00.000Z" itemprop="datePublished">2017-11-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming/">Programming</a>►<a class="article-category-link" href="/categories/Programming/Angularjs/">Angularjs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/11/01/angularjs-2017-11-01-angularjs-test/">Angularjs - Karma Unit Testing</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>angularjs 단위 테스트에 대해 정리한다.</p>
<ul>
<li>angularjs 1.6.x 에서 진행했다.</li>
<li>macOS, Linux 환경에 적합하다.</li>
</ul>
<p>node.js 를 nvm 가상환경에서 구축하고 사용하는 방법에 대해서는 <a href="!--swig%EF%BF%BC40--">Node.js Install with nvm</a> 를 참조하면 된다.</p>
<p>angularjs 단위 테스트에 대해 참고한 문서는 아래 <strong>참고</strong> 섹션에 제공했다.</p>
<h2 id="Angularjs-Testing"><a href="#Angularjs-Testing" class="headerlink" title="Angularjs Testing"></a>Angularjs Testing</h2><p>angularjs는 unit test와 E2E (end to end) 테스트를 제공하고 있다.</p>
<table>
<thead>
<tr>
<th>Unit testing</th>
<th>E2E testing</th>
</tr>
</thead>
<tbody><tr>
<td>코드&#x2F;모듈&#x2F;함수 레벨 테스트팅</td>
<td>웹 UI 테스팅</td>
</tr>
<tr>
<td>서비스, 클래스, 오브젝트 테스트에 적합</td>
<td>웹 서버 필요</td>
</tr>
<tr>
<td>샌드박스, 독립 테스트에 적합</td>
<td>통합 테스트에 적합</td>
</tr>
<tr>
<td></td>
<td>랜더링 결과와 angularjs 데이터 부합 확인</td>
</tr>
<tr>
<td>fast</td>
<td>느리다</td>
</tr>
</tbody></table>
<h3 id="Karma"><a href="#Karma" class="headerlink" title="Karma"></a>Karma</h3><p>자바스크립트 단위 테스트 도구로 테스트 러너 설정시 번거로운 부분을 쉽게 할 수 있다.</p>
<h4 id="시작"><a href="#시작" class="headerlink" title="시작"></a>시작</h4><p>nodejs가 설치되었으면 새 프로젝트 폴더에서 npm init 로 프로젝트를 초기화 하고</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> angularjs-karma-test</span><br><span class="line">$ <span class="built_in">cd</span> angularjs-karma-test</span><br><span class="line">$ npm init</span><br></pre></td></tr></table></figure>

<p>글로벌로 karma와 jasmine framework를 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i –g karma</span><br><span class="line">$ npm i -g jasmine jasmine-core</span><br></pre></td></tr></table></figure>

<blockquote>
<p>만약 karma를 프로젝트의 로컬 dev 모드로 설치한다면 jasmine도 같이 로컬로 설치하자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -D jasmine jasmine-core</span><br><span class="line">$ npm i -D karma</span><br></pre></td></tr></table></figure>
</blockquote>
<p>프로젝트에 angularjs 모듈과 mock 모듈을 설치해 준다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i angular</span><br><span class="line">$ npm i -D angular-mocks</span><br></pre></td></tr></table></figure>

<p>그리고 karma.conf.js 파일을 만들기 위해 <code>karma init</code> 명령을 실행하면 선택 입력 항목을 물어 온다. 기본 설정으로 진행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Which testing framework <span class="keyword">do</span> you want to use ?</span><br><span class="line">Press tab to list possible options. Enter to move to the next question.</span><br><span class="line">&gt; jasmine</span><br><span class="line"></span><br><span class="line">Do you want to use Require.js ?</span><br><span class="line">This will add Require.js plugin.</span><br><span class="line">Press tab to list possible options. Enter to move to the next question.</span><br><span class="line">&gt; no</span><br><span class="line"></span><br><span class="line">Do you want to capture any browsers automatically ?</span><br><span class="line">Press tab to list possible options. Enter empty string to move to the next question.</span><br><span class="line">&gt; Chrome</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line">What is the location of your <span class="built_in">source</span> and <span class="built_in">test</span> files ?</span><br><span class="line">You can use glob patterns, eg. <span class="string">&quot;js/*.js&quot;</span> or <span class="string">&quot;test/**/*Spec.js&quot;</span>.</span><br><span class="line">Enter empty string to move to the next question.</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line">Should any of the files included by the previous patterns be excluded ?</span><br><span class="line">You can use glob patterns, eg. <span class="string">&quot;**/*.swp&quot;</span>.</span><br><span class="line">Enter empty string to move to the next question.</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line">Do you want Karma to watch all the files and run the tests on change ?</span><br><span class="line">Press tab to list possible options.</span><br><span class="line">&gt; <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Config file generated at <span class="string">&quot;/Users/qkboo/www-app/angularjs-karma/karma.conf.js&quot;</span>.</span><br></pre></td></tr></table></figure>

<p>현재 설정을 테스트하기 위해 start 명령으로 시작하면 karma 서버가 시작된다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ karma start</span><br><span class="line">20 12 2017 12:41:02.798:INFO [karma]: Karma v1.7.1 server started at http://0.0.0.0:9876/</span><br></pre></td></tr></table></figure>

<p>데스크탑 환경이면 karma.conf.js 에 지정한 브라우저가 실행되어 보여준다.</p>
<h4 id="테스트-스펙-작성"><a href="#테스트-스펙-작성" class="headerlink" title="테스트 스펙 작성"></a>테스트 스펙 작성</h4><p>실제 테스트 시나리오를 기술하는 jasmine 테스트 스펙 파일은 아래 같은 구조를 가지고 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;테스트 대상 설명&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 테스트 전처리</span></span><br><span class="line">  <span class="title function_">before</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 테스트 후처리</span></span><br><span class="line">  <span class="title function_">after</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// it 마다 매번 실행하는 전처리</span></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// it 마다 매번 실행하는 후처리</span></span><br><span class="line">  <span class="title function_">afterEach</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;테스트 내용 설명&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 테스트</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;테스트 내용 설명&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 테스트</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="테스트-코드-작성"><a href="#테스트-코드-작성" class="headerlink" title="테스트 코드 작성"></a>테스트 코드 작성</h4><p>app&#x2F;src&#x2F;app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&quot;myapp&quot;</span>, [<span class="string">&quot;myapp.service&quot;</span>]);</span><br></pre></td></tr></table></figure>

<p>서비스 모듈을 생성하고 테스트 해보자, test&#x2F;test.service.js 테스트 스펙을 작성해 보자.</p>
<p><strong>app&#x2F;src&#x2F;test&#x2F;test.service.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;서비스 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">module</span>(<span class="string">&quot;myapp.service&quot;</span>)); <span class="comment">//모듈 로드</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&quot;서비스 모듈 버전 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;현재 버전 반환&quot;</span>, <span class="title function_">inject</span>(<span class="keyword">function</span> (<span class="params">version</span>) &#123;</span><br><span class="line">      <span class="title function_">expect</span>(version).<span class="title function_">toEqual</span>(<span class="string">&quot;0.1&quot;</span>);</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>myapp.service.js를 작성한다.</p>
<p><strong>app&#x2F;src&#x2F;service&#x2F;myapp.service.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&quot;myapp.service&quot;</span>, []).<span class="title function_">value</span>(<span class="string">&quot;version&quot;</span>, <span class="string">&quot;0.1&quot;</span>); <span class="comment">//버전</span></span><br></pre></td></tr></table></figure>

<p>karma를 종료했다 다시 실행한다 – (소스 및 스펙 변경이 바로 적용 안된다면…)</p>
<p>이제 테스트 스크립을 실행해 보기 위해 karma.conf.js에 소스 파일들을 명시하자. files는 karma가 실행될 때 로드되는 파일의 path를 가지고 있는 배열이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">files</span>: [</span><br><span class="line">    <span class="string">&#x27;node_modules/angular/angular.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;node_modules/angular-mocks/angular-mocks.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app/src/app.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app/src/service/myapp.service.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app/src/test/test*.js&#x27;</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>앞서 실행한 karma 를 종료하지 않아도 된다. 소스를 추가하고 변경하면 테스트가 자동으로 시작된다. 브라우저는 angular-mock으로 테스트하는 프레임워크로 브라우저 내용에는 별다른 정보가 나타나지 않는다,</p>
<p>터미널에 테스트가 실패하면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6) 서비스 테스트 서비스 모듈 버전 테스트 현재 버전 반환 FAILED</span><br><span class="line">  Expected &#x27;0.1&#x27; to equal &#x27;1.0&#x27;.</span><br></pre></td></tr></table></figure>

<p>버전 정보를 요구되는 값으로 변경하고 저장하면 로그에 다음 같이 테스트 스크립 성공 여부가 표시된다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6): Executed 1 of 1 SUCCESS (0.016 secs / 0.012 secs)</span><br></pre></td></tr></table></figure>

<h4 id="컨트롤러-테스트-작성"><a href="#컨트롤러-테스트-작성" class="headerlink" title="컨트롤러 테스트 작성"></a>컨트롤러 테스트 작성</h4><p>컨트롤러는 Scope을 통해 데이터 바인딩이에 대해 …</p>
<p><strong>app&#x2F;src&#x2F;test&#x2F;test.service.js</strong> 테스트 스펙을 작성해 보자.</p>
<ul>
<li><ol>
<li>컨트롤러 모듈을 들여오고</li>
</ol>
</li>
<li><ol start="2">
<li>필요한 모듈, 여기서 $scope를 주입하고</li>
</ol>
</li>
<li><ol start="3">
<li>모듈에 적재되었는지 테스트한다.</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;서비스 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> scope;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 모듈을 들여오고</span></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">module</span>(<span class="string">&quot;myapp.controller&quot;</span>)); <span class="comment">//모듈 로드</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&quot;컨트롤러 모듈 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//2. 필요한 모듈, 여기서 $scope를 주입하고</span></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;컨트롤러 들여오기&quot;</span>, <span class="title function_">inject</span>([</span><br><span class="line">      <span class="string">&quot;$rootScope&quot;</span>,</span><br><span class="line">      <span class="string">&quot;$controller&quot;</span>,</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">$rootScope, $controller</span>) &#123;</span><br><span class="line">        <span class="comment">// 새 스코프</span></span><br><span class="line">        scope = $rootScope.$new();</span><br><span class="line">        <span class="comment">// 대상 컨트롤러에 의존성을 주입하고 들여온다.</span></span><br><span class="line">        userListController = $controller(<span class="string">&quot;userListController&quot;</span>, &#123;</span><br><span class="line">          <span class="attr">$scope</span>: scope,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    ]));</span><br><span class="line">    <span class="comment">//3. 모듈에 적재되었는지 테스트한다.</span></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;userListController 컨트롤러가 정의되어 있다.&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">expect</span>(userListController).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>실제 컨트롤러 소스 가 없으므로 아래 같이 에러가 발생한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6) 서비스 테스트 컨트롤러 모듈 테스트 userListController 컨트롤러가 정의되어 있다. FAILED</span><br><span class="line">  ReferenceError: userListController is not defined</span><br><span class="line">      at UserContext.&lt;anonymous&gt; (app/src/test/test.controller.js:18:14)</span><br><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6): Executed 2 of 3 (2 FAILED) (0 secs / 0.013 sec</span><br><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6): Executed 3 of 3 (2 FAILED) (0 secs / 0.018 sec</span><br><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6): Executed 3 of 3 (2 FAILED) (0.026 secs / 0.018 secs)</span><br></pre></td></tr></table></figure>

<p>이제 <strong>app&#x2F;src&#x2F;controller&#x2F;myapp.controller.js</strong> 소스를 작성한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">  .<span class="title function_">module</span>(<span class="string">&quot;myapp.controller&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">  .<span class="title function_">controller</span>(<span class="string">&quot;userListController&quot;</span>, [</span><br><span class="line">    <span class="string">&quot;$scope&quot;</span>,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">$scope</span>) &#123;</span><br><span class="line">      $scope.<span class="property">test</span> = <span class="string">&quot;Hello Test!&quot;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]);</span><br></pre></td></tr></table></figure>

<p>이제 myapp.controller.js 를 karma.conf.js에 추가해 준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">files</span>: [</span><br><span class="line">    <span class="string">&#x27;node_modules/angular/angular.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;node_modules/angular-mocks/angular-mocks.js&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;app/src/app.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app/src/service/myapp.service.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app/src/controller/myapp.controller.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;app/src/test/test*.js&#x27;</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>karma를 종료했다 다시 실행한다 – (소스 및 스펙 변경이 바로 적용 안된다면…) 실제 테스트가 제대로 수행되면 알개 같이 SUCCESS 메시지를 볼 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6): Executed 3 of 3 SUCCESS (0.018 secs / 0.013 secs)</span><br></pre></td></tr></table></figure>

<h4 id="컨트롤로-메서드-단위-테스트"><a href="#컨트롤로-메서드-단위-테스트" class="headerlink" title="컨트롤로 메서드 단위 테스트"></a>컨트롤로 메서드 단위 테스트</h4><p>myapp.service 에 ‘UserService’ 를 선언한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">  .<span class="title function_">module</span>(<span class="string">&quot;myapp.service&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">  .<span class="title function_">factory</span>(<span class="string">&quot;UserService&quot;</span>, [</span><br><span class="line">    <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]);</span><br></pre></td></tr></table></figure>

<p>컨트롤러에 userList 배열을 선언해 주낟.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">controller</span>(<span class="string">&#x27;userListController&#x27;</span>, [<span class="string">&#x27;$scope&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope</span>) &#123;</span><br><span class="line">    $scope.<span class="property">test</span> = <span class="string">&quot;Hello Test!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    $scope.<span class="property">userList</span> = [];</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>

<p>test.controller.js 스펙에</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;서비스 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> userListController, scope, mockService;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">module</span>(<span class="string">&quot;myapp.controller&quot;</span>)); <span class="comment">//모듈 로드</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&quot;컨트롤러 모듈 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;컨트롤러 들여오기&quot;</span>, <span class="title function_">inject</span>([</span><br><span class="line">      <span class="string">&quot;$rootScope&quot;</span>,</span><br><span class="line">      <span class="string">&quot;$controller&quot;</span>,</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">$rootScope, $controller</span>) &#123;</span><br><span class="line">        scope = $rootScope.$new();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//임의 사용자 조회 서비스를 만든다.</span></span><br><span class="line">        mockService = &#123;</span><br><span class="line">          <span class="attr">getUserList</span>: <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">            callback.<span class="title function_">call</span>(<span class="literal">null</span>, [&#123; <span class="attr">name</span>: <span class="string">&quot;Hello&quot;</span> &#125;]);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 대상 컨트롤러에 의존성을 주입하고 &#x27;UserService&#x27; 서비스를 주입한다.</span></span><br><span class="line">        userListController = $controller(<span class="string">&quot;userListController&quot;</span>, &#123;</span><br><span class="line">          <span class="attr">$scope</span>: scope,</span><br><span class="line">          <span class="title class_">UserService</span>: mockService,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    ]));</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;userListController 컨트롤러가 정의되어 있다.&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">expect</span>(userListController).<span class="title function_">toBeDefined</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 사용자 조회 함수를 테스트 한다.</span></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;사용자를 조회한다.&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      scope.<span class="title function_">searchUsers</span>();</span><br><span class="line">      <span class="comment">// 1건의 결과가 있다.</span></span><br><span class="line">      <span class="title function_">expect</span>(scope.<span class="property">userList</span>.<span class="property">length</span>).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>컨트롤러에 searchUsers() 함수가 없으므로 에러가 발생한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: scope.searchUsers is not a function</span><br></pre></td></tr></table></figure>

<p>컨트롤러에 UserService를 주입하고, searchusers() 함수를 선언해 준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">controller</span>(<span class="string">&#x27;userListController&#x27;</span>, [<span class="string">&#x27;$scope&#x27;</span>,<span class="string">&#x27;UserService&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope, UserService</span>) &#123;</span><br><span class="line">    $scope.<span class="property">test</span> = <span class="string">&quot;Hello Test!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    $scope.<span class="property">userList</span> = [];</span><br><span class="line"></span><br><span class="line">    $scope.<span class="property">searchUsers</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title class_">UserService</span>.<span class="title function_">getUserList</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        $scope.<span class="property">userList</span> = data;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>

<h4 id="서비스-단위-테스트"><a href="#서비스-단위-테스트" class="headerlink" title="서비스 단위 테스트"></a>서비스 단위 테스트</h4><p>앞서 서비스로 UserService 팩토리를 선언했다. 제대로 들여오는지 테스트 스펙에 다음 같이 선언할 수 있다. test.service.js 스펙에 다음을 추가하자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&quot;UserService가 정의되어 있다&quot;</span>, <span class="title function_">inject</span>(<span class="keyword">function</span> (<span class="params">UserService</span>) &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title class_">UserService</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>이제 getUserList() 함수를 테스트해보자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&quot;UserService.getUserList 가 사용자를 조회한다&quot;</span>, <span class="title function_">inject</span>(<span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  UserService,</span></span><br><span class="line"><span class="params">  $httpBackend</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// http 응답</span></span><br><span class="line">  $httpBackend.<span class="title function_">when</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;sample.json&quot;</span>).<span class="title function_">response</span>([&#123; <span class="attr">name</span>: <span class="string">&quot;test&quot;</span> &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//서비스를 호출한다.</span></span><br><span class="line">  <span class="title class_">UserService</span>.<span class="title function_">getUserList</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    users = respond.<span class="property">data</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  $httpBackend.<span class="title function_">flush</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// http 응답에 1건이 있으므로</span></span><br><span class="line">  <span class="title function_">expect</span>(d.<span class="property">length</span>).<span class="title function_">toBe</span>(<span class="number">1</span>);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>실제 getUserList() 함수가 구현 안되어 있으므로 다음 같이 실패가 나타난다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">20 12 2017 14:59:44.061:INFO [watcher]: Changed file &quot;/Users/qkboo/www-app/angularjs-karma/app/src/test/test.service.js&quot;.</span><br><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6) 서비스 테스트 UserService.getUserList 가 사용자를 조회한다 FAILED</span><br><span class="line">  TypeError: UserService.getUserList is not a function</span><br></pre></td></tr></table></figure>

<p>실제 서비스 객체에 함수를 선언해 주자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">factory</span>(<span class="string">&#x27;UserService&#x27;</span>, [<span class="string">&#x27;$http&#x27;</span>, <span class="keyword">function</span>(<span class="params">$http</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">getUserList</span>: <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      $http.<span class="title function_">get</span>(<span class="string">&#x27;sample.json&#x27;</span>)</span><br><span class="line">        .<span class="title function_">then</span>(callback);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure>

<h4 id="Directive-테스트"><a href="#Directive-테스트" class="headerlink" title="Directive 테스트"></a>Directive 테스트</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;디렉티브 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">module</span>(<span class="string">&quot;myapp.directives&quot;</span>)); <span class="comment">//모듈 로드</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&quot;app-version 디렉티브 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;현재 버전 출력&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">module</span>(<span class="keyword">function</span> (<span class="params">$provide</span>) &#123;</span><br><span class="line">        $provide.<span class="title function_">value</span>(<span class="string">&quot;version&quot;</span>, <span class="string">&quot;TEST_VER&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="title function_">inject</span>([</span><br><span class="line">        <span class="string">&quot;$compile&quot;</span>,</span><br><span class="line">        <span class="string">&quot;$rootScope&quot;</span>,</span><br><span class="line">        <span class="keyword">function</span> (<span class="params">$compile, $rootScope</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> element = $compile(<span class="string">&quot;&lt;span app-version&gt;&lt;/span&gt;&quot;</span>)($rootScope);</span><br><span class="line">          <span class="title function_">expect</span>(element.<span class="title function_">text</span>()).<span class="title function_">toEqual</span>(<span class="string">&quot;TEST_VER&quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">      ]);</span><br><span class="line">    &#125;); <span class="comment">//it</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>디렉티브 모듈을 선언한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">  .<span class="title function_">module</span>(<span class="string">&quot;myapp.directives&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">  .<span class="title function_">directive</span>(<span class="string">&quot;appVersion&quot;</span>, [</span><br><span class="line">    <span class="string">&quot;version&quot;</span>,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">version</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">scope, elm, attrs</span>) &#123;</span><br><span class="line">        elm.<span class="title function_">text</span>(version);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  ]);</span><br></pre></td></tr></table></figure>

<p>추가한 소스를 karma.config.js 에 추가해 준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">files</span>: [</span><br><span class="line">        <span class="string">&#x27;node_modules/angular/angular.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;node_modules/angular-mocks/angular-mocks.js&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;app/src/app.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/service/myapp.service.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/controller/myapp.controller.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/directive/myapp.directive.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/test/test*.js&#x27;</span></span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>

<h4 id="필터-테스트"><a href="#필터-테스트" class="headerlink" title="필터 테스트"></a>필터 테스트</h4><p>필터를 테스트 할 때는 필터를 inject 한 후에 호출하면서 진행한다. 먼저 테스트 스펙을 작성해 보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;필터 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">module</span>(<span class="string">&quot;myapp.filters&quot;</span>)); <span class="comment">//모듈 로드</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> $filter;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&quot;length 필터 테스트&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="title function_">inject</span>(<span class="keyword">function</span> (<span class="params">_$filter_</span>) &#123;</span><br><span class="line">      $filter = _$filter_;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&quot;null 이면 0을 반환&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> length = $filter(<span class="string">&quot;length&quot;</span>);</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title function_">length</span>(<span class="literal">null</span>)).<span class="title function_">toEqual</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>length 필터를 선언한 myapp.filters.js 소스</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&quot;myapp.filters&quot;</span>, []).<span class="title function_">filter</span>(<span class="string">&quot;length&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&quot;&quot;</span> + (text || <span class="string">&quot;&quot;</span>)).<span class="property">length</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>karma.config.js 에 필터 소스를 추가해 준다.</p>
<p>추가한 소스를 karma.config.js 에 추가해 준다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">files</span>: [</span><br><span class="line">        <span class="string">&#x27;node_modules/angular/angular.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;node_modules/angular-mocks/angular-mocks.js&#x27;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;app/src/app.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/service/myapp.service.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/controller/myapp.controller.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/filter/myapp.filters.js&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;app/src/test/test*.js&#x27;</span></span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>

<p>새 컨트롤이 추가된 후 karma를 재시작해서 테스트를 진행한다.</p>
<!--

<br>
<br>
### 샘플 테스팅 프로젝트


#### (윈도우)

> [테스트 프로젝트](https://github.com/eu81273/angularjs-testing-example.git) [^Angularjs 테스팅 - 이론부터 실전] 를 사용하자.

nodejs가 설치되었으면 테스트 프로젝트 폴더에서 karma를 설치한다.

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd angularjs-testing-example</span><br><span class="line">$ npm i –g karma</span><br></pre></td></tr></table></figure>

<p>그리고 필요하다면 karma 실행 파일 경로를 찾아서 PATH 환경변수에 추가해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ which karma</span><br><span class="line">/Users/qkboo/.nvm/versions/node/v8.9.1/bin/karma</span><br></pre></td></tr></table></figure>


<h4 id="inject-를-사용한-컨트롤러-예제"><a href="#inject-를-사용한-컨트롤러-예제" class="headerlink" title="$inject 를 사용한 컨트롤러 예제"></a>$inject 를 사용한 컨트롤러 예제</h4><p><a target="_blank" rel="noopener" href="http://guswnsxodlf.github.io/how-to-test-angularjs-using-karma-jasmine">http://guswnsxodlf.github.io/how-to-test-angularjs-using-karma-jasmine</a></p>
<p>app&#x2F;src&#x2F;app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;myapp&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;test.controller&#x27;</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;test.controller&#x27;</span>, []);</span><br></pre></td></tr></table></figure>

<p>app&#x2F;src&#x2F;controller&#x2F;myapp.controller.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">angular.<span class="title function_">module</span>(<span class="string">&#x27;test.controller&#x27;</span>).<span class="title function_">controller</span>(<span class="string">&#x27;MainCtrl&#x27;</span>, [<span class="string">&#x27;$scope&#x27;</span>, <span class="keyword">function</span>(<span class="params">$scope</span>)&#123;</span><br><span class="line">    $scope.<span class="property">test</span> = <span class="string">&quot;Hello!&quot;</span>;</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>

<p>그리고 karma 테스트 스펙을 작성한다. 테스트 스펙은 외부 모듈을 <a target="_blank" rel="noopener" href="https://docs.angularjs.org/api/ngMock/function/angular.mock.inject">ngMock</a> 를 사용해서 들여온다.</p>
<p>app&#x2F;src&#x2F;test&#x2F;testController.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;컨트롤러 테스트&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">module</span>(<span class="string">&#x27;test.controller&#x27;</span>)); <span class="comment">//모듈 로드</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> $controller;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="title function_">inject</span>(<span class="keyword">function</span>(<span class="params">_$controller_</span>)&#123; <span class="comment">// inject</span></span><br><span class="line">    $controller = _$controller_;</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="title function_">describe</span>(<span class="string">&#x27;MainCtrl&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">// 컨트롤러가 로드됐는지...</span></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;MainCtrl이 정의되어 있다&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">var</span> $scope = &#123;&#125;;</span><br><span class="line">      <span class="keyword">var</span> <span class="title class_">MainCtrl</span> = $controller(<span class="string">&#x27;MainCtrl&#x27;</span>, &#123; <span class="attr">$scope</span>: $scope &#125;);</span><br><span class="line">      <span class="title function_">expect</span>(<span class="title class_">MainCtrl</span>).<span class="title function_">toBeDefined</span>();</span><br><span class="line">      <span class="title function_">expect</span>($scope.<span class="property">test</span>).<span class="title function_">toEqual</span>(<span class="string">&quot;Hello Test!&quot;</span>); <span class="comment">// 변수 테스트</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이제 테스트 스크립을 실행해 보기 위해 karma.conf.js에 소스 파일들을 명시하자. files는 karma가 실행될 때 로드되는 파일의 path를 가지고 있는 배열이다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">files: [</span><br><span class="line">       &#x27;node_modules/angular/angular.js&#x27;,</span><br><span class="line">       &#x27;node_modules/angular-mocks/angular-mocks.js&#x27;,</span><br><span class="line">       &#x27;app/src/app.js&#x27;,</span><br><span class="line">       &#x27;app/src/controller/MainCtrl.js&#x27;,</span><br><span class="line">       &#x27;app/src/test/test*.js&#x27;</span><br><span class="line">   ],</span><br></pre></td></tr></table></figure>

<p>앞서 실행한 karma 를 종료하지 않아도 된다. 소스를 추가하고 변경하면 테스트가 자동으로 시작된다. 브라우저는 angular-mock으로 테스트하는 프레임워크로 브라우저 내용에는 별다른 정보가 나타나지 않는다,</p>
<p>터미널에 테스트가 실패하면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Chrome 63.0.3239 (Mac OS X 10.12.6) 컨트롤러 테스트 MainCtrl MainCtrl이 정의되어 있다 FAILED</span><br><span class="line">  Expected &#x27;Hello!&#x27; to equal &#x27;Hello Test!&#x27;.</span><br></pre></td></tr></table></figure>

<p>–&gt;</p>
<h2 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h2><ul>
<li></li>
<li><a target="_blank" rel="noopener" href="https://docs.angularjs.org/guide/unit-testing">angularjs Unit Testing</a></li>
<li><a target="_blank" rel="noopener" href="http://webframeworks.kr/tutorials/angularjs/angularjs_unit_test/">Angularjs 테스팅</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.outsider.ne.kr/1020">https://blog.outsider.ne.kr/1020</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/11/01/angularjs-2017-11-01-angularjs-test/" data-id="cl0196xk500hzjs7gf73r2kqa" data-title="Angularjs - Karma Unit Testing" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jasmine/" rel="tag">jasmine</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/karma/" rel="tag">karma</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unit-testing/" rel="tag">unit testing</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-python-2017-10-30-jupyter-scitific-pip" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/10/30/python-2017-10-30-jupyter-scitific-pip/" class="article-date">
  <time class="dt-published" datetime="2017-10-30T00:00:00.000Z" itemprop="datePublished">2017-10-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>►<a class="article-category-link" href="/categories/Linux/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/10/30/python-2017-10-30-jupyter-scitific-pip/">Python - 과학계산을 위한 Jupyter(pip)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>과학계산을 위한 Python3 및 pip를 사용한 scipy, jupyter 설치 및 구성을  요약하고 있다.</p>
<p><a target="_blank" rel="noopener" href="https://packaging.python.org/guides/installing-scientific-packages/">https://packaging.python.org/guides/installing-scientific-packages/</a></p>
<h2 id="과학계산을-위한-Python-Jupyter"><a href="#과학계산을-위한-Python-Jupyter" class="headerlink" title="과학계산을 위한 Python Jupyter"></a>과학계산을 위한 Python Jupyter</h2><p>과학계산을 위한 Python 과 Jupyter Notebook 환경을 정리한다. </p>
<ul>
<li>개발 프론트 엔드: Jupyter</li>
<li>과학계산 모듈: numpy, scipy 등</li>
</ul>
<p>Python과 Virtualenv 환경을 더 알고 싶으면 다음 두 링크에 자세한 설명이 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC27--">Python - Install virtualenv on Linux</a></li>
</ul>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>시스템에 Python2, Python3 가 설치되었는지 확인:</p>
<ul>
<li>Ubuntu&#x2F;Debian 계열: Python 2.7, Python 3.5 설치되어 있다.</li>
<li>openSUSE : Python2.7</li>
</ul>
<h4 id="Python-3-설치"><a href="#Python-3-설치" class="headerlink" title="Python 3 설치"></a>Python 3 설치</h4><h4 id="시스템-개발-패키지-설치"><a href="#시스템-개발-패키지-설치" class="headerlink" title="시스템 개발 패키지 설치"></a>시스템 개발 패키지 설치</h4><p>컴파일에 필요한 헤더 등이 포함된 개발자 라이브러리를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install python-dev python-distlib python3-dev python3-distlib</span><br></pre></td></tr></table></figure>

<p>python-dev, python-distlib, apython-setuptools 은 파이썬 개발과 패키징을 지원한다.</p>
<p>apt-get install libfreetype6-dev<br>apt-get install pkg-config<br>apt-get install libpng-dev<br>apt-get install pkg-config</p>
<p>libzmq3-dev은 쥬피터 노트북에서 필요로 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libzmq3-dev</span><br></pre></td></tr></table></figure>

<ul>
<li>python-curses: Python이 (N)Curses Libr에 대한 인터페이스이다</li>
</ul>
<p>Pandas 로 데이터 셋트를 다룰 예정, libgdal-dev 은 geopandas에서 geospatial analysis 에 필요하다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libgdal-dev</span><br></pre></td></tr></table></figure>

<p>For Debian Jessie and Stretch installing the following packages resolves the issue:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libblas3 liblapack3 liblapack-dev libblas-dev</span><br></pre></td></tr></table></figure>

<p>Your next issue is very likely going to be a missing Fortran compiler, resolve this by installing it like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gfortran</span><br></pre></td></tr></table></figure>


<h4 id="pip-설치"><a href="#pip-설치" class="headerlink" title="pip 설치"></a>pip 설치</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python3-pip</span><br></pre></td></tr></table></figure>

<p>python3 설치후 마지막으로 <code>update-alternatives</code> 를 이용해 <code>pip</code> 를 pip3 로 연결해 준다. </p>
<p>다른 배포본에서 필요시 update-alternatives 사용:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 30</span><br></pre></td></tr></table></figure>

<p>시스템 <code>pip</code> 모듈을 최신 버전으로 업그레이드한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install -U pip</span><br><span class="line">sudo pip install -U setuptools</span><br></pre></td></tr></table></figure>



<h3 id="pip로-설치하기"><a href="#pip로-설치하기" class="headerlink" title="pip로 설치하기"></a><code>pip</code>로 설치하기</h3><p>Python2.6부터 User scheme 개념이 도입되며서 <code>pip</code>로 설치하는 패키지를 개별 사용자 환경 위치에 설치할 수 있다. </p>
<p>install 명령에 <code>--user</code> 옵션을 주고 설치한다.[^2] </p>
<ul>
<li>기본으로 리눅스는 <em>~&#x2F;.local</em> 폴더이고, </li>
<li>Mac OS X 는 <em>~&#x2F;Library&#x2F;Python&#x2F;X.Y</em> 에 위치한다.[^3]</li>
<li>그리고 <code>PATH</code> 에 <em>~&#x2F;.local&#x2F;bin</em> 을 추가한다.</li>
</ul>
<h4 id="Scientific-stack"><a href="#Scientific-stack" class="headerlink" title="Scientific stack"></a>Scientific stack</h4><p>아래 같이 사용자 영역에 python3 기반으로 설치해보자, pip 를 파이썬 버전의 site-package 에 모듈을 설치하기 위해서 파이썬 <code>-m</code> 을 사용한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user numpy sympy nose</span><br></pre></td></tr></table></figure>

<p>scipy는 설치 시스템에 따라 시간이 많이 걸린다. 또한 swap 영역을 사용하므로 스왑파일시스템을 활성화 하는 것을 권한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user scipy</span><br></pre></td></tr></table></figure>

<h5 id="error"><a href="#error" class="headerlink" title="error"></a>error</h5><p>스왑 파일시스템을 사용하지 않거나 모자라면 아래 같이 가상메모리 에러 혹은 컴파일 에러가 나는 것 같다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> #warning &quot;Using deprecated NumPy API, disable it by &quot; \</span><br><span class="line">  ^~~~~~~</span><br><span class="line">virtual memory exhausted: Cannot allocate memory</span><br></pre></td></tr></table></figure>


<blockquote>
<p>글쓴이는 OdroidC2, Armbian Stretch 에서 시도했다.</p>
</blockquote>
<h4 id="pandas-및"><a href="#pandas-및" class="headerlink" title="pandas 및"></a>pandas 및</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m pip install --user pandas</span><br></pre></td></tr></table></figure>

<p>파이썬이 있고 pip를 사용하여 패키지를 설치하려면 다음 명령을 사용합니다.</p>
<p>matplotlib  pillow graphviz</p>
<p>scikit-learn </p>
<h4 id="conda를-사용한-패키지-설치"><a href="#conda를-사용한-패키지-설치" class="headerlink" title="conda를 사용한 패키지 설치"></a>conda를 사용한 패키지 설치</h4><p>설치된 파이썬이 있다면 conda 패키지 매니저를 사용하여 다음 명령을 실행하면 필요한 패키지를 모두 얻을 수 있습니다.</p>
<p>conda install numpy scipy scikit-learn matplotlib pandas pillow graphviz python-graphviz<br>pip를 사용한 패키지 설치</p>
<h4 id="설치-확인"><a href="#설치-확인" class="headerlink" title="설치 확인"></a>설치 확인</h4><p>설치되고 사용이 가능한지 확인한다. 다음 두 모듈이 없으면 jupyter 설치가 제대로 안된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import numpy;print(numpy.__version__)&quot;</span><br><span class="line">1.9.3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import scipy;print(scipy.__version__)&quot;</span><br><span class="line">0.16.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import numpy;print(matplotlib.__version__)&quot;</span><br></pre></td></tr></table></figure>

<br>
### Jupyter Notebook

<p>Jupyter는 웹 브라우저를 통해서 IDE 환경을 제공하고, 다양한 언어&#x2F;문법을 지원하는 Kernel 이라는 해석기를 통해 IDE에서 코딩한 결과를 확인할 수 있다. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install --user jupyter </span><br></pre></td></tr></table></figure>

<blockquote>
<p>물론 가상환경이 아닌 시스템 패키지로 설치해도 된다.<br>$ sudo pip install jupyter geopandas osmnx</p>
</blockquote>
<p><code>jupyter-notebook</code>을 실행해 보고, 서버 관련 구성 내용을 설정해서 사용해 보자.</p>
<h5 id="Upgrade-jupyter"><a href="#Upgrade-jupyter" class="headerlink" title="Upgrade jupyter"></a>Upgrade jupyter</h5><p>여기서는 pip 가상머신을 이용하고 있어서 다음 같이 pip install 명령으로 업그레이드 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install -U jupyter</span><br></pre></td></tr></table></figure>


<p>python3 -m pip freeze —local &gt; requirements.txt</p>
<h4 id="서버로-실행"><a href="#서버로-실행" class="headerlink" title="서버로 실행"></a>서버로 실행</h4><p><code>jupyter-notebook</code> 은 로컬 머신에서 브라우저를 실행한다. 여기서는 원격 사용을 위해 다음 같이 시작할 수 있다. <code>[DIR]</code> 에 jupyter-notebook에서 작성한 노트북 파일이 저장된다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter-notebook --no-browser --ip=* --port=8000 [DIR]</span><br><span class="line">[I 02:51:04.797 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:04.800 NotebookApp]</span><br><span class="line"></span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8585/?token=a747472bc9a7c6684829267d2ed0a4cd9a722e</span><br></pre></td></tr></table></figure>

<p>시작후 <code>?token=a.....</code> 부분의 토큰을 복사해 브라우저에 입력후 쥬피터 노트북 사용을 시작한다. 브라우저로 노트북에 접속해서 복사한 토큰을 입력한 후 로그인한다.</p>
<p><img src="/images/python/jupyter5-run.png">{:width&#x3D;”650”}</p>
<br>
### Jupyter 설정 이용

<p>jupyter는 설치된 후에 jupyter 시스템 디렉토리와 사용자 <strong>JUPYTER_DATA_DIR</strong>에 필요한 내용을 저장한다.</p>
<ul>
<li><strong>시스템 디렉토리</strong>: &#x2F;usr&#x2F;local&#x2F;share&#x2F;jupyter&#x2F;</li>
<li><strong>JUPYTER_DATA_DIR</strong> 는 보통 ~&#x2F;.jupyter</li>
</ul>
<p>설정 파일을 이용해서 사용자 비밀번호를 이용해 노트북을 사용할 수 있다.</p>
<p>먼저 실행중인 쥬피터 노트북에서 <code>passwd()</code> 를 실행해 <strong>패스워드 해시 값</strong>을 얻는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">In [<span class="number">2</span>]: passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;sha1:67c9e60bb8b6:9ffede0825894254b2e043ea597d771089e11eed&#x27;</span></span><br></pre></td></tr></table></figure>

<p>패스워드 해시 값을 데이터 디렉토리의 설정 파일에 입력해야 한다.</p>
<h4 id="데이터-설정-파일"><a href="#데이터-설정-파일" class="headerlink" title="데이터 설정 파일"></a>데이터 설정 파일</h4><p>먼저 다음 같이 설정 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /home/foo/.jupyter/jupyter_notebook_config.py</span><br><span class="line">$ <span class="built_in">cd</span> .jupyter &amp;&amp; <span class="built_in">mv</span> jupyter_notebook_config.py mynotebook.py</span><br></pre></td></tr></table></figure>

<p><em>mynotebook.py</em>에 다음을 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#c.NotebookApp.notebook_dir = &#x27;/path/to/notebook_directory&#x27;</span><br><span class="line">c.NotebookApp.base_url = &#x27;http://www.yourdomain.com/notebok&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;&#x27;</span><br><span class="line">c.NotebookApp.port = 8000</span><br><span class="line">c.NotebookApp.port_retries = 50</span><br></pre></td></tr></table></figure>

<p>복사한 패스워드 해시 값을 mynotebook.py 설정 파일 안의 <code>c.NotebookApp.password</code> 항목 주석을 풀고 해시 값을 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = &#x27;sha1:4ee6bb2da3d7:ed76216b87228540e5f5f20fcfa8069cf82686f0&#x27;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 이용해 jupyter-notebook을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --config .jupyter/mybook_config.py [DIR]</span><br></pre></td></tr></table></figure>

<p>이제 jupyter에 접속하려면 다음 같이 패스워드를 묻고 입력한 후에 사용할 수 있다.</p>
<p><img src="/images/python/jupyter-login.png">{:width&#x3D;”650”}</p>
<h4 id="Background-실행"><a href="#Background-실행" class="headerlink" title="Background 실행"></a>Background 실행</h4><p>Jupyter-notebook을 백그라운드로 실행하려면 <code>nohup</code> 을 사용할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">nohup</span> jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>nohup은 재시동시 다시 시작해야 하는 불편한 점이 있다.</p>
<h4 id="crontab-으로-실행"><a href="#crontab-으로-실행" class="headerlink" title="crontab 으로 실행"></a>crontab 으로 실행</h4><p>nohup 과 결합해서 사용해도 좋은 방법으로 crontab 을 사용해 재시동 후 자동으로 시작해 줄 수 있다. 사용자 crontab 을 편집해 다음 같이 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot cd /home/foo; jnohup jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>


<p>이 방법도 사용자가 시작&#x2F;상태확인&#x2F;종료 같은 직접적인 방법을 사용하기는 좀 불편하다.</p>
<p>그래서 upstart의 init.d 를 사용하거나 systemd 의 unit으로 생성해서 사용하는 것이 좋다.</p>
<h4 id="systemd-에서-실행"><a href="#systemd-에서-실행" class="headerlink" title="systemd 에서 실행"></a>systemd 에서 실행</h4><p>systemd unit으로 새로운 unit 파일을 생성해서 기존 <code>systemctl</code> 명령으로 시작&#x2F;상태&#x2F;종료&#x2F;재시작 등의 작업을 할 수 있다. 물론 재시동 관련해서도 완벽히 동작한다.</p>
<p>systemd의 unit 위치는 OS 마다 조금 다른 것 같다. 여기서는 <em>&#x2F;etc&#x2F;systemd&#x2F;system</em> 밑에 <em>jupyter.service</em> 라는 유닉 파일로 직접 작업한다.</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;jupyter.service</li>
</ul>
<p>가상환경을 사용하고 있으므로 systemd unit의 <code>ExecStart</code> 의 python도 가상환경 위치로 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Jupyter-Notebook</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter-notebook.pid</span><br><span class="line">ExecStart=/home/foo/.virtualenvs/jupyter/bin/jupyter-notebook --config=/home/foo/.jupyter/mynotebook.py</span><br><span class="line">User=foo</span><br><span class="line">Group=foo</span><br><span class="line">WorkingDirectory=/home/foo/notebooks</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>그리고 시스템 유닛을 시작해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable jupyter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart jupyter.service</span><br></pre></td></tr></table></figure>



<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="http://pandas.pydata.org/pandas-docs/stable/install.html">Pandas Install</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/install.html">Scipy Install</a></li>
<li><a target="_blank" rel="noopener" href="http://geoffboeing.com/2016/03/scientific-python-raspberry-pi/">Scientific Python on Raspberry Pi</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/10/30/python-2017-10-30-jupyter-scitific-pip/" data-id="cl0196xgt002qjs7g8s741as8" data-title="Python - 과학계산을 위한 Jupyter(pip)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jupyter/" rel="tag">jupyter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter-notebook</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtualenv/" rel="tag">virtualenv</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtualenvwrapper/" rel="tag">virtualenvwrapper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-python-2017-10-30-jupyter-scitific-virtuaenv" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/10/30/python-2017-10-30-jupyter-scitific-virtuaenv/" class="article-date">
  <time class="dt-published" datetime="2017-10-30T00:00:00.000Z" itemprop="datePublished">2017-10-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>►<a class="article-category-link" href="/categories/Linux/Programming/">Programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/10/30/python-2017-10-30-jupyter-scitific-virtuaenv/">Python - 과학계산을 위한 Jupyter(Armbian)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Odroid C2, Raspberry Pi 계열의 ARM CPU를 위한 <strong>Armbian</strong> 에서 과학계산을 위한 Jupyter 설치 및 구성까지 요약하고 있다.</p>
<p><a target="_blank" rel="noopener" href="https://packaging.python.org/guides/installing-scientific-packages/">https://packaging.python.org/guides/installing-scientific-packages/</a></p>
<h2 id="과학계산을-위한-Python-Jupyter"><a href="#과학계산을-위한-Python-Jupyter" class="headerlink" title="과학계산을 위한 Python Jupyter"></a>과학계산을 위한 Python Jupyter</h2><p>과학계산을 위한 Python 모듈을 시스템 패키지로 설치하고 <code>pip</code> 를 사용해서 Jupyter Notebook 을 설치하고 사용하는 과정을 정리했다.</p>
<ul>
<li>개발 프론트 엔드: Jupyter</li>
<li>과학계산 모듈: numpy, scipy, pandas</li>
</ul>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>시스템에 Python2, Python3 가 설치되었는지 확인:</p>
<ul>
<li>Ubuntu&#x2F;Debian 계열: Python 2.7, Python 3.5 설치되어 있다.</li>
<li>openSUSE : Python2.7</li>
</ul>
<h4 id="시스템-개발-패키지-설치"><a href="#시스템-개발-패키지-설치" class="headerlink" title="시스템 개발 패키지 설치"></a>시스템 개발 패키지 설치</h4><p>컴파일에 필요한 헤더 등이 포함된 개발자 라이브러리를 설치한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install python-dev python-distlib python3-dev python3-distlib</span><br></pre></td></tr></table></figure>

<p>python-dev, python-distlib, apython-setuptools 은 파이썬 개발과 패키징을 지원한다.</p>
<h4 id="pip-설치"><a href="#pip-설치" class="headerlink" title="pip 설치"></a>pip 설치</h4><p>배포본에 pip가 설치되어 있지 않으면 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install python3-pip</span><br></pre></td></tr></table></figure>

<p>python3 설치후 마지막으로 <code>update-alternatives</code> 를 이용해 <code>pip</code> 를 pip3 로 연결해 준다. </p>
<p>다른 배포본에서 필요시 update-alternatives 사용:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/pip pip /usr/bin/pip3 30</span><br></pre></td></tr></table></figure>


<h4 id="라이브러리-설치"><a href="#라이브러리-설치" class="headerlink" title="라이브러리 설치"></a>라이브러리 설치</h4><h4 id="Scientific-stack-apt"><a href="#Scientific-stack-apt" class="headerlink" title="Scientific stack - apt"></a>Scientific stack - <code>apt</code></h4><p>시스템 패키지로 과학계산을 지원하는 Python2, Python3 모듈을 설치.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python-numpy python-decorator python-scipy python-matplotlib</span><br><span class="line">$ sudo apt-get install python3-decorator python3-numpy python3-scipy python3-matplotlib</span><br></pre></td></tr></table></figure>

<p>symbolic mathematics 관련 패키지도 설치한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-sympy python-nose</span><br><span class="line">sudo apt-get install python3-sympy python3-nose</span><br></pre></td></tr></table></figure>

<p>설치되고 사용이 가능한지 확인한다. 다음 두 모듈 <em>numpy</em>, <em>scipy</em> 의 버전이 출력되면 된다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import numpy;print(numpy.__version__)&quot;</span></span><br><span class="line">1.12.1</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import scipy;print(scipy.__version__)&quot;</span></span><br><span class="line">0.18.1</span><br></pre></td></tr></table></figure>


<p>여기까지 설치하면 의존성에 관련한 아래 같은 여러 패키지가 함께 설치된다.</p>
<ul>
<li>requests : Python package provides a graceful interface for making HTTP requests, </li>
<li>pil : provides Python imaging capabilities, </li>
<li>scrapy : is a web scraping framework, </li>
<li>geopy provides geocoding and geodesic distance functions, </li>
<li>shapely provides 2D geometry manipulation, </li>
<li>pyproj: provides cartographic transformations. In the second command, jupyter provides interactive coding notebooks, </li>
<li>geopandas spatializes pandas, </li>
<li>OSMnx lets you work with OpenStreetMap street networks.</li>
</ul>
<p>이 패키지들은 별도로 설치를 하고자 하면 <code>pip</code>로 설치하거나 시스템 패키지로 다음 같이 설치 할 수 있다.</p>
<p>Python2 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-requests python-pil python-scrapy python-geopy python-shapely python-pyproj</span><br></pre></td></tr></table></figure>

<p>Python3</p>
<blockquote>
<p>pil -&gt; Pillow</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-requests python3-pil python3-scrapy python3-geopy python3-shapely python3-pyproj</span><br></pre></td></tr></table></figure>


<h4 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h4><p>Pandas 로 데이터 셋트를 다룰 예정이라면 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libgdal-dev</span><br></pre></td></tr></table></figure>

<p>libgdal-dev 은 geopandas에서 geospatial analysis 에 필요하다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-pandas python3-pandas</span><br></pre></td></tr></table></figure>


<br>
### Jupyter Notebook

<p>Jupyter는 웹 브라우저를 통해서 IDE 환경을 제공하고, 다양한 언어&#x2F;문법을 지원하는 Kernel 이라는 해석기를 통해 IDE에서 코딩한 결과를 확인할 수 있다. </p>
<p>Jupyter 관련 모듈을 <code>pip</code>로 사용자 환경에 설치하고 사용하겠다.</p>
<ul>
<li>시스템에 설치된 Python3 와 pip 모듈</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libzmq3-dev</span><br></pre></td></tr></table></figure>

<p>libzmq3-dev은 쥬피터 노트북에서 필요로 한다.</p>
<h4 id="pip"><a href="#pip" class="headerlink" title="pip"></a><code>pip</code></h4><p>먼저 pip를 업그레이드 해준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install -U pip</span><br></pre></td></tr></table></figure>


<p>Python2.6부터 User scheme 개념이 도입되며서 <code>pip</code>로 설치하는 패키지를 개별 사용자 환경 위치에 설치할 수 있다. </p>
<p>install 명령에 <code>--user</code> 옵션을 주고 설치한다.[^2] </p>
<ul>
<li>기본으로 리눅스는 <em>~&#x2F;.local</em> 폴더이고, </li>
<li>Mac OS X 는 <em>~&#x2F;Library&#x2F;Python&#x2F;X.Y</em> 에 위치한다.[^3]</li>
</ul>
<p>그리고 <code>PATH</code> 에 <em>~&#x2F;.local&#x2F;bin</em> 을 추가한다.</p>
<h4 id="Install-Jupyter"><a href="#Install-Jupyter" class="headerlink" title="Install Jupyter"></a>Install Jupyter</h4><p>사용자 환경에서 pip로 Jupyter를 설치한다. Python3 환경에서 설치를 권장하고 있다. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install --user jupyter </span><br></pre></td></tr></table></figure>

<p>그리고 필요하면 Python2에서 설치할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python2 -m pip install --user jupyter </span><br></pre></td></tr></table></figure>

<p><code>jupyter notebook</code>을 실행해 보자.</p>
<h4 id="서버로-실행"><a href="#서버로-실행" class="headerlink" title="서버로 실행"></a>서버로 실행</h4><p><code>jupyter notebook</code> 을 바로 실행하면 로컬 머신의 브라우저를 실행한다. 여기서는 원격 사용을 위해 다음 같이 브라우저 없이 시작한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --no-browser --ip=* --port=8000</span><br><span class="line">[I 02:51:04.797 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:04.800 NotebookApp]</span><br><span class="line"></span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8585/?token=a747472bc9a7c6684829267d2ed0a4cd9a722e</span><br></pre></td></tr></table></figure>

<p>jupyter notebook을 시작하면 콘솔에 <code>?token=a.....</code> 부분의 토큰을 복사해 브라우저에 입력후 쥬피터 노트북 사용을 시작한다. 브라우저로 노트북에 접속해서 복사한 토큰을 입력한 후 로그인한다.</p>
<p><img src="/images/python/jupyter5-run.png">{:width&#x3D;”650”}</p>
<h4 id="사용자-설치-모듈-목록"><a href="#사용자-설치-모듈-목록" class="headerlink" title="사용자 설치 모듈 목록"></a>사용자 설치 모듈 목록</h4><p>여기까지 pip로 사용자 환경 local에 설치한 모듈 목록을 백업해 둘 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip freeze —-local &gt; requirements.txt</span><br></pre></td></tr></table></figure>


<h5 id="Upgrade-jupyter"><a href="#Upgrade-jupyter" class="headerlink" title="Upgrade jupyter"></a>Upgrade jupyter</h5><p>여기서는 pip 가상머신을 이용하고 있어서 다음 같이 pip install 명령으로 업그레이드 할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install -U --user jupyter</span><br></pre></td></tr></table></figure>



<br>
### Jupyter 설정 이용

<p>jupyter는 설치된 후에 jupyter 시스템 디렉토리와 사용자 <strong>JUPYTER_DATA_DIR</strong>에 필요한 내용을 저장한다.</p>
<ul>
<li><strong>시스템 디렉토리</strong>: &#x2F;usr&#x2F;local&#x2F;share&#x2F;jupyter&#x2F;</li>
<li><strong>JUPYTER_DATA_DIR</strong> 는 보통 ~&#x2F;.jupyter</li>
</ul>
<p>설정 파일을 이용해서 사용자 비밀번호를 이용해 노트북을 사용할 수 있다.</p>
<p>먼저 실행중인 쥬피터 노트북에서 <code>passwd()</code> 를 실행해 <strong>패스워드 해시 값</strong>을 얻는다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd</span><br><span class="line">In [<span class="number">2</span>]: passwd()</span><br><span class="line">Enter password:</span><br><span class="line">Verify password:</span><br><span class="line">Out[<span class="number">2</span>]: <span class="string">&#x27;sha1:67c9e60bb8b6:9ffede0825894254b2e043ea597d771089e11eed&#x27;</span></span><br></pre></td></tr></table></figure>

<p>패스워드 해시 값을 데이터 디렉토리의 설정 파일에 입력해야 한다.</p>
<h4 id="데이터-설정-파일"><a href="#데이터-설정-파일" class="headerlink" title="데이터 설정 파일"></a>데이터 설정 파일</h4><p>먼저 다음 같이 설정 파일을 생성한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --generate-config</span><br><span class="line">Writing default config to: /home/foo/.jupyter/jupyter_notebook_config.py</span><br><span class="line">$ <span class="built_in">cd</span> .jupyter &amp;&amp; <span class="built_in">mv</span> jupyter_notebook_config.py mynotebook.py</span><br></pre></td></tr></table></figure>

<p><em>mynotebook.py</em>에 다음을 설정한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#c.NotebookApp.notebook_dir = &#x27;/path/to/notebook_directory&#x27;</span><br><span class="line">c.NotebookApp.base_url = &#x27;http://www.yourdomain.com/notebok&#x27;</span><br><span class="line">c.NotebookApp.password = &#x27;&#x27;</span><br><span class="line">c.NotebookApp.port = 8000</span><br><span class="line">c.NotebookApp.port_retries = 50</span><br></pre></td></tr></table></figure>

<p>복사한 패스워드 해시 값을 mynotebook.py 설정 파일 안의 <code>c.NotebookApp.password</code> 항목 주석을 풀고 해시 값을 입력한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.NotebookApp.password = &#x27;sha1:4ee6bb2da3d7:ed76216b87228540e5f5f20fcfa8069cf82686f0&#x27;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 이용해 jupyter-notebook을 실행한다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook --config .jupyter/mybook_config.py [DIR]</span><br></pre></td></tr></table></figure>

<p>이제 jupyter에 접속하려면 다음 같이 패스워드를 묻고 입력한 후에 사용할 수 있다.</p>
<p><img src="/images/python/jupyter-login.png">{:width&#x3D;”650”}</p>
<h4 id="Background-실행"><a href="#Background-실행" class="headerlink" title="Background 실행"></a>Background 실행</h4><p>Jupyter-notebook을 백그라운드로 실행하려면 <code>nohup</code> 을 사용할 수 있다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">nohup</span> jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>

<p>nohup은 재시동시 다시 시작해야 하는 불편한 점이 있다.</p>
<h4 id="crontab-으로-실행"><a href="#crontab-으로-실행" class="headerlink" title="crontab 으로 실행"></a>crontab 으로 실행</h4><p>nohup 과 결합해서 사용해도 좋은 방법으로 crontab 을 사용해 재시동 후 자동으로 시작해 줄 수 있다. 사용자 crontab 을 편집해 다음 같이 사용할 수 있다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot cd /home/foo; jnohup jupyter notebook --no-browser --ip=* --port=8000 [DIR] &gt; log-jupyter.log &amp;</span><br></pre></td></tr></table></figure>


<p>이 방법도 사용자가 시작&#x2F;상태확인&#x2F;종료 같은 직접적인 방법을 사용하기는 좀 불편하다.</p>
<p>그래서 upstart의 init.d 를 사용하거나 systemd 의 unit으로 생성해서 사용하는 것이 좋다.</p>
<h4 id="systemd-에서-실행"><a href="#systemd-에서-실행" class="headerlink" title="systemd 에서 실행"></a>systemd 에서 실행</h4><p>systemd unit으로 새로운 unit 파일을 생성해서 기존 <code>systemctl</code> 명령으로 시작&#x2F;상태&#x2F;종료&#x2F;재시작 등의 작업을 할 수 있다. 물론 재시동 관련해서도 완벽히 동작한다.</p>
<p>systemd의 unit 위치는 OS 마다 조금 다른 것 같다. 여기서는 <em>&#x2F;etc&#x2F;systemd&#x2F;system</em> 밑에 <em>jupyter.service</em> 라는 유닉 파일로 직접 작업한다.</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;jupyter.service</li>
</ul>
<p>가상환경을 사용하고 있으므로 systemd unit의 <code>ExecStart</code> 의 python도 가상환경 위치로 지정해 주어야 한다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=My Jupyter-Notebook</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/run/jupyter-notebook.pid</span><br><span class="line">ExecStart=/home/foo/.virtualenvs/jupyter/bin/jupyter-notebook --config=/home/foo/.jupyter/mynotebook.py</span><br><span class="line">User=foo</span><br><span class="line">Group=foo</span><br><span class="line">WorkingDirectory=/home/foo/notebooks</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>그리고 시스템 유닛을 시작해 준다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable jupyter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart jupyter.service</span><br></pre></td></tr></table></figure>


<p>현재 서버의 열린 포트는 다음 같이 <code>netstat</code> 명령으로 확인이 가능하다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -tlnp</span><br><span class="line">tcp        0      0 127.0.0.1:8585          0.0.0.0:*              LISTEN      11906/python3</span><br></pre></td></tr></table></figure>

<h3 id="virtualenv-이용"><a href="#virtualenv-이용" class="headerlink" title="virtualenv 이용"></a>virtualenv 이용</h3><p>Python과 Virtualenv 환경을 더 알고 싶으면 다음 두 링크에 자세한 설명이 있다.</p>
<ul>
<li><a href="!--swig%EF%BF%BC28--">Python - Install virtualenv on Linux</a></li>
</ul>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="http://jupyter.org/install">Installing the Jupyter Notebook</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/install.html">Scipy Install</a></li>
<li><a target="_blank" rel="noopener" href="http://geoffboeing.com/2016/03/scientific-python-raspberry-pi/">Scientific Python on Raspberry Pi</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/10/30/python-2017-10-30-jupyter-scitific-virtuaenv/" data-id="cl0196xgu002ujs7gfqer52pm" data-title="Python - 과학계산을 위한 Jupyter(Armbian)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jupyter/" rel="tag">jupyter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter-notebook</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtualenv/" rel="tag">virtualenv</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/virtualenvwrapper/" rel="tag">virtualenvwrapper</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 이전</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">다음 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI/">AI</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Database/">Database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/NodeJS/">NodeJS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Programming/">Programming</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NodeJS/">NodeJS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/NodeJS/Database/">Database</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Photoshop/">Photoshop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/">Programming</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/Angular/">Angular</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/Angularjs/">Angularjs</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Raspberry-Pi/">Raspberry Pi</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Raspberry-Pi/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Raspberry-Pi/Linux/Database/">Database</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Armbian/" rel="tag">Armbian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Artificial-Intelligence/" rel="tag">Artificial Intelligence</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian/" rel="tag">Debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Debian-Strech/" rel="tag">Debian Strech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSON-Web-Token/" rel="tag">JSON Web Token</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT-Toekn/" rel="tag">JWT Toekn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEAP-15-0/" rel="tag">LEAP 15.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEAP-42-3/" rel="tag">LEAP 42.3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numpy/" rel="tag">Numpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Odroid/" rel="tag">Odroid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Odroid-C2/" rel="tag">Odroid C2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Orange-Pi/" rel="tag">Orange Pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberry-Pi/" rel="tag">Raspberry Pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspberry-Pi-3/" rel="tag">Raspberry Pi 3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raspbian/" rel="tag">Raspbian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SD-Card/" rel="tag">SD Card</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scientific/" rel="tag">Scientific</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TensorFlow/" rel="tag">TensorFlow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript-Tutorials/" rel="tag">TypeScript Tutorials</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/X11/" rel="tag">X11</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/amd64/" rel="tag">amd64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular4/" rel="tag">angular4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angularjs/" rel="tag">angularjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/" rel="tag">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm64/" rel="tag">arm64</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/armbian/" rel="tag">armbian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/banana-pi/" rel="tag">banana pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/certificate-ssl/" rel="tag">certificate ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clipping-mask/" rel="tag">clipping-mask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/collages/" rel="tag">collages</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cross-compiler/" rel="tag">cross compiler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debian/" rel="tag">debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firewall/" rel="tag">firewall</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firewalld/" rel="tag">firewalld</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/install/" rel="tag">install</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jasmine/" rel="tag">jasmine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter/" rel="tag">jupyter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter notebook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter-notebook/" rel="tag">jupyter-notebook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/karma/" rel="tag">karma</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leap-15/" rel="tag">leap 15</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leap-42-3/" rel="tag">leap 42.3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvm/" rel="tag">lvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvm2/" rel="tag">lvm2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macOS/" rel="tag">macOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/micro-SD-Card/" rel="tag">micro SD Card</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/middleware/" rel="tag">middleware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongoose/" rel="tag">mongoose</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs-tutorials/" rel="tag">nodejs tutorials</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvm/" rel="tag">nvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/odroid/" rel="tag">odroid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/odroid-c2/" rel="tag">odroid c2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/odroid-c2/" rel="tag">odroid-c2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openSUSE/" rel="tag">openSUSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensuse/" rel="tag">opensuse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensuse-leap-15/" rel="tag">opensuse leap 15</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orange-pi/" rel="tag">orange pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/photoshop/" rel="tag">photoshop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry-pi/" rel="tag">raspberry pi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/" rel="tag">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/synergy/" rel="tag">synergy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/terminal/" rel="tag">terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/" rel="tag">tmux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unit-testing/" rel="tag">unit testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenv/" rel="tag">virtualenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualenvwrapper/" rel="tag">virtualenvwrapper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webdav/" rel="tag">webdav</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%8D%B0%EB%B9%84%EC%95%88/" rel="tag">데비안</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/" rel="tag">데이안</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/" rel="tag">라즈베리파이</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/" rel="tag">라즈비안</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%A6%AC%EB%88%85%EC%8A%A4/" rel="tag">리눅스</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%B0%94%EB%82%98%EB%82%98%ED%8C%8C%EC%9D%B4/" rel="tag">바나나파이</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EB%B0%A9%ED%99%94%EB%B2%BD/" rel="tag">방화벽</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EC%98%A4%EB%A0%8C%EC%A7%80%ED%8C%8C%EC%9D%B4/" rel="tag">오렌지파이</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/" rel="tag">우분투</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/" rel="tag">웹토큰</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EC%9D%B8%EA%B3%B5%EC%A7%80%EB%8A%A5/" rel="tag">인공지능</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/" rel="tag">전원관리</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%ED%8C%8C%EC%9D%B4%EC%8D%AC/" rel="tag">파이썬</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%ED%8C%8C%EC%9D%B4%EC%96%B4%EC%9B%94/" rel="tag">파이어월</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARM/" style="font-size: 10px;">ARM</a> <a href="/tags/Armbian/" style="font-size: 10px;">Armbian</a> <a href="/tags/Artificial-Intelligence/" style="font-size: 12px;">Artificial Intelligence</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/Debian-Strech/" style="font-size: 10px;">Debian Strech</a> <a href="/tags/JSON-Web-Token/" style="font-size: 10px;">JSON Web Token</a> <a href="/tags/JWT-Toekn/" style="font-size: 10px;">JWT Toekn</a> <a href="/tags/LEAP-15-0/" style="font-size: 11px;">LEAP 15.0</a> <a href="/tags/LEAP-42-3/" style="font-size: 11px;">LEAP 42.3</a> <a href="/tags/Linux/" style="font-size: 19px;">Linux</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Numpy/" style="font-size: 10px;">Numpy</a> <a href="/tags/Odroid/" style="font-size: 11px;">Odroid</a> <a href="/tags/Odroid-C2/" style="font-size: 10px;">Odroid C2</a> <a href="/tags/Orange-Pi/" style="font-size: 10px;">Orange Pi</a> <a href="/tags/Raspberry-Pi/" style="font-size: 14px;">Raspberry Pi</a> <a href="/tags/Raspberry-Pi-3/" style="font-size: 19px;">Raspberry Pi 3</a> <a href="/tags/Raspbian/" style="font-size: 14px;">Raspbian</a> <a href="/tags/SD-Card/" style="font-size: 10px;">SD Card</a> <a href="/tags/Scientific/" style="font-size: 10px;">Scientific</a> <a href="/tags/TensorFlow/" style="font-size: 11px;">TensorFlow</a> <a href="/tags/TypeScript/" style="font-size: 14px;">TypeScript</a> <a href="/tags/TypeScript-Tutorials/" style="font-size: 11px;">TypeScript Tutorials</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/X11/" style="font-size: 10px;">X11</a> <a href="/tags/amd64/" style="font-size: 14px;">amd64</a> <a href="/tags/angular4/" style="font-size: 12px;">angular4</a> <a href="/tags/angularjs/" style="font-size: 10px;">angularjs</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/arm64/" style="font-size: 14px;">arm64</a> <a href="/tags/armbian/" style="font-size: 16px;">armbian</a> <a href="/tags/banana-pi/" style="font-size: 10px;">banana pi</a> <a href="/tags/certificate-ssl/" style="font-size: 10px;">certificate ssl</a> <a href="/tags/clipping-mask/" style="font-size: 10px;">clipping-mask</a> <a href="/tags/collages/" style="font-size: 10px;">collages</a> <a href="/tags/cross-compiler/" style="font-size: 10px;">cross compiler</a> <a href="/tags/debian/" style="font-size: 15px;">debian</a> <a href="/tags/firewall/" style="font-size: 12px;">firewall</a> <a href="/tags/firewalld/" style="font-size: 10px;">firewalld</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/install/" style="font-size: 11px;">install</a> <a href="/tags/jasmine/" style="font-size: 10px;">jasmine</a> <a href="/tags/jupyter/" style="font-size: 14px;">jupyter</a> <a href="/tags/jupyter-notebook/" style="font-size: 10px;">jupyter notebook</a> <a href="/tags/jupyter-notebook/" style="font-size: 15px;">jupyter-notebook</a> <a href="/tags/karma/" style="font-size: 10px;">karma</a> <a href="/tags/leap-15/" style="font-size: 11px;">leap 15</a> <a href="/tags/leap-42-3/" style="font-size: 11px;">leap 42.3</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/lvm/" style="font-size: 10px;">lvm</a> <a href="/tags/lvm2/" style="font-size: 10px;">lvm2</a> <a href="/tags/macOS/" style="font-size: 10px;">macOS</a> <a href="/tags/micro-SD-Card/" style="font-size: 10px;">micro SD Card</a> <a href="/tags/middleware/" style="font-size: 10px;">middleware</a> <a href="/tags/mongodb/" style="font-size: 17px;">mongodb</a> <a href="/tags/mongoose/" style="font-size: 11px;">mongoose</a> <a href="/tags/nginx/" style="font-size: 12px;">nginx</a> <a href="/tags/nodejs/" style="font-size: 18px;">nodejs</a> <a href="/tags/nodejs-tutorials/" style="font-size: 10px;">nodejs tutorials</a> <a href="/tags/nvm/" style="font-size: 10px;">nvm</a> <a href="/tags/odroid/" style="font-size: 11px;">odroid</a> <a href="/tags/odroid-c2/" style="font-size: 12px;">odroid c2</a> <a href="/tags/odroid-c2/" style="font-size: 14px;">odroid-c2</a> <a href="/tags/openSUSE/" style="font-size: 17px;">openSUSE</a> <a href="/tags/opensuse/" style="font-size: 11px;">opensuse</a> <a href="/tags/opensuse-leap-15/" style="font-size: 10px;">opensuse leap 15</a> <a href="/tags/orange-pi/" style="font-size: 10px;">orange pi</a> <a href="/tags/photoshop/" style="font-size: 11px;">photoshop</a> <a href="/tags/python/" style="font-size: 18px;">python</a> <a href="/tags/raspberry-pi/" style="font-size: 13px;">raspberry pi</a> <a href="/tags/security/" style="font-size: 11px;">security</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/ssl/" style="font-size: 11px;">ssl</a> <a href="/tags/synergy/" style="font-size: 10px;">synergy</a> <a href="/tags/terminal/" style="font-size: 11px;">terminal</a> <a href="/tags/tmux/" style="font-size: 11px;">tmux</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/unit-testing/" style="font-size: 10px;">unit testing</a> <a href="/tags/virtualenv/" style="font-size: 14px;">virtualenv</a> <a href="/tags/virtualenvwrapper/" style="font-size: 14px;">virtualenvwrapper</a> <a href="/tags/webdav/" style="font-size: 10px;">webdav</a> <a href="/tags/%EB%8D%B0%EB%B9%84%EC%95%88/" style="font-size: 10px;">데비안</a> <a href="/tags/%EB%8D%B0%EC%9D%B4%EC%95%88/" style="font-size: 13px;">데이안</a> <a href="/tags/%EB%9D%BC%EC%A6%88%EB%B2%A0%EB%A6%AC%ED%8C%8C%EC%9D%B4/" style="font-size: 19px;">라즈베리파이</a> <a href="/tags/%EB%9D%BC%EC%A6%88%EB%B9%84%EC%95%88/" style="font-size: 14px;">라즈비안</a> <a href="/tags/%EB%A6%AC%EB%88%85%EC%8A%A4/" style="font-size: 12px;">리눅스</a> <a href="/tags/%EB%B0%94%EB%82%98%EB%82%98%ED%8C%8C%EC%9D%B4/" style="font-size: 10px;">바나나파이</a> <a href="/tags/%EB%B0%A9%ED%99%94%EB%B2%BD/" style="font-size: 10px;">방화벽</a> <a href="/tags/%EC%98%A4%EB%A0%8C%EC%A7%80%ED%8C%8C%EC%9D%B4/" style="font-size: 10px;">오렌지파이</a> <a href="/tags/%EC%9A%B0%EB%B6%84%ED%88%AC/" style="font-size: 15px;">우분투</a> <a href="/tags/%EC%9B%B9%ED%86%A0%ED%81%B0/" style="font-size: 10px;">웹토큰</a> <a href="/tags/%EC%9D%B8%EA%B3%B5%EC%A7%80%EB%8A%A5/" style="font-size: 12px;">인공지능</a> <a href="/tags/%EC%A0%84%EC%9B%90%EA%B4%80%EB%A6%AC/" style="font-size: 10px;">전원관리</a> <a href="/tags/%ED%8C%8C%EC%9D%B4%EC%8D%AC/" style="font-size: 12px;">파이썬</a> <a href="/tags/%ED%8C%8C%EC%9D%B4%EC%96%B4%EC%9B%94/" style="font-size: 10px;">파이어월</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">2월 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">2월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">12월 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">9월 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">10월 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">8월 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">7월 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">6월 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">12월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">11월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">10월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">9월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">7월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">5월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">4월 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">12월 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">2월 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/02/24/hello-world/">blog.thinkbee.kr 이전 작업중입니다.</a>
          </li>
        
          <li>
            <a href="/2020/02/02/linux-2020-02-02-letsencrypt%EB%B0%9C%EA%B8%89/">HTTPS를 위한 공인인증서 - Let&#39;s Encrypt 발급</a>
          </li>
        
          <li>
            <a href="/2019/12/20/linux-2019-12-20-mongodb-config/">MongoDB 구성 설정과 사용자 인증 사용</a>
          </li>
        
          <li>
            <a href="/2019/12/20/linux-2019-12-20-mongodb-4-2-install-arm64/">MongoDB Community Edition 4.2 설치 - ARM64 Ubuntu/Debian Armbian</a>
          </li>
        
          <li>
            <a href="/2019/09/05/python-2019-09-05-OpenSuse-JupyterNotebook-scientific/">openSUSE - 과학계산을 위한 Python, Jupyter Notebook</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>